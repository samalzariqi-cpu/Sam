#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    global start_time
    uptime = str(datetime.now() - start_time).split(".")[0] if start_time else "0"
    
    html = """
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</title>
        <style>
            * {{
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 600px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9em;
            }}
            .status {{
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
            }}
            .status h2 {{
                color: #10b981;
                text-align: center;
                margin-bottom: 20px;
            }}
            .bot-item {{
                background: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIK8J+OrCDYttin2LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2KfYrdiq2LHYp9mB2YogLSBUZWxlZ3JhbSBCb3QK2KfZhNmG2LPYrtipINin2YTZhdit2LPZkdmG2Kkg2YXYuSDZhdmF2YrYstin2Kog2YXYqtmC2K/ZhdipIQoK2KfZhNmF2YXZitiy2KfYqiDYp9mE2KzYr9mK2K/YqToK4pyFINi22LrYtyDZgdin2KbZgiDYp9mE2LPYsdi52KkgKDN4INij2LPYsdi5KQrinIUg2LbYuti3INij2YLZiNmJIC0g2K3YrNmFINi12LrZitixINis2K/Yp9mLCuKchSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmI2YfYp9iqINmF2YfZhdinINmD2KfZhiDYrdis2YXZh9inICjYqtmC2LPZitmFINiq2YTZgtin2KbZiikK4pyFINiz2KzZhCDYo9iu2LfYp9ihIHR4dCDZhdmB2LXZhArinIUg2LPYrNmEINiq2YLYr9mFINmF2Lkg2KPYs9io2KfYqCDYp9mE2KrYo9iu2YrYsQrinIUg2K/YudmFINis2YXZiti5INij2K3YrNin2YUg2KfZhNmB2YrYr9mK2YjZh9in2KoKCtin2YTZhdiq2LfZhNio2KfYqjoKLSBQeXRob24gMy44KwotIEZGbXBlZyAoc3VkbyBhcHQgaW5zdGFsbCBmZm1wZWcpCi0gcGlwIGluc3RhbGwgcHl0aG9uLXRlbGVncmFtLWJvdCByZXF1ZXN0cyB0cWRtCgrYp9mE2KfYs9iq2K7Yr9in2YU6CjEuINi52K/ZhCBCT1RfVE9LRU4g2KPYr9mG2KfZhwoyLiDYtNi62YQ6IHB5dGhvbjMgdmlkZW9fY29tcHJlc3Nvcl9ib3RfcHJvLnB5CjMuINij2LHYs9mEINix2KfYqNi3INin2YTZgdmK2K/ZitmIINmE2YTYqNmI2KoKIiIiCgppbXBvcnQgb3MKaW1wb3J0IGFzeW5jaW8KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCByZQppbXBvcnQgdGltZQppbXBvcnQgbG9nZ2luZwppbXBvcnQganNvbgppbXBvcnQgemlwZmlsZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgVXBkYXRlLCBJbmxpbmVLZXlib2FyZEJ1dHRvbiwgSW5saW5lS2V5Ym9hcmRNYXJrdXAKZnJvbSB0ZWxlZ3JhbS5leHQgaW1wb3J0IEFwcGxpY2F0aW9uLCBDb21tYW5kSGFuZGxlciwgTWVzc2FnZUhhbmRsZXIsIENhbGxiYWNrUXVlcnlIYW5kbGVyLCBDb250ZXh0VHlwZXMsIGZpbHRlcnMKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIOKame+4jyDYp9mE2KXYudiv2KfYr9in2KogLSDYudiv2YQg2YfZhtinINmB2YLYtyEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpCT1RfVE9LRU4gPSAiODUwNDY0ODU1MDpBQUdINFRvNHZSdDczRjBlT0hIQlIzQnNEOUlTYS0wekF0SSIgICMg8J+RiCDYtti5INiq2YjZg9mGINin2YTYqNmI2Kog2YfZhtinClRFTVBfRElSID0gIi4vdGVtcF92aWRlb3MiICAjINmF2KzZhNivINin2YTZhdmE2YHYp9iqINin2YTZhdik2YLYqtipCkxPR1NfRElSID0gIi4vbG9ncyIgICMg2YXYrNmE2K8g2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoQpNQVhfVEVMRUdSQU1fU0laRV9NQiA9IDUwICAjINit2K8g2LHZgdi5INin2YTZhdmE2YHYp9iqINmB2YogVGVsZWdyYW0gKNmE2YPZhCDYrNiy2KEpCk1BWF9GSUxFX1BBUlRTID0gMTAgICMg2LnYr9ivINin2YTYo9is2LLYp9ihINin2YTYo9mC2LXZiSDZhNmE2KrZgtiz2YrZhQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+TnSDYpdi52K/Yp9ivINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mFIChMb2dnaW5nKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIERldGFpbGVkTG9nZ2VyOgogICAgIiIi2YHYptipINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mF2Kkg2YXYuSDYrdmB2Lgg2KfZhNij2K7Yt9in2KEg2YHZiiB0eHQiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ3NfZGlyPUxPR1NfRElSKToKICAgICAgICBzZWxmLmxvZ3NfZGlyID0gUGF0aChsb2dzX2RpcikKICAgICAgICBzZWxmLmxvZ3NfZGlyLm1rZGlyKGV4aXN0X29rPVRydWUpCiAgICAgICAgc2VsZi5jdXJyZW50X3Nlc3Npb25fbG9nID0gTm9uZQogICAgICAgIHNlbGYuc2V0dXBfbG9nZ2luZygpCiAgICAKICAgIGRlZiBzZXR1cF9sb2dnaW5nKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YbYuNin2YUg2KfZhNiq2LPYrNmK2YQiIiIKICAgICAgICBsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgICAgICAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShuYW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnLAogICAgICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8KICAgICAgICApCiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKICAgIAogICAgZGVmIHN0YXJ0X3Nlc3Npb24oc2VsZiwgdXNlcl9pZCwgdmlkZW9fdXJsKToKICAgICAgICAiIiLYqNiv2KEg2KzZhNiz2Kkg2KzYr9mK2K/YqSDZiNil2YbYtNin2KEg2YXZhNmBINiz2KzZhCIiIgogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWRfJUglTSVTIikKICAgICAgICBsb2dfZmlsZW5hbWUgPSBmInNlc3Npb25fe3VzZXJfaWR9X3t0aW1lc3RhbXB9LnR4dCIKICAgICAgICBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cgPSBzZWxmLmxvZ3NfZGlyIC8gbG9nX2ZpbGVuYW1lCiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgZi53cml0ZSgi8J+OrCDYs9is2YQg2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIIC0gVGVsZWdyYW0gQm90XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgICAgICBmLndyaXRlKGYi4o+wINin2YTYqtin2LHZitiuINmI2KfZhNmI2YLYqjoge2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIikKICAgICAgICAgICAgZi53cml0ZShmIvCfkaQg2YXYudix2YEg2KfZhNmF2LPYqtiu2K/ZhToge3VzZXJfaWR9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYi8J+UlyDYsdin2KjYtyDYp9mE2YHZitiv2YrZiDoge3ZpZGVvX3VybH1cblxuIikKICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgIGYud3JpdGUoIvCfk4sg2LPYrNmEINin2YTYudmF2YTZitin2Ko6XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgIAogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKICAgIAogICAgZGVmIGxvZyhzZWxmLCBtZXNzYWdlLCBsZXZlbD0iSU5GTyIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2LHYs9in2YTYqSDZgdmKINin2YTYs9is2YQg2YjYp9mE2YXZhNmBIiIiCiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBsb2dfbWVzc2FnZSA9IGYiW3t0aW1lc3RhbXB9XSBbe2xldmVsfV0ge21lc3NhZ2V9IgogICAgICAgIAogICAgICAgICMg2LfYqNin2LnYqSDZgdmKINin2YTZg9mI2YbYs9mI2YQKICAgICAgICBpZiBsZXZlbCA9PSAiRVJST1IiOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihtZXNzYWdlKQogICAgICAgIGVsaWYgbGV2ZWwgPT0gIldBUk5JTkciOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgIAogICAgICAgICMg2K3Zgdi4INmB2Yog2KfZhNmF2YTZgQogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShsb2dfbWVzc2FnZSArICJcbiIpCiAgICAKICAgIGRlZiBsb2dfZXJyb3Ioc2VsZiwgZXJyb3IsIGNvbnRleHQ9IiIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2K7Yt9ijINmF2YHYtdmEIiIiCiAgICAgICAgZXJyb3JfZGV0YWlscyA9IHsKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpLAogICAgICAgICAgICAnY29udGV4dCc6IGNvbnRleHQsCiAgICAgICAgICAgICdlcnJvcl90eXBlJzogdHlwZShlcnJvcikuX19uYW1lX18sCiAgICAgICAgICAgICdlcnJvcl9tZXNzYWdlJzogc3RyKGVycm9yKSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2VsZi5sb2coZiLinYwg2K7Yt9ijINmB2Yoge2NvbnRleHR9OiB7ZXJyb3J9IiwgIkVSUk9SIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2c6CiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2csICdhJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoIuKdjCDYqtmB2KfYtdmK2YQg2KfZhNiu2LfYozpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhlcnJvcl9kZXRhaWxzLCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD0yKSkKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuXG4iKQogICAgCiAgICBkZWYgZmluaXNoX3Nlc3Npb24oc2VsZiwgc3VjY2Vzcz1UcnVlLCBmaW5hbF9zaXplPU5vbmUpOgogICAgICAgICIiItil2YbZh9in2KEg2KfZhNis2YTYs9ipINmI2K3Zgdi4INin2YTZhdmE2K7YtSIiIgogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZSgiXG4iICsgIj0iICogODAgKyAiXG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgi8J+TiiDZhdmE2K7YtSDYp9mE2KzZhNiz2Kk6XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYi4o+wINmI2YLYqiDYp9mE2KfZhtiq2YfYp9ihOiB7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZShmIuKchSDYp9mE2K3Yp9mE2Kk6IHsn2YbYrNitJyBpZiBzdWNjZXNzIGVsc2UgJ9mB2LTZhCd9XG4iKQogICAgICAgICAgICAgICAgaWYgZmluYWxfc2l6ZToKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYi8J+TpiDYp9mE2K3YrNmFINin2YTZhtmH2KfYptmKOiB7ZmluYWxfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgIAogICAgZGVmIGdldF9sb2dfZmlsZShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTZgSDYp9mE2LPYrNmEINin2YTYrdin2YTZiiIiIgogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfk4og2YXYr9mK2LEg2KfZhNiq2YLYr9mFIChQcm9ncmVzcyBNYW5hZ2VyKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFByb2dyZXNzTWFuYWdlcjoKICAgICIiItil2K/Yp9ix2Kkg2YjYudix2LYg2KfZhNiq2YLYr9mFINmF2Lkg2YPYtNmBINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LEiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ2dlcik6CiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnZXIKICAgICAgICBzZWxmLnN0YXJ0X3RpbWUgPSBOb25lCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gTm9uZQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSAwCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5waGFzZSA9ICIiCiAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zID0gW10KICAgIAogICAgZGVmIHN0YXJ0KHNlbGYsIHBoYXNlLCB0b3RhbF9zaXplPTApOgogICAgICAgICIiItio2K/YoSDZhdix2K3ZhNipINis2K/Zitiv2KkiIiIKICAgICAgICBzZWxmLnBoYXNlID0gcGhhc2UKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMgPSBbXQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfmoAg2KjYr9ihINmF2LHYrdmE2Kk6IHtwaGFzZX0iKQogICAgCiAgICBkZWYgdXBkYXRlKHNlbGYsIGN1cnJlbnQsIHRvdGFsPU5vbmUpOgogICAgICAgICIiItiq2K3Yr9mK2Ksg2KfZhNiq2YLYr9mFIiIiCiAgICAgICAgaWYgdG90YWw6CiAgICAgICAgICAgIHNlbGYudG90YWxfc2l6ZSA9IHRvdGFsCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSBjdXJyZW50CiAgICAgICAgCiAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID0gY3VycmVudF90aW1lIC0gc2VsZi5sYXN0X3VwZGF0ZV90aW1lCiAgICAgICAgCiAgICAgICAgIyDZg9i02YEg2KfZhNiq2KPYrtmK2LEKICAgICAgICBpZiB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID4gNTogICMg2KPZg9ir2LEg2YXZhiA1INir2YjYp9mG2Y0g2KjYr9mI2YYg2KrYrdiv2YrYqwogICAgICAgICAgICBwcm9ncmVzc19jaGFuZ2UgPSBjdXJyZW50IC0gc2VsZi5sYXN0X3Byb2dyZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm9ncmVzc19jaGFuZ2UgPT0gMDoKICAgICAgICAgICAgICAgIHJlYXNvbiA9ICLimqDvuI8g2YTYpyDYqtmI2KzYryDYrdix2YPYqSAtINix2KjZhdinINmF2LTZg9mE2Kkg2YHZiiDYp9mE2LTYqNmD2KkiCiAgICAgICAgICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMuYXBwZW5kKHJlYXNvbikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhyZWFzb24sICJXQVJOSU5HIikKICAgICAgICAgICAgZWxpZiBwcm9ncmVzc19jaGFuZ2UgPCAxMDI0ICogMTAwOiAgIyDYo9mC2YQg2YXZhiAxMDBLQgogICAgICAgICAgICAgICAgcmVhc29uID0gZiLwn5CMINiz2LHYudipINio2LfZitim2Kkg2KzYr9in2YsgLSB7cHJvZ3Jlc3NfY2hhbmdlIC8gMTAyNDouMmZ9IEtCINmB2Yoge3RpbWVfc2luY2VfbGFzdF91cGRhdGU6LjFmfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zLmFwcGVuZChyZWFzb24pCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2cocmVhc29uLCAiV0FSTklORyIpCiAgICAgICAgCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgc2VsZi5sYXN0X3Byb2dyZXNzID0gY3VycmVudAogICAgCiAgICBkZWYgZ2V0X3Byb2dyZXNzX3RleHQoc2VsZik6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhti1INin2YTYqtmC2K/ZhSIiIgogICAgICAgIGlmIHNlbGYudG90YWxfc2l6ZSA+IDA6CiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAoc2VsZi5kb3dubG9hZGVkX3NpemUgLyBzZWxmLnRvdGFsX3NpemUpICogMTAwCiAgICAgICAgICAgIGRvd25sb2FkZWRfbWIgPSBzZWxmLmRvd25sb2FkZWRfc2l6ZSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgIHRvdGFsX21iID0gc2VsZi50b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHNlbGYuc3RhcnRfdGltZQogICAgICAgICAgICBpZiBzZWxmLmRvd25sb2FkZWRfc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICBzcGVlZCA9IHNlbGYuZG93bmxvYWRlZF9zaXplIC8gZWxhcHNlZAogICAgICAgICAgICAgICAgc3BlZWRfbWIgPSBzcGVlZCAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICByZW1haW5pbmdfYnl0ZXMgPSBzZWxmLnRvdGFsX3NpemUgLSBzZWxmLmRvd25sb2FkZWRfc2l6ZQogICAgICAgICAgICAgICAgZXRhID0gcmVtYWluaW5nX2J5dGVzIC8gc3BlZWQgaWYgc3BlZWQgPiAwIGVsc2UgMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIGYi8J+TpSB7c2VsZi5waGFzZX1cbiIKICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNiq2YLYr9mFOiB7cGVyY2VudGFnZTouMWZ9JVxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+TpiB7ZG93bmxvYWRlZF9tYjouMWZ9IC8ge3RvdGFsX21iOi4xZn0g2YXZitis2KfYqNin2YrYqlxuIgogICAgICAgICAgICAgICAgICAgIGYi4pqhINin2YTYs9ix2LnYqToge3NwZWVkX21iOi4yZn0g2YXZitis2KfYqNin2YrYqi/Yq9in2YbZitipXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7HvuI8g2KfZhNmI2YLYqiDYp9mE2YXYqtio2YLZijoge2ludChldGEpfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIHJldHVybiBmIuKPsyB7c2VsZi5waGFzZX0uLi4iCiAgICAKICAgIGRlZiBnZXRfZGVsYXlfc3VtbWFyeShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTYrti1INin2YTYqtij2K7Zitix2KfYqiIiIgogICAgICAgIGlmIHNlbGYuZGVsYXlfcmVhc29uczoKICAgICAgICAgICAgcmV0dXJuICLwn5SNINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LE6XG4iICsgIlxuIi5qb2luKGYiICDigKIge3J9IiBmb3IgciBpbiBzZWxmLmRlbGF5X3JlYXNvbnNbLTM6XSkKICAgICAgICByZXR1cm4gIiIKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfjqwg2YHYptipINi22KfYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdit2LPZkdmG2KkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBWaWRlb0NvbXByZXNzb3I6CiAgICAiIiLZgdim2Kkg2LTYp9mF2YTYqSDZhNiq2K3ZhdmK2YQg2YjYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KjYs9ix2LnYqSDZgdin2KbZgtipIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0ZW1wX2Rpcj1URU1QX0RJUiwgbG9nZ2VyPU5vbmUpOgogICAgICAgICIiItiq2YfZitim2Kkg2KfZhNi22KfYuti3IiIiCiAgICAgICAgc2VsZi50ZW1wX2RpciA9IFBhdGgodGVtcF9kaXIpCiAgICAgICAgc2VsZi50ZW1wX2Rpci5ta2RpcihleGlzdF9vaz1UcnVlKQogICAgICAgIHNlbGYubG9nZ2VyID0gbG9nZ2VyCiAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyID0gUHJvZ3Jlc3NNYW5hZ2VyKGxvZ2dlcikKICAgICAgICBsb2dnZXIubG9nKGYi8J+TgSDYqtmFINil2YbYtNin2KEg2YXYrNmE2K8g2YXYpNmC2Ko6IHtzZWxmLnRlbXBfZGlyfSIpCiAgICAKICAgIGRlZiBleHRyYWN0X2dvb2dsZV9kcml2ZV9pZChzZWxmLCB1cmwpOgogICAgICAgICIiItin2LPYqtiu2LHYp9isINmF2LnYsdmBINin2YTZhdmE2YEg2YXZhiDYsdin2KjYtyBHb29nbGUgRHJpdmUiIiIKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgcidpZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcicvZC8oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcidvcGVuXD9pZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHVybCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X2dvb2dsZV9kcml2ZV9kb3dubG9hZF91cmwoc2VsZiwgZmlsZV9pZCk6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsSDZhdmGIEdvb2dsZSBEcml2ZSIiIgogICAgICAgIHJldHVybiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkJmNvbmZpcm09dCIKICAgIAogICAgZGVmIF9kb3dubG9hZF9mcm9tX2dvb2dsZV9kcml2ZShzZWxmLCBmaWxlX2lkLCBvdXRwdXRfcGF0aCwgY2h1bmtfc2l6ZT02NTUzNik6CiAgICAgICAgIiIiCiAgICAgICAg2KrYrdmF2YrZhCDYs9ix2YrYuSDZhdmGIEdvb2dsZSBEcml2ZSDZhdi5INmF2LnYp9mE2KzYqSDYrNmF2YrYuSDYo9mG2YjYp9i5INin2YTZhdmE2YHYp9iqCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+UhCDZhdit2KfZiNmE2Kkg2KfZhNiq2K3ZhdmK2YQg2YXZhiBHb29nbGUgRHJpdmUuLi4iKQogICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDZhdmGIEdvb2dsZSBEcml2ZSIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINin2LPYqtiu2K/Yp9mFIGdkb3duINil2LDYpyDZg9in2YYg2YXYqtmI2YHYsdin2YsgKNij2LPYsdi5INi32LHZitmC2KkpCiAgICAgICAgICAgIGltcG9ydCBnZG93bgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIuKchSDYp9iz2KrYrtiv2KfZhSBnZG93biDZhNmE2KrYrdmF2YrZhCDYp9mE2LPYsdmK2LkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/aWQ9e2ZpbGVfaWR9IgogICAgICAgICAgICBvdXRwdXQgPSBnZG93bi5kb3dubG9hZCh1cmwsIG91dHB1dF9wYXRoLCBxdWlldD1GYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG91dHB1dCBpcyBOb25lOgogICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi2YHYtNmEINin2YTYqtit2YXZitmEINio2KfYs9iq2K7Yr9in2YUgZ2Rvd24iKQogICAgICAgICAgICAKICAgICAgICAgICAgZmluYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQg2KjZhtis2KfYrSEg2KfZhNit2KzZhToge2ZpbmFsX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIG91dHB1dF9wYXRoCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCLimqDvuI8gZ2Rvd24g2LrZitixINmF2KrZiNmB2LHYjCDYp9iz2KrYrtiv2KfZhSDYp9mE2LfYsdmK2YLYqSDYp9mE2YrYr9mI2YrYqS4uLiIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2dfZXJyb3IoZSwgItiq2K3ZhdmK2YQgZ2Rvd24iKQogICAgICAgIAogICAgICAgICMg2KfZhNi32LHZitmC2Kkg2KfZhNmK2K/ZiNmK2Kkg2KfZhNmF2K3Ys9mR2YbYqQogICAgICAgIHNlc3Npb24gPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgICAgICAKICAgICAgICBhdHRlbXB0cyA9IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ3VybCc6IGYiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2lkPXtmaWxlX2lkfSZleHBvcnQ9ZG93bmxvYWQmY29uZmlybT10IiwKICAgICAgICAgICAgICAgICduYW1lJzogJ0RpcmVjdCB3aXRoIGNvbmZpcm09dCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgJ3VybCc6IGYiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2lkPXtmaWxlX2lkfSZleHBvcnQ9ZG93bmxvYWQiLAogICAgICAgICAgICAgICAgJ25hbWUnOiAnV2l0aCBjb29raWVzJywKICAgICAgICAgICAgICAgICd1c2VfY29va2llcyc6IFRydWUKICAgICAgICAgICAgfSwKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIGF0dGVtcHRfbnVtLCBhdHRlbXB0IGluIGVudW1lcmF0ZShhdHRlbXB0cywgMSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflIQg2KfZhNmF2K3Yp9mI2YTYqSB7YXR0ZW1wdF9udW19OiB7YXR0ZW1wdFsnbmFtZSddfS4uLiIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQuZ2V0KCd1c2VfY29va2llcycpOgogICAgICAgICAgICAgICAgICAgIGluaXRfcmVzcG9uc2UgPSBzZXNzaW9uLmdldCgKICAgICAgICAgICAgICAgICAgICAgICAgZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/aWQ9e2ZpbGVfaWR9IiwKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9NjAKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5nZXQoCiAgICAgICAgICAgICAgICAgICAgYXR0ZW1wdFsndXJsJ10sCiAgICAgICAgICAgICAgICAgICAgc3RyZWFtPVRydWUsCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD0xMjAsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dfcmVkaXJlY3RzPVRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29udGVudF90eXBlID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAndGV4dC9odG1sJyBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPINi12YHYrdipIEhUTUwgLSDZhdit2KfZiNmE2Kkg2KfYs9iq2K7Ysdin2Kwg2KfZhNix2KfYqNi3Li4uIikKICAgICAgICAgICAgICAgICAgICBjb250ZW50ID0gcmVzcG9uc2UudGV4dAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHBhdHRlcm5zID0gWwogICAgICAgICAgICAgICAgICAgICAgICByJ2hyZWY9IihodHRwczovL2RyaXZlXC51c2VyY29udGVudFwuZ29vZ2xlXC5jb20vZG93bmxvYWRbXiJdKykiJywKICAgICAgICAgICAgICAgICAgICAgICAgcidocmVmPSIoL3VjXD9leHBvcnQ9ZG93bmxvYWQmYW1wO2NvbmZpcm09W14iXSsmYW1wO2lkPScgKyBmaWxlX2lkICsgcicpIicsCiAgICAgICAgICAgICAgICAgICAgXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkX3VybCA9IE5vbmUKICAgICAgICAgICAgICAgICAgICBmb3IgcGF0dGVybiBpbiBwYXR0ZXJuczoKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocGF0dGVybiwgY29udGVudCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZF91cmwgPSBtYXRjaC5ncm91cCgxKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZG93bmxvYWRfdXJsLnN0YXJ0c3dpdGgoJy8nKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZF91cmwgPSAnaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tJyArIGRvd25sb2FkX3VybC5yZXBsYWNlKCcmYW1wOycsICcmJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2LHYp9io2Lcg2KfZhNiq2K3ZhdmK2YQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBkb3dubG9hZF91cmw6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gc2Vzc2lvbi5nZXQoZG93bmxvYWRfdXJsLCBzdHJlYW09VHJ1ZSwgdGltZW91dD0xMjApCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAndGV4dC9odG1sJyBpbiBjb250ZW50X3R5cGU6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRvdGFsX3NpemUgPSBpbnQocmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJywgMCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHRvdGFsX3NpemUgPiAwOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2K3YrNmFINin2YTZhdmE2YE6IHt0b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIuc3RhcnQoItiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YgiLCB0b3RhbF9zaXplKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINin2YTYqtit2YXZitmEINio2KfZhNmC2LfYuSDYp9mE2YPYqNmK2LHYqSAo2KPYs9ix2LkpCiAgICAgICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9wYXRoLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT1jaHVua19zaXplKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGNodW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRlZF9zaXplICs9IGxlbihjaHVuaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci51cGRhdGUoZG93bmxvYWRlZF9zaXplLCB0b3RhbF9zaXplKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICBmaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBmaW5hbF9zaXplIDwgMTAyNCAqIDEwMDoKICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYi2KfZhNmF2YTZgSDYp9mE2YXYrdmF2YQg2LXYutmK2LEg2KzYr9in2YsgKHtmaW5hbF9zaXplfSDYqNin2YrYqikgLSDZgtivINmK2YPZiNmGINi12YHYrdipIEhUTUwiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhdmdfc3BlZWQgPSBmaW5hbF9zaXplIC8gZWxhcHNlZCAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhCDYqNmG2KzYp9itISIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OKINin2YTYrdis2YU6IHtmaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoSDZhdiq2YjYs9i3INin2YTYs9ix2LnYqToge2F2Z19zcGVlZDouMmZ9INmF2YrYrNin2KjYp9mK2Kov2KvYp9mG2YrYqSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXRfcGF0aAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZ19lcnJvcihlLCBmItmF2K3Yp9mI2YTYqSDYp9mE2KrYrdmF2YrZhCB7YXR0ZW1wdF9udW19IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCLZgdi02YQg2KrYrdmF2YrZhCDYp9mE2YXZhNmBINmF2YYgR29vZ2xlIERyaXZlINio2LnYryDYrNmF2YrYuSDYp9mE2YXYrdin2YjZhNin2KoiKQogICAgCiAgICBkZWYgZG93bmxvYWRfdmlkZW8oc2VsZiwgdXJsLCBvdXRwdXRfcGF0aCk6CiAgICAgICAgIiIi2KrYrdmF2YrZhCDZgdmK2K/ZitmIINmF2YYg2KPZiiDYsdin2KjYtyIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Ug2KjYr9ihINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflJcg2KfZhNix2KfYqNi3OiB7dXJsWzoxMDBdfS4uLiIpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDZhtmI2Lkg2KfZhNix2KfYqNi3CiAgICAgICAgZmlsZV9pZCA9IHNlbGYuZXh0cmFjdF9nb29nbGVfZHJpdmVfaWQodXJsKQogICAgICAgIAogICAgICAgIGlmIGZpbGVfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflI0g2KrZhSDYp9mD2KrYtNin2YEg2LHYp9io2LcgR29vZ2xlIERyaXZlOiB7ZmlsZV9pZH0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZG93bmxvYWRfZnJvbV9nb29nbGVfZHJpdmUoZmlsZV9pZCwgb3V0cHV0X3BhdGgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyDYsdin2KjYtyDYqtit2YXZitmEINmF2KjYp9i02LEKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+UlyDYsdin2KjYtyDYqtit2YXZitmEINmF2KjYp9i02LEiKQogICAgICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIuc3RhcnQoItiq2K3ZhdmK2YQg2YXZhiDYsdin2KjYtyDZhdio2KfYtNixIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MTIwKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRvdGFsX3NpemUgPSBpbnQocmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJywgMCkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB0b3RhbF9zaXplID4gMDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2K3YrNmFINin2YTZhdmE2YE6IHt0b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiCIsIHRvdGFsX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT02NTUzNik6CiAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZWRfc2l6ZSArPSBsZW4oY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci51cGRhdGUoZG93bmxvYWRlZF9zaXplLCB0b3RhbF9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgZmluYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQhINin2YTYrdis2YU6IHtmaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBvdXRwdXRfcGF0aAogICAgCiAgICBkZWYgZ2V0X3ZpZGVvX2luZm8oc2VsZiwgdmlkZW9fcGF0aCk6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiCIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2KzYp9ix2Yog2YHYrdi1INmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmILi4uIikKICAgICAgICAKICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICdmZnByb2JlJywKICAgICAgICAgICAgJy12JywgJ3F1aWV0JywKICAgICAgICAgICAgJy1wcmludF9mb3JtYXQnLCAnanNvbicsCiAgICAgICAgICAgICctc2hvd19mb3JtYXQnLAogICAgICAgICAgICAnLXNob3dfc3RyZWFtcycsCiAgICAgICAgICAgIHZpZGVvX3BhdGgKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgaW5mbyA9IGpzb24ubG9hZHMocmVzdWx0LnN0ZG91dCkKICAgICAgICAKICAgICAgICAjINin2LPYqtiu2LHYp9isINin2YTZhdi52YTZiNmF2KfYqgogICAgICAgIGR1cmF0aW9uID0gZmxvYXQoaW5mb1snZm9ybWF0J10uZ2V0KCdkdXJhdGlvbicsIDApKQogICAgICAgIHNpemUgPSBpbnQoaW5mb1snZm9ybWF0J10uZ2V0KCdzaXplJywgMCkpCiAgICAgICAgCiAgICAgICAgdmlkZW9fc3RyZWFtID0gbmV4dCgocyBmb3IgcyBpbiBpbmZvWydzdHJlYW1zJ10gaWYgc1snY29kZWNfdHlwZSddID09ICd2aWRlbycpLCBOb25lKQogICAgICAgIAogICAgICAgIGlmIHZpZGVvX3N0cmVhbToKICAgICAgICAgICAgd2lkdGggPSBpbnQodmlkZW9fc3RyZWFtLmdldCgnd2lkdGgnLCAwKSkKICAgICAgICAgICAgaGVpZ2h0ID0gaW50KHZpZGVvX3N0cmVhbS5nZXQoJ2hlaWdodCcsIDApKQogICAgICAgICAgICBiaXRyYXRlID0gaW50KGluZm9bJ2Zvcm1hdCddLmdldCgnYml0X3JhdGUnLCAwKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk7kg2KfZhNij2KjYudin2K86IHt3aWR0aH14e2hlaWdodH0iKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLij7HvuI8g2KfZhNmF2K/YqToge2R1cmF0aW9uOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2KfZhNit2KzZhToge3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimqEg2YXYudiv2YQg2KfZhNio2Ko6IHtiaXRyYXRlIC8gMTAwMDouMGZ9INmD2YrZhNmI2KjYqi/Yq9in2YbZitipIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbiwKICAgICAgICAgICAgICAgICdzaXplJzogc2l6ZSwKICAgICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRoLAogICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCwKICAgICAgICAgICAgICAgICdiaXRyYXRlJzogYml0cmF0ZQogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiCIpCiAgICAKICAgIGRlZiBjb21wcmVzc192aWRlbyhzZWxmLCBpbnB1dF9wYXRoLCBvdXRwdXRfcGF0aCwgcXVhbGl0eT0nbWVkaXVtJyk6CiAgICAgICAgIiIiCiAgICAgICAg2LbYuti3INin2YTZgdmK2K/ZitmIINio2LPYsdi52Kkg2YHYp9im2YLYqSDZiNit2KzZhSDYtdi62YrYsSDYrNiv2KfZiwogICAgICAgIAogICAgICAgINmF2LPYqtmI2YrYp9iqINin2YTYrNmI2K/YqToKICAgICAgICAtIHVsdHJhX2xvdzog2K3YrNmFINi12LrZitixINis2K/Yp9mLIChDUkYgMzUsIDQ4MHAsINmF2LnYr9mEINil2LfYp9ix2KfYqiDZhdmG2K7Zgdi2KQogICAgICAgIC0gbG93OiDYrdis2YUg2LXYutmK2LEgKENSRiAzMiwgNzIwcCkKICAgICAgICAtIG1lZGl1bTog2YXYqtmI2KfYstmGIChDUkYgMjgsIDcyMHApCiAgICAgICAgLSBoaWdoOiDYrNmI2K/YqSDYudin2YTZitipIChDUkYgMjMsIDEwODBwKQogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfjqwg2KjYr9ihINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDZhdiz2KrZiNmJINin2YTYrNmI2K/YqToge3F1YWxpdHl9IikKICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIuc3RhcnQoIti22LrYtyDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmICiAgICAgICAgdmlkZW9faW5mbyA9IHNlbGYuZ2V0X3ZpZGVvX2luZm8oaW5wdXRfcGF0aCkKICAgICAgICBkdXJhdGlvbiA9IHZpZGVvX2luZm9bJ2R1cmF0aW9uJ10KICAgICAgICAKICAgICAgICAjINil2LnYr9in2K/Yp9iqINin2YTYrNmI2K/YqSDYp9mE2YXYrdiz2ZHZhtipCiAgICAgICAgcXVhbGl0eV9zZXR0aW5ncyA9IHsKICAgICAgICAgICAgJ3VsdHJhX2xvdyc6IHsKICAgICAgICAgICAgICAgICdjcmYnOiAnMzUnLAogICAgICAgICAgICAgICAgJ3ByZXNldCc6ICd2ZXJ5ZmFzdCcsCiAgICAgICAgICAgICAgICAnc2NhbGUnOiAnNjQwOi0yJywKICAgICAgICAgICAgICAgICdmcHMnOiAnMTUnLAogICAgICAgICAgICAgICAgJ2F1ZGlvX2JpdHJhdGUnOiAnMzJrJywKICAgICAgICAgICAgICAgICd2Y29kZWMnOiAnbGlieDI2NCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2xvdyc6IHsKICAgICAgICAgICAgICAgICdjcmYnOiAnMzInLAogICAgICAgICAgICAgICAgJ3ByZXNldCc6ICd2ZXJ5ZmFzdCcsCiAgICAgICAgICAgICAgICAnc2NhbGUnOiAnODU0Oi0yJywKICAgICAgICAgICAgICAgICdmcHMnOiAnMjQnLAogICAgICAgICAgICAgICAgJ2F1ZGlvX2JpdHJhdGUnOiAnNjRrJywKICAgICAgICAgICAgICAgICd2Y29kZWMnOiAnbGlieDI2NCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ21lZGl1bSc6IHsKICAgICAgICAgICAgICAgICdjcmYnOiAnMjgnLAogICAgICAgICAgICAgICAgJ3ByZXNldCc6ICdmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICcxMjgwOi0yJywKICAgICAgICAgICAgICAgICdmcHMnOiAnMzAnLAogICAgICAgICAgICAgICAgJ2F1ZGlvX2JpdHJhdGUnOiAnOTZrJywKICAgICAgICAgICAgICAgICd2Y29kZWMnOiAnbGlieDI2NCcKICAgICAgICAgICAgfSwKICAgICAgICAgICAgJ2hpZ2gnOiB7CiAgICAgICAgICAgICAgICAnY3JmJzogJzIzJywKICAgICAgICAgICAgICAgICdwcmVzZXQnOiAnbWVkaXVtJywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICcxOTIwOi0yJywKICAgICAgICAgICAgICAgICdmcHMnOiAnMzAnLAogICAgICAgICAgICAgICAgJ2F1ZGlvX2JpdHJhdGUnOiAnMTI4aycsCiAgICAgICAgICAgICAgICAndmNvZGVjJzogJ2xpYngyNjQnCiAgICAgICAgICAgIH0sCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNldHRpbmdzID0gcXVhbGl0eV9zZXR0aW5ncy5nZXQocXVhbGl0eSwgcXVhbGl0eV9zZXR0aW5nc1snbWVkaXVtJ10pCiAgICAgICAgCiAgICAgICAgIyDYqNmG2KfYoSDYo9mF2LEgRkZtcGVnINin2YTZhdit2LPZkdmGCiAgICAgICAgY21kID0gWwogICAgICAgICAgICAnZmZtcGVnJywKICAgICAgICAgICAgJy1pJywgaW5wdXRfcGF0aCwKICAgICAgICAgICAgJy1jOnYnLCBzZXR0aW5nc1sndmNvZGVjJ10sCiAgICAgICAgICAgICctcHJlc2V0Jywgc2V0dGluZ3NbJ3ByZXNldCddLAogICAgICAgICAgICAnLWNyZicsIHNldHRpbmdzWydjcmYnXSwKICAgICAgICAgICAgJy12ZicsIGYic2NhbGU9e3NldHRpbmdzWydzY2FsZSddfSxmcHM9e3NldHRpbmdzWydmcHMnXX0iLAogICAgICAgICAgICAnLWM6YScsICdhYWMnLAogICAgICAgICAgICAnLWI6YScsIHNldHRpbmdzWydhdWRpb19iaXRyYXRlJ10sCiAgICAgICAgICAgICctYWMnLCAnMScsICAjINij2K3Yp9iv2Yog2KfZhNmC2YbYp9ipIChtb25vKSDZhNiq2YLZhNmK2YQg2KfZhNit2KzZhQogICAgICAgICAgICAnLW1vdmZsYWdzJywgJytmYXN0c3RhcnQnLAogICAgICAgICAgICAnLXknLAogICAgICAgICAgICBvdXRwdXRfcGF0aAogICAgICAgIF0KICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimpnvuI8g2KPZhdixIEZGbXBlZzogeycgJy5qb2luKGNtZCl9IikKICAgICAgICAKICAgICAgICAjINiq2LTYutmK2YQgRkZtcGVnINmF2Lkg2YXYsdin2YLYqNipINin2YTYqtmC2K/ZhQogICAgICAgIHByb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKAogICAgICAgICAgICBjbWQsCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2YXYsdin2YLYqNipINin2YTYqtmC2K/ZhQogICAgICAgIGxhc3RfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgZm9yIGxpbmUgaW4gcHJvY2Vzcy5zdGRlcnI6CiAgICAgICAgICAgIGlmICd0aW1lPScgaW4gbGluZToKICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHIndGltZT0oXGQrKTooXGQrKTooXGQrKScsIGxpbmUpCiAgICAgICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICAgICBoLCBtLCBzID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gaCAqIDM2MDAgKyBtICogNjAgKyBzCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSAoY3VycmVudF90aW1lIC8gZHVyYXRpb24pICogMTAwIGlmIGR1cmF0aW9uID4gMCBlbHNlIDAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjINiq2K3Yr9mK2Ksg2YPZhCAzINir2YjYp9mG2Y0KICAgICAgICAgICAgICAgICAgICBpZiB0aW1lLnRpbWUoKSAtIGxhc3RfdGltZSA+IDM6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfjqwg2KrZgtiv2YUg2KfZhNi22LrYtzoge3Byb2dyZXNzOi4xZn0lICh7Y3VycmVudF90aW1lOi4wZn0ve2R1cmF0aW9uOi4wZn0g2KvYp9mG2YrYqSkiKQogICAgICAgICAgICAgICAgICAgICAgICBsYXN0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIHByb2Nlc3Mud2FpdCgpCiAgICAgICAgCiAgICAgICAgaWYgcHJvY2Vzcy5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGVycm9yX291dHB1dCA9IHByb2Nlc3Muc3RkZXJyLnJlYWQoKSBpZiBwcm9jZXNzLnN0ZGVyciBlbHNlICJVbmtub3duIGVycm9yIgogICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiLZgdi02YQg2LbYuti3INin2YTZgdmK2K/ZitmIOiB7ZXJyb3Jfb3V0cHV0fSIpCiAgICAgICAgCiAgICAgICAgIyDYrdiz2KfYqCDZhtiz2KjYqSDYp9mE2LbYuti3CiAgICAgICAgb3JpZ2luYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShpbnB1dF9wYXRoKQogICAgICAgIGNvbXByZXNzZWRfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICBjb21wcmVzc2lvbl9yYXRpbyA9ICgxIC0gY29tcHJlc3NlZF9zaXplIC8gb3JpZ2luYWxfc2l6ZSkgKiAxMDAKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2LbYuti3INio2YbYrNin2K0hIikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OKINin2YTYrdis2YUg2KfZhNij2LXZhNmKOiB7b3JpZ2luYWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TpiDYp9mE2K3YrNmFINin2YTZhdi22LrZiNi3OiB7Y29tcHJlc3NlZF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OJINmG2LPYqNipINin2YTYtti62Lc6IHtjb21wcmVzc2lvbl9yYXRpbzouMWZ9JSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIG91dHB1dF9wYXRoCiAgICAKICAgIGRlZiBzcGxpdF92aWRlbyhzZWxmLCBpbnB1dF9wYXRoLCBtYXhfc2l6ZV9tYj1NQVhfVEVMRUdSQU1fU0laRV9NQik6CiAgICAgICAgIiIi2KrZgtiz2YrZhSDYp9mE2YHZitiv2YrZiCDYpdmE2Ykg2KPYrNiy2KfYoSDYtdi62YrYsdipIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyC77iPINio2K/YoSDYqtmC2LPZitmFINin2YTZgdmK2K/ZitmILi4uIikKICAgICAgICAKICAgICAgICB2aWRlb19pbmZvID0gc2VsZi5nZXRfdmlkZW9faW5mbyhpbnB1dF9wYXRoKQogICAgICAgIHRvdGFsX3NpemUgPSB2aWRlb19pbmZvWydzaXplJ10KICAgICAgICBkdXJhdGlvbiA9IHZpZGVvX2luZm9bJ2R1cmF0aW9uJ10KICAgICAgICAKICAgICAgICAjINit2LPYp9ioINi52K/YryDYp9mE2KPYrNiy2KfYoSDYp9mE2YXYt9mE2YjYqNipCiAgICAgICAgbWF4X3NpemVfYnl0ZXMgPSBtYXhfc2l6ZV9tYiAqIDEwMjQgKiAxMDI0CiAgICAgICAgbnVtX3BhcnRzID0gaW50KHRvdGFsX3NpemUgLyBtYXhfc2l6ZV9ieXRlcykgKyAxCiAgICAgICAgCiAgICAgICAgaWYgbnVtX3BhcnRzID4gTUFYX0ZJTEVfUEFSVFM6CiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiLYp9mE2YXZhNmBINmD2KjZitixINis2K/Yp9mLISDZitiq2LfZhNioIHtudW1fcGFydHN9INis2LLYoSAo2KfZhNit2K8g2KfZhNij2YLYtdmJIHtNQVhfRklMRV9QQVJUU30pIikKICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OKINi52K/YryDYp9mE2KPYrNiy2KfYoToge251bV9wYXJ0c30iKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKPse+4jyDZhdiv2Kkg2YPZhCDYrNiy2KE6IHtkdXJhdGlvbiAvIG51bV9wYXJ0czouMWZ9INir2KfZhtmK2KkiKQogICAgICAgIAogICAgICAgICMg2KrZgtiz2YrZhSDYp9mE2YHZitiv2YrZiAogICAgICAgIHBhcnRfZHVyYXRpb24gPSBkdXJhdGlvbiAvIG51bV9wYXJ0cwogICAgICAgIHBhcnRzID0gW10KICAgICAgICAKICAgICAgICBmb3IgaSBpbiByYW5nZShudW1fcGFydHMpOgogICAgICAgICAgICBzdGFydF90aW1lID0gaSAqIHBhcnRfZHVyYXRpb24KICAgICAgICAgICAgb3V0cHV0X3BhcnQgPSBzZWxmLnRlbXBfZGlyIC8gZiJwYXJ0X3tpKzE6MDJkfS5tcDQiCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinILvuI8g2KXZhti02KfYoSDYp9mE2KzYstihIHtpKzF9L3tudW1fcGFydHN9Li4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIGNtZCA9IFsKICAgICAgICAgICAgICAgICdmZm1wZWcnLAogICAgICAgICAgICAgICAgJy1pJywgaW5wdXRfcGF0aCwKICAgICAgICAgICAgICAgICctc3MnLCBzdHIoc3RhcnRfdGltZSksCiAgICAgICAgICAgICAgICAnLXQnLCBzdHIocGFydF9kdXJhdGlvbiksCiAgICAgICAgICAgICAgICAnLWMnLCAnY29weScsCiAgICAgICAgICAgICAgICAnLXknLAogICAgICAgICAgICAgICAgc3RyKG91dHB1dF9wYXJ0KQogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihjbWQsIGNoZWNrPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUpCiAgICAgICAgICAgIHBhcnRzLmFwcGVuZChvdXRwdXRfcGFydCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHBhcnRfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGFydCkgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KfZhNis2LLYoSB7aSsxfToge3BhcnRfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgIAogICAgICAgIHJldHVybiBwYXJ0cwogICAgCiAgICBkZWYgcHJvY2Vzc192aWRlb19mcm9tX3VybChzZWxmLCB1cmwsIHF1YWxpdHk9J21lZGl1bScpOgogICAgICAgICIiItmF2LnYp9mE2KzYqSDZg9in2YXZhNipINmE2YTZgdmK2K/ZitmIINmF2YYg2LHYp9io2LciIiIKICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKCLwn5qAINio2K/YoSDZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2YgiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICAKICAgICAgICBzdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgMS4g2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICBkb3dubG9hZF9wYXRoID0gc2VsZi50ZW1wX2RpciAvICJkb3dubG9hZGVkX3ZpZGVvLm1wNCIKICAgICAgICAgICAgc2VsZi5kb3dubG9hZF92aWRlbyh1cmwsIGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIDIuINi22LrYtyDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICBjb21wcmVzc2VkX3BhdGggPSBzZWxmLnRlbXBfZGlyIC8gImNvbXByZXNzZWRfdmlkZW8ubXA0IgogICAgICAgICAgICBzZWxmLmNvbXByZXNzX3ZpZGVvKGRvd25sb2FkX3BhdGgsIGNvbXByZXNzZWRfcGF0aCwgcXVhbGl0eSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMy4g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNit2KzZhQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemUgPSBvcy5wYXRoLmdldHNpemUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemVfbWIgPSBjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TpiDYrdis2YUg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtzoge2NvbXByZXNzZWRfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdiw2Kcg2YPYp9mGINin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2YvYjCDZhtmC2LPZhdmHCiAgICAgICAgICAgIGlmIGNvbXByZXNzZWRfc2l6ZV9tYiA+IE1BWF9URUxFR1JBTV9TSVpFX01COgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPINin2YTZhdmE2YEg2KPZg9io2LEg2YXZhiB7TUFYX1RFTEVHUkFNX1NJWkVfTUJ9INmF2YrYrNin2KjYp9mK2KogLSDYs9mK2KrZhSDYp9mE2KrZgtiz2YrZhSIpCiAgICAgICAgICAgICAgICBwYXJ0cyA9IHNlbGYuc3BsaXRfdmlkZW8oY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KfZg9iq2YXZhNiqINin2YTZhdi52KfZhNis2Kkg2YHZiiB7ZWxhcHNlZDouMWZ9INir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCI9IiAqIDgwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4geyd0eXBlJzogJ3BhcnRzJywgJ2ZpbGVzJzogcGFydHN9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTYo9i12YTZigogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYp9mD2KrZhdmE2Kog2KfZhNmF2LnYp9mE2KzYqSDZgdmKIHtlbGFwc2VkOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7J3R5cGUnOiAnc2luZ2xlJywgJ2ZpbGUnOiBjb21wcmVzc2VkX3BhdGh9CiAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2dfZXJyb3IoZSwgItmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgICAgIHJhaXNlCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn6SWINio2YjYqiBUZWxlZ3JhbQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFZpZGVvQ29tcHJlc3NvckJvdDoKICAgICIiItio2YjYqiBUZWxlZ3JhbSDZhNi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgdG9rZW4pOgogICAgICAgICIiItiq2YfZitim2Kkg2KfZhNio2YjYqiIiIgogICAgICAgIHNlbGYuYXBwID0gQXBwbGljYXRpb24uYnVpbGRlcigpLnRva2VuKHRva2VuKS5idWlsZCgpCiAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIgPSBEZXRhaWxlZExvZ2dlcigpCiAgICAgICAgc2VsZi5jb21wcmVzc29yID0gVmlkZW9Db21wcmVzc29yKGxvZ2dlcj1zZWxmLmRldGFpbGVkX2xvZ2dlcikKICAgICAgICBzZWxmLnNldHVwX2hhbmRsZXJzKCkKICAgIAogICAgZGVmIHNldHVwX2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YXYudin2YTYrNin2Kog2KfZhNij2YjYp9mF2LEiIiIKICAgICAgICBzZWxmLmFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzZWxmLnN0YXJ0X2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJoZWxwIiwgc2VsZi5oZWxwX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsb2dzIiwgc2VsZi5sb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsYXN0bG9nIiwgc2VsZi5sYXN0bG9nX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhbGxsb2dzIiwgc2VsZi5hbGxsb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKE1lc3NhZ2VIYW5kbGVyKGZpbHRlcnMuVEVYVCAmIH5maWx0ZXJzLkNPTU1BTkQsIHNlbGYuaGFuZGxlX3VybCkpCiAgICAgICAgc2VsZi5hcHAuYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoc2VsZi5oYW5kbGVfcXVhbGl0eV9zZWxlY3Rpb24pKQogICAgCiAgICBhc3luYyBkZWYgc3RhcnRfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KPZhdixINin2YTYqNiv2KfZitipIiIiCiAgICAgICAgd2VsY29tZV90ZXh0ID0gKAogICAgICAgICAgICAi8J+OrCAqKtmF2LHYrdio2KfZiyDYqNmDINmB2Yog2LbYp9i62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNin2K3Yqtix2KfZgdmKISoqXG5cbiIKICAgICAgICAgICAgIuKcqCAqKtin2YTZhdmF2YrYstin2Kog2KfZhNis2K/Zitiv2Kk6KipcbiIKICAgICAgICAgICAgIuKchSDYtti62Lcg2YHYp9im2YIg2KfZhNiz2LHYudipICgzeCDYo9iz2LHYuSlcbiIKICAgICAgICAgICAgIuKchSDYpdix2LPYp9mEINmB2YrYr9mK2YjZh9in2Kog2KjYo9mKINit2KzZhSAo2KrZgtiz2YrZhSDYqtmE2YLYp9im2YopXG4iCiAgICAgICAgICAgICLinIUg2LPYrNmEINij2K7Yt9in2KEgdHh0INmF2YHYtdmEXG4iCiAgICAgICAgICAgICLinIUg2LPYrNmEINiq2YLYr9mFINmF2Lkg2KPYs9io2KfYqCDYp9mE2KrYo9iu2YrYsVxuIgogICAgICAgICAgICAi4pyFINi22LrYtyDYo9mC2YjZiSAtINit2KzZhSDYtdi62YrYsSDYrNiv2KfZi1xuXG4iCiAgICAgICAgICAgICLwn5OdICoq2YPZitmB2YrYqSDYp9mE2KfYs9iq2K7Yr9in2YU6KipcbiIKICAgICAgICAgICAgIjHvuI/ig6Mg2KPYsdiz2YQg2LHYp9io2Lcg2KfZhNmB2YrYr9mK2YggKEdvb2dsZSBEcml2ZSDYo9mIINix2KfYqNi3INmF2KjYp9i02LEpXG4iCiAgICAgICAgICAgICIy77iP4oOjINin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipXG4iCiAgICAgICAgICAgICIz77iP4oOjINin2YbYqti42LEg2K3YqtmJINmK2KrZhSDYp9mE2LbYuti3XG4iCiAgICAgICAgICAgICI077iP4oOjINin2LPYqtmE2YUg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2LbYutmI2Lcg2YXYuSDYs9is2YQg2KfZhNi52YXZhNmK2KfYqiFcblxuIgogICAgICAgICAgICAi8J+boO+4jyAqKtin2YTYo9mI2KfZhdixINin2YTZhdiq2KfYrdipOioqXG4iCiAgICAgICAgICAgICLigKIgL2hlbHAgLSDYr9mE2YrZhCDYp9mE2KfYs9iq2K7Yr9in2YUg2KfZhNmD2KfZhdmEXG4iCiAgICAgICAgICAgICLigKIgL2xvZ3MgLSDYudix2LYg2YLYp9im2YXYqSDYp9mE2LPYrNmE2KfYqlxuIgogICAgICAgICAgICAi4oCiIC9sYXN0bG9nIC0g2KLYrtixINiz2KzZhCDZhdi52KfZhNis2KlcbiIKICAgICAgICAgICAgIuKAoiAvYWxsbG9ncyAtINis2YXZiti5INin2YTYs9is2YTYp9iqINmF2LbYutmI2LfYqVxuXG4iCiAgICAgICAgICAgICLwn4aYINmE2YTZhdiz2KfYudiv2Kk6IC9oZWxwIgogICAgICAgICkKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHdlbGNvbWVfdGV4dCwgcGFyc2VfbW9kZT0nTWFya2Rvd24nKQogICAgCiAgICBhc3luYyBkZWYgaGVscF9jb21tYW5kKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYo9mF2LEg2KfZhNmF2LPYp9i52K/YqSIiIgogICAgICAgIGhlbHBfdGV4dCA9ICgKICAgICAgICAgICAgIuKdkyAqKtiv2YTZitmEINin2YTYp9iz2KrYrtiv2KfZhSoqXG5cbiIKICAgICAgICAgICAgIioq8J+TpSDYp9mE2LHZiNin2KjYtyDYp9mE2YXYr9i52YjZhdipOioqXG4iCiAgICAgICAgICAgICLigKIgR29vZ2xlIERyaXZlOiBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vLi4uXG4iCiAgICAgICAgICAgICLigKIg2LHZiNin2KjYtyDZhdio2KfYtNix2Kk6IGh0dHA6Ly9leGFtcGxlLmNvbS92aWRlby5tcDRcblxuIgogICAgICAgICAgICAiKirwn46vINmF2LPYqtmI2YrYp9iqINin2YTYrNmI2K/YqToqKlxuIgogICAgICAgICAgICAi4oCiIPCfn6MgKirZgdin2KbZgiDYp9mE2KfZhtiu2YHYp9i2Kio6INit2KzZhSDYtdi62YrYsSDYrNiv2KfZiyAoNDgwcCwgQ1JGIDM1KVxuIgogICAgICAgICAgICAi4oCiIPCflLQgKirZhdmG2K7Zgdi22KkqKjog2K3YrNmFINi12LrZitixICg3MjBwLCBDUkYgMzIpXG4iCiAgICAgICAgICAgICLigKIg8J+foSAqKtmF2KrZiNiz2LfYqSoqOiDZhdiq2YjYp9iy2YYgKDcyMHAsIENSRiAyOClcbiIKICAgICAgICAgICAgIuKAoiDwn5+iICoq2LnYp9mE2YrYqSoqOiDYrNmI2K/YqSDYudin2YTZitipICgxMDgwcCwgQ1JGIDIzKVxuXG4iCiAgICAgICAgICAgICIqKvCfm6DvuI8g2KfZhNij2YjYp9mF2LEg2KfZhNmF2KrYp9it2Kk6KipcbiIKICAgICAgICAgICAgIuKAoiAvc3RhcnQgLSDYqNiv2KEg2KfZhNio2YjYqlxuIgogICAgICAgICAgICAi4oCiIC9oZWxwIC0g2LnYsdi2INin2YTZhdiz2KfYudiv2KlcbiIKICAgICAgICAgICAgIuKAoiAvbG9ncyAtINi52LHYtiDZgtin2KbZhdipINin2YTYs9is2YTYp9iqXG4iCiAgICAgICAgICAgICLigKIgL2xhc3Rsb2cgLSDYotiu2LEg2LPYrNmEINmF2LnYp9mE2KzYqVxuIgogICAgICAgICAgICAi4oCiIC9hbGxsb2dzIC0g2KzZhdmK2Lkg2KfZhNiz2KzZhNin2Kog2YHZiiDZhdmE2YEg2YXYtti62YjYt1xuXG4iCiAgICAgICAgICAgICIqKvCfkqEg2YbYtdin2KbYrToqKlxuIgogICAgICAgICAgICAi4oCiINmE2YTYrdi12YjZhCDYudmE2Ykg2KPYtdi62LEg2K3YrNmFOiDYp9iu2KrYsSDwn5+jINmB2KfYptmCINin2YTYp9mG2K7Zgdin2LZcbiIKICAgICAgICAgICAgIuKAoiDYp9mE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqSDZitiq2YUg2KrZgtiz2YrZhdmH2Kcg2KrZhNmC2KfYptmK2KfZi1xuIgogICAgICAgICAgICAi4oCiINiz2KrYrdi12YQg2LnZhNmJINmF2YTZgSB0eHQg2YrYrdiq2YjZiiDYudmE2Ykg2LPYrNmEINin2YTYudmF2YTZitin2KpcblxuIgogICAgICAgICAgICAiKirinZMg2YXYtNin2YPZhCDYtNin2KbYudipOioqXG4iCiAgICAgICAgICAgICLigKIgR29vZ2xlIERyaXZlOiDYqtij2YPYryDZhdmGINij2YYg2KfZhNmF2YTZgSDYudin2YVcbiIKICAgICAgICAgICAgIuKAoiDYp9mE2KrYrdmF2YrZhCDYqNi32YrYoTog2KrYrdmC2YIg2YXZhiDYp9iq2LXYp9mEINin2YTYpdmG2KrYsdmG2KpcblxuIgogICAgICAgICAgICAi8J+TpyDZhNmE2YXYs9in2LnYr9ipOiDYo9ix2LPZhCDYsdiz2KfZhNipINmE2YTZhdi32YjYsSIKICAgICAgICApCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChoZWxwX3RleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgIAogICAgYXN5bmMgZGVmIGxvZ3NfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2LnYsdi2INmC2KfYptmF2Kkg2KfZhNiz2KzZhNin2Kog2KfZhNmF2KrYp9it2KkiIiIKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgbG9nc19kaXIgPSBQYXRoKExPR1NfRElSKQogICAgICAgIAogICAgICAgIGlmIG5vdCBsb2dzX2Rpci5leGlzdHMoKToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLwn5OLICoq2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmF2KrYp9it2KkqKlxuXG4iCiAgICAgICAgICAgICAgICAi2YTZhSDZitiq2YUg2KXZhti02KfYoSDYo9mKINiz2KzZhNin2Kog2KjYudivLlxuIgogICAgICAgICAgICAgICAgItin2KjYr9ijINio2YXYudin2YTYrNipINmB2YrYr9mK2Ygg2KPZiNmE2KfZiyEiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KjYrdirINi52YYg2LPYrNmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mFCiAgICAgICAgdXNlcl9sb2dzID0gc29ydGVkKAogICAgICAgICAgICBsb2dzX2Rpci5nbG9iKGYic2Vzc2lvbl97dXNlcl9pZH1fKi50eHQiKSwKICAgICAgICAgICAga2V5PWxhbWJkYSB4OiB4LnN0YXQoKS5zdF9tdGltZSwKICAgICAgICAgICAgcmV2ZXJzZT1UcnVlCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGlmIG5vdCB1c2VyX2xvZ3M6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi8J+TiyAqKtmE2Kcg2KrZiNis2K8g2LPYrNmE2KfYqiDZhNmDKipcblxuIgogICAgICAgICAgICAgICAgItmE2YUg2KrZgtmFINio2YXYudin2YTYrNipINij2Yog2YHZitiv2YrZiCDYqNi52K8uXG4iCiAgICAgICAgICAgICAgICAi2KPYsdiz2YQg2LHYp9io2Lcg2YHZitiv2YrZiCDZhNmE2KjYr9ihISIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINi52LHYtiDYotiu2LEgMTAg2LPYrNmE2KfYqgogICAgICAgIGxvZ3NfbGlzdCA9ICLwn5OLICoq2LPYrNmE2KfYqtmDINin2YTYo9iu2YrYsdipOioqXG5cbiIKICAgICAgICAKICAgICAgICBmb3IgaSwgbG9nX2ZpbGUgaW4gZW51bWVyYXRlKHVzZXJfbG9nc1s6MTBdLCAxKToKICAgICAgICAgICAgIyDYp9iz2KrYrtix2KfYrCDYp9mE2KrYp9ix2YrYriDZhdmGINin2LPZhSDYp9mE2YXZhNmBCiAgICAgICAgICAgICMgc2Vzc2lvbl8xMjM0NTZfMjAyNjAyMDRfMTUwNTMwLnR4dAogICAgICAgICAgICBwYXJ0cyA9IGxvZ19maWxlLnN0ZW0uc3BsaXQoJ18nKQogICAgICAgICAgICBpZiBsZW4ocGFydHMpID49IDQ6CiAgICAgICAgICAgICAgICBkYXRlX3N0ciA9IHBhcnRzWzJdICAjIDIwMjYwMjA0CiAgICAgICAgICAgICAgICB0aW1lX3N0ciA9IHBhcnRzWzNdICAjIDE1MDUzMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINiq2YbYs9mK2YIg2KfZhNiq2KfYsdmK2K4g2YjYp9mE2YjZgtiqCiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRfZGF0ZSA9IGYie2RhdGVfc3RyWzA6NF19LXtkYXRlX3N0cls0OjZdfS17ZGF0ZV9zdHJbNjo4XX0iCiAgICAgICAgICAgICAgICBmb3JtYXR0ZWRfdGltZSA9IGYie3RpbWVfc3RyWzA6Ml19Ont0aW1lX3N0clsyOjRdfTp7dGltZV9zdHJbNDo2XX0iCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZpbGVfc2l6ZSA9IGxvZ19maWxlLnN0YXQoKS5zdF9zaXplIC8gMTAyNCAgIyBLQgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBsb2dzX2xpc3QgKz0gZiJ7aX0uIPCfk4Qge2Zvcm1hdHRlZF9kYXRlfSB7Zm9ybWF0dGVkX3RpbWV9XG4iCiAgICAgICAgICAgICAgICBsb2dzX2xpc3QgKz0gZiIgICDwn5OmIHtmaWxlX3NpemU6LjFmfSBLQlxuXG4iCiAgICAgICAgCiAgICAgICAgbG9nc19saXN0ICs9ICgKICAgICAgICAgICAgIioq8J+TjCDZhNmE2K3YtdmI2YQg2LnZhNmJINiz2KzZhDoqKlxuIgogICAgICAgICAgICAi4oCiIC9sYXN0bG9nIC0g2KLYrtixINiz2KzZhFxuIgogICAgICAgICAgICAi4oCiIC9hbGxsb2dzIC0g2KzZhdmK2Lkg2KfZhNiz2KzZhNin2Kog2YXYtti62YjYt9ipIgogICAgICAgICkKICAgICAgICAKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGxvZ3NfbGlzdCwgcGFyc2VfbW9kZT0nTWFya2Rvd24nKQogICAgCiAgICBhc3luYyBkZWYgbGFzdGxvZ19jb21tYW5kKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYpdix2LPYp9mEINii2K7YsSDZhdmE2YEg2LPYrNmEIiIiCiAgICAgICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgICAgIGxvZ3NfZGlyID0gUGF0aChMT0dTX0RJUikKICAgICAgICAKICAgICAgICBpZiBub3QgbG9nc19kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi4p2MINmE2Kcg2KrZiNis2K8g2LPYrNmE2KfYqiDZhdiq2KfYrdipIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KfZhNio2K3YqyDYudmGINii2K7YsSDYs9is2YQg2YTZhNmF2LPYqtiu2K/ZhQogICAgICAgIHVzZXJfbG9ncyA9IHNvcnRlZCgKICAgICAgICAgICAgbG9nc19kaXIuZ2xvYihmInNlc3Npb25fe3VzZXJfaWR9XyoudHh0IiksCiAgICAgICAgICAgIGtleT1sYW1iZGEgeDogeC5zdGF0KCkuc3RfbXRpbWUsCiAgICAgICAgICAgIHJldmVyc2U9VHJ1ZQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyDYqNi52K8iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgbGFzdF9sb2cgPSB1c2VyX2xvZ3NbMF0KICAgICAgICAKICAgICAgICAjINil2LHYs9in2YQg2KfZhNmF2YTZgQogICAgICAgIHdpdGggb3BlbihsYXN0X2xvZywgJ3JiJykgYXMgZjoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfZG9jdW1lbnQoCiAgICAgICAgICAgICAgICBkb2N1bWVudD1mLAogICAgICAgICAgICAgICAgY2FwdGlvbj1mIvCfk4sgKirYotiu2LEg2LPYrNmEINmF2LnYp9mE2KzYqSoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OFINin2YTYqtin2LHZitiuOiB7ZGF0ZXRpbWUuZnJvbXRpbWVzdGFtcChsYXN0X2xvZy5zdGF0KCkuc3RfbXRpbWUpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIgogICAgICAgICAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge2xhc3RfbG9nLnN0YXQoKS5zdF9zaXplIC8gMTAyNDouMWZ9IEtCIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAKICAgIGFzeW5jIGRlZiBhbGxsb2dzX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItil2LHYs9in2YQg2KzZhdmK2Lkg2KfZhNiz2KzZhNin2Kog2YHZiiDZhdmE2YEg2YXYtti62YjYtyIiIgogICAgICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgICAgICBsb2dzX2RpciA9IFBhdGgoTE9HU19ESVIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGxvZ3NfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YXYqtin2K3YqSIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2YTYqNit2Ksg2LnZhiDYs9is2YTYp9iqINin2YTZhdiz2KrYrtiv2YUKICAgICAgICB1c2VyX2xvZ3MgPSBsaXN0KGxvZ3NfZGlyLmdsb2IoZiJzZXNzaW9uX3t1c2VyX2lkfV8qLnR4dCIpKQogICAgICAgIAogICAgICAgIGlmIG5vdCB1c2VyX2xvZ3M6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi4p2MINmE2Kcg2KrZiNis2K8g2LPYrNmE2KfYqiDZhNmDINio2LnYryIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINil2LHYs9in2YQg2LHYs9in2YTYqSDYp9mG2KrYuNin2LEKICAgICAgICB3YWl0X21zZyA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICLwn5OmINis2KfYsdmKINiq2KzZh9mK2LIg2KzZhdmK2Lkg2KfZhNiz2KzZhNin2KouLi4iLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAgICAgCiAgICAgICAgIyDYpdmG2LTYp9ihINmF2YTZgSDZhdi22LrZiNi3CiAgICAgICAgaW1wb3J0IHppcGZpbGUKICAgICAgICAKICAgICAgICB6aXBfcGF0aCA9IFBhdGgoVEVNUF9ESVIpIC8gZiJsb2dzX3t1c2VyX2lkfV97aW50KHRpbWUudGltZSgpKX0uemlwIgogICAgICAgIAogICAgICAgIHdpdGggemlwZmlsZS5aaXBGaWxlKHppcF9wYXRoLCAndycsIHppcGZpbGUuWklQX0RFRkxBVEVEKSBhcyB6aXBmOgogICAgICAgICAgICBmb3IgbG9nX2ZpbGUgaW4gdXNlcl9sb2dzOgogICAgICAgICAgICAgICAgemlwZi53cml0ZShsb2dfZmlsZSwgbG9nX2ZpbGUubmFtZSkKICAgICAgICAKICAgICAgICAjINit2LDZgSDYsdiz2KfZhNipINin2YTYp9mG2KrYuNin2LEKICAgICAgICB0cnk6CiAgICAgICAgICAgIGF3YWl0IHdhaXRfbXNnLmRlbGV0ZSgpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgCiAgICAgICAgIyDYpdix2LPYp9mEINin2YTZhdmE2YEg2KfZhNmF2LbYutmI2LcKICAgICAgICB6aXBfc2l6ZSA9IHppcF9wYXRoLnN0YXQoKS5zdF9zaXplIC8gMTAyNAogICAgICAgIAogICAgICAgIHdpdGggb3Blbih6aXBfcGF0aCwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfZG9jdW1lbnQoCiAgICAgICAgICAgICAgICBkb2N1bWVudD1mLAogICAgICAgICAgICAgICAgY2FwdGlvbj1mIvCfk6YgKirYrNmF2YrYuSDYs9is2YTYp9iq2YMqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TiiDYudiv2K8g2KfZhNiz2KzZhNin2Ko6IHtsZW4odXNlcl9sb2dzKX1cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OmINin2YTYrdis2YU6IHt6aXBfc2l6ZTouMWZ9IEtCXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLZitit2KrZiNmKINi52YTZiSDYrNmF2YrYuSDYs9is2YTYp9iqINmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2K7Yp9i12Kkg2KjZgyIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2LbYutmI2LcKICAgICAgICBvcy5yZW1vdmUoemlwX3BhdGgpCiAgICAKICAgIGFzeW5jIGRlZiBoYW5kbGVfdXJsKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLZhdi52KfZhNis2Kkg2LHYp9io2Lcg2KfZhNmB2YrYr9mK2YgiIiIKICAgICAgICB1cmwgPSB1cGRhdGUubWVzc2FnZS50ZXh0LnN0cmlwKCkKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgCiAgICAgICAgIyDYqNiv2KEg2KzZhNiz2Kkg2KfZhNiz2KzZhAogICAgICAgIHNlbGYuZGV0YWlsZWRfbG9nZ2VyLnN0YXJ0X3Nlc3Npb24odXNlcl9pZCwgdXJsKQogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2LXYrdipINin2YTYsdin2KjYtwogICAgICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgoJ2h0dHA6Ly8nLCAnaHR0cHM6Ly8nKSk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi4p2MICoq2LHYp9io2Lcg2LrZitixINi12K3ZititISoqXG5cbiIKICAgICAgICAgICAgICAgICLYp9mE2LHYrNin2KEg2KXYsdiz2KfZhCDYsdin2KjYtyDZitio2K/YoyDYqNmAIGh0dHA6Ly8g2KPZiCBodHRwczovLyIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINit2YHYuCDYp9mE2LHYp9io2LcKICAgICAgICBjb250ZXh0LnVzZXJfZGF0YVsndmlkZW9fdXJsJ10gPSB1cmwKICAgICAgICAKICAgICAgICAjINi52LHYtiDYrtmK2KfYsdin2Kog2KfZhNis2YjYr9ipCiAgICAgICAga2V5Ym9hcmQgPSBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+jINmB2KfYptmCINin2YTYp9mG2K7Zgdin2LYiLCBjYWxsYmFja19kYXRhPSdxdWFsaXR5X3VsdHJhX2xvdycpLAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflLQg2YXZhtiu2YHYttipIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9sb3cnKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfn6Eg2YXYqtmI2LPYt9ipIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9tZWRpdW0nKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+iINi52KfZhNmK2KkiLCBjYWxsYmFja19kYXRhPSdxdWFsaXR5X2hpZ2gnKSwKICAgICAgICAgICAgXQogICAgICAgIF0KICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgICAgICAKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAi8J+OryAqKtin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipOioqXG5cbiIKICAgICAgICAgICAgIvCfn6MgKirZgdin2KbZgiDYp9mE2KfZhtiu2YHYp9i2Kio6INij2LXYutixINit2KzZhSDZhdmF2YPZhiAoNDgwcClcbiIKICAgICAgICAgICAgIvCflLQgKirZhdmG2K7Zgdi22KkqKjog2K3YrNmFINi12LrZitixICg3MjBwKVxuIgogICAgICAgICAgICAi8J+foSAqKtmF2KrZiNiz2LfYqSoqOiDZhdiq2YjYp9iy2YYgKDcyMHApIC0g2YXZj9mI2LXZiSDYqNmHXG4iCiAgICAgICAgICAgICLwn5+iICoq2LnYp9mE2YrYqSoqOiDYrNmI2K/YqSDZhdmF2KrYp9iy2KkgKDEwODBwKVxuXG4iCiAgICAgICAgICAgICLwn5KhINmE2YTYrdi12YjZhCDYudmE2Ykg2KPYtdi62LEg2K3YrNmFOiDYp9iu2KrYsSDwn5+jIiwKICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgaGFuZGxlX3F1YWxpdHlfc2VsZWN0aW9uKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLZhdi52KfZhNis2Kkg2KfYrtiq2YrYp9ixINin2YTYrNmI2K/YqSIiIgogICAgICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCkKICAgICAgICAKICAgICAgICAjINin2LPYqtiu2LHYp9isINin2YTYrNmI2K/YqQogICAgICAgIHF1YWxpdHlfbWFwID0gewogICAgICAgICAgICAncXVhbGl0eV91bHRyYV9sb3cnOiAoJ3VsdHJhX2xvdycsICfwn5+jINmB2KfYptmCINin2YTYp9mG2K7Zgdin2LYnKSwKICAgICAgICAgICAgJ3F1YWxpdHlfbG93JzogKCdsb3cnLCAn8J+UtCDZhdmG2K7Zgdi22KknKSwKICAgICAgICAgICAgJ3F1YWxpdHlfbWVkaXVtJzogKCdtZWRpdW0nLCAn8J+foSDZhdiq2YjYs9i32KknKSwKICAgICAgICAgICAgJ3F1YWxpdHlfaGlnaCc6ICgnaGlnaCcsICfwn5+iINi52KfZhNmK2KknKSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcXVhbGl0eSwgcXVhbGl0eV9uYW1lID0gcXVhbGl0eV9tYXAuZ2V0KHF1ZXJ5LmRhdGEsICgnbWVkaXVtJywgJ/Cfn6Eg2YXYqtmI2LPYt9ipJykpCiAgICAgICAgdXJsID0gY29udGV4dC51c2VyX2RhdGEuZ2V0KCd2aWRlb191cmwnKQogICAgICAgIAogICAgICAgIGlmIG5vdCB1cmw6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2K7Yt9ijOiDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINin2YTYsdin2KjYty4g2KPYsdiz2YQg2LHYp9io2Lcg2KzYr9mK2K8uIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYqtit2K/ZitirINin2YTYsdiz2KfZhNipCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgIGYi4o+zICoq2KzYp9ix2Yog2KfZhNmF2LnYp9mE2KzYqS4uLioqXG5cbiIKICAgICAgICAgICAgZiLwn5SXINin2YTYsdin2KjYtzogYHt1cmxbOjUwXX0uLi5gXG4iCiAgICAgICAgICAgIGYi8J+TiiDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5X25hbWV9XG5cbiIKICAgICAgICAgICAgZiLij7HvuI8g2YLYryDYqtiz2KrYutix2YIg2KfZhNi52YXZhNmK2Kkg2LnYr9ipINiv2YLYp9im2YIuLi5cbiIKICAgICAgICAgICAgZiLYs9ij2LHYs9mEINmE2YMg2LPYrNmEINin2YTYqtmC2K/ZhSDZgtix2YrYqNin2YshIiwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyDYsdiz2KfZhNipINin2YTYqtmC2K/ZhQogICAgICAgICAgICBwcm9ncmVzc19tZXNzYWdlID0gYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIvCfk6UgKirZhdix2K3ZhNipIDEvMzoqKiDYrNin2LHZiiDYp9mE2KrYrdmF2YrZhC4uLlxuIgogICAgICAgICAgICAgICAgIuKPsyDYp9mE2LHYrNin2KEg2KfZhNin2YbYqti42KfYsS4uLiIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2YgKICAgICAgICAgICAgcmVzdWx0ID0gYXdhaXQgYXN5bmNpby50b190aHJlYWQoCiAgICAgICAgICAgICAgICBzZWxmLmNvbXByZXNzb3IucHJvY2Vzc192aWRlb19mcm9tX3VybCwKICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgIHF1YWxpdHk9cXVhbGl0eQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYsdiz2KfZhNipINin2YTYqtmC2K/ZhQogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCBwcm9ncmVzc19tZXNzYWdlLmRlbGV0ZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2LHZgdi5INin2YTZgdmK2K/ZitmIL9in2YTZgdmK2K/ZitmI2YfYp9iqCiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgZiLinIUgKirYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSEqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk6Qg2KzYp9ix2Yog2LHZgdi5INin2YTZgdmK2K/ZitmILi4uIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXN1bHRbJ3R5cGUnXSA9PSAnc2luZ2xlJzoKICAgICAgICAgICAgICAgICMg2YHZitiv2YrZiCDZiNin2K3YrwogICAgICAgICAgICAgICAgZmlsZV9zaXplID0gb3MucGF0aC5nZXRzaXplKHJlc3VsdFsnZmlsZSddKSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdpdGggb3BlbihyZXN1bHRbJ2ZpbGUnXSwgJ3JiJykgYXMgdmlkZW86CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV92aWRlbygKICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW89dmlkZW8sCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb249ZiLinIUgKirYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSEqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OKINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZX1cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge2ZpbGVfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KoiLAogICAgICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c19zdHJlYW1pbmc9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUocmVzdWx0WydmaWxlJ10pCiAgICAgICAgICAgIAogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyDYudiv2Kkg2KPYrNiy2KfYoQogICAgICAgICAgICAgICAgdG90YWxfcGFydHMgPSBsZW4ocmVzdWx0WydmaWxlcyddKQogICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgICAgIGYi8J+TpiAqKtin2YTZgdmK2K/ZitmIINmD2KjZitixIC0g2KrZhSDYp9mE2KrZgtiz2YrZhSDYpdmE2Ykge3RvdGFsX3BhcnRzfSDYo9is2LLYp9ihKipcblxuIgogICAgICAgICAgICAgICAgICAgIGYi4o+zINis2KfYsdmKINix2YHYuSDYp9mE2KPYrNiy2KfYoS4uLiIsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBpLCBwYXJ0X2ZpbGUgaW4gZW51bWVyYXRlKHJlc3VsdFsnZmlsZXMnXSwgMSk6CiAgICAgICAgICAgICAgICAgICAgcGFydF9zaXplID0gb3MucGF0aC5nZXRzaXplKHBhcnRfZmlsZSkgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihwYXJ0X2ZpbGUsICdyYicpIGFzIHZpZGVvOgogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3ZpZGVvKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlkZW89dmlkZW8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uPWYi8J+TpiAqKtin2YTYrNiy2KEge2l9L3t0b3RhbF9wYXJ0c30qKlxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge3BhcnRfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KoiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHNfc3RyZWFtaW5nPVRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShwYXJ0X2ZpbGUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINil2LHYs9in2YQg2LPYrNmEINin2YTYudmF2YTZitin2KoKICAgICAgICAgICAgbG9nX2ZpbGUgPSBzZWxmLmRldGFpbGVkX2xvZ2dlci5nZXRfbG9nX2ZpbGUoKQogICAgICAgICAgICBpZiBsb2dfZmlsZSBhbmQgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfZG9jdW1lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50PWYsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb249IvCfk4sgKirYs9is2YQg2KfZhNi52YXZhNmK2KfYqiDYp9mE2YPYp9mF2YQqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgItmK2K3YqtmI2Yog2LnZhNmJINis2YXZiti5INiq2YHYp9i12YrZhCDYp9mE2YXYudin2YTYrNipINmI2KfZhNij2K7Yt9in2KEgKNil2YYg2YjYrNiv2KopIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdmG2YfYp9ihINin2YTYrNmE2LPYqSDYqNmG2KzYp9itCiAgICAgICAgICAgIHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmZpbmlzaF9zZXNzaW9uKHN1Y2Nlc3M9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgZiLinIUgKirYqtmFINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2LbYutmI2LchKipcblxuIgogICAgICAgICAgICAgICAgZiLwn5OKINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZX1cbiIKICAgICAgICAgICAgICAgIGYi8J+TiyDYqtmFINil2LHYs9in2YQg2LPYrNmEINin2YTYudmF2YTZitin2Kog2KPZiti22KfZi1xuXG4iCiAgICAgICAgICAgICAgICBmIvCflIQg2KPYsdiz2YQg2LHYp9io2Lcg2KLYrtixINmE2YTZhdiy2YrYryEiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICMg2KrYs9is2YrZhCDYp9mE2K7Yt9ijCiAgICAgICAgICAgIHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmxvZ19lcnJvcihlLCAi2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIINin2YTZg9in2YXZhNipIikKICAgICAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIuZmluaXNoX3Nlc3Npb24oc3VjY2Vzcz1GYWxzZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYs9is2YQg2KfZhNij2K7Yt9in2KEKICAgICAgICAgICAgbG9nX2ZpbGUgPSBzZWxmLmRldGFpbGVkX2xvZ2dlci5nZXRfbG9nX2ZpbGUoKQogICAgICAgICAgICBpZiBsb2dfZmlsZSBhbmQgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncmInKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfZG9jdW1lbnQoCiAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50PWYsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb249IuKdjCAqKtiz2KzZhCDYp9mE2KPYrti32KfYoSoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi2K3Yr9irINiu2LfYoyDYo9ir2YbYp9ihINin2YTZhdi52KfZhNis2KkuINin2YTZhdmE2YEg2YrYrdiq2YjZiiDYudmE2Ykg2KfZhNiq2YHYp9i12YrZhCDYp9mE2YPYp9mF2YTYqS4iLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINix2LPYp9mE2Kkg2KfZhNiu2LfYowogICAgICAgICAgICBlcnJvcl90ZXh0ID0gKAogICAgICAgICAgICAgICAgZiLinYwgKirYrdiv2Ksg2K7Yt9ijINij2KvZhtin2KEg2KfZhNmF2LnYp9mE2KzYqSoqXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+TnSDYp9mE2K7Yt9ijOiBge3N0cihlKVs6MjAwXX1gXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+SoSAqKtin2YTYrdmE2YjZhCDYp9mE2YXZgtiq2LHYrdipOioqXG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYqtij2YPYryDZhdmGINi12K3YqSDYp9mE2LHYp9io2LdcbiIKICAgICAgICAgICAgICAgIGYi4oCiINiq2K3ZgtmCINmF2YYg2KPZhiDYp9mE2YXZhNmBINi52KfZhSAoR29vZ2xlIERyaXZlKVxuIgogICAgICAgICAgICAgICAgZiLigKIg2KzYsdioINis2YjYr9ipINij2YLZhFxuIgogICAgICAgICAgICAgICAgZiLigKIg2LHYp9is2Lkg2YXZhNmBINin2YTYs9is2YQg2YTZhNiq2YHYp9i12YrZhFxuXG4iCiAgICAgICAgICAgICAgICBmIvCfhpgg2YTZhNmF2LPYp9i52K/YqTogL2hlbHAiCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGVycm9yX3RleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgIAogICAgZGVmIHJ1bihzZWxmKToKICAgICAgICAiIiLYqti02LrZitmEINin2YTYqNmI2KoiIiIKICAgICAgICBwcmludCgiPSIgKiA3MCkKICAgICAgICBwcmludCgi8J+agCDYqNiv2KEg2KrYtNi62YrZhCDYqNmI2Kog2LbYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTYp9it2KrYsdin2YHZiiIpCiAgICAgICAgcHJpbnQoIj0iICogNzApCiAgICAgICAgcHJpbnQoZiLwn5OBINin2YTZhdis2YTYryDYp9mE2YXYpNmC2Ko6IHtURU1QX0RJUn0iKQogICAgICAgIHByaW50KGYi8J+TiyDZhdis2YTYryDYp9mE2LPYrNmE2KfYqjoge0xPR1NfRElSfSIpCiAgICAgICAgcHJpbnQoZiLwn5OmINit2K8g2LHZgdi5IFRlbGVncmFtICjZhNmD2YQg2KzYstihKToge01BWF9URUxFR1JBTV9TSVpFX01CfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICBwcmludCgi4pyFINin2YTYqNmI2Kog2KzYp9mH2LIg2YTZhNi52YXZhCEiKQogICAgICAgIHByaW50KCI9IiAqIDcwKQogICAgICAgIAogICAgICAgICMg2KrZhSDYqti52K/ZitmE2Ycg2YTZhNi52YXZhCDZgdmKIHRocmVhZAoKICAgICAgICAKICAgICAgICBpbXBvcnQgYXN5bmNpbwoKICAgICAgICAKICAgICAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCgogICAgICAgIAogICAgICAgIGFzeW5jaW8uc2V0X2V2ZW50X2xvb3AobG9vcCkKCiAgICAgICAgCiAgICAgICAgYXN5bmMgZGVmIHJ1bigpOgoKICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAuaW5pdGlhbGl6ZSgpCgogICAgICAgIAogICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC5zdGFydCgpCgogICAgICAgIAogICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC51cGRhdGVyLnN0YXJ0X3BvbGxpbmcoKQoKICAgICAgICAKICAgICAgICAgICAgdHJ5OgoKICAgICAgICAKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CgogICAgICAgIAogICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMSkKCiAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdDoKCiAgICAgICAgCiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIAogICAgICAgICAgICBmaW5hbGx5OgoKICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnVwZGF0ZXIuc3RvcCgpCgogICAgICAgIAogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAuc3RvcCgpCgogICAgICAgIAogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAuc2h1dGRvd24oKQoKICAgICAgICAKICAgICAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShydW4oKSkKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfjq8g2YbZgti32Kkg2KfZhNio2K/Yp9mK2KkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOgogICAgdHJ5OgogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYgRkZtcGVnCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ2ZmbXBlZycsICctdmVyc2lvbiddLCBjYXB0dXJlX291dHB1dD1UcnVlLCBjaGVjaz1UcnVlKQogICAgICAgICAgICBwcmludCgi4pyFINiq2YUg2KfZhNi52KvZiNixINi52YTZiSBGRm1wZWciKQogICAgICAgIGV4Y2VwdCAoc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IsIEZpbGVOb3RGb3VuZEVycm9yKToKICAgICAgICAgICAgcHJpbnQoIuKdjCBGRm1wZWcg2LrZitixINmF2KvYqNiqISIpCiAgICAgICAgICAgIHByaW50KCLYp9mE2LHYrNin2KEg2KrYq9io2YrYqtmHINio2KfZhNij2YXYsTogc3VkbyBhcHQgaW5zdGFsbCBmZm1wZWciKQogICAgICAgICAgICBleGl0KDEpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDYqtmI2YPZhiDYp9mE2KjZiNiqCiAgICAgICAgaWYgQk9UX1RPS0VOID09ICJZT1VSX0JPVF9UT0tFTl9IRVJFIjoKICAgICAgICAgICAgcHJpbnQoIuKdjCDYp9mE2LHYrNin2KEg2KrYudiv2YrZhCBCT1RfVE9LRU4g2YHZiiDYp9mE2YPZiNivISIpCiAgICAgICAgICAgIGV4aXQoMSkKICAgICAgICAKICAgICAgICAjINiq2LTYutmK2YQg2KfZhNio2YjYqgogICAgICAgIGJvdCA9IFZpZGVvQ29tcHJlc3NvckJvdChCT1RfVE9LRU4pCiAgICAgICAgYm90LnJ1bigpCiAgICAKICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoKICAgICAgICBwcmludCgiXG7wn5GLINiq2YUg2KXZitmC2KfZgSDYp9mE2KjZiNiqINio2YjYp9iz2LfYqSDYp9mE2YXYs9iq2K7Yr9mFIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHYp9iv2K06IHtlfSIpCiAgICAgICAgZXhpdCgxKQo=",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
