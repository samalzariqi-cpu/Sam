#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    global start_time
    uptime = str(datetime.now() - start_time).split(".")[0] if start_time else "0"
    
    html = """
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</title>
        <style>
            * {{
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 600px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9em;
            }}
            .status {{
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
            }}
            .status h2 {{
                color: #10b981;
                text-align: center;
                margin-bottom: 20px;
            }}
            .bot-item {{
                background: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIK8J+OrCDYttin2LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2KfYrdiq2LHYp9mB2YogLSBUZWxlZ3JhbSBCb3QK2KfZhNmG2LPYrtipINin2YTZhdit2LPZkdmG2Kkg2YXYuSDZhdmF2YrYstin2Kog2YXYqtmC2K/ZhdipIQoK2KfZhNmF2YXZitiy2KfYqiDYp9mE2KzYr9mK2K/YqToK4pyFINi22LrYtyDZgdin2KbZgiDYp9mE2LPYsdi52KkgKDN4INij2LPYsdi5KQrinIUg2LbYuti3INij2YLZiNmJIC0g2K3YrNmFINi12LrZitixINis2K/Yp9mLCuKchSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmI2YfYp9iqINmF2YfZhdinINmD2KfZhiDYrdis2YXZh9inICjYqtmC2LPZitmFINiq2YTZgtin2KbZiikK4pyFINiz2KzZhCDYo9iu2LfYp9ihIHR4dCDZhdmB2LXZhArinIUg2LPYrNmEINiq2YLYr9mFINmF2Lkg2KPYs9io2KfYqCDYp9mE2KrYo9iu2YrYsQrinIUg2K/YudmFINis2YXZiti5INij2K3YrNin2YUg2KfZhNmB2YrYr9mK2YjZh9in2KoKCtin2YTZhdiq2LfZhNio2KfYqjoKLSBQeXRob24gMy44KwotIEZGbXBlZyAoc3VkbyBhcHQgaW5zdGFsbCBmZm1wZWcpCi0gcGlwIGluc3RhbGwgcHl0aG9uLXRlbGVncmFtLWJvdCByZXF1ZXN0cyB0cWRtCgrYp9mE2KfYs9iq2K7Yr9in2YU6CjEuINi52K/ZhCBCT1RfVE9LRU4g2KPYr9mG2KfZhwoyLiDYtNi62YQ6IHB5dGhvbjMgdmlkZW9fY29tcHJlc3Nvcl9ib3RfcHJvLnB5CjMuINij2LHYs9mEINix2KfYqNi3INin2YTZgdmK2K/ZitmIINmE2YTYqNmI2KoKIiIiCgppbXBvcnQgb3MKaW1wb3J0IGFzeW5jaW8KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCByZQppbXBvcnQgdGltZQppbXBvcnQgbG9nZ2luZwppbXBvcnQganNvbgppbXBvcnQgemlwZmlsZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgVXBkYXRlLCBJbmxpbmVLZXlib2FyZEJ1dHRvbiwgSW5saW5lS2V5Ym9hcmRNYXJrdXAKZnJvbSB0ZWxlZ3JhbS5leHQgaW1wb3J0IEFwcGxpY2F0aW9uLCBDb21tYW5kSGFuZGxlciwgTWVzc2FnZUhhbmRsZXIsIENhbGxiYWNrUXVlcnlIYW5kbGVyLCBDb250ZXh0VHlwZXMsIGZpbHRlcnMKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIOKame+4jyDYp9mE2KXYudiv2KfYr9in2KogLSDYudiv2YQg2YfZhtinINmB2YLYtyEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpCT1RfVE9LRU4gPSAiODUwNDY0ODU1MDpBQUdINFRvNHZSdDczRjBlT0hIQlIzQnNEOUlTYS0wekF0SSIgICMg8J+RiCDYtti5INiq2YjZg9mGINin2YTYqNmI2Kog2YfZhtinClRFTVBfRElSID0gIi4vdGVtcF92aWRlb3MiICAjINmF2KzZhNivINin2YTZhdmE2YHYp9iqINin2YTZhdik2YLYqtipCkxPR1NfRElSID0gIi4vbG9ncyIgICMg2YXYrNmE2K8g2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoQpNQVhfVEVMRUdSQU1fU0laRV9NQiA9IDUwICAjINit2K8g2LHZgdi5INin2YTZhdmE2YHYp9iqINmB2YogVGVsZWdyYW0gKNmE2YPZhCDYrNiy2KEpCk1BWF9GSUxFX1BBUlRTID0gMTAgICMg2LnYr9ivINin2YTYo9is2LLYp9ihINin2YTYo9mC2LXZiSDZhNmE2KrZgtiz2YrZhQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+TnSDYpdi52K/Yp9ivINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mFIChMb2dnaW5nKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIERldGFpbGVkTG9nZ2VyOgogICAgIiIi2YHYptipINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mF2Kkg2YXYuSDYrdmB2Lgg2KfZhNij2K7Yt9in2KEg2YHZiiB0eHQiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ3NfZGlyPUxPR1NfRElSKToKICAgICAgICBzZWxmLmxvZ3NfZGlyID0gUGF0aChsb2dzX2RpcikKICAgICAgICBzZWxmLmxvZ3NfZGlyLm1rZGlyKGV4aXN0X29rPVRydWUpCiAgICAgICAgc2VsZi5jdXJyZW50X3Nlc3Npb25fbG9nID0gTm9uZQogICAgICAgIHNlbGYuc2V0dXBfbG9nZ2luZygpCiAgICAKICAgIGRlZiBzZXR1cF9sb2dnaW5nKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YbYuNin2YUg2KfZhNiq2LPYrNmK2YQiIiIKICAgICAgICBsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgICAgICAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShuYW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnLAogICAgICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8KICAgICAgICApCiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKICAgIAogICAgZGVmIHN0YXJ0X3Nlc3Npb24oc2VsZiwgdXNlcl9pZCwgdmlkZW9fdXJsKToKICAgICAgICAiIiLYqNiv2KEg2KzZhNiz2Kkg2KzYr9mK2K/YqSDZiNil2YbYtNin2KEg2YXZhNmBINiz2KzZhCIiIgogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWRfJUglTSVTIikKICAgICAgICBsb2dfZmlsZW5hbWUgPSBmInNlc3Npb25fe3VzZXJfaWR9X3t0aW1lc3RhbXB9LnR4dCIKICAgICAgICBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cgPSBzZWxmLmxvZ3NfZGlyIC8gbG9nX2ZpbGVuYW1lCiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgZi53cml0ZSgi8J+OrCDYs9is2YQg2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIIC0gVGVsZWdyYW0gQm90XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgICAgICBmLndyaXRlKGYi4o+wINin2YTYqtin2LHZitiuINmI2KfZhNmI2YLYqjoge2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIikKICAgICAgICAgICAgZi53cml0ZShmIvCfkaQg2YXYudix2YEg2KfZhNmF2LPYqtiu2K/ZhToge3VzZXJfaWR9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYi8J+UlyDYsdin2KjYtyDYp9mE2YHZitiv2YrZiDoge3ZpZGVvX3VybH1cblxuIikKICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgIGYud3JpdGUoIvCfk4sg2LPYrNmEINin2YTYudmF2YTZitin2Ko6XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgIAogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKICAgIAogICAgZGVmIGxvZyhzZWxmLCBtZXNzYWdlLCBsZXZlbD0iSU5GTyIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2LHYs9in2YTYqSDZgdmKINin2YTYs9is2YQg2YjYp9mE2YXZhNmBIiIiCiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBsb2dfbWVzc2FnZSA9IGYiW3t0aW1lc3RhbXB9XSBbe2xldmVsfV0ge21lc3NhZ2V9IgogICAgICAgIAogICAgICAgICMg2LfYqNin2LnYqSDZgdmKINin2YTZg9mI2YbYs9mI2YQKICAgICAgICBpZiBsZXZlbCA9PSAiRVJST1IiOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihtZXNzYWdlKQogICAgICAgIGVsaWYgbGV2ZWwgPT0gIldBUk5JTkciOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgIAogICAgICAgICMg2K3Zgdi4INmB2Yog2KfZhNmF2YTZgQogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShsb2dfbWVzc2FnZSArICJcbiIpCiAgICAKICAgIGRlZiBsb2dfZXJyb3Ioc2VsZiwgZXJyb3IsIGNvbnRleHQ9IiIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2K7Yt9ijINmF2YHYtdmEIiIiCiAgICAgICAgZXJyb3JfZGV0YWlscyA9IHsKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpLAogICAgICAgICAgICAnY29udGV4dCc6IGNvbnRleHQsCiAgICAgICAgICAgICdlcnJvcl90eXBlJzogdHlwZShlcnJvcikuX19uYW1lX18sCiAgICAgICAgICAgICdlcnJvcl9tZXNzYWdlJzogc3RyKGVycm9yKSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2VsZi5sb2coZiLinYwg2K7Yt9ijINmB2Yoge2NvbnRleHR9OiB7ZXJyb3J9IiwgIkVSUk9SIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2c6CiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2csICdhJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoIuKdjCDYqtmB2KfYtdmK2YQg2KfZhNiu2LfYozpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhlcnJvcl9kZXRhaWxzLCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD0yKSkKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuXG4iKQogICAgCiAgICBkZWYgZmluaXNoX3Nlc3Npb24oc2VsZiwgc3VjY2Vzcz1UcnVlLCBmaW5hbF9zaXplPU5vbmUpOgogICAgICAgICIiItil2YbZh9in2KEg2KfZhNis2YTYs9ipINmI2K3Zgdi4INin2YTZhdmE2K7YtSIiIgogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZSgiXG4iICsgIj0iICogODAgKyAiXG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgi8J+TiiDZhdmE2K7YtSDYp9mE2KzZhNiz2Kk6XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYi4o+wINmI2YLYqiDYp9mE2KfZhtiq2YfYp9ihOiB7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZShmIuKchSDYp9mE2K3Yp9mE2Kk6IHsn2YbYrNitJyBpZiBzdWNjZXNzIGVsc2UgJ9mB2LTZhCd9XG4iKQogICAgICAgICAgICAgICAgaWYgZmluYWxfc2l6ZToKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYi8J+TpiDYp9mE2K3YrNmFINin2YTZhtmH2KfYptmKOiB7ZmluYWxfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgIAogICAgZGVmIGdldF9sb2dfZmlsZShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTZgSDYp9mE2LPYrNmEINin2YTYrdin2YTZiiIiIgogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfk4og2YXYr9mK2LEg2KfZhNiq2YLYr9mFINin2YTZhdio2KfYtNixIChMaXZlIFByb2dyZXNzIFRyYWNrZXIpCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKY2xhc3MgTGl2ZVByb2dyZXNzVHJhY2tlcjoKICAgICIiItiq2KrYqNi5INin2YTYqtmC2K/ZhSDYp9mE2YXYqNin2LTYsSDZhdi5INiq2K3Yr9mK2KvYp9iqINiq2YTZgtin2KbZitipINmB2YogVGVsZWdyYW0iIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ2dlciwgbWVzc2FnZT1Ob25lKToKICAgICAgICBzZWxmLmxvZ2dlciA9IGxvZ2dlcgogICAgICAgIHNlbGYubWVzc2FnZSA9IG1lc3NhZ2UgICMg2LHYs9in2YTYqSBUZWxlZ3JhbSDZhNmE2KrYrdiv2YrYqwogICAgICAgIHNlbGYuc3RhcnRfdGltZSA9IE5vbmUKICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSBOb25lCiAgICAgICAgc2VsZi5jdXJyZW50X3BoYXNlID0gIiIKICAgICAgICBzZWxmLnByb2dyZXNzX3BlcmNlbnQgPSAwCiAgICAgICAgc2VsZi5jdXJyZW50X3N0ZXAgPSAwCiAgICAgICAgc2VsZi50b3RhbF9zdGVwcyA9IDAKICAgICAgICBzZWxmLnN0YXR1cyA9ICLij7MiCiAgICAgICAgc2VsZi5zcGVlZCA9IDAKICAgICAgICBzZWxmLmV0YSA9IDAKICAgICAgICBzZWxmLndhcm5pbmdzID0gW10KICAgICAgICBzZWxmLmxhc3RfbWVzc2FnZV90ZXh0ID0gIiIKICAgICAgICBzZWxmLnVwZGF0ZV9pbnRlcnZhbCA9IDMgICMg2KrYrdiv2YrYqyDZg9mEIDMg2KvZiNin2YbZjQogICAgICAgIHNlbGYuc3RhbGxfdGhyZXNob2xkID0gMTAgICMg2KXYsNinINmE2YUg2YrZg9mGINmH2YbYp9mDINiq2YLYr9mFINmE2YXYr9ipIDEwINir2YjYp9mG2Y0KICAgICAgICBzZWxmLmxhc3RfcHJvZ3Jlc3NfdGltZSA9IE5vbmUKICAgICAgICBzZWxmLmxhc3RfcHJvZ3Jlc3NfdmFsdWUgPSAwCiAgICAKICAgIGFzeW5jIGRlZiBzdGFydChzZWxmLCBwaGFzZSwgdG90YWxfc3RlcHM9MTAwKToKICAgICAgICAiIiLYqNiv2KEg2YXYsdit2YTYqSDYrNiv2YrYr9ipIiIiCiAgICAgICAgc2VsZi5jdXJyZW50X3BoYXNlID0gcGhhc2UKICAgICAgICBzZWxmLnRvdGFsX3N0ZXBzID0gdG90YWxfc3RlcHMKICAgICAgICBzZWxmLmN1cnJlbnRfc3RlcCA9IDAKICAgICAgICBzZWxmLnByb2dyZXNzX3BlcmNlbnQgPSAwCiAgICAgICAgc2VsZi5zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzc190aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLmxhc3RfcHJvZ3Jlc3NfdmFsdWUgPSAwCiAgICAgICAgc2VsZi53YXJuaW5ncyA9IFtdCiAgICAgICAgc2VsZi5zdGF0dXMgPSAi4pa277iPIgogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfmoAg2KjYr9ihINmF2LHYrdmE2Kk6IHtwaGFzZX0iKQogICAgICAgIAogICAgICAgIGlmIHNlbGYubWVzc2FnZToKICAgICAgICAgICAgYXdhaXQgc2VsZi51cGRhdGVfbWVzc2FnZSgpCiAgICAKICAgIGFzeW5jIGRlZiB1cGRhdGUoc2VsZiwgc3RlcCwgdG90YWw9Tm9uZSk6CiAgICAgICAgIiIi2KrYrdiv2YrYqyDYp9mE2KrZgtiv2YUiIiIKICAgICAgICBpZiB0b3RhbDoKICAgICAgICAgICAgc2VsZi50b3RhbF9zdGVwcyA9IHRvdGFsCiAgICAgICAgCiAgICAgICAgc2VsZi5jdXJyZW50X3N0ZXAgPSBzdGVwCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi50b3RhbF9zdGVwcyA+IDA6CiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfcGVyY2VudCA9IChzdGVwIC8gc2VsZi50b3RhbF9zdGVwcykgKiAxMDAKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINin2YTYs9ix2LnYqSDZiNin2YTZiNmC2Kog2KfZhNmF2KrYqNmC2YoKICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzZWxmLnN0YXJ0X3RpbWUKICAgICAgICBpZiBlbGFwc2VkID4gMCBhbmQgc3RlcCA+IDA6CiAgICAgICAgICAgIHNlbGYuc3BlZWQgPSBzdGVwIC8gZWxhcHNlZAogICAgICAgICAgICBpZiBzZWxmLnNwZWVkID4gMDoKICAgICAgICAgICAgICAgIHJlbWFpbmluZ19zdGVwcyA9IHNlbGYudG90YWxfc3RlcHMgLSBzdGVwCiAgICAgICAgICAgICAgICBzZWxmLmV0YSA9IHJlbWFpbmluZ19zdGVwcyAvIHNlbGYuc3BlZWQKICAgICAgICAKICAgICAgICAjINmD2LTZgSDYp9mE2KrZiNmC2YEKICAgICAgICBjdXJyZW50X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHRpbWVfc2luY2VfbGFzdF9wcm9ncmVzcyA9IGN1cnJlbnRfdGltZSAtIHNlbGYubGFzdF9wcm9ncmVzc190aW1lCiAgICAgICAgCiAgICAgICAgaWYgc3RlcCA+IHNlbGYubGFzdF9wcm9ncmVzc192YWx1ZToKICAgICAgICAgICAgIyDZh9mG2KfZgyDYqtmC2K/ZhQogICAgICAgICAgICBzZWxmLmxhc3RfcHJvZ3Jlc3NfdGltZSA9IGN1cnJlbnRfdGltZQogICAgICAgICAgICBzZWxmLmxhc3RfcHJvZ3Jlc3NfdmFsdWUgPSBzdGVwCiAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gIuKWtu+4jyIKICAgICAgICBlbGlmIHRpbWVfc2luY2VfbGFzdF9wcm9ncmVzcyA+IHNlbGYuc3RhbGxfdGhyZXNob2xkOgogICAgICAgICAgICAjINmE2Kcg2KrZgtiv2YUg2YXZhtiwINmB2KrYsdipCiAgICAgICAgICAgIHNlbGYuc3RhdHVzID0gIuKaoO+4jyIKICAgICAgICAgICAgd2FybmluZyA9IGYi2YTYpyDYqtmC2K/ZhSDZhdmG2LAge2ludCh0aW1lX3NpbmNlX2xhc3RfcHJvZ3Jlc3MpfSDYq9in2YbZitipIgogICAgICAgICAgICBpZiB3YXJuaW5nIG5vdCBpbiBzZWxmLndhcm5pbmdzOgogICAgICAgICAgICAgICAgc2VsZi53YXJuaW5ncy5hcHBlbmQod2FybmluZykKICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2Ksg2KfZhNix2LPYp9mE2KkKICAgICAgICBpZiBjdXJyZW50X3RpbWUgLSBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPj0gc2VsZi51cGRhdGVfaW50ZXJ2YWw6CiAgICAgICAgICAgIGlmIHNlbGYubWVzc2FnZToKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYudXBkYXRlX21lc3NhZ2UoKQogICAgICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSBjdXJyZW50X3RpbWUKICAgIAogICAgYXN5bmMgZGVmIGFkZF93YXJuaW5nKHNlbGYsIHdhcm5pbmcpOgogICAgICAgICIiItil2LbYp9mB2Kkg2KrYrdiw2YrYsSIiIgogICAgICAgIGlmIHdhcm5pbmcgbm90IGluIHNlbGYud2FybmluZ3M6CiAgICAgICAgICAgIHNlbGYud2FybmluZ3MuYXBwZW5kKHdhcm5pbmcpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyB7d2FybmluZ30iLCAiV0FSTklORyIpCiAgICAgICAgICAgIGlmIHNlbGYubWVzc2FnZToKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYudXBkYXRlX21lc3NhZ2UoKQogICAgCiAgICBhc3luYyBkZWYgZmluaXNoKHNlbGYsIHN1Y2Nlc3M9VHJ1ZSk6CiAgICAgICAgIiIi2KXZhtmH2KfYoSDYp9mE2YXYsdit2YTYqSIiIgogICAgICAgIHNlbGYuc3RhdHVzID0gIuKchSIgaWYgc3VjY2VzcyBlbHNlICLinYwiCiAgICAgICAgc2VsZi5wcm9ncmVzc19wZXJjZW50ID0gMTAwIGlmIHN1Y2Nlc3MgZWxzZSBzZWxmLnByb2dyZXNzX3BlcmNlbnQKICAgICAgICAKICAgICAgICBpZiBzZWxmLm1lc3NhZ2U6CiAgICAgICAgICAgIGF3YWl0IHNlbGYudXBkYXRlX21lc3NhZ2UoKQogICAgCiAgICBkZWYgZ2V0X3Byb2dyZXNzX2JhcihzZWxmLCB3aWR0aD0xMCk6CiAgICAgICAgIiIi2KXZhti02KfYoSDYtNix2YrYtyDYqtmC2K/ZhSIiIgogICAgICAgIGZpbGxlZCA9IGludCgoc2VsZi5wcm9ncmVzc19wZXJjZW50IC8gMTAwKSAqIHdpZHRoKQogICAgICAgIGVtcHR5ID0gd2lkdGggLSBmaWxsZWQKICAgICAgICByZXR1cm4gIuKWiCIgKiBmaWxsZWQgKyAi4paRIiAqIGVtcHR5CiAgICAKICAgIGRlZiBmb3JtYXRfdGltZShzZWxmLCBzZWNvbmRzKToKICAgICAgICAiIiLYqtmG2LPZitmCINin2YTZiNmC2KoiIiIKICAgICAgICBpZiBzZWNvbmRzIDwgNjA6CiAgICAgICAgICAgIHJldHVybiBmIntpbnQoc2Vjb25kcyl92KsiCiAgICAgICAgZWxpZiBzZWNvbmRzIDwgMzYwMDoKICAgICAgICAgICAgcmV0dXJuIGYie2ludChzZWNvbmRzIC8gNjApfdivIHtpbnQoc2Vjb25kcyAlIDYwKX3YqyIKICAgICAgICBlbHNlOgogICAgICAgICAgICBob3VycyA9IGludChzZWNvbmRzIC8gMzYwMCkKICAgICAgICAgICAgbWludXRlcyA9IGludCgoc2Vjb25kcyAlIDM2MDApIC8gNjApCiAgICAgICAgICAgIHJldHVybiBmIntob3Vyc33YsyB7bWludXRlc33YryIKICAgIAogICAgYXN5bmMgZGVmIHVwZGF0ZV9tZXNzYWdlKHNlbGYpOgogICAgICAgICIiItiq2K3Yr9mK2Ksg2LHYs9in2YTYqSBUZWxlZ3JhbSIiIgogICAgICAgIGlmIG5vdCBzZWxmLm1lc3NhZ2U6CiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KjZhtin2KEg2YbYtSDYp9mE2LHYs9in2YTYqQogICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHNlbGYuc3RhcnRfdGltZQogICAgICAgIAogICAgICAgIG1lc3NhZ2VfdGV4dCA9IGYie3NlbGYuc3RhdHVzfSAqKntzZWxmLmN1cnJlbnRfcGhhc2V9KipcblxuIgogICAgICAgIAogICAgICAgICMg2LTYsdmK2Lcg2KfZhNiq2YLYr9mFCiAgICAgICAgcHJvZ3Jlc3NfYmFyID0gc2VsZi5nZXRfcHJvZ3Jlc3NfYmFyKDE1KQogICAgICAgIG1lc3NhZ2VfdGV4dCArPSBmIntwcm9ncmVzc19iYXJ9IHtzZWxmLnByb2dyZXNzX3BlcmNlbnQ6LjFmfSVcblxuIgogICAgICAgIAogICAgICAgICMg2KfZhNiq2YHYp9i12YrZhAogICAgICAgIG1lc3NhZ2VfdGV4dCArPSBmIvCfk4ogKirYp9mE2KrZgdin2LXZitmEOioqXG4iCiAgICAgICAgbWVzc2FnZV90ZXh0ICs9IGYi4o+x77iPINin2YTZiNmC2Ko6IHtzZWxmLmZvcm1hdF90aW1lKGVsYXBzZWQpfVxuIgogICAgICAgIAogICAgICAgIGlmIHNlbGYuZXRhID4gMCBhbmQgc2VsZi5zdGF0dXMgPT0gIuKWtu+4jyI6CiAgICAgICAgICAgIG1lc3NhZ2VfdGV4dCArPSBmIuKPsyDYp9mE2YjZgtiqINin2YTZhdiq2KjZgtmKOiB7c2VsZi5mb3JtYXRfdGltZShzZWxmLmV0YSl9XG4iCiAgICAgICAgCiAgICAgICAgaWYgc2VsZi5zcGVlZCA+IDA6CiAgICAgICAgICAgIG1lc3NhZ2VfdGV4dCArPSBmIuKaoSDYp9mE2LPYsdi52Kk6IHtzZWxmLnNwZWVkOi4xZn0v2KvYp9mG2YrYqVxuIgogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3YsNmK2LHYp9iqCiAgICAgICAgaWYgc2VsZi53YXJuaW5nczoKICAgICAgICAgICAgbWVzc2FnZV90ZXh0ICs9IGYiXG7imqDvuI8gKirYqtit2LDZitix2KfYqjoqKlxuIgogICAgICAgICAgICBmb3Igd2FybmluZyBpbiBzZWxmLndhcm5pbmdzWy0zOl06ICAjINii2K7YsSAzINiq2K3YsNmK2LHYp9iqCiAgICAgICAgICAgICAgICBtZXNzYWdlX3RleHQgKz0gZiLigKIge3dhcm5pbmd9XG4iCiAgICAgICAgCiAgICAgICAgbWVzc2FnZV90ZXh0ICs9IGYiXG7wn5KhINin2YTYqNmI2Kog2YrYudmF2YQuLi4iCiAgICAgICAgCiAgICAgICAgIyDYqtit2K/ZitirINmB2YLYtyDYpdiw2Kcg2KrYutmK2LEg2KfZhNmG2LUKICAgICAgICBpZiBtZXNzYWdlX3RleHQgIT0gc2VsZi5sYXN0X21lc3NhZ2VfdGV4dDoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5tZXNzYWdlLmVkaXRfdGV4dChtZXNzYWdlX3RleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgICAgICAgICAgICAgIHNlbGYubGFzdF9tZXNzYWdlX3RleHQgPSBtZXNzYWdlX3RleHQKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgIyDYqtis2KfZh9mEINij2K7Yt9in2KEg2KfZhNiq2K3Yr9mK2KsgKNmF2KvZhDogbm8gY2hhbmdlcykKICAgICAgICAgICAgICAgIHBhc3MKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfk4og2YXYr9mK2LEg2KfZhNiq2YLYr9mFIChQcm9ncmVzcyBNYW5hZ2VyKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFByb2dyZXNzTWFuYWdlcjoKICAgICIiItil2K/Yp9ix2Kkg2YjYudix2LYg2KfZhNiq2YLYr9mFINmF2Lkg2YPYtNmBINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LEiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ2dlcik6CiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnZXIKICAgICAgICBzZWxmLnN0YXJ0X3RpbWUgPSBOb25lCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gTm9uZQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSAwCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5waGFzZSA9ICIiCiAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zID0gW10KICAgIAogICAgZGVmIHN0YXJ0KHNlbGYsIHBoYXNlLCB0b3RhbF9zaXplPTApOgogICAgICAgICIiItio2K/YoSDZhdix2K3ZhNipINis2K/Zitiv2KkiIiIKICAgICAgICBzZWxmLnBoYXNlID0gcGhhc2UKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMgPSBbXQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfmoAg2KjYr9ihINmF2LHYrdmE2Kk6IHtwaGFzZX0iKQogICAgCiAgICBkZWYgdXBkYXRlKHNlbGYsIGN1cnJlbnQsIHRvdGFsPU5vbmUpOgogICAgICAgICIiItiq2K3Yr9mK2Ksg2KfZhNiq2YLYr9mFIiIiCiAgICAgICAgaWYgdG90YWw6CiAgICAgICAgICAgIHNlbGYudG90YWxfc2l6ZSA9IHRvdGFsCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSBjdXJyZW50CiAgICAgICAgCiAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID0gY3VycmVudF90aW1lIC0gc2VsZi5sYXN0X3VwZGF0ZV90aW1lCiAgICAgICAgCiAgICAgICAgIyDZg9i02YEg2KfZhNiq2KPYrtmK2LEKICAgICAgICBpZiB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID4gNTogICMg2KPZg9ir2LEg2YXZhiA1INir2YjYp9mG2Y0g2KjYr9mI2YYg2KrYrdiv2YrYqwogICAgICAgICAgICBwcm9ncmVzc19jaGFuZ2UgPSBjdXJyZW50IC0gc2VsZi5sYXN0X3Byb2dyZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm9ncmVzc19jaGFuZ2UgPT0gMDoKICAgICAgICAgICAgICAgIHJlYXNvbiA9ICLimqDvuI8g2YTYpyDYqtmI2KzYryDYrdix2YPYqSAtINix2KjZhdinINmF2LTZg9mE2Kkg2YHZiiDYp9mE2LTYqNmD2KkiCiAgICAgICAgICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMuYXBwZW5kKHJlYXNvbikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhyZWFzb24sICJXQVJOSU5HIikKICAgICAgICAgICAgZWxpZiBwcm9ncmVzc19jaGFuZ2UgPCAxMDI0ICogMTAwOiAgIyDYo9mC2YQg2YXZhiAxMDBLQgogICAgICAgICAgICAgICAgcmVhc29uID0gZiLwn5CMINiz2LHYudipINio2LfZitim2Kkg2KzYr9in2YsgLSB7cHJvZ3Jlc3NfY2hhbmdlIC8gMTAyNDouMmZ9IEtCINmB2Yoge3RpbWVfc2luY2VfbGFzdF91cGRhdGU6LjFmfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zLmFwcGVuZChyZWFzb24pCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2cocmVhc29uLCAiV0FSTklORyIpCiAgICAgICAgCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgc2VsZi5sYXN0X3Byb2dyZXNzID0gY3VycmVudAogICAgCiAgICBkZWYgZ2V0X3Byb2dyZXNzX3RleHQoc2VsZik6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhti1INin2YTYqtmC2K/ZhSIiIgogICAgICAgIGlmIHNlbGYudG90YWxfc2l6ZSA+IDA6CiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAoc2VsZi5kb3dubG9hZGVkX3NpemUgLyBzZWxmLnRvdGFsX3NpemUpICogMTAwCiAgICAgICAgICAgIGRvd25sb2FkZWRfbWIgPSBzZWxmLmRvd25sb2FkZWRfc2l6ZSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgIHRvdGFsX21iID0gc2VsZi50b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHNlbGYuc3RhcnRfdGltZQogICAgICAgICAgICBpZiBzZWxmLmRvd25sb2FkZWRfc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICBzcGVlZCA9IHNlbGYuZG93bmxvYWRlZF9zaXplIC8gZWxhcHNlZAogICAgICAgICAgICAgICAgc3BlZWRfbWIgPSBzcGVlZCAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICByZW1haW5pbmdfYnl0ZXMgPSBzZWxmLnRvdGFsX3NpemUgLSBzZWxmLmRvd25sb2FkZWRfc2l6ZQogICAgICAgICAgICAgICAgZXRhID0gcmVtYWluaW5nX2J5dGVzIC8gc3BlZWQgaWYgc3BlZWQgPiAwIGVsc2UgMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIGYi8J+TpSB7c2VsZi5waGFzZX1cbiIKICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNiq2YLYr9mFOiB7cGVyY2VudGFnZTouMWZ9JVxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+TpiB7ZG93bmxvYWRlZF9tYjouMWZ9IC8ge3RvdGFsX21iOi4xZn0g2YXZitis2KfYqNin2YrYqlxuIgogICAgICAgICAgICAgICAgICAgIGYi4pqhINin2YTYs9ix2LnYqToge3NwZWVkX21iOi4yZn0g2YXZitis2KfYqNin2YrYqi/Yq9in2YbZitipXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7HvuI8g2KfZhNmI2YLYqiDYp9mE2YXYqtio2YLZijoge2ludChldGEpfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIHJldHVybiBmIuKPsyB7c2VsZi5waGFzZX0uLi4iCiAgICAKICAgIGRlZiBnZXRfZGVsYXlfc3VtbWFyeShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTYrti1INin2YTYqtij2K7Zitix2KfYqiIiIgogICAgICAgIGlmIHNlbGYuZGVsYXlfcmVhc29uczoKICAgICAgICAgICAgcmV0dXJuICLwn5SNINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LE6XG4iICsgIlxuIi5qb2luKGYiICDigKIge3J9IiBmb3IgciBpbiBzZWxmLmRlbGF5X3JlYXNvbnNbLTM6XSkKICAgICAgICByZXR1cm4gIiIKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfjqwg2YHYptipINi22KfYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdit2LPZkdmG2KkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBWaWRlb0NvbXByZXNzb3I6CiAgICAiIiLZgdim2Kkg2LTYp9mF2YTYqSDZhNiq2K3ZhdmK2YQg2YjYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KjYs9ix2LnYqSDZgdin2KbZgtipIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0ZW1wX2Rpcj1URU1QX0RJUiwgbG9nZ2VyPU5vbmUsIGxpdmVfdHJhY2tlcj1Ob25lKToKICAgICAgICAiIiLYqtmH2YrYptipINin2YTYttin2LrYtyIiIgogICAgICAgIHNlbGYudGVtcF9kaXIgPSBQYXRoKHRlbXBfZGlyKQogICAgICAgIHNlbGYudGVtcF9kaXIubWtkaXIoZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBzZWxmLmxvZ2dlciA9IGxvZ2dlcgogICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlciA9IFByb2dyZXNzTWFuYWdlcihsb2dnZXIpCiAgICAgICAgc2VsZi5saXZlX3RyYWNrZXIgPSBsaXZlX3RyYWNrZXIgICMg2YXYqtiq2KjYuSDYp9mE2KrZgtiv2YUg2KfZhNmF2KjYp9i02LEKICAgICAgICBsb2dnZXIubG9nKGYi8J+TgSDYqtmFINil2YbYtNin2KEg2YXYrNmE2K8g2YXYpNmC2Ko6IHtzZWxmLnRlbXBfZGlyfSIpCiAgICAKICAgIGRlZiBleHRyYWN0X2dvb2dsZV9kcml2ZV9pZChzZWxmLCB1cmwpOgogICAgICAgICIiItin2LPYqtiu2LHYp9isINmF2LnYsdmBINin2YTZhdmE2YEg2YXZhiDYsdin2KjYtyBHb29nbGUgRHJpdmUiIiIKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgcidpZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcicvZC8oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcidvcGVuXD9pZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHVybCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X2dvb2dsZV9kcml2ZV9kb3dubG9hZF91cmwoc2VsZiwgZmlsZV9pZCk6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsSDZhdmGIEdvb2dsZSBEcml2ZSIiIgogICAgICAgIHJldHVybiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkJmNvbmZpcm09dCIKICAgIAogICAgZGVmIF9kb3dubG9hZF9mcm9tX2dvb2dsZV9kcml2ZShzZWxmLCBmaWxlX2lkLCBvdXRwdXRfcGF0aCwgY2h1bmtfc2l6ZT02NTUzNik6CiAgICAgICAgIiIiCiAgICAgICAg2KrYrdmF2YrZhCDYs9ix2YrYuSDZhdmGIEdvb2dsZSBEcml2ZSDZhdi5INmF2LnYp9mE2KzYqSDYrNmF2YrYuSDYo9mG2YjYp9i5INin2YTZhdmE2YHYp9iqCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+UhCDZhdit2KfZiNmE2Kkg2KfZhNiq2K3ZhdmK2YQg2YXZhiBHb29nbGUgRHJpdmUuLi4iKQogICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDZhdmGIEdvb2dsZSBEcml2ZSIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINin2LPYqtiu2K/Yp9mFIGdkb3duINil2LDYpyDZg9in2YYg2YXYqtmI2YHYsdin2YsgKNij2LPYsdi5INi32LHZitmC2KkpCiAgICAgICAgICAgIGltcG9ydCBnZG93bgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIuKchSDYp9iz2KrYrtiv2KfZhSBnZG93biDZhNmE2KrYrdmF2YrZhCDYp9mE2LPYsdmK2LkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/aWQ9e2ZpbGVfaWR9IgogICAgICAgICAgICBvdXRwdXQgPSBnZG93bi5kb3dubG9hZCh1cmwsIHN0cihvdXRwdXRfcGF0aCksIHF1aWV0PUZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb3V0cHV0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLZgdi02YQg2KfZhNiq2K3ZhdmK2YQg2KjYp9iz2KrYrtiv2KfZhSBnZG93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBmaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhCDYqNmG2KzYp9itISDYp9mE2K3YrNmFOiB7ZmluYWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygi4pqg77iPIGdkb3duINi62YrYsSDZhdiq2YjZgdix2Iwg2KfYs9iq2K7Yr9in2YUg2KfZhNi32LHZitmC2Kkg2KfZhNmK2K/ZiNmK2KkuLi4iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nX2Vycm9yKGUsICLYqtit2YXZitmEIGdkb3duIikKICAgICAgICAKICAgICAgICAjINin2YTYt9ix2YrZgtipINin2YTZitiv2YjZitipINin2YTZhdit2LPZkdmG2KkKICAgICAgICBzZXNzaW9uID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgCiAgICAgICAgYXR0ZW1wdHMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICd1cmwnOiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkJmNvbmZpcm09dCIsCiAgICAgICAgICAgICAgICAnbmFtZSc6ICdEaXJlY3Qgd2l0aCBjb25maXJtPXQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICd1cmwnOiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkIiwKICAgICAgICAgICAgICAgICduYW1lJzogJ1dpdGggY29va2llcycsCiAgICAgICAgICAgICAgICAndXNlX2Nvb2tpZXMnOiBUcnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBhdHRlbXB0X251bSwgYXR0ZW1wdCBpbiBlbnVtZXJhdGUoYXR0ZW1wdHMsIDEpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5SEINin2YTZhdit2KfZiNmE2Kkge2F0dGVtcHRfbnVtfToge2F0dGVtcHRbJ25hbWUnXX0uLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0LmdldCgndXNlX2Nvb2tpZXMnKToKICAgICAgICAgICAgICAgICAgICBpbml0X3Jlc3BvbnNlID0gc2Vzc2lvbi5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2lkPXtmaWxlX2lkfSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbT1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTYwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlc3Npb24uZ2V0KAogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRbJ3VybCddLAogICAgICAgICAgICAgICAgICAgIHN0cmVhbT1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTIwLAogICAgICAgICAgICAgICAgICAgIGFsbG93X3JlZGlyZWN0cz1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgJ3RleHQvaHRtbCcgaW4gY29udGVudF90eXBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyDYtdmB2K3YqSBIVE1MIC0g2YXYrdin2YjZhNipINin2LPYqtiu2LHYp9isINin2YTYsdin2KjYty4uLiIpCiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHJlc3BvbnNlLnRleHQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgcidocmVmPSIoaHR0cHM6Ly9kcml2ZVwudXNlcmNvbnRlbnRcLmdvb2dsZVwuY29tL2Rvd25sb2FkW14iXSspIicsCiAgICAgICAgICAgICAgICAgICAgICAgIHInaHJlZj0iKC91Y1w/ZXhwb3J0PWRvd25sb2FkJmFtcDtjb25maXJtPVteIl0rJmFtcDtpZD0nICsgZmlsZV9pZCArIHInKSInLAogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZF91cmwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIGNvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRfdXJsID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRvd25sb2FkX3VybC5zdGFydHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRfdXJsID0gJ2h0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbScgKyBkb3dubG9hZF91cmwucmVwbGFjZSgnJmFtcDsnLCAnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgZG93bmxvYWRfdXJsOgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlc3Npb24uZ2V0KGRvd25sb2FkX3VybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MTIwKQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgJ3RleHQvaHRtbCcgaW4gY29udGVudF90eXBlOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0b3RhbF9zaXplID0gaW50KHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LWxlbmd0aCcsIDApKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB0b3RhbF9zaXplID4gMDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINit2KzZhSDYp9mE2YXZhNmBOiB7dG90YWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyLnN0YXJ0KCLYqtit2YXZitmEINin2YTZgdmK2K/ZitmIIiwgdG90YWxfc2l6ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYp9mE2KrYrdmF2YrZhCDYqNin2YTZgti32Lkg2KfZhNmD2KjZitix2KkgKNij2LPYsdi5KQogICAgICAgICAgICAgICAgZG93bmxvYWRlZF9zaXplID0gMAogICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmb3IgY2h1bmsgaW4gcmVzcG9uc2UuaXRlcl9jb250ZW50KGNodW5rX3NpemU9Y2h1bmtfc2l6ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNodW5rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZWRfc2l6ZSArPSBsZW4oY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIudXBkYXRlKGRvd25sb2FkZWRfc2l6ZSwgdG90YWxfc2l6ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICAgICAgZmluYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZmluYWxfc2l6ZSA8IDEwMjQgKiAxMDA6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmItin2YTZhdmE2YEg2KfZhNmF2K3ZhdmEINi12LrZitixINis2K/Yp9mLICh7ZmluYWxfc2l6ZX0g2KjYp9mK2KopIC0g2YLYryDZitmD2YjZhiDYtdmB2K3YqSBIVE1MIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXZnX3NwZWVkID0gZmluYWxfc2l6ZSAvIGVsYXBzZWQgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQg2KjZhtis2KfYrSEiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDYp9mE2K3YrNmFOiB7ZmluYWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimqEg2YXYqtmI2LPYtyDYp9mE2LPYsdi52Kk6IHthdmdfc3BlZWQ6LjJmfSDZhdmK2KzYp9io2KfZitiqL9ir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZ19lcnJvcihlLCBmItmF2K3Yp9mI2YTYqSDYp9mE2KrYrdmF2YrZhCB7YXR0ZW1wdF9udW19IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCLZgdi02YQg2KrYrdmF2YrZhCDYp9mE2YXZhNmBINmF2YYgR29vZ2xlIERyaXZlINio2LnYryDYrNmF2YrYuSDYp9mE2YXYrdin2YjZhNin2KoiKQogICAgCiAgICBkZWYgZG93bmxvYWRfdmlkZW8oc2VsZiwgdXJsLCBvdXRwdXRfcGF0aCk6CiAgICAgICAgIiIi2KrYrdmF2YrZhCDZgdmK2K/ZitmIINmF2YYg2KPZiiDYsdin2KjYtyIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Ug2KjYr9ihINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflJcg2KfZhNix2KfYqNi3OiB7dXJsWzoxMDBdfS4uLiIpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDZhtmI2Lkg2KfZhNix2KfYqNi3CiAgICAgICAgZmlsZV9pZCA9IHNlbGYuZXh0cmFjdF9nb29nbGVfZHJpdmVfaWQodXJsKQogICAgICAgIAogICAgICAgIGlmIGZpbGVfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflI0g2KrZhSDYp9mD2KrYtNin2YEg2LHYp9io2LcgR29vZ2xlIERyaXZlOiB7ZmlsZV9pZH0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZG93bmxvYWRfZnJvbV9nb29nbGVfZHJpdmUoZmlsZV9pZCwgb3V0cHV0X3BhdGgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyDYsdin2KjYtyDYqtit2YXZitmEINmF2KjYp9i02LEKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+UlyDYsdin2KjYtyDYqtit2YXZitmEINmF2KjYp9i02LEiKQogICAgICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIuc3RhcnQoItiq2K3ZhdmK2YQg2YXZhiDYsdin2KjYtyDZhdio2KfYtNixIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MTIwKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHRvdGFsX3NpemUgPSBpbnQocmVzcG9uc2UuaGVhZGVycy5nZXQoJ2NvbnRlbnQtbGVuZ3RoJywgMCkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB0b3RhbF9zaXplID4gMDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2K3YrNmFINin2YTZhdmE2YE6IHt0b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiCIsIHRvdGFsX3NpemUpCiAgICAgICAgICAgIAogICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT02NTUzNik6CiAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZWRfc2l6ZSArPSBsZW4oY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci51cGRhdGUoZG93bmxvYWRlZF9zaXplLCB0b3RhbF9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgZmluYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQhINin2YTYrdis2YU6IHtmaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBzdHIob3V0cHV0X3BhdGgpCiAgICAKICAgIGRlZiBnZXRfdmlkZW9faW5mbyhzZWxmLCB2aWRlb19wYXRoKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmIIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDYrNin2LHZiiDZgdit2LUg2YXYudmE2YjZhdin2Kog2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgIAogICAgICAgIGNtZCA9IFsKICAgICAgICAgICAgJ2ZmcHJvYmUnLAogICAgICAgICAgICAnLXYnLCAncXVpZXQnLAogICAgICAgICAgICAnLXByaW50X2Zvcm1hdCcsICdqc29uJywKICAgICAgICAgICAgJy1zaG93X2Zvcm1hdCcsCiAgICAgICAgICAgICctc2hvd19zdHJlYW1zJywKICAgICAgICAgICAgc3RyKHZpZGVvX3BhdGgpCiAgICAgICAgXQogICAgICAgIAogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgIGluZm8gPSBqc29uLmxvYWRzKHJlc3VsdC5zdGRvdXQpCiAgICAgICAgCiAgICAgICAgIyDYp9iz2KrYrtix2KfYrCDYp9mE2YXYudmE2YjZhdin2KoKICAgICAgICBkdXJhdGlvbiA9IGZsb2F0KGluZm9bJ2Zvcm1hdCddLmdldCgnZHVyYXRpb24nLCAwKSkKICAgICAgICBzaXplID0gaW50KGluZm9bJ2Zvcm1hdCddLmdldCgnc2l6ZScsIDApKQogICAgICAgIAogICAgICAgIHZpZGVvX3N0cmVhbSA9IG5leHQoKHMgZm9yIHMgaW4gaW5mb1snc3RyZWFtcyddIGlmIHNbJ2NvZGVjX3R5cGUnXSA9PSAndmlkZW8nKSwgTm9uZSkKICAgICAgICAKICAgICAgICBpZiB2aWRlb19zdHJlYW06CiAgICAgICAgICAgIHdpZHRoID0gaW50KHZpZGVvX3N0cmVhbS5nZXQoJ3dpZHRoJywgMCkpCiAgICAgICAgICAgIGhlaWdodCA9IGludCh2aWRlb19zdHJlYW0uZ2V0KCdoZWlnaHQnLCAwKSkKICAgICAgICAgICAgYml0cmF0ZSA9IGludChpbmZvWydmb3JtYXQnXS5nZXQoJ2JpdF9yYXRlJywgMCkpCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5O5INin2YTYo9io2LnYp9ivOiB7d2lkdGh9eHtoZWlnaHR9IikKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4o+x77iPINin2YTZhdiv2Kk6IHtkdXJhdGlvbjouMWZ9INir2KfZhtmK2KkiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINin2YTYrdis2YU6IHtzaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqhINmF2LnYr9mEINin2YTYqNiqOiB7Yml0cmF0ZSAvIDEwMDA6LjBmfSDZg9mK2YTZiNio2Kov2KvYp9mG2YrYqSIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgJ2R1cmF0aW9uJzogZHVyYXRpb24sCiAgICAgICAgICAgICAgICAnc2l6ZSc6IHNpemUsCiAgICAgICAgICAgICAgICAnd2lkdGgnOiB3aWR0aCwKICAgICAgICAgICAgICAgICdoZWlnaHQnOiBoZWlnaHQsCiAgICAgICAgICAgICAgICAnYml0cmF0ZSc6IGJpdHJhdGUKICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoItmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNmB2YrYr9mK2YgiKQogICAgCiAgICBkZWYgY29tcHJlc3NfdmlkZW8oc2VsZiwgaW5wdXRfcGF0aCwgb3V0cHV0X3BhdGgsIHF1YWxpdHk9J21lZGl1bScpOgogICAgICAgICIiIgogICAgICAgINi22LrYtyDYp9mE2YHZitiv2YrZiCDYqNiz2LHYudipINmB2KfYptmC2Kkg2YjYrdis2YUg2LXYutmK2LEg2KzYr9in2YsKICAgICAgICAKICAgICAgICDZhdiz2KrZiNmK2KfYqiDYp9mE2KzZiNiv2Kk6CiAgICAgICAgLSB1bHRyYV9sb3c6INit2KzZhSDYtdi62YrYsSDYrNiv2KfZiyAoQ1JGIDM1LCA0ODBwLCDZhdi52K/ZhCDYpdi32KfYsdin2Kog2YXZhtiu2YHYtikKICAgICAgICAtIGxvdzog2K3YrNmFINi12LrZitixIChDUkYgMzIsIDcyMHApCiAgICAgICAgLSBtZWRpdW06INmF2KrZiNin2LLZhiAoQ1JGIDI4LCA3MjBwKQogICAgICAgIC0gaGlnaDog2KzZiNiv2Kkg2LnYp9mE2YrYqSAoQ1JGIDIzLCAxMDgwcCkKICAgICAgICAiIiIKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn46sINio2K/YoSDYtti62Lcg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2YXYs9iq2YjZiSDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5fSIpCiAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyLnN0YXJ0KCLYtti62Lcg2KfZhNmB2YrYr9mK2YgiKQogICAgICAgIAogICAgICAgICMg2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiAogICAgICAgIHZpZGVvX2luZm8gPSBzZWxmLmdldF92aWRlb19pbmZvKGlucHV0X3BhdGgpCiAgICAgICAgZHVyYXRpb24gPSB2aWRlb19pbmZvWydkdXJhdGlvbiddCiAgICAgICAgCiAgICAgICAgIyDYpdi52K/Yp9iv2KfYqiDYp9mE2KzZiNiv2Kkg2KfZhNmF2K3Ys9mR2YbYqQogICAgICAgIHF1YWxpdHlfc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICdtYXhpbXVtX2NvbXByZXNzaW9uJzogewogICAgICAgICAgICAgICAgJ2NyZic6ICc0MCcsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc0ODA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcxOCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICcyNGsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAndWx0cmFfbG93JzogewogICAgICAgICAgICAgICAgJ2NyZic6ICczNScsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc2NDA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcyMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICczMmsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnbG93JzogewogICAgICAgICAgICAgICAgJ2NyZic6ICczMicsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc4NTQ6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcyNCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICc2NGsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnbWVkaXVtJzogewogICAgICAgICAgICAgICAgJ2NyZic6ICcyOCcsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ2Zhc3QnLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzEyODA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICczMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICc5NmsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnaGlnaCc6IHsKICAgICAgICAgICAgICAgICdjcmYnOiAnMjMnLAogICAgICAgICAgICAgICAgJ3ByZXNldCc6ICdtZWRpdW0nLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzE5MjA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICczMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICcxMjhrJywKICAgICAgICAgICAgICAgICd2Y29kZWMnOiAnbGlieDI2NCcKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0dGluZ3MgPSBxdWFsaXR5X3NldHRpbmdzLmdldChxdWFsaXR5LCBxdWFsaXR5X3NldHRpbmdzWydtZWRpdW0nXSkKICAgICAgICAKICAgICAgICAjINio2YbYp9ihINij2YXYsSBGRm1wZWcg2KfZhNmF2K3Ys9mR2YYKICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICdmZm1wZWcnLAogICAgICAgICAgICAnLWknLCBzdHIoaW5wdXRfcGF0aCksCiAgICAgICAgICAgICctYzp2Jywgc2V0dGluZ3NbJ3Zjb2RlYyddLAogICAgICAgICAgICAnLXByZXNldCcsIHNldHRpbmdzWydwcmVzZXQnXSwKICAgICAgICAgICAgJy1jcmYnLCBzZXR0aW5nc1snY3JmJ10sCiAgICAgICAgICAgICctdmYnLCBmInNjYWxlPXtzZXR0aW5nc1snc2NhbGUnXX0sZnBzPXtzZXR0aW5nc1snZnBzJ119IiwKICAgICAgICAgICAgJy1jOmEnLCAnYWFjJywKICAgICAgICAgICAgJy1iOmEnLCBzZXR0aW5nc1snYXVkaW9fYml0cmF0ZSddLAogICAgICAgICAgICAnLWFjJywgJzEnLCAgIyDYo9it2KfYr9mKINin2YTZgtmG2KfYqSAobW9ubykg2YTYqtmC2YTZitmEINin2YTYrdis2YUKICAgICAgICAgICAgJy1tb3ZmbGFncycsICcrZmFzdHN0YXJ0JywKICAgICAgICAgICAgJy15JywKICAgICAgICAgICAgc3RyKG91dHB1dF9wYXRoKQogICAgICAgIF0KICAgICAgICAKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimpnvuI8g2KPZhdixIEZGbXBlZzogeycgJy5qb2luKGNtZCl9IikKICAgICAgICAKICAgICAgICAjINiq2LTYutmK2YQgRkZtcGVnINmF2Lkg2YXYsdin2YLYqNipINin2YTYqtmC2K/ZhQogICAgICAgIHByb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKAogICAgICAgICAgICBjbWQsCiAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgIHVuaXZlcnNhbF9uZXdsaW5lcz1UcnVlCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2YXYsdin2YLYqNipINin2YTYqtmC2K/ZhQogICAgICAgIGxhc3RfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgbGFzdF9sb2dfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgCiAgICAgICAgZm9yIGxpbmUgaW4gcHJvY2Vzcy5zdGRlcnI6CiAgICAgICAgICAgIGlmICd0aW1lPScgaW4gbGluZToKICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHIndGltZT0oXGQrKTooXGQrKTooXGQrKScsIGxpbmUpCiAgICAgICAgICAgICAgICBpZiBtYXRjaDoKICAgICAgICAgICAgICAgICAgICBoLCBtLCBzID0gbWFwKGludCwgbWF0Y2guZ3JvdXBzKCkpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gaCAqIDM2MDAgKyBtICogNjAgKyBzCiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3MgPSAoY3VycmVudF90aW1lIC8gZHVyYXRpb24pICogMTAwIGlmIGR1cmF0aW9uID4gMCBlbHNlIDAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjINiq2K3Yr9mK2Ksg2KfZhNmF2KrYqtio2Lkg2KfZhNmF2KjYp9i02LEKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmxpdmVfdHJhY2tlcjoKICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0IGFzeW5jaW8KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNpby5jcmVhdGVfdGFzaygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxpdmVfdHJhY2tlci51cGRhdGUoY3VycmVudF90aW1lLCBkdXJhdGlvbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KrYrdiv2YrYqyDYp9mE2LPYrNmEINmD2YQgMyDYq9mI2KfZhtmNCiAgICAgICAgICAgICAgICAgICAgaWYgdGltZS50aW1lKCkgLSBsYXN0X2xvZ190aW1lID4gMzoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+OrCDYqtmC2K/ZhSDYp9mE2LbYuti3OiB7cHJvZ3Jlc3M6LjFmfSUgKHtjdXJyZW50X3RpbWU6LjBmfS97ZHVyYXRpb246LjBmfSDYq9in2YbZitipKSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbG9nX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIHByb2Nlc3Mud2FpdCgpCiAgICAgICAgCiAgICAgICAgaWYgcHJvY2Vzcy5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgIGVycm9yX291dHB1dCA9IHByb2Nlc3Muc3RkZXJyLnJlYWQoKSBpZiBwcm9jZXNzLnN0ZGVyciBlbHNlICJVbmtub3duIGVycm9yIgogICAgICAgICAgICBpZiBzZWxmLmxpdmVfdHJhY2tlcjoKICAgICAgICAgICAgICAgIGltcG9ydCBhc3luY2lvCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXN5bmNpby5jcmVhdGVfdGFzaygKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5saXZlX3RyYWNrZXIuYWRkX3dhcm5pbmcoZiLZgdi02YQg2KfZhNi22LrYtzoge2Vycm9yX291dHB1dFs6MTAwXX0iKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmItmB2LTZhCDYtti62Lcg2KfZhNmB2YrYr9mK2Yg6IHtlcnJvcl9vdXRwdXR9IikKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINmG2LPYqNipINin2YTYtti62LcKICAgICAgICBvcmlnaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKGlucHV0X3BhdGgpCiAgICAgICAgY29tcHJlc3NlZF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgIGNvbXByZXNzaW9uX3JhdGlvID0gKDEgLSBjb21wcmVzc2VkX3NpemUgLyBvcmlnaW5hbF9zaXplKSAqIDEwMAogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSEiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2KfZhNit2KzZhSDYp9mE2KPYtdmE2Yo6IHtvcmlnaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINin2YTYrdis2YUg2KfZhNmF2LbYutmI2Lc6IHtjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4kg2YbYs9io2Kkg2KfZhNi22LrYtzoge2NvbXByZXNzaW9uX3JhdGlvOi4xZn0lIikKICAgICAgICAKICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgCiAgICBkZWYgY29tcHJlc3NfdmlkZW9faW5fc2VnbWVudHMoc2VsZiwgaW5wdXRfcGF0aCwgb3V0cHV0X3BhdGgsIHF1YWxpdHk9J21lZGl1bScsIHNlZ21lbnRfZHVyYXRpb249NjAwKToKICAgICAgICAiIiIKICAgICAgICDYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNi32YjZitmE2Kkg2KzYr9in2Ysg2LnZhNmJINmF2LHYp9it2YQgKHNlZ21lbnRzKQogICAgICAgINmE2YTYqti52KfZhdmEINmF2Lkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNiq2Yog2KrYs9iq2LrYsdmCINiz2KfYudin2KoKICAgICAgICAKICAgICAgICBzZWdtZW50X2R1cmF0aW9uOiDZhdiv2Kkg2YPZhCBzZWdtZW50INio2KfZhNir2YjYp9mG2YogKNin2YHYqtix2KfYttmKIDEwINiv2YLYp9im2YIpCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+OrCDYqNiv2KEg2LbYuti3INmB2YrYr9mK2Ygg2LfZiNmK2YQg2LnZhNmJINmF2LHYp9it2YQuLi4iKQogICAgICAgIAogICAgICAgICMg2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiAogICAgICAgIHZpZGVvX2luZm8gPSBzZWxmLmdldF92aWRlb19pbmZvKGlucHV0X3BhdGgpCiAgICAgICAgdG90YWxfZHVyYXRpb24gPSB2aWRlb19pbmZvWydkdXJhdGlvbiddCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4o+x77iPINin2YTZhdiv2Kkg2KfZhNil2KzZhdin2YTZitipOiB7dG90YWxfZHVyYXRpb24gLyA2MDouMWZ9INiv2YLZitmC2KkiKQogICAgICAgIAogICAgICAgICMg2KXYsNinINmD2KfZhiDYp9mE2YHZitiv2YrZiCDZgti12YrYsdiMINin2LPYqtiu2K/ZhSDYp9mE2LbYuti3INin2YTYudin2K/ZigogICAgICAgIGlmIHRvdGFsX2R1cmF0aW9uIDw9IHNlZ21lbnRfZHVyYXRpb246CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk7kg2KfZhNmB2YrYr9mK2Ygg2YLYtdmK2LEgLSDYp9iz2KrYrtiv2KfZhSDYp9mE2LbYuti3INin2YTYudin2K/ZiiIpCiAgICAgICAgICAgIHJldHVybiBzZWxmLmNvbXByZXNzX3ZpZGVvKGlucHV0X3BhdGgsIG91dHB1dF9wYXRoLCBxdWFsaXR5KQogICAgICAgIAogICAgICAgICMg2K3Ys9in2Kgg2LnYr9ivINin2YTYo9is2LLYp9ihCiAgICAgICAgbnVtX3NlZ21lbnRzID0gaW50KHRvdGFsX2R1cmF0aW9uIC8gc2VnbWVudF9kdXJhdGlvbikgKyAxCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyC77iPINiz2YrYqtmFINiq2YLYs9mK2YUg2KXZhNmJIHtudW1fc2VnbWVudHN9INis2LLYoSDZhNmE2YXYudin2YTYrNipIikKICAgICAgICAKICAgICAgICAjINil2LnYr9in2K/Yp9iqINin2YTYrNmI2K/YqQogICAgICAgIHF1YWxpdHlfc2V0dGluZ3MgPSB7CiAgICAgICAgICAgICdtYXhpbXVtX2NvbXByZXNzaW9uJzogewogICAgICAgICAgICAgICAgJ2NyZic6ICc0MCcsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc0ODA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcxOCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICcyNGsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAndWx0cmFfbG93JzogewogICAgICAgICAgICAgICAgJ2NyZic6ICczNScsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc2NDA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcyMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICczMmsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnbG93JzogewogICAgICAgICAgICAgICAgJ2NyZic6ICczMicsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ3ZlcnlmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc4NTQ6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICcyNCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICc2NGsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnbWVkaXVtJzogewogICAgICAgICAgICAgICAgJ2NyZic6ICcyOCcsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ2Zhc3QnLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzEyODA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICczMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICc5NmsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgICAgICAnaGlnaCc6IHsKICAgICAgICAgICAgICAgICdjcmYnOiAnMjMnLAogICAgICAgICAgICAgICAgJ3ByZXNldCc6ICdtZWRpdW0nLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzE5MjA6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICczMCcsCiAgICAgICAgICAgICAgICAnYXVkaW9fYml0cmF0ZSc6ICcxMjhrJywKICAgICAgICAgICAgICAgICd2Y29kZWMnOiAnbGlieDI2NCcKICAgICAgICAgICAgfSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2V0dGluZ3MgPSBxdWFsaXR5X3NldHRpbmdzLmdldChxdWFsaXR5LCBxdWFsaXR5X3NldHRpbmdzWydtZWRpdW0nXSkKICAgICAgICAKICAgICAgICAjINi22LrYtyDZg9mEIHNlZ21lbnQg2LnZhNmJINit2K/YqQogICAgICAgIHNlZ21lbnRfZmlsZXMgPSBbXQogICAgICAgIAogICAgICAgIGZvciBpIGluIHJhbmdlKG51bV9zZWdtZW50cyk6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSBpICogc2VnbWVudF9kdXJhdGlvbgogICAgICAgICAgICAKICAgICAgICAgICAgIyDYotiu2LEgc2VnbWVudCDZgtivINmK2YPZiNmGINij2YLYtdixCiAgICAgICAgICAgIGlmIGkgPT0gbnVtX3NlZ21lbnRzIC0gMToKICAgICAgICAgICAgICAgIGR1cmF0aW9uID0gdG90YWxfZHVyYXRpb24gLSBzdGFydF90aW1lCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBkdXJhdGlvbiA9IHNlZ21lbnRfZHVyYXRpb24KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlZ21lbnRfZmlsZSA9IHNlbGYudGVtcF9kaXIgLyBmInNlZ21lbnRfe2k6MDNkfS5tcDQiCiAgICAgICAgICAgIAogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn46sINi22LrYtyDYp9mE2KzYstihIHtpKzF9L3tudW1fc2VnbWVudHN9ICh7c3RhcnRfdGltZS82MDouMWZ92YUgLSB7KHN0YXJ0X3RpbWUrZHVyYXRpb24pLzYwOi4xZn3ZhSkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYtti62Lcg2YfYsNinINin2YTYrNiy2KEKICAgICAgICAgICAgY21kID0gWwogICAgICAgICAgICAgICAgJ2ZmbXBlZycsCiAgICAgICAgICAgICAgICAnLWknLCBzdHIoaW5wdXRfcGF0aCksCiAgICAgICAgICAgICAgICAnLXNzJywgc3RyKHN0YXJ0X3RpbWUpLAogICAgICAgICAgICAgICAgJy10Jywgc3RyKGR1cmF0aW9uKSwKICAgICAgICAgICAgICAgICctYzp2Jywgc2V0dGluZ3NbJ3Zjb2RlYyddLAogICAgICAgICAgICAgICAgJy1wcmVzZXQnLCBzZXR0aW5nc1sncHJlc2V0J10sCiAgICAgICAgICAgICAgICAnLWNyZicsIHNldHRpbmdzWydjcmYnXSwKICAgICAgICAgICAgICAgICctdmYnLCBmInNjYWxlPXtzZXR0aW5nc1snc2NhbGUnXX0sZnBzPXtzZXR0aW5nc1snZnBzJ119IiwKICAgICAgICAgICAgICAgICctYzphJywgJ2FhYycsCiAgICAgICAgICAgICAgICAnLWI6YScsIHNldHRpbmdzWydhdWRpb19iaXRyYXRlJ10sCiAgICAgICAgICAgICAgICAnLWFjJywgJzEnLAogICAgICAgICAgICAgICAgJy1tb3ZmbGFncycsICcrZmFzdHN0YXJ0JywKICAgICAgICAgICAgICAgICcteScsCiAgICAgICAgICAgICAgICBzdHIoc2VnbWVudF9maWxlKQogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBwcm9jZXNzID0gc3VicHJvY2Vzcy5Qb3BlbigKICAgICAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICBzdGRlcnI9c3VicHJvY2Vzcy5QSVBFLAogICAgICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJvY2Vzcy53YWl0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb2Nlc3MucmV0dXJuY29kZSAhPSAwOgogICAgICAgICAgICAgICAgZXJyb3Jfb3V0cHV0ID0gcHJvY2Vzcy5zdGRlcnIucmVhZCgpIGlmIHByb2Nlc3Muc3RkZXJyIGVsc2UgIlVua25vd24gZXJyb3IiCiAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiLZgdi02YQg2LbYuti3INin2YTYrNiy2KEge2krMX06IHtlcnJvcl9vdXRwdXR9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlZ21lbnRfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShzZWdtZW50X2ZpbGUpIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINin2YTYrNiy2KEge2krMX06IHtzZWdtZW50X3NpemU6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlZ21lbnRfZmlsZXMuYXBwZW5kKHN0cihzZWdtZW50X2ZpbGUpKQogICAgICAgIAogICAgICAgICMg2K/ZhdisINis2YXZiti5INin2YTYo9is2LLYp9ihINin2YTZhdi22LrZiNi32KkKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5SXINiv2YXYrCB7bnVtX3NlZ21lbnRzfSDYrNiy2KEuLi4iKQogICAgICAgIAogICAgICAgICMg2KXZhti02KfYoSDZhdmE2YEg2YLYp9im2YXYqSDZhNmE2K/ZhdisCiAgICAgICAgY29uY2F0X2xpc3QgPSBzZWxmLnRlbXBfZGlyIC8gImNvbmNhdF9saXN0LnR4dCIKICAgICAgICB3aXRoIG9wZW4oY29uY2F0X2xpc3QsICd3JykgYXMgZjoKICAgICAgICAgICAgZm9yIHNlZ21lbnRfZmlsZSBpbiBzZWdtZW50X2ZpbGVzOgogICAgICAgICAgICAgICAgZi53cml0ZShmImZpbGUgJ3tzZWdtZW50X2ZpbGV9J1xuIikKICAgICAgICAKICAgICAgICAjINiv2YXYrCDYp9mE2KPYrNiy2KfYoQogICAgICAgIG1lcmdlX2NtZCA9IFsKICAgICAgICAgICAgJ2ZmbXBlZycsCiAgICAgICAgICAgICctZicsICdjb25jYXQnLAogICAgICAgICAgICAnLXNhZmUnLCAnMCcsCiAgICAgICAgICAgICctaScsIHN0cihjb25jYXRfbGlzdCksCiAgICAgICAgICAgICctYycsICdjb3B5JywKICAgICAgICAgICAgJy15JywKICAgICAgICAgICAgc3RyKG91dHB1dF9wYXRoKQogICAgICAgIF0KICAgICAgICAKICAgICAgICBzdWJwcm9jZXNzLnJ1bihtZXJnZV9jbWQsIGNoZWNrPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUpCiAgICAgICAgCiAgICAgICAgIyDYrdiw2YEg2KfZhNij2KzYstin2KEg2KfZhNmF2KTZgtiq2KkKICAgICAgICBmb3Igc2VnbWVudF9maWxlIGluIHNlZ21lbnRfZmlsZXM6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHNlZ21lbnRfZmlsZSk6CiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoc2VnbWVudF9maWxlKQogICAgICAgIAogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGNvbmNhdF9saXN0KToKICAgICAgICAgICAgb3MucmVtb3ZlKGNvbmNhdF9saXN0KQogICAgICAgIAogICAgICAgICMg2K3Ys9in2Kgg2YbYs9io2Kkg2KfZhNi22LrYtwogICAgICAgIG9yaWdpbmFsX3NpemUgPSBvcy5wYXRoLmdldHNpemUoaW5wdXRfcGF0aCkKICAgICAgICBjb21wcmVzc2VkX3NpemUgPSBvcy5wYXRoLmdldHNpemUob3V0cHV0X3BhdGgpCiAgICAgICAgY29tcHJlc3Npb25fcmF0aW8gPSAoMSAtIGNvbXByZXNzZWRfc2l6ZSAvIG9yaWdpbmFsX3NpemUpICogMTAwCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNi22LrYtyDZiNin2YTYr9mF2Kwg2KjZhtis2KfYrSEiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2KfZhNit2KzZhSDYp9mE2KPYtdmE2Yo6IHtvcmlnaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINin2YTYrdis2YUg2KfZhNmF2LbYutmI2Lc6IHtjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4kg2YbYs9io2Kkg2KfZhNi22LrYtzoge2NvbXByZXNzaW9uX3JhdGlvOi4xZn0lIikKICAgICAgICAKICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgCiAgICBkZWYgc3BsaXRfdmlkZW8oc2VsZiwgaW5wdXRfcGF0aCwgbWF4X3NpemVfbWI9TUFYX1RFTEVHUkFNX1NJWkVfTUIpOgogICAgICAgICIiItiq2YLYs9mK2YUg2KfZhNmB2YrYr9mK2Ygg2KXZhNmJINij2KzYstin2KEg2LXYutmK2LHYqSIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKcgu+4jyDYqNiv2KEg2KrZgtiz2YrZhSDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgCiAgICAgICAgdmlkZW9faW5mbyA9IHNlbGYuZ2V0X3ZpZGVvX2luZm8oaW5wdXRfcGF0aCkKICAgICAgICB0b3RhbF9zaXplID0gdmlkZW9faW5mb1snc2l6ZSddCiAgICAgICAgZHVyYXRpb24gPSB2aWRlb19pbmZvWydkdXJhdGlvbiddCiAgICAgICAgCiAgICAgICAgIyDYrdiz2KfYqCDYudiv2K8g2KfZhNij2KzYstin2KEg2KfZhNmF2LfZhNmI2KjYqQogICAgICAgIG1heF9zaXplX2J5dGVzID0gbWF4X3NpemVfbWIgKiAxMDI0ICogMTAyNAogICAgICAgIG51bV9wYXJ0cyA9IGludCh0b3RhbF9zaXplIC8gbWF4X3NpemVfYnl0ZXMpICsgMQogICAgICAgIAogICAgICAgIGlmIG51bV9wYXJ0cyA+IE1BWF9GSUxFX1BBUlRTOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYi2KfZhNmF2YTZgSDZg9io2YrYsSDYrNiv2KfZiyEg2YrYqti32YTYqCB7bnVtX3BhcnRzfSDYrNiy2KEgKNin2YTYrdivINin2YTYo9mC2LXZiSB7TUFYX0ZJTEVfUEFSVFN9KSIpCiAgICAgICAgCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDYudiv2K8g2KfZhNij2KzYstin2KE6IHtudW1fcGFydHN9IikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLij7HvuI8g2YXYr9ipINmD2YQg2KzYstihOiB7ZHVyYXRpb24gLyBudW1fcGFydHM6LjFmfSDYq9in2YbZitipIikKICAgICAgICAKICAgICAgICAjINiq2YLYs9mK2YUg2KfZhNmB2YrYr9mK2YgKICAgICAgICBwYXJ0X2R1cmF0aW9uID0gZHVyYXRpb24gLyBudW1fcGFydHMKICAgICAgICBwYXJ0cyA9IFtdCiAgICAgICAgCiAgICAgICAgZm9yIGkgaW4gcmFuZ2UobnVtX3BhcnRzKToKICAgICAgICAgICAgc3RhcnRfdGltZSA9IGkgKiBwYXJ0X2R1cmF0aW9uCiAgICAgICAgICAgIG91dHB1dF9wYXJ0ID0gc2VsZi50ZW1wX2RpciAvIGYicGFydF97aSsxOjAyZH0ubXA0IgogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyC77iPINil2YbYtNin2KEg2KfZhNis2LLYoSB7aSsxfS97bnVtX3BhcnRzfS4uLiIpCiAgICAgICAgICAgIAogICAgICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICAgICAnZmZtcGVnJywKICAgICAgICAgICAgICAgICctaScsIHN0cihpbnB1dF9wYXRoKSwKICAgICAgICAgICAgICAgICctc3MnLCBzdHIoc3RhcnRfdGltZSksCiAgICAgICAgICAgICAgICAnLXQnLCBzdHIocGFydF9kdXJhdGlvbiksCiAgICAgICAgICAgICAgICAnLWMnLCAnY29weScsCiAgICAgICAgICAgICAgICAnLXknLAogICAgICAgICAgICAgICAgc3RyKG91dHB1dF9wYXJ0KQogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBzdWJwcm9jZXNzLnJ1bihjbWQsIGNoZWNrPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUpCiAgICAgICAgICAgIHBhcnRzLmFwcGVuZChzdHIob3V0cHV0X3BhcnQpKQogICAgICAgICAgICAKICAgICAgICAgICAgcGFydF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXJ0KSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYp9mE2KzYstihIHtpKzF9OiB7cGFydF9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHBhcnRzCiAgICAKICAgIGRlZiBwcm9jZXNzX3ZpZGVvX2Zyb21fdXJsKHNlbGYsIHVybCwgcXVhbGl0eT0nbWVkaXVtJyk6CiAgICAgICAgIiIi2YXYudin2YTYrNipINmD2KfZhdmE2Kkg2YTZhNmB2YrYr9mK2Ygg2YXZhiDYsdin2KjYtyIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICBzZWxmLmxvZ2dlci5sb2coIvCfmoAg2KjYr9ihINmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKCI9IiAqIDgwKQogICAgICAgIAogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyAxLiDYqtit2YXZitmEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGlmIHNlbGYubGl2ZV90cmFja2VyOgogICAgICAgICAgICAgICAgaW1wb3J0IGFzeW5jaW8KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBhc3luY2lvLmNyZWF0ZV90YXNrKAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxpdmVfdHJhY2tlci5zdGFydCgi8J+TpSDYqtit2YXZitmEINin2YTZgdmK2K/ZitmIIiwgMTAwKQogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBkb3dubG9hZF9wYXRoID0gc3RyKHNlbGYudGVtcF9kaXIgLyAiZG93bmxvYWRlZF92aWRlby5tcDQiKQogICAgICAgICAgICBzZWxmLmRvd25sb2FkX3ZpZGVvKHVybCwgZG93bmxvYWRfcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2YXYr9ipINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIHZpZGVvX2luZm8gPSBzZWxmLmdldF92aWRlb19pbmZvKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgIGR1cmF0aW9uX21pbnV0ZXMgPSB2aWRlb19pbmZvWydkdXJhdGlvbiddIC8gNjAKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMi4g2LbYuti3INin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGlmIHNlbGYubGl2ZV90cmFja2VyOgogICAgICAgICAgICAgICAgaW1wb3J0IGFzeW5jaW8KICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBwaGFzZV9uYW1lID0gZiLwn46sINi22LrYtyDYp9mE2YHZitiv2YrZiCAoe2R1cmF0aW9uX21pbnV0ZXM6LjFmfSDYr9mC2YrZgtipKSIKICAgICAgICAgICAgICAgICAgICBhc3luY2lvLmNyZWF0ZV90YXNrKAogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxpdmVfdHJhY2tlci5zdGFydChwaGFzZV9uYW1lLCBpbnQodmlkZW9faW5mb1snZHVyYXRpb24nXSkpCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbXByZXNzZWRfcGF0aCA9IHN0cihzZWxmLnRlbXBfZGlyIC8gImNvbXByZXNzZWRfdmlkZW8ubXA0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KfYs9iq2K7Yr9in2YUg2KfZhNi22LrYtyDYudmE2Ykg2YXYsdin2K3ZhCDZhNmE2YHZitiv2YrZiNmH2KfYqiDYp9mE2LfZiNmK2YTYqSAo2KPZg9ir2LEg2YXZhiAyMCDYr9mC2YrZgtipKQogICAgICAgICAgICBpZiBkdXJhdGlvbl9taW51dGVzID4gMjA6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLij7HvuI8g2YHZitiv2YrZiCDYt9mI2YrZhCAoe2R1cmF0aW9uX21pbnV0ZXM6LjFmfSDYr9mC2YrZgtipKSAtINin2LPYqtiu2K/Yp9mFINin2YTYtti62Lcg2LnZhNmJINmF2LHYp9it2YQiKQogICAgICAgICAgICAgICAgc2VsZi5jb21wcmVzc192aWRlb19pbl9zZWdtZW50cyhkb3dubG9hZF9wYXRoLCBjb21wcmVzc2VkX3BhdGgsIHF1YWxpdHksIHNlZ21lbnRfZHVyYXRpb249NjAwKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4o+x77iPINmB2YrYr9mK2Ygg2LnYp9iv2YogKHtkdXJhdGlvbl9taW51dGVzOi4xZn0g2K/ZgtmK2YLYqSkgLSDYp9iz2KrYrtiv2KfZhSDYp9mE2LbYuti3INin2YTYudin2K/ZiiIpCiAgICAgICAgICAgICAgICBzZWxmLmNvbXByZXNzX3ZpZGVvKGRvd25sb2FkX3BhdGgsIGNvbXByZXNzZWRfcGF0aCwgcXVhbGl0eSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMy4g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNit2KzZhQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemUgPSBvcy5wYXRoLmdldHNpemUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemVfbWIgPSBjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TpiDYrdis2YUg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtzoge2NvbXByZXNzZWRfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdiw2Kcg2YPYp9mGINin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2YvYjCDZhtmC2LPZhdmHCiAgICAgICAgICAgIGlmIGNvbXByZXNzZWRfc2l6ZV9tYiA+IE1BWF9URUxFR1JBTV9TSVpFX01COgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPINin2YTZhdmE2YEg2KPZg9io2LEg2YXZhiB7TUFYX1RFTEVHUkFNX1NJWkVfTUJ9INmF2YrYrNin2KjYp9mK2KogLSDYs9mK2KrZhSDYp9mE2KrZgtiz2YrZhSIpCiAgICAgICAgICAgICAgICBwYXJ0cyA9IHNlbGYuc3BsaXRfdmlkZW8oY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KfZg9iq2YXZhNiqINin2YTZhdi52KfZhNis2Kkg2YHZiiB7ZWxhcHNlZDouMWZ9INir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCI9IiAqIDgwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4geyd0eXBlJzogJ3BhcnRzJywgJ2ZpbGVzJzogcGFydHN9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTYo9i12YTZigogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYp9mD2KrZhdmE2Kog2KfZhNmF2LnYp9mE2KzYqSDZgdmKIHtlbGFwc2VkOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7J3R5cGUnOiAnc2luZ2xlJywgJ2ZpbGUnOiBjb21wcmVzc2VkX3BhdGh9CiAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2dfZXJyb3IoZSwgItmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgICAgIHJhaXNlCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn6SWINio2YjYqiBUZWxlZ3JhbQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFZpZGVvQ29tcHJlc3NvckJvdDoKICAgICIiItio2YjYqiBUZWxlZ3JhbSDZhNi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgdG9rZW4pOgogICAgICAgICIiItiq2YfZitim2Kkg2KfZhNio2YjYqiIiIgogICAgICAgIHNlbGYuYXBwID0gQXBwbGljYXRpb24uYnVpbGRlcigpLnRva2VuKHRva2VuKS5idWlsZCgpCiAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIgPSBEZXRhaWxlZExvZ2dlcigpCiAgICAgICAgc2VsZi5jb21wcmVzc29yID0gVmlkZW9Db21wcmVzc29yKGxvZ2dlcj1zZWxmLmRldGFpbGVkX2xvZ2dlcikKICAgICAgICBzZWxmLnNldHVwX2hhbmRsZXJzKCkKICAgIAogICAgZGVmIHNldHVwX2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YXYudin2YTYrNin2Kog2KfZhNij2YjYp9mF2LEiIiIKICAgICAgICBzZWxmLmFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzZWxmLnN0YXJ0X2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJoZWxwIiwgc2VsZi5oZWxwX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsb2dzIiwgc2VsZi5sb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsYXN0bG9nIiwgc2VsZi5sYXN0bG9nX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhbGxsb2dzIiwgc2VsZi5hbGxsb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJlcnJvcmxvZyIsIHNlbGYuZXJyb3Jsb2dfY29tbWFuZCkpCiAgICAgICAgc2VsZi5hcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImNsZWFudXAiLCBzZWxmLmNsZWFudXBfY29tbWFuZCkpCiAgICAgICAgc2VsZi5hcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInN0YXR1cyIsIHNlbGYuc3RhdHVzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKE1lc3NhZ2VIYW5kbGVyKGZpbHRlcnMuVEVYVCAmIH5maWx0ZXJzLkNPTU1BTkQsIHNlbGYuaGFuZGxlX3VybCkpCiAgICAgICAgc2VsZi5hcHAuYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoc2VsZi5oYW5kbGVfcXVhbGl0eV9zZWxlY3Rpb24pKQogICAgCiAgICBhc3luYyBkZWYgc3RhcnRfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KPZhdixINin2YTYqNiv2KfZitipIiIiCiAgICAgICAgd2VsY29tZV90ZXh0ID0gKAogICAgICAgICAgICAi8J+OrCAqKtmF2LHYrdio2KfZiyDYqNmDINmB2Yog2LbYp9i62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNin2K3Yqtix2KfZgdmKISoqXG5cbiIKICAgICAgICAgICAgIuKcqCAqKtin2YTZhdmF2YrYstin2Kog2KfZhNmF2KrZgtiv2YXYqToqKlxuIgogICAgICAgICAgICAi4pyFINi22LrYtyDZgdin2KbZgiDYp9mE2LPYsdi52KkgKDN4INij2LPYsdi5KVxuIgogICAgICAgICAgICAi4pyFINil2LHYs9in2YQg2YHZitiv2YrZiNmH2KfYqiDYqNij2Yog2K3YrNmFICjYqtmC2LPZitmFINiq2YTZgtin2KbZiilcbiIKICAgICAgICAgICAgIuKchSDZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNi32YjZitmE2KkgKNiz2KfYudin2KopINi52YTZiSDZhdix2KfYrdmEXG4iCiAgICAgICAgICAgICLinIUg2LPYrNmEINij2K7Yt9in2KEgdHh0INmF2YHYtdmEXG4iCiAgICAgICAgICAgICLinIUg2LPYrNmEINiq2YLYr9mFINmF2Lkg2KPYs9io2KfYqCDYp9mE2KrYo9iu2YrYsVxuIgogICAgICAgICAgICAi4pyFINi22LrYtyDYo9mC2YjZiSAtINit2KzZhSDYtdi62YrYsSDYrNiv2KfZi1xuIgogICAgICAgICAgICAi4pyFINil2K/Yp9ix2Kkg2KfZhNin2LPYqti22KfZgdipINmI2KfZhNmF2YTZgdin2KpcblxuIgogICAgICAgICAgICAi8J+TnSAqKtmD2YrZgdmK2Kkg2KfZhNin2LPYqtiu2K/Yp9mFOioqXG4iCiAgICAgICAgICAgICIx77iP4oOjINij2LHYs9mEINix2KfYqNi3INin2YTZgdmK2K/ZitmIIChHb29nbGUgRHJpdmUg2KPZiCDYsdin2KjYtyDZhdio2KfYtNixKVxuIgogICAgICAgICAgICAiMu+4j+KDoyDYp9iu2KrYsSDZhdiz2KrZiNmJINin2YTYrNmI2K/YqVxuIgogICAgICAgICAgICAiM++4j+KDoyDYp9mG2KrYuNixINit2KrZiSDZitiq2YUg2KfZhNi22LrYt1xuIgogICAgICAgICAgICAiNO+4j+KDoyDYp9iz2KrZhNmFINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3INmF2Lkg2LPYrNmEINin2YTYudmF2YTZitin2KohXG5cbiIKICAgICAgICAgICAgIvCfm6DvuI8gKirYp9mE2KPZiNin2YXYsSDYp9mE2YXYqtin2K3YqToqKlxuIgogICAgICAgICAgICAi4oCiIC9oZWxwIC0g2K/ZhNmK2YQg2KfZhNin2LPYqtiu2K/Yp9mFINin2YTZg9in2YXZhFxuIgogICAgICAgICAgICAi4oCiIC9sb2dzIC0g2LnYsdi2INmC2KfYptmF2Kkg2KfZhNiz2KzZhNin2KpcbiIKICAgICAgICAgICAgIuKAoiAvbGFzdGxvZyAtINii2K7YsSDYs9is2YQg2YXYudin2YTYrNipXG4iCiAgICAgICAgICAgICLigKIgL2Vycm9ybG9nIC0g2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoSDZgdmC2LdcbiIKICAgICAgICAgICAgIuKAoiAvY2xlYW51cCAtINiq2YbYuNmK2YEg2KfZhNin2LPYqti22KfZgdipXG4iCiAgICAgICAgICAgICLigKIgL3N0YXR1cyAtINit2KfZhNipINin2YTZhdiz2KfYrdipINin2YTZhdiq2KfYrdipXG5cbiIKICAgICAgICAgICAgIvCfhpgg2YTZhNmF2LPYp9i52K/YqTogL2hlbHAiCiAgICAgICAgKQogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQod2VsY29tZV90ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAKICAgIGFzeW5jIGRlZiBoZWxwX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItij2YXYsSDYp9mE2YXYs9in2LnYr9ipIiIiCiAgICAgICAgaGVscF90ZXh0ID0gKAogICAgICAgICAgICAi4p2TICoq2K/ZhNmK2YQg2KfZhNin2LPYqtiu2K/Yp9mFKipcblxuIgogICAgICAgICAgICAiKirwn5OlINin2YTYsdmI2KfYqNi3INin2YTZhdiv2LnZiNmF2Kk6KipcbiIKICAgICAgICAgICAgIuKAoiBHb29nbGUgRHJpdmU6IGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS8uLi5cbiIKICAgICAgICAgICAgIuKAoiDYsdmI2KfYqNi3INmF2KjYp9i02LHYqTogaHR0cDovL2V4YW1wbGUuY29tL3ZpZGVvLm1wNFxuXG4iCiAgICAgICAgICAgICIqKvCfjq8g2YXYs9iq2YjZitin2Kog2KfZhNis2YjYr9ipOioqXG4iCiAgICAgICAgICAgICLigKIg8J+foyAqKtmB2KfYptmCINin2YTYp9mG2K7Zgdin2LYqKjog2K3YrNmFINi12LrZitixINis2K/Yp9mLICg0ODBwLCBDUkYgMzUpXG4iCiAgICAgICAgICAgICLigKIg8J+UtCAqKtmF2YbYrtmB2LbYqSoqOiDYrdis2YUg2LXYutmK2LEgKDcyMHAsIENSRiAzMilcbiIKICAgICAgICAgICAgIuKAoiDwn5+hICoq2YXYqtmI2LPYt9ipKio6INmF2KrZiNin2LLZhiAoNzIwcCwgQ1JGIDI4KVxuIgogICAgICAgICAgICAi4oCiIPCfn6IgKirYudin2YTZitipKio6INis2YjYr9ipINi52KfZhNmK2KkgKDEwODBwLCBDUkYgMjMpXG5cbiIKICAgICAgICAgICAgIioq8J+boO+4jyDYp9mE2KPZiNin2YXYsSDYp9mE2YXYqtin2K3YqToqKlxuIgogICAgICAgICAgICAi4oCiIC9zdGFydCAtINio2K/YoSDYp9mE2KjZiNiqXG4iCiAgICAgICAgICAgICLigKIgL2hlbHAgLSDYudix2LYg2KfZhNmF2LPYp9i52K/YqVxuIgogICAgICAgICAgICAi4oCiIC9sb2dzIC0g2LnYsdi2INmC2KfYptmF2Kkg2KfZhNiz2KzZhNin2KpcbiIKICAgICAgICAgICAgIuKAoiAvbGFzdGxvZyAtINii2K7YsSDYs9is2YQg2YXYudin2YTYrNipXG4iCiAgICAgICAgICAgICLigKIgL2FsbGxvZ3MgLSDYrNmF2YrYuSDYp9mE2LPYrNmE2KfYqiDZgdmKINmF2YTZgSDZhdi22LrZiNi3XG4iCiAgICAgICAgICAgICLigKIgL2Vycm9ybG9nIC0g2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoSDZgdmC2LdcbiIKICAgICAgICAgICAgIuKAoiAvY2xlYW51cCAtINit2LDZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqSDZhdmGINin2YTYp9iz2KrYttin2YHYqVxuIgogICAgICAgICAgICAi4oCiIC9zdGF0dXMgLSDYudix2LYg2K3Yp9mE2Kkg2KfZhNmF2LPYp9it2Kkg2KfZhNmF2KrYp9it2KlcblxuIgogICAgICAgICAgICAiKirimqEg2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTYt9mI2YrZhNipOioqXG4iCiAgICAgICAgICAgICLigKIg2KfZhNmB2YrYr9mK2YjZh9in2KogPiAyMCDYr9mC2YrZgtipOiDYtti62Lcg2LnZhNmJINmF2LHYp9it2YRcbiIKICAgICAgICAgICAgIuKAoiDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2LfZiNmK2YTYqSDYrNiv2KfZiyAo2LPYp9i52KfYqik6INii2YXZhtipIOKchVxuIgogICAgICAgICAgICAi4oCiINiq2YjZgdmK2LEg2KfZhNiw2KfZg9ix2Kk6INiq2YTZgtin2KbZilxuXG4iCiAgICAgICAgICAgICIqKvCfkqEg2YbYtdin2KbYrToqKlxuIgogICAgICAgICAgICAi4oCiINmE2YTYrdi12YjZhCDYudmE2Ykg2KPYtdi62LEg2K3YrNmFOiDYp9iu2KrYsSDwn5+jINmB2KfYptmCINin2YTYp9mG2K7Zgdin2LZcbiIKICAgICAgICAgICAgIuKAoiDYp9mE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqSDZitiq2YUg2KrZgtiz2YrZhdmH2Kcg2KrZhNmC2KfYptmK2KfZi1xuIgogICAgICAgICAgICAi4oCiINiz2KrYrdi12YQg2LnZhNmJINmF2YTZgSB0eHQg2YrYrdiq2YjZiiDYudmE2Ykg2LPYrNmEINin2YTYudmF2YTZitin2KpcbiIKICAgICAgICAgICAgIuKAoiDYp9iz2KrYrtiv2YUgL2NsZWFudXAg2YTYqtmI2YHZitixINin2YTZhdiz2KfYrdipXG5cbiIKICAgICAgICAgICAgIioq4p2TINmF2LTYp9mD2YQg2LTYp9im2LnYqToqKlxuIgogICAgICAgICAgICAi4oCiIEdvb2dsZSBEcml2ZTog2KrYo9mD2K8g2YXZhiDYo9mGINin2YTZhdmE2YEg2LnYp9mFXG4iCiAgICAgICAgICAgICLigKIg2KfZhNiq2K3ZhdmK2YQg2KjYt9mK2KE6INiq2K3ZgtmCINmF2YYg2KfYqti12KfZhCDYp9mE2KXZhtiq2LHZhtiqXG4iCiAgICAgICAgICAgICLigKIg2KfZhNin2LPYqti22KfZgdipINmF2YXYqtmE2KbYqTog2KfYs9iq2K7Yr9mFIC9jbGVhbnVwXG5cbiIKICAgICAgICAgICAgIvCfk6cg2YTZhNmF2LPYp9i52K/YqTog2KPYsdiz2YQg2LHYs9in2YTYqSDZhNmE2YXYt9mI2LEiCiAgICAgICAgKQogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoaGVscF90ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAKICAgIGFzeW5jIGRlZiBsb2dzX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiIti52LHYtiDZgtin2KbZhdipINin2YTYs9is2YTYp9iqINin2YTZhdiq2KfYrdipIiIiCiAgICAgICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgICAgIGxvZ3NfZGlyID0gUGF0aChMT0dTX0RJUikKICAgICAgICAKICAgICAgICBpZiBub3QgbG9nc19kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi8J+TiyAqKtmE2Kcg2KrZiNis2K8g2LPYrNmE2KfYqiDZhdiq2KfYrdipKipcblxuIgogICAgICAgICAgICAgICAgItmE2YUg2YrYqtmFINil2YbYtNin2KEg2KPZiiDYs9is2YTYp9iqINio2LnYry5cbiIKICAgICAgICAgICAgICAgICLYp9io2K/YoyDYqNmF2LnYp9mE2KzYqSDZgdmK2K/ZitmIINij2YjZhNin2YshIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KfZhNio2K3YqyDYudmGINiz2KzZhNin2Kog2KfZhNmF2LPYqtiu2K/ZhQogICAgICAgIHVzZXJfbG9ncyA9IHNvcnRlZCgKICAgICAgICAgICAgbG9nc19kaXIuZ2xvYihmInNlc3Npb25fe3VzZXJfaWR9XyoudHh0IiksCiAgICAgICAgICAgIGtleT1sYW1iZGEgeDogeC5zdGF0KCkuc3RfbXRpbWUsCiAgICAgICAgICAgIHJldmVyc2U9VHJ1ZQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIvCfk4sgKirZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyoqXG5cbiIKICAgICAgICAgICAgICAgICLZhNmFINiq2YLZhSDYqNmF2LnYp9mE2KzYqSDYo9mKINmB2YrYr9mK2Ygg2KjYudivLlxuIgogICAgICAgICAgICAgICAgItij2LHYs9mEINix2KfYqNi3INmB2YrYr9mK2Ygg2YTZhNio2K/YoSEiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYudix2LYg2KLYrtixIDEwINiz2KzZhNin2KoKICAgICAgICBsb2dzX2xpc3QgPSAi8J+TiyAqKtiz2KzZhNin2KrZgyDYp9mE2KPYrtmK2LHYqToqKlxuXG4iCiAgICAgICAgCiAgICAgICAgZm9yIGksIGxvZ19maWxlIGluIGVudW1lcmF0ZSh1c2VyX2xvZ3NbOjEwXSwgMSk6CiAgICAgICAgICAgICMg2KfYs9iq2K7Ysdin2Kwg2KfZhNiq2KfYsdmK2K4g2YXZhiDYp9iz2YUg2KfZhNmF2YTZgQogICAgICAgICAgICAjIHNlc3Npb25fMTIzNDU2XzIwMjYwMjA0XzE1MDUzMC50eHQKICAgICAgICAgICAgcGFydHMgPSBsb2dfZmlsZS5zdGVtLnNwbGl0KCdfJykKICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+PSA0OgogICAgICAgICAgICAgICAgZGF0ZV9zdHIgPSBwYXJ0c1syXSAgIyAyMDI2MDIwNAogICAgICAgICAgICAgICAgdGltZV9zdHIgPSBwYXJ0c1szXSAgIyAxNTA1MzAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYqtmG2LPZitmCINin2YTYqtin2LHZitiuINmI2KfZhNmI2YLYqgogICAgICAgICAgICAgICAgZm9ybWF0dGVkX2RhdGUgPSBmIntkYXRlX3N0clswOjRdfS17ZGF0ZV9zdHJbNDo2XX0te2RhdGVfc3RyWzY6OF19IgogICAgICAgICAgICAgICAgZm9ybWF0dGVkX3RpbWUgPSBmInt0aW1lX3N0clswOjJdfTp7dGltZV9zdHJbMjo0XX06e3RpbWVfc3RyWzQ6Nl19IgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBsb2dfZmlsZS5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQgICMgS0IKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nc19saXN0ICs9IGYie2l9LiDwn5OEIHtmb3JtYXR0ZWRfZGF0ZX0ge2Zvcm1hdHRlZF90aW1lfVxuIgogICAgICAgICAgICAgICAgbG9nc19saXN0ICs9IGYiICAg8J+TpiB7ZmlsZV9zaXplOi4xZn0gS0JcblxuIgogICAgICAgIAogICAgICAgIGxvZ3NfbGlzdCArPSAoCiAgICAgICAgICAgICIqKvCfk4wg2YTZhNit2LXZiNmEINi52YTZiSDYs9is2YQ6KipcbiIKICAgICAgICAgICAgIuKAoiAvbGFzdGxvZyAtINii2K7YsSDYs9is2YRcbiIKICAgICAgICAgICAgIuKAoiAvYWxsbG9ncyAtINis2YXZiti5INin2YTYs9is2YTYp9iqINmF2LbYutmI2LfYqSIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChsb2dzX2xpc3QsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgIAogICAgYXN5bmMgZGVmIGxhc3Rsb2dfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KXYsdiz2KfZhCDYotiu2LEg2YXZhNmBINiz2KzZhCIiIgogICAgICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgICAgICBsb2dzX2RpciA9IFBhdGgoTE9HU19ESVIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGxvZ3NfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YXYqtin2K3YqSIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2YTYqNit2Ksg2LnZhiDYotiu2LEg2LPYrNmEINmE2YTZhdiz2KrYrtiv2YUKICAgICAgICB1c2VyX2xvZ3MgPSBzb3J0ZWQoCiAgICAgICAgICAgIGxvZ3NfZGlyLmdsb2IoZiJzZXNzaW9uX3t1c2VyX2lkfV8qLnR4dCIpLAogICAgICAgICAgICBrZXk9bGFtYmRhIHg6IHguc3RhdCgpLnN0X210aW1lLAogICAgICAgICAgICByZXZlcnNlPVRydWUKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgbm90IHVzZXJfbG9nczoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinYwg2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmE2YMg2KjYudivIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGxhc3RfbG9nID0gdXNlcl9sb2dzWzBdCiAgICAgICAgCiAgICAgICAgIyDYpdix2LPYp9mEINin2YTZhdmE2YEKICAgICAgICB3aXRoIG9wZW4obGFzdF9sb2csICdyYicpIGFzIGY6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X2RvY3VtZW50KAogICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OLICoq2KLYrtixINiz2KzZhCDZhdi52KfZhNis2KkqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+ThSDYp9mE2KrYp9ix2YrYrjoge2RhdGV0aW1lLmZyb210aW1lc3RhbXAobGFzdF9sb2cuc3RhdCgpLnN0X210aW1lKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKX1cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OmINin2YTYrdis2YU6IHtsYXN0X2xvZy5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQ6LjFmfSBLQiIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgYWxsbG9nc19jb21tYW5kKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYpdix2LPYp9mEINis2YXZiti5INin2YTYs9is2YTYp9iqINmB2Yog2YXZhNmBINmF2LbYutmI2LciIiIKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgbG9nc19kaXIgPSBQYXRoKExPR1NfRElSKQogICAgICAgIAogICAgICAgIGlmIG5vdCBsb2dzX2Rpci5leGlzdHMoKToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinYwg2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmF2KrYp9it2KkiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KjYrdirINi52YYg2LPYrNmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mFCiAgICAgICAgdXNlcl9sb2dzID0gbGlzdChsb2dzX2Rpci5nbG9iKGYic2Vzc2lvbl97dXNlcl9pZH1fKi50eHQiKSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyDYqNi52K8iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYpdix2LPYp9mEINix2LPYp9mE2Kkg2KfZhtiq2LjYp9ixCiAgICAgICAgd2FpdF9tc2cgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAi8J+TpiDYrNin2LHZiiDYqtis2YfZitiyINis2YXZiti5INin2YTYs9is2YTYp9iqLi4uIiwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2KXZhti02KfYoSDZhdmE2YEg2YXYtti62YjYtwogICAgICAgIGltcG9ydCB6aXBmaWxlCiAgICAgICAgCiAgICAgICAgemlwX3BhdGggPSBQYXRoKFRFTVBfRElSKSAvIGYibG9nc197dXNlcl9pZH1fe2ludCh0aW1lLnRpbWUoKSl9LnppcCIKICAgICAgICAKICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgJ3cnLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKICAgICAgICAgICAgZm9yIGxvZ19maWxlIGluIHVzZXJfbG9nczoKICAgICAgICAgICAgICAgIHppcGYud3JpdGUobG9nX2ZpbGUsIGxvZ19maWxlLm5hbWUpCiAgICAgICAgCiAgICAgICAgIyDYrdiw2YEg2LHYs9in2YTYqSDYp9mE2KfZhtiq2LjYp9ixCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCB3YWl0X21zZy5kZWxldGUoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YXZhNmBINin2YTZhdi22LrZiNi3CiAgICAgICAgemlwX3NpemUgPSB6aXBfcGF0aC5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQKICAgICAgICAKICAgICAgICB3aXRoIG9wZW4oemlwX3BhdGgsICdyYicpIGFzIGY6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X2RvY3VtZW50KAogICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OmICoq2KzZhdmK2Lkg2LPYrNmE2KfYqtmDKipcblxuIgogICAgICAgICAgICAgICAgICAgICAgICBmIvCfk4og2LnYr9ivINin2YTYs9is2YTYp9iqOiB7bGVuKHVzZXJfbG9ncyl9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7emlwX3NpemU6LjFmfSBLQlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi2YrYrdiq2YjZiiDYudmE2Ykg2KzZhdmK2Lkg2LPYrNmE2KfYqiDZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNiu2KfYtdipINio2YMiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdi22LrZiNi3CiAgICAgICAgb3MucmVtb3ZlKHppcF9wYXRoKQogICAgCiAgICBhc3luYyBkZWYgZXJyb3Jsb2dfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KXYsdiz2KfZhCDYs9is2YQg2KfZhNij2K7Yt9in2KEg2YHZgti3ICjYp9mE2LPYrNmE2KfYqiDYp9mE2YHYp9i02YTYqSkiIiIKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgbG9nc19kaXIgPSBQYXRoKExPR1NfRElSKQogICAgICAgIAogICAgICAgIGlmIG5vdCBsb2dzX2Rpci5leGlzdHMoKToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinYwg2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmF2KrYp9it2KkiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KjYrdirINi52YYg2LPYrNmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mFCiAgICAgICAgdXNlcl9sb2dzID0gbGlzdChsb2dzX2Rpci5nbG9iKGYic2Vzc2lvbl97dXNlcl9pZH1fKi50eHQiKSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyDYqNi52K8iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KjYrdirINi52YYg2LPYrNmE2KfYqiDYqtit2KrZiNmKINi52YTZiSDYo9iu2LfYp9ihCiAgICAgICAgZXJyb3JfbG9ncyA9IFtdCiAgICAgICAgZm9yIGxvZ19maWxlIGluIHVzZXJfbG9nczoKICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgICAgICBjb250ZW50ID0gZi5yZWFkKCkKICAgICAgICAgICAgICAgIGlmICfZgdi02YQnIGluIGNvbnRlbnQgb3IgJ0VSUk9SJyBpbiBjb250ZW50OgogICAgICAgICAgICAgICAgICAgIGVycm9yX2xvZ3MuYXBwZW5kKGxvZ19maWxlKQogICAgICAgIAogICAgICAgIGlmIG5vdCBlcnJvcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKchSAqKtix2KfYpti5ISDZhNinINiq2YjYrNivINij2K7Yt9in2KEqKlxuXG4iCiAgICAgICAgICAgICAgICAi2KzZhdmK2Lkg2LnZhdmE2YrYp9iqINin2YTZhdi52KfZhNis2Kkg2YbYrNit2KohIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KXYsdiz2KfZhCDYsdiz2KfZhNipINin2YbYqti42KfYsQogICAgICAgIHdhaXRfbXNnID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgZiLwn5OmINis2KfYsdmKINiq2KzZh9mK2LIge2xlbihlcnJvcl9sb2dzKX0g2LPYrNmEINij2K7Yt9in2KEuLi4iLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAgICAgCiAgICAgICAgIyDYpdmG2LTYp9ihINmF2YTZgSDZhdi22LrZiNi3INmE2YTYo9iu2LfYp9ihCiAgICAgICAgemlwX3BhdGggPSBQYXRoKFRFTVBfRElSKSAvIGYiZXJyb3JfbG9nc197dXNlcl9pZH1fe2ludCh0aW1lLnRpbWUoKSl9LnppcCIKICAgICAgICAKICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgJ3cnLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKICAgICAgICAgICAgZm9yIGxvZ19maWxlIGluIGVycm9yX2xvZ3M6CiAgICAgICAgICAgICAgICB6aXBmLndyaXRlKGxvZ19maWxlLCBsb2dfZmlsZS5uYW1lKQogICAgICAgIAogICAgICAgICMg2K3YsNmBINix2LPYp9mE2Kkg2KfZhNin2YbYqti42KfYsQogICAgICAgIHRyeToKICAgICAgICAgICAgYXdhaXQgd2FpdF9tc2cuZGVsZXRlKCkKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAKICAgICAgICAjINil2LHYs9in2YQg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtwogICAgICAgIHppcF9zaXplID0gemlwX3BhdGguc3RhdCgpLnN0X3NpemUgLyAxMDI0CiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHppcF9wYXRoLCAncmInKSBhcyBmOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV9kb2N1bWVudCgKICAgICAgICAgICAgICAgIGRvY3VtZW50PWYsCiAgICAgICAgICAgICAgICBjYXB0aW9uPWYi4p2MICoq2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoSoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OKINi52K/YryDYp9mE2LPYrNmE2KfYqjoge2xlbihlcnJvcl9sb2dzKX1cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OmINin2YTYrdis2YU6IHt6aXBfc2l6ZTouMWZ9IEtCXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLZitit2KrZiNmKINi52YTZiSDYrNmF2YrYuSDYp9mE2LnZhdmE2YrYp9iqINin2YTZgdin2LTZhNipINmB2YLYtyIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2LbYutmI2LcKICAgICAgICBvcy5yZW1vdmUoemlwX3BhdGgpCiAgICAKICAgIGFzeW5jIGRlZiBjbGVhbnVwX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqSDZhdmGINin2YTYp9iz2KrYttin2YHYqSIiIgogICAgICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINin2YTZhdiz2KfYrdipINin2YTZhdiz2KrYrtiv2YXYqQogICAgICAgIHRlbXBfZGlyID0gUGF0aChURU1QX0RJUikKICAgICAgICBsb2dzX2RpciA9IFBhdGgoTE9HU19ESVIpCiAgICAgICAgCiAgICAgICAgdG90YWxfc2l6ZSA9IDAKICAgICAgICBmaWxlX2NvdW50ID0gMAogICAgICAgIAogICAgICAgICMg2K3Ys9in2Kgg2K3YrNmFINin2YTZhdmE2YHYp9iqINin2YTZhdik2YLYqtipCiAgICAgICAgaWYgdGVtcF9kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgIGZvciBmaWxlIGluIHRlbXBfZGlyLmdsb2IoJyonKToKICAgICAgICAgICAgICAgIGlmIGZpbGUuaXNfZmlsZSgpOgogICAgICAgICAgICAgICAgICAgIHRvdGFsX3NpemUgKz0gZmlsZS5zdGF0KCkuc3Rfc2l6ZQogICAgICAgICAgICAgICAgICAgIGZpbGVfY291bnQgKz0gMQogICAgICAgIAogICAgICAgIGlmIHRvdGFsX3NpemUgPT0gMDoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinIUgKirYp9mE2KfYs9iq2LbYp9mB2Kkg2YbYuNmK2YHYqSEqKlxuXG4iCiAgICAgICAgICAgICAgICAi2YTYpyDYqtmI2KzYryDZhdmE2YHYp9iqINmF2KTZgtiq2Kkg2YTZhNit2LDZgSIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINil2YbYtNin2KEg2KPYstix2KfYsSDYp9mE2KrYo9mD2YrYrwogICAgICAgIGtleWJvYXJkID0gWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pyFINmG2LnZhdiMINin2K3YsNmBINin2YTZg9mEIiwgY2FsbGJhY2tfZGF0YT1mJ2NsZWFudXBfY29uZmlybV97dXNlcl9pZH0nKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLinYwg2KXZhNi62KfYoSIsIGNhbGxiYWNrX2RhdGE9J2NsZWFudXBfY2FuY2VsJyksCiAgICAgICAgICAgIF0KICAgICAgICBdCiAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgZiLwn5eR77iPICoq2KrZhti42YrZgSDYp9mE2KfYs9iq2LbYp9mB2KkqKlxuXG4iCiAgICAgICAgICAgIGYi8J+TiiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqToge2ZpbGVfY291bnR9XG4iCiAgICAgICAgICAgIGYi8J+TpiDYp9mE2YXYs9in2K3YqSDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHt0b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqXG5cbiIKICAgICAgICAgICAgZiLimqDvuI8gKirYs9mK2KrZhSDYrdiw2YE6KipcbiIKICAgICAgICAgICAgZiLigKIg2KzZhdmK2Lkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmF2K3ZhdmE2KlcbiIKICAgICAgICAgICAgZiLigKIg2KzZhdmK2Lkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmF2LbYutmI2LfYqVxuIgogICAgICAgICAgICBmIuKAoiDYrNmF2YrYuSDYp9mE2KPYrNiy2KfYoSDYp9mE2YXZgtiz2YXYqVxuXG4iCiAgICAgICAgICAgIGYi2YfZhCDYo9mG2Kog2YXYqtij2YPYr9ifIiwKICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgc3RhdHVzX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiIti52LHYtiDYrdin2YTYqSDYp9mE2KfYs9iq2LbYp9mB2Kkg2YjYp9mE2YXYs9in2K3YqSDYp9mE2YXYqtin2K3YqSIiIgogICAgICAgIGltcG9ydCBzaHV0aWwKICAgICAgICAKICAgICAgICAjINmF2LnZhNmI2YXYp9iqINin2YTZhdiz2KfYrdipCiAgICAgICAgdGVtcF9kaXIgPSBQYXRoKFRFTVBfRElSKQogICAgICAgIGxvZ3NfZGlyID0gUGF0aChMT0dTX0RJUikKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINin2YTZhdiz2KfYrdipINin2YTZhdiz2KrYrtiv2YXYqQogICAgICAgIHRlbXBfc2l6ZSA9IDAKICAgICAgICB0ZW1wX2ZpbGVzID0gMAogICAgICAgIGlmIHRlbXBfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBmb3IgZmlsZSBpbiB0ZW1wX2Rpci5nbG9iKCcqJyk6CiAgICAgICAgICAgICAgICBpZiBmaWxlLmlzX2ZpbGUoKToKICAgICAgICAgICAgICAgICAgICB0ZW1wX3NpemUgKz0gZmlsZS5zdGF0KCkuc3Rfc2l6ZQogICAgICAgICAgICAgICAgICAgIHRlbXBfZmlsZXMgKz0gMQogICAgICAgIAogICAgICAgIGxvZ3Nfc2l6ZSA9IDAKICAgICAgICBsb2dzX2ZpbGVzID0gMAogICAgICAgIGlmIGxvZ3NfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBmb3IgZmlsZSBpbiBsb2dzX2Rpci5nbG9iKCcqJyk6CiAgICAgICAgICAgICAgICBpZiBmaWxlLmlzX2ZpbGUoKToKICAgICAgICAgICAgICAgICAgICBsb2dzX3NpemUgKz0gZmlsZS5zdGF0KCkuc3Rfc2l6ZQogICAgICAgICAgICAgICAgICAgIGxvZ3NfZmlsZXMgKz0gMQogICAgICAgIAogICAgICAgICMg2YXYudmE2YjZhdin2Kog2KfZhNmC2LHYtQogICAgICAgIGRpc2tfdXNhZ2UgPSBzaHV0aWwuZGlza191c2FnZSgnLycpCiAgICAgICAgdG90YWxfZGlzayA9IGRpc2tfdXNhZ2UudG90YWwgLyAxMDI0IC8gMTAyNCAvIDEwMjQgICMgR0IKICAgICAgICB1c2VkX2Rpc2sgPSBkaXNrX3VzYWdlLnVzZWQgLyAxMDI0IC8gMTAyNCAvIDEwMjQKICAgICAgICBmcmVlX2Rpc2sgPSBkaXNrX3VzYWdlLmZyZWUgLyAxMDI0IC8gMTAyNCAvIDEwMjQKICAgICAgICBkaXNrX3BlcmNlbnQgPSAodXNlZF9kaXNrIC8gdG90YWxfZGlzaykgKiAxMDAKICAgICAgICAKICAgICAgICBzdGF0dXNfdGV4dCA9ICgKICAgICAgICAgICAgZiLwn5OKICoq2K3Yp9mE2Kkg2KfZhNin2LPYqti22KfZgdipKipcblxuIgogICAgICAgICAgICBmIvCfkr4gKirYp9mE2YLYsdi1INin2YTYtdmE2Kg6KipcbiIKICAgICAgICAgICAgZiLwn5OmINin2YTYpdis2YXYp9mE2Yo6IHt0b3RhbF9kaXNrOi4xZn0g2KzZitis2KfYqNin2YrYqlxuIgogICAgICAgICAgICBmIuKchSDYp9mE2YXYqtin2K06IHtmcmVlX2Rpc2s6LjFmfSDYrNmK2KzYp9io2KfZitiqXG4iCiAgICAgICAgICAgIGYi8J+TiCDYp9mE2YXYs9iq2K7Yr9mFOiB7ZGlza19wZXJjZW50Oi4xZn0lXG5cbiIKICAgICAgICAgICAgZiLwn5OBICoq2KfZhNmF2YTZgdin2Kog2KfZhNmF2KTZgtiq2Kk6KipcbiIKICAgICAgICAgICAgZiLwn5OEINin2YTYudiv2K86IHt0ZW1wX2ZpbGVzfVxuIgogICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge3RlbXBfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqlxuXG4iCiAgICAgICAgICAgIGYi8J+TiyAqKtin2YTYs9is2YTYp9iqOioqXG4iCiAgICAgICAgICAgIGYi8J+ThCDYp9mE2LnYr9ivOiB7bG9nc19maWxlc31cbiIKICAgICAgICAgICAgZiLwn5OmINin2YTYrdis2YU6IHtsb2dzX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KpcblxuIgogICAgICAgICAgICBmIvCfkqEgKirZhti12YrYrdipOioqXG4iCiAgICAgICAgKQogICAgICAgIAogICAgICAgIGlmIHRlbXBfc2l6ZSA+IDEwMCAqIDEwMjQgKiAxMDI0OiAgIyDYo9mD2KvYsSDZhdmGIDEwMCDZhdmK2KzYp9io2KfZitiqCiAgICAgICAgICAgIHN0YXR1c190ZXh0ICs9ICLimqDvuI8g2KfYs9iq2K7Yr9mFIC9jbGVhbnVwINmE2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqSIKICAgICAgICBlbHNlOgogICAgICAgICAgICBzdGF0dXNfdGV4dCArPSAi4pyFINin2YTZhdiz2KfYrdipINis2YrYr9ipISIKICAgICAgICAKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHN0YXR1c190ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAKICAgIGFzeW5jIGRlZiBoYW5kbGVfdXJsKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLZhdi52KfZhNis2Kkg2LHYp9io2Lcg2KfZhNmB2YrYr9mK2YgiIiIKICAgICAgICB1cmwgPSB1cGRhdGUubWVzc2FnZS50ZXh0LnN0cmlwKCkKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgCiAgICAgICAgIyDYqNiv2KEg2KzZhNiz2Kkg2KfZhNiz2KzZhAogICAgICAgIHNlbGYuZGV0YWlsZWRfbG9nZ2VyLnN0YXJ0X3Nlc3Npb24odXNlcl9pZCwgdXJsKQogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2LXYrdipINin2YTYsdin2KjYtwogICAgICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgoJ2h0dHA6Ly8nLCAnaHR0cHM6Ly8nKSk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi4p2MICoq2LHYp9io2Lcg2LrZitixINi12K3ZititISoqXG5cbiIKICAgICAgICAgICAgICAgICLYp9mE2LHYrNin2KEg2KXYsdiz2KfZhCDYsdin2KjYtyDZitio2K/YoyDYqNmAIGh0dHA6Ly8g2KPZiCBodHRwczovLyIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINit2YHYuCDYp9mE2LHYp9io2LcKICAgICAgICBjb250ZXh0LnVzZXJfZGF0YVsndmlkZW9fdXJsJ10gPSB1cmwKICAgICAgICAKICAgICAgICAjINi52LHYtiDYrtmK2KfYsdin2Kog2KfZhNis2YjYr9ipCiAgICAgICAga2V5Ym9hcmQgPSBbCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5SlINi22LrYtyDYo9mC2LXZiSIsIGNhbGxiYWNrX2RhdGE9J3F1YWxpdHlfbWF4aW11bV9jb21wcmVzc2lvbicpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+foyDZgdin2KbZgiDYp9mE2KfZhtiu2YHYp9i2IiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV91bHRyYV9sb3cnKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5S0INmF2YbYrtmB2LbYqSIsIGNhbGxiYWNrX2RhdGE9J3F1YWxpdHlfbG93JyksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+hINmF2KrZiNiz2LfYqSIsIGNhbGxiYWNrX2RhdGE9J3F1YWxpdHlfbWVkaXVtJyksCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+foiDYudin2YTZitipIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9oaWdoJyksCiAgICAgICAgICAgIF0KICAgICAgICBdCiAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgIvCfjq8gKirYp9iu2KrYsSDZhdiz2KrZiNmJINin2YTYrNmI2K/YqToqKlxuXG4iCiAgICAgICAgICAgICLwn5SlICoq2LbYuti3INij2YLYtdmJKio6INij2LXYutixINit2KzZhSDZhdmF2YPZhiEgKDQ4MHAsIDE4ZnBzKSAtINiq2YjZgdmK2LEgOTAlK1xuIgogICAgICAgICAgICAi8J+foyAqKtmB2KfYptmCINin2YTYp9mG2K7Zgdin2LYqKjog2K3YrNmFINi12LrZitixINis2K/Yp9mLICg2NDBwLCAyMGZwcylcbiIKICAgICAgICAgICAgIvCflLQgKirZhdmG2K7Zgdi22KkqKjog2K3YrNmFINi12LrZitixICg4NTRwLCAyNGZwcylcbiIKICAgICAgICAgICAgIvCfn6EgKirZhdiq2YjYs9i32KkqKjog2YXYqtmI2KfYstmGICg3MjBwLCAzMGZwcykgLSDZhdmP2YjYtdmJINio2YdcbiIKICAgICAgICAgICAgIvCfn6IgKirYudin2YTZitipKio6INis2YjYr9ipINmF2YXYqtin2LLYqSAoMTA4MHAsIDMwZnBzKVxuXG4iCiAgICAgICAgICAgICLwn5KhINmE2YTYrdi12YjZhCDYudmE2Ykg2KPYtdi62LEg2K3YrNmFOiDYp9iu2KrYsSDwn5SlIiwKICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgaGFuZGxlX3F1YWxpdHlfc2VsZWN0aW9uKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLZhdi52KfZhNis2Kkg2KfYrtiq2YrYp9ixINin2YTYrNmI2K/YqSDZiNij2LLYsdin2LEg2KfZhNiq2YbYuNmK2YEiIiIKICAgICAgICBxdWVyeSA9IHVwZGF0ZS5jYWxsYmFja19xdWVyeQogICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigpCiAgICAgICAgCiAgICAgICAgIyDZhdi52KfZhNis2Kkg2KPYstix2KfYsSDYp9mE2KrZhti42YrZgQogICAgICAgIGlmIHF1ZXJ5LmRhdGEuc3RhcnRzd2l0aCgnY2xlYW51cF8nKToKICAgICAgICAgICAgaWYgcXVlcnkuZGF0YSA9PSAnY2xlYW51cF9jYW5jZWwnOgogICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICAgICAgIuKdjCAqKtiq2YUg2KXZhNi62KfYoSDYp9mE2KrZhti42YrZgSoqIiwKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcXVlcnkuZGF0YS5zdGFydHN3aXRoKCdjbGVhbnVwX2NvbmZpcm1fJyk6CiAgICAgICAgICAgICAgICAjINit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqQogICAgICAgICAgICAgICAgdGVtcF9kaXIgPSBQYXRoKFRFTVBfRElSKQogICAgICAgICAgICAgICAgZGVsZXRlZF9jb3VudCA9IDAKICAgICAgICAgICAgICAgIGRlbGV0ZWRfc2l6ZSA9IDAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgdGVtcF9kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIGZpbGUgaW4gdGVtcF9kaXIuZ2xvYignKicpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmaWxlLmlzX2ZpbGUoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRfc2l6ZSArPSBmaWxlLnN0YXQoKS5zdF9zaXplCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZmlsZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZWRfY291bnQgKz0gMQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgICAgICAgICBmIuKchSAqKtiq2YUg2KfZhNiq2YbYuNmK2YEg2KjZhtis2KfYrSEqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgZiLwn5eR77iPINin2YTZhdmE2YHYp9iqINin2YTZhdit2LDZiNmB2Kk6IHtkZWxldGVkX2NvdW50fVxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2YXYs9in2K3YqSDYp9mE2YXYrdix2LHYqToge2RlbGV0ZWRfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqlxuXG4iCiAgICAgICAgICAgICAgICAgICAgZiLwn5KaINin2YTYp9iz2KrYttin2YHYqSDZhti42YrZgdipINin2YTYotmGISIsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2LPYqtiu2LHYp9isINin2YTYrNmI2K/YqQogICAgICAgIHF1YWxpdHlfbWFwID0gewogICAgICAgICAgICAncXVhbGl0eV9tYXhpbXVtX2NvbXByZXNzaW9uJzogKCdtYXhpbXVtX2NvbXByZXNzaW9uJywgJ/CflKUg2LbYuti3INij2YLYtdmJJyksCiAgICAgICAgICAgICdxdWFsaXR5X3VsdHJhX2xvdyc6ICgndWx0cmFfbG93JywgJ/Cfn6Mg2YHYp9im2YIg2KfZhNin2YbYrtmB2KfYticpLAogICAgICAgICAgICAncXVhbGl0eV9sb3cnOiAoJ2xvdycsICfwn5S0INmF2YbYrtmB2LbYqScpLAogICAgICAgICAgICAncXVhbGl0eV9tZWRpdW0nOiAoJ21lZGl1bScsICfwn5+hINmF2KrZiNiz2LfYqScpLAogICAgICAgICAgICAncXVhbGl0eV9oaWdoJzogKCdoaWdoJywgJ/Cfn6Ig2LnYp9mE2YrYqScpLAogICAgICAgIH0KICAgICAgICAKICAgICAgICBxdWFsaXR5LCBxdWFsaXR5X25hbWUgPSBxdWFsaXR5X21hcC5nZXQocXVlcnkuZGF0YSwgKCdtZWRpdW0nLCAn8J+foSDZhdiq2YjYs9i32KknKSkKICAgICAgICB1cmwgPSBjb250ZXh0LnVzZXJfZGF0YS5nZXQoJ3ZpZGVvX3VybCcpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHVybDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYrti32KM6INmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2KfZhNix2KfYqNi3LiDYo9ix2LPZhCDYsdin2KjYtyDYrNiv2YrYry4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2Ksg2KfZhNix2LPYp9mE2KkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgZiLij7MgKirYrNin2LHZiiDYp9mE2YXYudin2YTYrNipLi4uKipcblxuIgogICAgICAgICAgICBmIvCflJcg2KfZhNix2KfYqNi3OiBge3VybFs6NTBdfS4uLmBcbiIKICAgICAgICAgICAgZiLwn5OKINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZX1cblxuIgogICAgICAgICAgICBmIuKPse+4jyDZgtivINiq2LPYqti62LHZgiDYp9mE2LnZhdmE2YrYqSDYudiv2Kkg2K/Zgtin2KbZgi4uLlxuIgogICAgICAgICAgICBmItiz2KPYsdiz2YQg2YTZgyDYs9is2YQg2KfZhNiq2YLYr9mFINmC2LHZitio2KfZiyEiLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINil2YbYtNin2KEg2LHYs9in2YTYqSDYp9mE2KrZgtiv2YUg2KfZhNmF2KjYp9i02LEKICAgICAgICAgICAgcHJvZ3Jlc3NfbWVzc2FnZSA9IGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLij7MgKirYrNin2LHZiiDYp9mE2KrYrdi22YrYsS4uLioqXG5cbiIKICAgICAgICAgICAgICAgICLij7HvuI8g2KfZhNix2KzYp9ihINin2YTYp9mG2KrYuNin2LEuLi4iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXZhti02KfYoSDZhdiq2KrYqNi5INin2YTYqtmC2K/ZhSDYp9mE2YXYqNin2LTYsQogICAgICAgICAgICBsaXZlX3RyYWNrZXIgPSBMaXZlUHJvZ3Jlc3NUcmFja2VyKHNlbGYuZGV0YWlsZWRfbG9nZ2VyLCBwcm9ncmVzc19tZXNzYWdlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYqNiv2KEg2YXYsdit2YTYqSDYp9mE2KrYrdmF2YrZhAogICAgICAgICAgICBhd2FpdCBsaXZlX3RyYWNrZXIuc3RhcnQoIvCfk6Ug2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiCIsIDEwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXZhti02KfYoSBjb21wcmVzc29yINmF2Lkg2YXYqtiq2KjYuSDZhdio2KfYtNixCiAgICAgICAgICAgIGNvbXByZXNzb3Jfd2l0aF90cmFja2VyID0gVmlkZW9Db21wcmVzc29yKAogICAgICAgICAgICAgICAgbG9nZ2VyPXNlbGYuZGV0YWlsZWRfbG9nZ2VyLAogICAgICAgICAgICAgICAgbGl2ZV90cmFja2VyPWxpdmVfdHJhY2tlcgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBhc3luY2lvLnRvX3RocmVhZCgKICAgICAgICAgICAgICAgIGNvbXByZXNzb3Jfd2l0aF90cmFja2VyLnByb2Nlc3NfdmlkZW9fZnJvbV91cmwsCiAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICBxdWFsaXR5PXF1YWxpdHkKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdmG2YfYp9ihINin2YTYqtmC2K/ZhQogICAgICAgICAgICBhd2FpdCBsaXZlX3RyYWNrZXIuZmluaXNoKHN1Y2Nlc3M9VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzX21lc3NhZ2UuZGVsZXRlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgIyDYsdmB2Lkg2KfZhNmB2YrYr9mK2Ygv2KfZhNmB2YrYr9mK2YjZh9in2KoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBmIuKchSAqKtiq2YUg2KfZhNi22LrYtyDYqNmG2KzYp9itISoqXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+TpCDYrNin2LHZiiDYsdmB2Lkg2KfZhNmB2YrYr9mK2YguLi4iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdFsndHlwZSddID09ICdzaW5nbGUnOgogICAgICAgICAgICAgICAgIyDZgdmK2K/ZitmIINmI2KfYrdivCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUocmVzdWx0WydmaWxlJ10pIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKHJlc3VsdFsnZmlsZSddLCAncmInKSBhcyB2aWRlbzoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3ZpZGVvKAogICAgICAgICAgICAgICAgICAgICAgICB2aWRlbz12aWRlbywKICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj1mIuKchSAqKtiq2YUg2KfZhNi22LrYtyDYqNmG2KzYp9itISoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7ZmlsZV9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzX3N0cmVhbWluZz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShyZXN1bHRbJ2ZpbGUnXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjINi52K/YqSDYo9is2LLYp9ihCiAgICAgICAgICAgICAgICB0b3RhbF9wYXJ0cyA9IGxlbihyZXN1bHRbJ2ZpbGVzJ10pCiAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAgICAgZiLwn5OmICoq2KfZhNmB2YrYr9mK2Ygg2YPYqNmK2LEgLSDYqtmFINin2YTYqtmC2LPZitmFINil2YTZiSB7dG90YWxfcGFydHN9INij2KzYstin2KEqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7Mg2KzYp9ix2Yog2LHZgdi5INin2YTYo9is2LLYp9ihLi4uIiwKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGksIHBhcnRfZmlsZSBpbiBlbnVtZXJhdGUocmVzdWx0WydmaWxlcyddLCAxKToKICAgICAgICAgICAgICAgICAgICBwYXJ0X3NpemUgPSBvcy5wYXRoLmdldHNpemUocGFydF9maWxlKSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhcnRfZmlsZSwgJ3JiJykgYXMgdmlkZW86CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfdmlkZW8oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlbz12aWRlbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OmICoq2KfZhNis2LLYoSB7aX0ve3RvdGFsX3BhcnRzfSoqXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TiiDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5X25hbWV9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7cGFydF9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c19zdHJlYW1pbmc9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHBhcnRfZmlsZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYs9is2YQg2KfZhNi52YXZhNmK2KfYqgogICAgICAgICAgICBsb2dfZmlsZSA9IHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmdldF9sb2dfZmlsZSgpCiAgICAgICAgICAgIGlmIGxvZ19maWxlIGFuZCBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX2ZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV9kb2N1bWVudCgKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj0i8J+TiyAqKtiz2KzZhCDYp9mE2LnZhdmE2YrYp9iqINin2YTZg9in2YXZhCoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi2YrYrdiq2YjZiiDYudmE2Ykg2KzZhdmK2Lkg2KrZgdin2LXZitmEINin2YTZhdi52KfZhNis2Kkg2YjYp9mE2KPYrti32KfYoSAo2KXZhiDZiNis2K/YqikiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINil2YbZh9in2KEg2KfZhNis2YTYs9ipINio2YbYrNin2K0KICAgICAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIuZmluaXNoX3Nlc3Npb24oc3VjY2Vzcz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBmIuKchSAqKtiq2YUg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiCDYp9mE2YXYtti62YjYtyEqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuIgogICAgICAgICAgICAgICAgZiLwn5OLINiq2YUg2KXYsdiz2KfZhCDYs9is2YQg2KfZhNi52YXZhNmK2KfYqiDYo9mK2LbYp9mLXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+UhCDYo9ix2LPZhCDYsdin2KjYtyDYotiu2LEg2YTZhNmF2LLZitivISIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyDYqtit2K/ZitirINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFINio2KfZhNiu2LfYowogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBhd2FpdCBwcm9ncmVzc19tZXNzYWdlLmVkaXRfdGV4dCgKICAgICAgICAgICAgICAgICAgICBmIuKdjCAqKtit2K/YqyDYrti32KMhKipcblxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+TnSB7c3RyKGUpWzoxMDBdfS4uLlxuXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7Mg2KzYp9ix2Yog2KXYsdiz2KfZhCDYs9is2YQg2KfZhNij2K7Yt9in2KEuLi4iLAogICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjINiq2LPYrNmK2YQg2KfZhNiu2LfYowogICAgICAgICAgICBzZWxmLmRldGFpbGVkX2xvZ2dlci5sb2dfZXJyb3IoZSwgItmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCDYp9mE2YPYp9mF2YTYqSIpCiAgICAgICAgICAgIHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmZpbmlzaF9zZXNzaW9uKHN1Y2Nlc3M9RmFsc2UpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINil2LHYs9in2YQg2LPYrNmEINin2YTYo9iu2LfYp9ihCiAgICAgICAgICAgIGxvZ19maWxlID0gc2VsZi5kZXRhaWxlZF9sb2dnZXIuZ2V0X2xvZ19maWxlKCkKICAgICAgICAgICAgaWYgbG9nX2ZpbGUgYW5kIG9zLnBhdGguZXhpc3RzKGxvZ19maWxlKToKICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X2RvY3VtZW50KAogICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudD1mLAogICAgICAgICAgICAgICAgICAgICAgICBjYXB0aW9uPSLinYwgKirYs9is2YQg2KfZhNij2K7Yt9in2KEqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgItit2K/YqyDYrti32KMg2KPYq9mG2KfYoSDYp9mE2YXYudin2YTYrNipLiDYp9mE2YXZhNmBINmK2K3YqtmI2Yog2LnZhNmJINin2YTYqtmB2KfYtdmK2YQg2KfZhNmD2KfZhdmE2KkuIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYsdiz2KfZhNipINin2YTYrti32KMKICAgICAgICAgICAgZXJyb3JfdGV4dCA9ICgKICAgICAgICAgICAgICAgIGYi4p2MICoq2K3Yr9irINiu2LfYoyDYo9ir2YbYp9ihINin2YTZhdi52KfZhNis2KkqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk50g2KfZhNiu2LfYozogYHtzdHIoZSlbOjIwMF19YFxuXG4iCiAgICAgICAgICAgICAgICBmIvCfkqEgKirYp9mE2K3ZhNmI2YQg2KfZhNmF2YLYqtix2K3YqToqKlxuIgogICAgICAgICAgICAgICAgZiLigKIg2KrYo9mD2K8g2YXZhiDYtdit2Kkg2KfZhNix2KfYqNi3XG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYqtit2YLZgiDZhdmGINij2YYg2KfZhNmF2YTZgSDYudin2YUgKEdvb2dsZSBEcml2ZSlcbiIKICAgICAgICAgICAgICAgIGYi4oCiINis2LHYqCDYrNmI2K/YqSDYo9mC2YRcbiIKICAgICAgICAgICAgICAgIGYi4oCiINix2KfYrNi5INmF2YTZgSDYp9mE2LPYrNmEINmE2YTYqtmB2KfYtdmK2YRcblxuIgogICAgICAgICAgICAgICAgZiLwn4aYINmE2YTZhdiz2KfYudiv2Kk6IC9oZWxwIgogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChlcnJvcl90ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAKICAgIGRlZiBydW4oc2VsZik6CiAgICAgICAgIiIi2KrYtNi62YrZhCDYp9mE2KjZiNiqIiIiCiAgICAgICAgcHJpbnQoIj0iICogNzApCiAgICAgICAgcHJpbnQoIvCfmoAg2KjYr9ihINiq2LTYutmK2YQg2KjZiNiqINi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2KfYrdiq2LHYp9mB2YoiKQogICAgICAgIHByaW50KCI9IiAqIDcwKQogICAgICAgIHByaW50KGYi8J+TgSDYp9mE2YXYrNmE2K8g2KfZhNmF2KTZgtiqOiB7VEVNUF9ESVJ9IikKICAgICAgICBwcmludChmIvCfk4sg2YXYrNmE2K8g2KfZhNiz2KzZhNin2Ko6IHtMT0dTX0RJUn0iKQogICAgICAgIHByaW50KGYi8J+TpiDYrdivINix2YHYuSBUZWxlZ3JhbSAo2YTZg9mEINis2LLYoSk6IHtNQVhfVEVMRUdSQU1fU0laRV9NQn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgcHJpbnQoIuKchSDYp9mE2KjZiNiqINis2KfZh9iyINmE2YTYudmF2YQhIikKICAgICAgICBwcmludCgiPSIgKiA3MCkKICAgICAgICAKICAgICAgICAjINiq2YUg2KrYudiv2YrZhNmHINmE2YTYudmF2YQg2YHZiiB0aHJlYWQKCiAgICAgICAgCiAgICAgICAgaW1wb3J0IGFzeW5jaW8KCiAgICAgICAgCiAgICAgICAgbG9vcCA9IGFzeW5jaW8ubmV3X2V2ZW50X2xvb3AoKQoKICAgICAgICAKICAgICAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKGxvb3ApCgogICAgICAgIAogICAgICAgIGFzeW5jIGRlZiBydW4oKToKCiAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLmluaXRpYWxpemUoKQoKICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAuc3RhcnQoKQoKICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAudXBkYXRlci5zdGFydF9wb2xsaW5nKCkKCiAgICAgICAgCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgCiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgoKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgogICAgICAgIAogICAgICAgICAgICBleGNlcHQ6CgogICAgICAgIAogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAKICAgICAgICAgICAgZmluYWxseToKCiAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC51cGRhdGVyLnN0b3AoKQoKICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnN0b3AoKQoKICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnNodXRkb3duKCkKCiAgICAgICAgCiAgICAgICAgbG9vcC5ydW5fdW50aWxfY29tcGxldGUocnVuKCkpCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn46vINmG2YLYt9ipINin2YTYqNiv2KfZitipCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRyeToKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGIEZGbXBlZwogICAgICAgIHRyeToKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydmZm1wZWcnLCAnLXZlcnNpb24nXSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgY2hlY2s9VHJ1ZSkKICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINin2YTYudir2YjYsSDYudmE2YkgRkZtcGVnIikKICAgICAgICBleGNlcHQgKHN1YnByb2Nlc3MuQ2FsbGVkUHJvY2Vzc0Vycm9yLCBGaWxlTm90Rm91bmRFcnJvcik6CiAgICAgICAgICAgIHByaW50KCLinYwgRkZtcGVnINi62YrYsSDZhdir2KjYqiEiKQogICAgICAgICAgICBwcmludCgi2KfZhNix2KzYp9ihINiq2KvYqNmK2KrZhyDYqNin2YTYo9mF2LE6IHN1ZG8gYXB0IGluc3RhbGwgZmZtcGVnIikKICAgICAgICAgICAgZXhpdCgxKQogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2KrZiNmD2YYg2KfZhNio2YjYqgogICAgICAgIGlmIEJPVF9UT0tFTiA9PSAiWU9VUl9CT1RfVE9LRU5fSEVSRSI6CiAgICAgICAgICAgIHByaW50KCLinYwg2KfZhNix2KzYp9ihINiq2LnYr9mK2YQgQk9UX1RPS0VOINmB2Yog2KfZhNmD2YjYryEiKQogICAgICAgICAgICBleGl0KDEpCiAgICAgICAgCiAgICAgICAgIyDYqti02LrZitmEINin2YTYqNmI2KoKICAgICAgICBib3QgPSBWaWRlb0NvbXByZXNzb3JCb3QoQk9UX1RPS0VOKQogICAgICAgIGJvdC5ydW4oKQogICAgCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcHJpbnQoIlxu8J+RiyDYqtmFINil2YrZgtin2YEg2KfZhNio2YjYqiDYqNmI2KfYs9i32Kkg2KfZhNmF2LPYqtiu2K/ZhSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2KfYr9itOiB7ZX0iKQogICAgICAgIGV4aXQoMSkK",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
