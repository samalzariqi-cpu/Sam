#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    global start_time
    uptime = str(datetime.now() - start_time).split(".")[0] if start_time else "0"
    
    html = """
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</title>
        <style>
            * {{
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 600px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9em;
            }}
            .status {{
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
            }}
            .status h2 {{
                color: #10b981;
                text-align: center;
                margin-bottom: 20px;
            }}
            .bot-item {{
                background: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIK8J+OrCDYttin2LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2LTYp9mF2YQgLSBUZWxlZ3JhbSBCb3QK2YPZiNivINmD2KfZhdmEINmB2Yog2YXZhNmBINmI2KfYrdivIC0g2KzYp9mH2LIg2YTZhNiq2LTYutmK2YQg2YXYqNin2LTYsdipIQoK2KfZhNmF2YXZitiy2KfYqjoK4pyFINiv2LnZhSBHb29nbGUgRHJpdmUg2YjYp9mE2LHZiNin2KjYtyDYp9mE2YXYqNin2LTYsdipCuKchSDYtti62Lcg2YHZitiv2YrZiNmH2KfYqiDYqNij2Yog2K3YrNmFICg1MCBNQiAtIDYwMCBNQispCuKchSA0INmF2LPYqtmI2YrYp9iqINis2YjYr9ipCuKchSDYqtit2YXZitmEINiw2YPZiiDYqNin2YTZgti32LkgKGNodW5rcykK4pyFINi52LHYtiDYp9mE2KrZgtiv2YUg2KfZhNmF2KjYp9i02LEKCtin2YTZhdiq2LfZhNio2KfYqjoKLSBQeXRob24gMy44KwotIEZGbXBlZyAoc3VkbyBhcHQgaW5zdGFsbCBmZm1wZWcpCi0gcGlwIGluc3RhbGwgcHl0aG9uLXRlbGVncmFtLWJvdCByZXF1ZXN0cwoK2KfZhNin2LPYqtiu2K/Yp9mFOgoxLiDYudiv2YQgQk9UX1RPS0VOINij2K/Zhtin2YcKMi4g2LTYutmEOiBweXRob24zIHZpZGVvX2JvdC5weQozLiDYo9ix2LPZhCDYsdin2KjYtyDYp9mE2YHZitiv2YrZiCDZhNmE2KjZiNiqCiIiIgoKaW1wb3J0IG9zCmltcG9ydCBhc3luY2lvCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgcmUKaW1wb3J0IHRpbWUKaW1wb3J0IGxvZ2dpbmcKZnJvbSBwYXRobGliIGltcG9ydCBQYXRoCmZyb20gdGVsZWdyYW0gaW1wb3J0IFVwZGF0ZSwgSW5saW5lS2V5Ym9hcmRCdXR0b24sIElubGluZUtleWJvYXJkTWFya3VwCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCBBcHBsaWNhdGlvbiwgQ29tbWFuZEhhbmRsZXIsIE1lc3NhZ2VIYW5kbGVyLCBDYWxsYmFja1F1ZXJ5SGFuZGxlciwgQ29udGV4dFR5cGVzLCBmaWx0ZXJzCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDimpnvuI8g2KfZhNil2LnYr9in2K/Yp9iqIC0g2LnYr9mEINmH2YbYpyDZgdmC2LchCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKQk9UX1RPS0VOID0gIjc4NzE1ODM3NjA6QUFFQWoxTk1sZ01VN0g4WTNUbzNhN2xHdlNoVlo3NEJ2elUiICAjIPCfkYgg2LbYuSDYqtmI2YPZhiDYp9mE2KjZiNiqINmH2YbYpwpURU1QX0RJUiA9ICIuL3RlbXBfdmlkZW9zIiAgIyDZhdis2YTYryDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqQpNQVhfVEVMRUdSQU1fU0laRV9NQiA9IDUwICAjINit2K8g2LHZgdi5INin2YTZhdmE2YHYp9iqINmB2YogVGVsZWdyYW0KCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfk50g2KXYudiv2KfYryDYp9mE2KrYs9is2YrZhCAoTG9nZ2luZykKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Cgpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgZm9ybWF0PSclKGFzY3RpbWUpcyAtICUobmFtZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywKICAgIGxldmVsPWxvZ2dpbmcuSU5GTwopCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+OrCDZgdim2Kkg2LbYp9i62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBWaWRlb0NvbXByZXNzb3I6CiAgICAiIiLZgdim2Kkg2LTYp9mF2YTYqSDZhNiq2K3ZhdmK2YQg2YjYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KoiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRlbXBfZGlyPVRFTVBfRElSKToKICAgICAgICAiIiLYqtmH2YrYptipINin2YTYttin2LrYtyIiIgogICAgICAgIHNlbGYudGVtcF9kaXIgPSBQYXRoKHRlbXBfZGlyKQogICAgICAgIHNlbGYudGVtcF9kaXIubWtkaXIoZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4Eg2KrZhSDYpdmG2LTYp9ihINmF2KzZhNivINmF2KTZgtiqOiB7c2VsZi50ZW1wX2Rpcn0iKQogICAgCiAgICBkZWYgZXh0cmFjdF9nb29nbGVfZHJpdmVfaWQoc2VsZiwgdXJsKToKICAgICAgICAiIiLYp9iz2KrYrtix2KfYrCDZhdi52LHZgSDYp9mE2YXZhNmBINmF2YYg2LHYp9io2LcgR29vZ2xlIERyaXZlIiIiCiAgICAgICAgcGF0dGVybnMgPSBbCiAgICAgICAgICAgIHInaWQ9KFthLXpBLVowLTlfLV0rKScsCiAgICAgICAgICAgIHInL2QvKFthLXpBLVowLTlfLV0rKScsCiAgICAgICAgICAgIHInb3Blblw/aWQ9KFthLXpBLVowLTlfLV0rKScsCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBwYXR0ZXJuIGluIHBhdHRlcm5zOgogICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChwYXR0ZXJuLCB1cmwpCiAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoLmdyb3VwKDEpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIAogICAgZGVmIGdldF9nb29nbGVfZHJpdmVfZG93bmxvYWRfdXJsKHNlbGYsIGZpbGVfaWQpOgogICAgICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2LHYp9io2Lcg2KfZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LEg2YXZhiBHb29nbGUgRHJpdmUiIiIKICAgICAgICByZXR1cm4gZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/aWQ9e2ZpbGVfaWR9JmV4cG9ydD1kb3dubG9hZCZjb25maXJtPXQiCiAgICAKICAgIGRlZiBkb3dubG9hZF92aWRlbyhzZWxmLCB1cmwsIG91dHB1dF9wYXRoLCBjaHVua19zaXplPTgxOTIsIHByb2dyZXNzX2NhbGxiYWNrPU5vbmUpOgogICAgICAgICIiIgogICAgICAgINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2Ygg2YXZhiDYo9mKINix2KfYqNi3INmF2Lkg2K/YudmFINmD2KfZhdmEINmE2YTZhdmE2YHYp9iqINin2YTZg9io2YrYsdipCiAgICAgICAgCiAgICAgICAgQXJnczoKICAgICAgICAgICAgdXJsOiDYsdin2KjYtyDYp9mE2YHZitiv2YrZiCAo2YXYqNin2LTYsSDYo9mIIEdvb2dsZSBEcml2ZSkKICAgICAgICAgICAgb3V0cHV0X3BhdGg6INmF2LPYp9ixINit2YHYuCDYp9mE2YXZhNmBCiAgICAgICAgICAgIGNodW5rX3NpemU6INit2KzZhSDYp9mE2YLYt9i52Kkg2YTZhNiq2K3ZhdmK2YQgKDhLQiDYp9mB2KrYsdin2LbZitin2YspCiAgICAgICAgICAgIHByb2dyZXNzX2NhbGxiYWNrOiDYr9in2YTYqSDZhNi52LHYtiDYp9mE2KrZgtiv2YUgKNin2K7YqtmK2KfYsdmKKQogICAgICAgICIiIgogICAgICAgIGxvZ2dlci5pbmZvKGYi8J+UvSDYqNiv2KEg2KfZhNiq2K3ZhdmK2YQg2YXZhjoge3VybFs6NjBdfS4uLiIpCiAgICAgICAgCiAgICAgICAgIyDZhdi52KfZhNis2Kkg2LHZiNin2KjYtyBHb29nbGUgRHJpdmUKICAgICAgICBpZiAnZHJpdmUuZ29vZ2xlLmNvbScgaW4gdXJsOgogICAgICAgICAgICBmaWxlX2lkID0gc2VsZi5leHRyYWN0X2dvb2dsZV9kcml2ZV9pZCh1cmwpCiAgICAgICAgICAgIGlmIGZpbGVfaWQ6CiAgICAgICAgICAgICAgICB1cmwgPSBzZWxmLmdldF9nb29nbGVfZHJpdmVfZG93bmxvYWRfdXJsKGZpbGVfaWQpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4Eg2YXYudix2YEgR29vZ2xlIERyaXZlOiB7ZmlsZV9pZH0iKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyDYqNiv2KEg2KfZhNiq2K3ZhdmK2YQg2YXYuSBzdHJlYW09VHJ1ZSDZhNiv2LnZhSDYp9mE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqQogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PTYwLCBhbGxvd19yZWRpcmVjdHM9VHJ1ZSkKICAgICAgICAgICAgcmVzcG9uc2UucmFpc2VfZm9yX3N0YXR1cygpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINin2YTYrdi12YjZhCDYudmE2Ykg2K3YrNmFINin2YTZhdmE2YEg2KXZhiDZiNis2K8KICAgICAgICAgICAgdG90YWxfc2l6ZSA9IGludChyZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnLCAwKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHRvdGFsX3NpemUgPiAwOgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5OmINit2KzZhSDYp9mE2YXZhNmBOiB7dG90YWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINin2YTYqtit2YXZitmEINio2KfZhNmC2LfYuQogICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9wYXRoLCAnd2InKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIGNodW5rIGluIHJlc3BvbnNlLml0ZXJfY29udGVudChjaHVua19zaXplPWNodW5rX3NpemUpOgogICAgICAgICAgICAgICAgICAgIGlmIGNodW5rOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGNodW5rKQogICAgICAgICAgICAgICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgKz0gbGVuKGNodW5rKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDYudix2LYg2KfZhNiq2YLYr9mFCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHByb2dyZXNzX2NhbGxiYWNrIGFuZCB0b3RhbF9zaXplID4gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2dyZXNzID0gKGRvd25sb2FkZWRfc2l6ZSAvIHRvdGFsX3NpemUpICogMTAwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9ncmVzc19jYWxsYmFjayhwcm9ncmVzcywgZG93bmxvYWRlZF9zaXplLCB0b3RhbF9zaXplKQogICAgICAgICAgICAKICAgICAgICAgICAgZWxhcHNlZF90aW1lID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgIGZpbmFsX3NpemUgPSBvcy5wYXRoLmdldHNpemUob3V0cHV0X3BhdGgpCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSDYqtmFINin2YTYqtit2YXZitmEINio2YbYrNin2K0hIikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5OKINin2YTYrdis2YUg2KfZhNmG2YfYp9im2Yo6IHtmaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLij7HvuI8g2KfZhNmI2YLYqiDYp9mE2YXYs9iq2LrYsdmCOiB7ZWxhcHNlZF90aW1lOi4yZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINij2YYg2KfZhNmF2YTZgSDZhNmK2LMg2YHYp9ix2LrYp9mLCiAgICAgICAgICAgIGlmIGZpbmFsX3NpemUgPCAxMDAwOiAgIyDYo9mC2YQg2YXZhiAxINmD2YrZhNmI2KjYp9mK2KoKICAgICAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZiLinYwg2KfZhNmF2YTZgSDYp9mE2YXYrdmF2YQg2LXYutmK2LEg2KzYr9in2YsgKHtmaW5hbF9zaXplfSDYqNin2YrYqikhINmC2K8g2YrZg9mI2YYg2YfZhtin2YMg2K7Yt9ijINmB2Yog2KfZhNix2KfYqNi3LiIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gb3V0cHV0X3BhdGgKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLmV4Y2VwdGlvbnMuUmVxdWVzdEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNiq2K3ZhdmK2YQ6IHtlfSIpCiAgICAgICAgICAgIHJhaXNlCiAgICAKICAgIGRlZiBnZXRfdmlkZW9faW5mbyhzZWxmLCB2aWRlb19wYXRoKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmIINio2KfYs9iq2K7Yr9in2YUgZmZwcm9iZSIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgY21kID0gWwogICAgICAgICAgICAgICAgJ2ZmcHJvYmUnLAogICAgICAgICAgICAgICAgJy12JywgJ3F1aWV0JywKICAgICAgICAgICAgICAgICctcHJpbnRfZm9ybWF0JywgJ2pzb24nLAogICAgICAgICAgICAgICAgJy1zaG93X2Zvcm1hdCcsCiAgICAgICAgICAgICAgICAnLXNob3dfc3RyZWFtcycsCiAgICAgICAgICAgICAgICB2aWRlb19wYXRoCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSAhPSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBpbXBvcnQganNvbgogICAgICAgICAgICBpbmZvID0ganNvbi5sb2FkcyhyZXN1bHQuc3Rkb3V0KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYp9iz2KrYrtix2KfYrCDYp9mE2YXYudmE2YjZhdin2Kog2KfZhNmF2YfZhdipCiAgICAgICAgICAgIGZvcm1hdF9pbmZvID0gaW5mby5nZXQoJ2Zvcm1hdCcsIHt9KQogICAgICAgICAgICB2aWRlb19zdHJlYW0gPSBuZXh0KChzIGZvciBzIGluIGluZm8uZ2V0KCdzdHJlYW1zJywgW10pIGlmIHNbJ2NvZGVjX3R5cGUnXSA9PSAndmlkZW8nKSwgTm9uZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnc2l6ZSc6IGludChmb3JtYXRfaW5mby5nZXQoJ3NpemUnLCAwKSksCiAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBmbG9hdChmb3JtYXRfaW5mby5nZXQoJ2R1cmF0aW9uJywgMCkpLAogICAgICAgICAgICAgICAgJ2JpdHJhdGUnOiBpbnQoZm9ybWF0X2luZm8uZ2V0KCdiaXRfcmF0ZScsIDApKSwKICAgICAgICAgICAgICAgICd3aWR0aCc6IHZpZGVvX3N0cmVhbS5nZXQoJ3dpZHRoJywgMCkgaWYgdmlkZW9fc3RyZWFtIGVsc2UgMCwKICAgICAgICAgICAgICAgICdoZWlnaHQnOiB2aWRlb19zdHJlYW0uZ2V0KCdoZWlnaHQnLCAwKSBpZiB2aWRlb19zdHJlYW0gZWxzZSAwLAogICAgICAgICAgICAgICAgJ2NvZGVjJzogdmlkZW9fc3RyZWFtLmdldCgnY29kZWNfbmFtZScsICd1bmtub3duJykgaWYgdmlkZW9fc3RyZWFtIGVsc2UgJ3Vua25vd24nLAogICAgICAgICAgICB9CiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyDYqti52LDYsSDYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmIOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgY29tcHJlc3NfdmlkZW8oc2VsZiwgaW5wdXRfcGF0aCwgb3V0cHV0X3BhdGgsIHF1YWxpdHk9J21lZGl1bScsIHRhcmdldF9zaXplX21iPU5vbmUsIHByb2dyZXNzX2NhbGxiYWNrPU5vbmUpOgogICAgICAgICIiIgogICAgICAgINi22LrYtyDYp9mE2YHZitiv2YrZiCDYqNin2LPYqtiu2K/Yp9mFIEZGbXBlZwogICAgICAgIAogICAgICAgIEFyZ3M6CiAgICAgICAgICAgIGlucHV0X3BhdGg6INmF2LPYp9ixINin2YTZgdmK2K/ZitmIINin2YTZhdiv2K7ZhAogICAgICAgICAgICBvdXRwdXRfcGF0aDog2YXYs9in2LEg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2K7YsdisCiAgICAgICAgICAgIHF1YWxpdHk6INis2YjYr9ipINin2YTYtti62LcgKCdsb3cnLCAnbWVkaXVtJywgJ2hpZ2gnLCAndWx0cmEnKQogICAgICAgICAgICB0YXJnZXRfc2l6ZV9tYjog2KfZhNit2KzZhSDYp9mE2YXYs9iq2YfYr9mBINio2KfZhNmF2YrYrNin2KjYp9mK2KogKNin2K7YqtmK2KfYsdmKKQogICAgICAgICAgICBwcm9ncmVzc19jYWxsYmFjazog2K/Yp9mE2Kkg2YTYudix2LYg2KfZhNiq2YLYr9mFICjYp9iu2KrZitin2LHZiikKICAgICAgICAiIiIKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfjqwg2KjYr9ihINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgbG9nZ2VyLmluZm8oZiLwn5OCINin2YTZhdiv2K7ZhDoge2lucHV0X3BhdGh9IikKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4Eg2KfZhNmF2K7YsdisOiB7b3V0cHV0X3BhdGh9IikKICAgICAgICAKICAgICAgICAjINin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNmB2YrYr9mK2YgKICAgICAgICB2aWRlb19pbmZvID0gc2VsZi5nZXRfdmlkZW9faW5mbyhpbnB1dF9wYXRoKQogICAgICAgIGlmIHZpZGVvX2luZm86CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+TiiDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiCDYp9mE2KPYtdmE2Yo6IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICDigKIg2KfZhNit2KzZhToge3ZpZGVvX2luZm9bJ3NpemUnXSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICAg4oCiINin2YTZhdiv2Kk6IHt2aWRlb19pbmZvWydkdXJhdGlvbiddOi4yZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiICAg4oCiINin2YTYr9mC2Kk6IHt2aWRlb19pbmZvWyd3aWR0aCddfXh7dmlkZW9faW5mb1snaGVpZ2h0J119IikKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiIgICDigKIg2YXYudiv2YQg2KfZhNio2Ko6IHt2aWRlb19pbmZvWydiaXRyYXRlJ10gLyAxMDAwOi4wZn0ga2JwcyIpCiAgICAgICAgCiAgICAgICAgIyDYpdi52K/Yp9iv2KfYqiDYp9mE2KzZiNiv2KkKICAgICAgICBxdWFsaXR5X3NldHRpbmdzID0gewogICAgICAgICAgICAndWx0cmEnOiB7J2NyZic6IDE4LCAncHJlc2V0JzogJ3Nsb3cnLCAnYXVkaW9fYml0cmF0ZSc6ICcxOTJrJ30sCiAgICAgICAgICAgICdoaWdoJzogeydjcmYnOiAyMywgJ3ByZXNldCc6ICdtZWRpdW0nLCAnYXVkaW9fYml0cmF0ZSc6ICcxMjhrJ30sCiAgICAgICAgICAgICdtZWRpdW0nOiB7J2NyZic6IDI4LCAncHJlc2V0JzogJ2Zhc3QnLCAnYXVkaW9fYml0cmF0ZSc6ICc5NmsnfSwKICAgICAgICAgICAgJ2xvdyc6IHsnY3JmJzogMzIsICdwcmVzZXQnOiAnZmFzdGVyJywgJ2F1ZGlvX2JpdHJhdGUnOiAnNjRrJ30sCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNldHRpbmdzID0gcXVhbGl0eV9zZXR0aW5ncy5nZXQocXVhbGl0eSwgcXVhbGl0eV9zZXR0aW5nc1snbWVkaXVtJ10pCiAgICAgICAgCiAgICAgICAgIyDYqNmG2KfYoSDYo9mF2LEgRkZtcGVnCiAgICAgICAgY21kID0gWwogICAgICAgICAgICAnZmZtcGVnJywKICAgICAgICAgICAgJy1pJywgaW5wdXRfcGF0aCwKICAgICAgICAgICAgJy1jOnYnLCAnbGlieDI2NCcsICAjINmD2YjYr9mDINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgICctY3JmJywgc3RyKHNldHRpbmdzWydjcmYnXSksICAjINis2YjYr9ipINin2YTYtti62LcgKNij2YLZhCA9INij2YHYttmEKQogICAgICAgICAgICAnLXByZXNldCcsIHNldHRpbmdzWydwcmVzZXQnXSwgICMg2LPYsdi52Kkg2KfZhNi22LrYtwogICAgICAgICAgICAnLWM6YScsICdhYWMnLCAgIyDZg9mI2K/ZgyDYp9mE2LXZiNiqCiAgICAgICAgICAgICctYjphJywgc2V0dGluZ3NbJ2F1ZGlvX2JpdHJhdGUnXSwgICMg2YXYudiv2YQg2KjYqiDYp9mE2LXZiNiqCiAgICAgICAgICAgICctbW92ZmxhZ3MnLCAnK2Zhc3RzdGFydCcsICAjINmE2YTYqti02LrZitmEINin2YTYs9ix2YrYuQogICAgICAgICAgICAnLXknLCAgIyDYp9iz2KrYqNiv2KfZhCDYp9mE2YXZhNmBINil2YYg2YjYrNivCiAgICAgICAgICAgIG91dHB1dF9wYXRoCiAgICAgICAgXQogICAgICAgIAogICAgICAgICMg2KXYsNinINmD2KfZhiDZh9mG2KfZgyDYrdis2YUg2YXYs9iq2YfYr9mB2Iwg2YbYrdiz2Kgg2YXYudiv2YQg2KfZhNio2Kog2KfZhNmF2LfZhNmI2KgKICAgICAgICBpZiB0YXJnZXRfc2l6ZV9tYiBhbmQgdmlkZW9faW5mbyBhbmQgdmlkZW9faW5mb1snZHVyYXRpb24nXSA+IDA6CiAgICAgICAgICAgIHRhcmdldF9iaXRyYXRlID0gaW50KCh0YXJnZXRfc2l6ZV9tYiAqIDggKiAxMDI0KSAvIHZpZGVvX2luZm9bJ2R1cmF0aW9uJ10pCiAgICAgICAgICAgIGF1ZGlvX2JpdHJhdGUgPSBpbnQoc2V0dGluZ3NbJ2F1ZGlvX2JpdHJhdGUnXS5yZXBsYWNlKCdrJywgJycpKQogICAgICAgICAgICB2aWRlb19iaXRyYXRlID0gdGFyZ2V0X2JpdHJhdGUgLSBhdWRpb19iaXRyYXRlCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB2aWRlb19iaXRyYXRlID4gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+OryDYp9mE2K3YrNmFINin2YTZhdiz2KrZh9iv2YE6IHt0YXJnZXRfc2l6ZV9tYn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4kg2YXYudiv2YQg2KfZhNio2Kog2KfZhNmF2K3Ys9mI2Kg6IHt2aWRlb19iaXRyYXRlfSBrYnBzIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYp9iz2KrYqNiv2KfZhCBDUkYg2KjZhdi52K/ZhCDYqNiqINir2KfYqNiqCiAgICAgICAgICAgICAgICBjbWQgPSBbCiAgICAgICAgICAgICAgICAgICAgJ2ZmbXBlZycsCiAgICAgICAgICAgICAgICAgICAgJy1pJywgaW5wdXRfcGF0aCwKICAgICAgICAgICAgICAgICAgICAnLWM6dicsICdsaWJ4MjY0JywKICAgICAgICAgICAgICAgICAgICAnLWI6dicsIGYne3ZpZGVvX2JpdHJhdGV9aycsCiAgICAgICAgICAgICAgICAgICAgJy1tYXhyYXRlJywgZid7dmlkZW9fYml0cmF0ZX1rJywKICAgICAgICAgICAgICAgICAgICAnLWJ1ZnNpemUnLCBmJ3t2aWRlb19iaXRyYXRlICogMn1rJywKICAgICAgICAgICAgICAgICAgICAnLXByZXNldCcsIHNldHRpbmdzWydwcmVzZXQnXSwKICAgICAgICAgICAgICAgICAgICAnLWM6YScsICdhYWMnLAogICAgICAgICAgICAgICAgICAgICctYjphJywgc2V0dGluZ3NbJ2F1ZGlvX2JpdHJhdGUnXSwKICAgICAgICAgICAgICAgICAgICAnLW1vdmZsYWdzJywgJytmYXN0c3RhcnQnLAogICAgICAgICAgICAgICAgICAgICcteScsCiAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3BhdGgKICAgICAgICAgICAgICAgIF0KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMg2KrZhtmB2YrYsCDYp9mE2LbYuti3CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4pqZ77iPINis2KfYsdmKINin2YTYtti62Lcg2KjYrNmI2K/YqSAne3F1YWxpdHl9Jy4uLiIpCiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oCiAgICAgICAgICAgICAgICBjbWQsCiAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLAogICAgICAgICAgICAgICAgdGV4dD1UcnVlCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlICE9IDA6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiLinYwg2K7Yt9ijINmB2YogRkZtcGVnOiIpCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IocmVzdWx0LnN0ZGVycikKICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigi2YHYtNmEINi22LrYtyDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgICAgIAogICAgICAgICAgICBlbGFwc2VkX3RpbWUgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2YXYudmE2YjZhdin2Kog2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtwogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhvdXRwdXRfcGF0aCk6CiAgICAgICAgICAgICAgICBvdXRwdXRfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgICAgIGNvbXByZXNzaW9uX3JhdGlvID0gKDEgLSBvdXRwdXRfc2l6ZSAvIHZpZGVvX2luZm9bJ3NpemUnXSkgKiAxMDAgaWYgdmlkZW9faW5mbyBlbHNlIDAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUg2KrZhSDYp9mE2LbYuti3INio2YbYrNin2K0hIikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi8J+TiiDYp9mE2K3YrNmFINio2LnYryDYp9mE2LbYuti3OiB7b3V0cHV0X3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAgICAgaWYgdmlkZW9faW5mbzoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk4kg2YbYs9io2Kkg2KfZhNi22LrYtzoge2NvbXByZXNzaW9uX3JhdGlvOi4xZn0lIikKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYi4o+x77iPINin2YTZiNmC2Kog2KfZhNmF2LPYqti62LHZgjoge2VsYXBzZWRfdGltZTouMmZ9INir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gb3V0cHV0X3BhdGgKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbigi2YHYtNmEINil2YbYtNin2KEg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtyIpCiAgICAgICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIuKdjCDYrti32KMg2KPYq9mG2KfYoSDYp9mE2LbYuti3OiB7ZX0iKQogICAgICAgICAgICByYWlzZQogICAgCiAgICBkZWYgcHJvY2Vzc192aWRlb19mcm9tX3VybChzZWxmLCB1cmwsIHF1YWxpdHk9J21lZGl1bScsIHRhcmdldF9zaXplX21iPU5vbmUsIHByb2dyZXNzX2NhbGxiYWNrPU5vbmUpOgogICAgICAgICIiIgogICAgICAgINiq2K3ZhdmK2YQg2YjYtti62Lcg2YHZitiv2YrZiCDZhdmGINix2KfYqNi3CiAgICAgICAgCiAgICAgICAgUmV0dXJuczoKICAgICAgICAgICAg2YXYs9in2LEg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2LbYutmI2LcKICAgICAgICAiIiIKICAgICAgICAjINil2YbYtNin2KEg2KPYs9mF2KfYoSDZhdmE2YHYp9iqINmF2KTZgtiq2KkKICAgICAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgaW5wdXRfZmlsZSA9IHNlbGYudGVtcF9kaXIgLyBmImlucHV0X3t0aW1lc3RhbXB9Lm1wNCIKICAgICAgICBvdXRwdXRfZmlsZSA9IHNlbGYudGVtcF9kaXIgLyBmImNvbXByZXNzZWRfe3RpbWVzdGFtcH0ubXA0IgogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyAxLiDYqtit2YXZitmEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGlmIHByb2dyZXNzX2NhbGxiYWNrOgogICAgICAgICAgICAgICAgcHJvZ3Jlc3NfY2FsbGJhY2soImRvd25sb2FkIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuZG93bmxvYWRfdmlkZW8odXJsLCBzdHIoaW5wdXRfZmlsZSkpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm9ncmVzc19jYWxsYmFjazoKICAgICAgICAgICAgICAgIHByb2dyZXNzX2NhbGxiYWNrKCJkb3dubG9hZCIsIDEwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMi4g2LbYuti3INin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGlmIHByb2dyZXNzX2NhbGxiYWNrOgogICAgICAgICAgICAgICAgcHJvZ3Jlc3NfY2FsbGJhY2soImNvbXByZXNzIiwgMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYuY29tcHJlc3NfdmlkZW8oCiAgICAgICAgICAgICAgICBzdHIoaW5wdXRfZmlsZSksCiAgICAgICAgICAgICAgICBzdHIob3V0cHV0X2ZpbGUpLAogICAgICAgICAgICAgICAgcXVhbGl0eT1xdWFsaXR5LAogICAgICAgICAgICAgICAgdGFyZ2V0X3NpemVfbWI9dGFyZ2V0X3NpemVfbWIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgcHJvZ3Jlc3NfY2FsbGJhY2s6CiAgICAgICAgICAgICAgICBwcm9ncmVzc19jYWxsYmFjaygiY29tcHJlc3MiLCAxMDApCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9maWxlKQogICAgICAgICAgICAKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdiv2K7ZhCDZhNmE2KrZiNmB2YrYsSDZgdmKINin2YTZhdiz2KfYrdipCiAgICAgICAgICAgIGlmIGlucHV0X2ZpbGUuZXhpc3RzKCk6CiAgICAgICAgICAgICAgICBpbnB1dF9maWxlLnVubGluaygpCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfl5HvuI8g2KrZhSDYrdiw2YEg2KfZhNmF2YTZgSDYp9mE2YXYpNmC2Ko6IHtpbnB1dF9maWxlfSIpCiAgICAKICAgIGRlZiBjbGVhbnVwKHNlbGYpOgogICAgICAgICIiItit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqSIiIgogICAgICAgIGltcG9ydCBzaHV0aWwKICAgICAgICBpZiBzZWxmLnRlbXBfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBzaHV0aWwucm10cmVlKHNlbGYudGVtcF9kaXIpCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCLwn5eR77iPINiq2YUg2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqINin2YTZhdik2YLYqtipIikKCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn6SWINmB2KbYqSBUZWxlZ3JhbSBCb3QKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBWaWRlb0NvbXByZXNzb3JCb3Q6CiAgICAiIiLYqNmI2KogVGVsZWdyYW0g2YTYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KoiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIHRva2VuKToKICAgICAgICBzZWxmLnRva2VuID0gdG9rZW4KICAgICAgICBzZWxmLmNvbXByZXNzb3IgPSBWaWRlb0NvbXByZXNzb3IoKQogICAgICAgIHNlbGYuYXBwID0gQXBwbGljYXRpb24uYnVpbGRlcigpLnRva2VuKHRva2VuKS5idWlsZCgpCiAgICAgICAgCiAgICAgICAgIyDYpdi22KfZgdipINin2YTZhdi52KfZhNis2KfYqgogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGFydCIsIHNlbGYuc3RhcnQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJoZWxwIiwgc2VsZi5oZWxwKSkKICAgICAgICBzZWxmLmFwcC5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlRFWFQgJiB+ZmlsdGVycy5DT01NQU5ELCBzZWxmLmhhbmRsZV91cmwpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENhbGxiYWNrUXVlcnlIYW5kbGVyKHNlbGYuaGFuZGxlX2NhbGxiYWNrKSkKICAgIAogICAgYXN5bmMgZGVmIHN0YXJ0KHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYsdiz2KfZhNipINin2YTYqtix2K3ZitioIiIiCiAgICAgICAgd2VsY29tZV90ZXh0ID0gIiIiCvCfjqwgKirZhdix2K3YqNin2Ysg2KjZgyDZgdmKINi22KfYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqISoqCgrwn4yfICoq2KfZhNmF2YXZitiy2KfYqjoqKgrinIUg2K/YudmFIEdvb2dsZSBEcml2ZSDZiNin2YTYsdmI2KfYqNi3INin2YTZhdio2KfYtNix2KkK4pyFINi22LrYtyDZgdmK2K/ZitmI2YfYp9iqINio2KPZiiDYrdis2YUgKDUwIE1CIC0gNjAwIE1CKykK4pyFIDQg2YXYs9iq2YjZitin2Kog2KzZiNiv2Kkg2YXYrtiq2YTZgdipCuKchSDYtti62Lcg2LPYsdmK2Lkg2YjZgdi52KfZhAoK8J+TnSAqKtmD2YrZgdmK2Kkg2KfZhNin2LPYqtiu2K/Yp9mFOioqCjHvuI/ig6Mg2KPYsdiz2YQg2LHYp9io2Lcg2KfZhNmB2YrYr9mK2YgKMu+4j+KDoyDYp9iu2KrYsSDYrNmI2K/YqSDYp9mE2LbYuti3CjPvuI/ig6Mg2KfZhtiq2LjYsSDYrdiq2Ykg2YrYqtmFINin2YTYtti62LcKNO+4j+KDoyDYp9iz2KrZhNmFINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3IQoK8J+UlyAqKtij2YXYq9mE2Kkg2LnZhNmJINin2YTYsdmI2KfYqNi3INin2YTZhdiv2LnZiNmF2Kk6KioK4oCiIEdvb2dsZSBEcml2ZTogCiAgYGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD14eHh4eCZleHBvcnQ9ZG93bmxvYWRgCuKAoiDYsdmI2KfYqNi3INmF2KjYp9i02LHYqTogCiAgYGh0dHBzOi8vZXhhbXBsZS5jb20vdmlkZW8ubXA0YAoK2KPYsdiz2YQg2LHYp9io2Lcg2KfZhNmB2YrYr9mK2Ygg2KfZhNii2YYhIPCfkYcKIiIiCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgd2VsY29tZV90ZXh0LAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAKICAgIGFzeW5jIGRlZiBoZWxwKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYsdiz2KfZhNipINin2YTZhdiz2KfYudiv2KkiIiIKICAgICAgICBoZWxwX3RleHQgPSAiIiIK4p2TICoq2YPZitmB2YrYqSDYp9mE2KfYs9iq2K7Yr9in2YU6KioKCioqMe+4j+KDoyDYo9ix2LPZhCDYsdin2KjYtyDYp9mE2YHZitiv2YrZiCoqCtmF2KvYp9mEOgpgaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2lkPXh4eHh4JmV4cG9ydD1kb3dubG9hZGAKCioqMu+4j+KDoyDYp9iu2KrYsSDYp9mE2KzZiNiv2Kk6KioK4oCiIPCflLQg2YXZhtiu2YHYttipOiDYtti62Lcg2YLZiNmKINis2K/Yp9mL2Iwg2K3YrNmFINi12LrZitixCuKAoiDwn5+hINmF2KrZiNiz2LfYqTog2KrZiNin2LLZhiDZhdir2KfZhNmKIOKtkCAo2YXZiNi12Ykg2KjZhykK4oCiIPCfn6Ig2LnYp9mE2YrYqTog2KzZiNiv2Kkg2YXZhdiq2KfYstip2Iwg2K3YrNmFINij2YPYqNixCuKAoiDwn5S1INmB2KfYptmC2Kk6INij2YHYttmEINis2YjYr9ipINmF2YXZg9mG2KkKCioqM++4j+KDoyDYp9mG2KrYuNixKioK2LPZitiq2YUg2KrYrdmF2YrZhCDZiNi22LrYtyDYp9mE2YHZitiv2YrZiCDYqtmE2YLYp9im2YrYp9mLCgoqKjTvuI/ig6Mg2KfYs9iq2YTZhSDYp9mE2YHZitiv2YrZiCoqCtiz2YrYqtmFINix2YHYuSDYp9mE2YHZitiv2YrZiCDYp9mE2YXYtti62YjYtyDZhdio2KfYtNix2KkKCvCfk4wgKirZhdmE2KfYrdi42KfYqjoqKgrigKIg2YrYr9i52YUg2KzZhdmK2Lkg2KPYrdis2KfZhSDYp9mE2YHZitiv2YrZiNmH2KfYqgrigKIg2KfZhNi22LrYtyDZitit2KfZgdi4INi52YTZiSDYp9mE2KzZiNiv2Kkg2YLYr9ixINin2YTYpdmF2YPYp9mGCuKAoiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqSDZitiq2YUg2K3YsNmB2YfYpyDYqtmE2YLYp9im2YrYp9mLCuKAoiDYrdivINix2YHYuSBUZWxlZ3JhbTogNTAg2YXZitis2KfYqNin2YrYqgoK8J+SoSAqKtmG2LXZitit2Kk6KioK2YTZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmD2KjZitix2Kkg2KzYr9in2YvYjCDYp9iu2KrYsSDYrNmI2K/YqSAi2YXZhtiu2YHYttipIiDYo9mIICLZhdiq2YjYs9i32KkiCiIiIgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgIGhlbHBfdGV4dCwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgaGFuZGxlX3VybChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2YXYudin2YTYrNipINin2YTYsdin2KjYtyDYp9mE2YXYsdiz2YQiIiIKICAgICAgICB1cmwgPSB1cGRhdGUubWVzc2FnZS50ZXh0LnN0cmlwKCkKICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINi12K3YqSDYp9mE2LHYp9io2LcKICAgICAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoKCdodHRwOi8vJywgJ2h0dHBzOi8vJykpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDYp9mE2LHYrNin2KEg2KXYsdiz2KfZhCDYsdin2KjYtyDYtdit2YrYrSDZitio2K/YoyDYqNmAIGh0dHA6Ly8g2KPZiCBodHRwczovL1xuXG4iCiAgICAgICAgICAgICAgICAi2YXYq9in2YQ6XG4iCiAgICAgICAgICAgICAgICAiYGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD14eHh4eCZleHBvcnQ9ZG93bmxvYWRgIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2K3Zgdi4INin2YTYsdin2KjYtyDZgdmKINin2YTYs9mK2KfZggogICAgICAgIGNvbnRleHQudXNlcl9kYXRhWyd2aWRlb191cmwnXSA9IHVybAogICAgICAgIAogICAgICAgICMg2LnYsdi2INiu2YrYp9ix2KfYqiDYp9mE2KzZiNiv2KkKICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflLQg2YXZhtiu2YHYttipIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9sb3ciKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+hINmF2KrZiNiz2LfYqSDirZAiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X21lZGl1bSIpLAogICAgICAgICAgICBdLAogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+foiDYudin2YTZitipIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9oaWdoIiksCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UtSDZgdin2KbZgtipIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV91bHRyYSIpLAogICAgICAgICAgICBdLAogICAgICAgIF0KICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgICAgICAKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAi4pyFINiq2YUg2KfYs9iq2YTYp9mFINin2YTYsdin2KjYtyFcblxuIgogICAgICAgICAgICAi8J+TiiDYp9iu2KrYsSDYrNmI2K/YqSDYp9mE2LbYuti3OlxuXG4iCiAgICAgICAgICAgICLwn5S0INmF2YbYrtmB2LbYqTog2KPYtdi62LEg2K3YrNmFXG4iCiAgICAgICAgICAgICLwn5+hINmF2KrZiNiz2LfYqTog2KrZiNin2LLZhiDZhdir2KfZhNmKICjZhdmI2LXZiSDYqNmHKVxuIgogICAgICAgICAgICAi8J+foiDYudin2YTZitipOiDYrNmI2K/YqSDZhdmF2KrYp9iy2KlcbiIKICAgICAgICAgICAgIvCflLUg2YHYp9im2YLYqTog2KPZgdi22YQg2KzZiNiv2KkiLAogICAgICAgICAgICByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwCiAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgaGFuZGxlX2NhbGxiYWNrKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLZhdi52KfZhNis2Kkg2KfYrtiq2YrYp9ixINin2YTYrNmI2K/YqSIiIgogICAgICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCkKICAgICAgICAKICAgICAgICAjINin2LPYqtiu2LHYp9isINin2YTYrNmI2K/YqSDZhdmGIGNhbGxiYWNrX2RhdGEKICAgICAgICBxdWFsaXR5X21hcCA9IHsKICAgICAgICAgICAgJ3F1YWxpdHlfbG93JzogKCdsb3cnLCAn8J+UtCDZhdmG2K7Zgdi22KknKSwKICAgICAgICAgICAgJ3F1YWxpdHlfbWVkaXVtJzogKCdtZWRpdW0nLCAn8J+foSDZhdiq2YjYs9i32KknKSwKICAgICAgICAgICAgJ3F1YWxpdHlfaGlnaCc6ICgnaGlnaCcsICfwn5+iINi52KfZhNmK2KknKSwKICAgICAgICAgICAgJ3F1YWxpdHlfdWx0cmEnOiAoJ3VsdHJhJywgJ/CflLUg2YHYp9im2YLYqScpLAogICAgICAgIH0KICAgICAgICAKICAgICAgICBxdWFsaXR5LCBxdWFsaXR5X25hbWUgPSBxdWFsaXR5X21hcC5nZXQocXVlcnkuZGF0YSwgKCdtZWRpdW0nLCAn8J+foSDZhdiq2YjYs9i32KknKSkKICAgICAgICB1cmwgPSBjb250ZXh0LnVzZXJfZGF0YS5nZXQoJ3ZpZGVvX3VybCcpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHVybDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYrti32KM6INmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2KfZhNix2KfYqNi3LiDYo9ix2LPZhCDYsdin2KjYtyDYrNiv2YrYry4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2Ksg2KfZhNix2LPYp9mE2KkgLSDYqNiv2KEg2KfZhNmF2LnYp9mE2KzYqQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICBmIuKPsyAqKtis2KfYsdmKINin2YTZhdi52KfZhNis2KkuLi4qKlxuXG4iCiAgICAgICAgICAgIGYi8J+UlyDYp9mE2LHYp9io2Lc6IGB7dXJsWzo1MF19Li4uYFxuIgogICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuXG4iCiAgICAgICAgICAgIGYi4o+x77iPINin2YTYsdis2KfYoSDYp9mE2KfZhtiq2LjYp9ixLi4uXG4iCiAgICAgICAgICAgIGYi2YLYryDYqtiz2KrYutix2YIg2KfZhNi52YXZhNmK2Kkg2LnYr9ipINiv2YLYp9im2YIg2K3Ys9ioINit2KzZhSDYp9mE2YHZitiv2YrZiC4iLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINil2YbYtNin2KEg2LHYs9in2YTYqSDYqtit2K/ZitirINin2YTYqtmC2K/ZhQogICAgICAgICAgICBwcm9ncmVzc19tZXNzYWdlID0gYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIvCfk6UgKirZhdix2K3ZhNipIDEvMzoqKiDYrNin2LHZiiDYp9mE2KrYrdmF2YrZhC4uLlxuIgogICAgICAgICAgICAgICAgIuKWseKWseKWseKWseKWseKWseKWseKWseKWseKWsSAwJSIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgbGFzdF91cGRhdGVfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBhc3luYyBkZWYgdXBkYXRlX3Byb2dyZXNzKHN0YWdlLCBwcm9ncmVzcyk6CiAgICAgICAgICAgICAgICAiIiLYqtit2K/ZitirINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFIiIiCiAgICAgICAgICAgICAgICBub25sb2NhbCBsYXN0X3VwZGF0ZV90aW1lCiAgICAgICAgICAgICAgICBjdXJyZW50X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINiq2K3Yr9mK2Ksg2YPZhCAyINir2KfZhtmK2Kkg2YHZgti3INmE2KrYrNmG2KggcmF0ZSBsaW1pdAogICAgICAgICAgICAgICAgaWYgY3VycmVudF90aW1lIC0gbGFzdF91cGRhdGVfdGltZSA8IDI6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGxhc3RfdXBkYXRlX3RpbWUgPSBjdXJyZW50X3RpbWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIHN0YWdlID09ICJkb3dubG9hZCI6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWdlX3RleHQgPSAi8J+TpSAqKtmF2LHYrdmE2KkgMS8zOioqINis2KfYsdmKINin2YTYqtit2YXZitmELi4uIgogICAgICAgICAgICAgICAgICAgIGVsaWYgc3RhZ2UgPT0gImNvbXByZXNzIjoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhZ2VfdGV4dCA9ICLwn46sICoq2YXYsdit2YTYqSAyLzM6Kiog2KzYp9ix2Yog2KfZhNi22LrYty4uLiIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzdGFnZV90ZXh0ID0gIvCfk6QgKirZhdix2K3ZhNipIDMvMzoqKiDYrNin2LHZiiDYp9mE2LHZgdi5Li4uIgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2LHYs9mFINi02LHZiti3INin2YTYqtmC2K/ZhQogICAgICAgICAgICAgICAgICAgIGJhcl9sZW5ndGggPSAxMAogICAgICAgICAgICAgICAgICAgIGZpbGxlZCA9IGludChiYXJfbGVuZ3RoICogcHJvZ3Jlc3MgLyAxMDApCiAgICAgICAgICAgICAgICAgICAgYmFyID0gJ+KWsCcgKiBmaWxsZWQgKyAn4paxJyAqIChiYXJfbGVuZ3RoIC0gZmlsbGVkKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzX21lc3NhZ2UuZWRpdF90ZXh0KAogICAgICAgICAgICAgICAgICAgICAgICBmIntzdGFnZV90ZXh0fVxuIgogICAgICAgICAgICAgICAgICAgICAgICBmIntiYXJ9IHtwcm9ncmVzczouMGZ9JSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmItmB2LTZhCDYqtit2K/ZitirINin2YTYqtmC2K/ZhToge2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KjYr9ihINi52YXZhNmK2Kkg2KfZhNi22LrYtwogICAgICAgICAgICBjb21wcmVzc2VkX2ZpbGUgPSBhd2FpdCBhc3luY2lvLnRvX3RocmVhZCgKICAgICAgICAgICAgICAgIHNlbGYuY29tcHJlc3Nvci5wcm9jZXNzX3ZpZGVvX2Zyb21fdXJsLAogICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgcXVhbGl0eT1xdWFsaXR5LAogICAgICAgICAgICAgICAgcHJvZ3Jlc3NfY2FsbGJhY2s9bGFtYmRhIHN0YWdlLCBwcm9nOiBhc3luY2lvLmNyZWF0ZV90YXNrKHVwZGF0ZV9wcm9ncmVzcyhzdGFnZSwgcHJvZykpCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzX21lc3NhZ2UuZGVsZXRlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgIyDYqtit2K/ZitirINin2YTYsdiz2KfZhNipIC0g2LHZgdi5INin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgZiLinIUgKirYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSEqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk6Qg2KzYp9ix2Yog2LHZgdi5INin2YTZgdmK2K/ZitmILi4uIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUoY29tcHJlc3NlZF9maWxlKQogICAgICAgICAgICBmaWxlX3NpemVfbWIgPSBmaWxlX3NpemUgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAKICAgICAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDYrdis2YUg2KfZhNmF2YTZgSAoVGVsZWdyYW0gbGltaXQ6IDUwTUIgZm9yIGJvdHMpCiAgICAgICAgICAgIGlmIGZpbGVfc2l6ZSA+IE1BWF9URUxFR1JBTV9TSVpFX01CICogMTAyNCAqIDEwMjQ6CiAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgICAgICAgICBmIuKaoO+4jyAqKtin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3INmD2KjZitixINis2K/Yp9mLISoqXG5cbiIKICAgICAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge2ZpbGVfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KpcbiIKICAgICAgICAgICAgICAgICAgICBmIvCfk48g2KfZhNit2K8g2KfZhNij2YLYtdmJOiB7TUFYX1RFTEVHUkFNX1NJWkVfTUJ9INmF2YrYrNin2KjYp9mK2KpcblxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+SoSAqKtin2YTYrdmEOioqXG4iCiAgICAgICAgICAgICAgICAgICAgZiLigKIg2KfYrtiq2LEg2KzZiNiv2Kkg2KPZgtmEICjwn5S0INmF2YbYrtmB2LbYqSlcbiIKICAgICAgICAgICAgICAgICAgICBmIuKAoiDYo9mIINmC2LPZhSDYp9mE2YHZitiv2YrZiCDYpdmE2Ykg2KPYrNiy2KfYoSDYo9i12LrYsSIsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoY29tcHJlc3NlZF9maWxlKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICAgICAjINix2YHYuSDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICB3aXRoIG9wZW4oY29tcHJlc3NlZF9maWxlLCAncmInKSBhcyB2aWRlbzoKICAgICAgICAgICAgICAgIGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfdmlkZW8oCiAgICAgICAgICAgICAgICAgICAgdmlkZW89dmlkZW8sCiAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj1mIuKchSAqKtiq2YUg2KfZhNi22LrYtyDYqNmG2KzYp9itISoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TiiDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5X25hbWV9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge2ZpbGVfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KpcblxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZiLwn46JINin2LPYqtmF2KrYuSDYqNin2YTZgdmK2K/ZitmIISIsCiAgICAgICAgICAgICAgICAgICAgc3VwcG9ydHNfc3RyZWFtaW5nPVRydWUsCiAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgICAgIGYi4pyFICoq2KrZhSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3ISoqXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+TiiDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5X25hbWV9XG4iCiAgICAgICAgICAgICAgICBmIvCfk6Yg2KfZhNit2KzZhToge2ZpbGVfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KpcblxuIgogICAgICAgICAgICAgICAgZiLwn5SEINij2LHYs9mEINix2KfYqNi3INii2K7YsSDZhNmE2YXYstmK2K8hIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdik2YLYqgogICAgICAgICAgICBvcy5yZW1vdmUoY29tcHJlc3NlZF9maWxlKQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIvCfl5HvuI8g2KrZhSDYrdiw2YEg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtzoge2NvbXByZXNzZWRfZmlsZX0iKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmItiu2LfYoyDZgdmKINi22LrYtyDYp9mE2YHZitiv2YrZiDoge2V9IiwgZXhjX2luZm89VHJ1ZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGVycm9yX21lc3NhZ2UgPSBzdHIoZSkKICAgICAgICAgICAgaWYgIkludmFsaWQgZGF0YSBmb3VuZCIgaW4gZXJyb3JfbWVzc2FnZToKICAgICAgICAgICAgICAgIGVycm9yX21lc3NhZ2UgPSAi2KfZhNix2KfYqNi3INi62YrYsSDYtdin2YTYrSDYo9mIINin2YTZgdmK2K/ZitmIINiq2KfZhNmBIgogICAgICAgICAgICBlbGlmICJ0aW1lb3V0IiBpbiBlcnJvcl9tZXNzYWdlLmxvd2VyKCk6CiAgICAgICAgICAgICAgICBlcnJvcl9tZXNzYWdlID0gItin2YbYqtmH2Kog2YXZh9mE2Kkg2KfZhNiq2K3ZhdmK2YQgLSDYrNix2Kgg2YXYsdipINij2K7YsdmJIgogICAgICAgICAgICBlbGlmICJDb25uZWN0aW9uIiBpbiBlcnJvcl9tZXNzYWdlOgogICAgICAgICAgICAgICAgZXJyb3JfbWVzc2FnZSA9ICLZhdi02YPZhNipINmB2Yog2KfZhNin2KrYtdin2YQgLSDYqtit2YLZgiDZhdmGINin2YTYsdin2KjYtyIKICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KAogICAgICAgICAgICAgICAgZiLinYwgKirYrdiv2Ksg2K7Yt9ijINij2KvZhtin2KEg2KfZhNmF2LnYp9mE2KzYqSoqXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+TnSDYp9mE2K7Yt9ijOiBge2Vycm9yX21lc3NhZ2V9YFxuXG4iCiAgICAgICAgICAgICAgICBmIvCfkqEgKirYp9mE2K3ZhNmI2YQg2KfZhNmF2YLYqtix2K3YqToqKlxuIgogICAgICAgICAgICAgICAgZiLigKIg2KrYo9mD2K8g2YXZhiDYtdit2Kkg2KfZhNix2KfYqNi3XG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYqtit2YLZgiDZhdmGINij2YYg2KfZhNix2KfYqNi3INmE2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixXG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYrNix2Kgg2LHYp9io2Lcg2KLYrtixXG4iCiAgICAgICAgICAgICAgICBmIuKAoiDZhNmE2YXYs9in2LnYr9ipOiAvaGVscCIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgICIiItiq2LTYutmK2YQg2KfZhNio2YjYqiIiIgogICAgICAgIGxvZ2dlci5pbmZvKCI9IiAqIDcwKQogICAgICAgIGxvZ2dlci5pbmZvKCLwn5qAINio2K/YoSDYqti02LrZitmEINio2YjYqiDYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KoiKQogICAgICAgIGxvZ2dlci5pbmZvKCI9IiAqIDcwKQogICAgICAgIGxvZ2dlci5pbmZvKGYi8J+TgSDYp9mE2YXYrNmE2K8g2KfZhNmF2KTZgtiqOiB7VEVNUF9ESVJ9IikKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk6Yg2K3YryDYsdmB2LkgVGVsZWdyYW06IHtNQVhfVEVMRUdSQU1fU0laRV9NQn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgbG9nZ2VyLmluZm8oIuKchSDYp9mE2KjZiNiqINis2KfZh9iyINmE2YTYudmF2YQhIikKICAgICAgICBsb2dnZXIuaW5mbygiPSIgKiA3MCkKICAgICAgICAKICAgICAgICAjINiq2YUg2KrYudiv2YrZhNmHINmE2YTYudmF2YQg2YHZiiB0aHJlYWQKCiAgICAgICAgCiAgICAgICAgaW1wb3J0IGFzeW5jaW8KCiAgICAgICAgCiAgICAgICAgbG9vcCA9IGFzeW5jaW8ubmV3X2V2ZW50X2xvb3AoKQoKICAgICAgICAKICAgICAgICBhc3luY2lvLnNldF9ldmVudF9sb29wKGxvb3ApCgogICAgICAgIAogICAgICAgIGFzeW5jIGRlZiBydW4oKToKCiAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLmluaXRpYWxpemUoKQoKICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAuc3RhcnQoKQoKICAgICAgICAKICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAudXBkYXRlci5zdGFydF9wb2xsaW5nKCkKCiAgICAgICAgCiAgICAgICAgICAgIHRyeToKCiAgICAgICAgCiAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOgoKICAgICAgICAKICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgogICAgICAgIAogICAgICAgICAgICBleGNlcHQ6CgogICAgICAgIAogICAgICAgICAgICAgICAgcGFzcwoKICAgICAgICAKICAgICAgICAgICAgZmluYWxseToKCiAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC51cGRhdGVyLnN0b3AoKQoKICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnN0b3AoKQoKICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnNodXRkb3duKCkKCiAgICAgICAgCiAgICAgICAgbG9vcC5ydW5fdW50aWxfY29tcGxldGUocnVuKCkpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+OryDZhtmC2LfYqSDYp9mE2KjYr9in2YrYqQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDZiNis2YjYryBGRm1wZWcKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnZmZtcGVnJywgJy12ZXJzaW9uJ10sIAogICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICBjaGVjaz1UcnVlKQogICAgICAgICAgICBsb2dnZXIuaW5mbygi4pyFINiq2YUg2KfZhNi52KvZiNixINi52YTZiSBGRm1wZWciKQogICAgICAgIGV4Y2VwdCAoc3VicHJvY2Vzcy5DYWxsZWRQcm9jZXNzRXJyb3IsIEZpbGVOb3RGb3VuZEVycm9yKToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCLinYwgRkZtcGVnINi62YrYsSDZhdir2KjYqiEiKQogICAgICAgICAgICBsb2dnZXIuZXJyb3IoItin2YTYsdis2KfYoSDYqtir2KjZitiq2Ycg2KjYp9mE2KPZhdixOiBzdWRvIGFwdCBpbnN0YWxsIGZmbXBlZyIpCiAgICAgICAgICAgIGV4aXQoMSkKICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINiq2YjZg9mGINin2YTYqNmI2KoKICAgICAgICBpZiBCT1RfVE9LRU4gPT0gIllPVVJfQk9UX1RPS0VOX0hFUkUiOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIuKdjCDYp9mE2LHYrNin2KEg2KrYudiv2YrZhCBCT1RfVE9LRU4g2YHZiiDYp9mE2YPZiNivISIpCiAgICAgICAgICAgIGV4aXQoMSkKICAgICAgICAKICAgICAgICAjINiq2LTYutmK2YQg2KfZhNio2YjYqgogICAgICAgIGJvdCA9IFZpZGVvQ29tcHJlc3NvckJvdChCT1RfVE9LRU4pCiAgICAgICAgYm90LnJ1bigpCiAgICAgICAgCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgbG9nZ2VyLmluZm8oIlxu8J+RiyDYqtmFINil2YrZgtin2YEg2KfZhNio2YjYqiDYqNmI2KfYs9i32Kkg2KfZhNmF2LPYqtiu2K/ZhSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nZ2VyLmVycm9yKGYi4p2MINiu2LfYoyDZgdin2K/YrToge2V9IiwgZXhjX2luZm89VHJ1ZSkKICAgICAgICBleGl0KDEpCg==",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
