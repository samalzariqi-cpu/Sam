#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    uptime = ""
    if start_time:
        delta = datetime.now() - start_time
        hours = delta.seconds // 3600
        minutes = (delta.seconds % 3600) // 60
        uptime = f"{delta.days}d {hours}h {minutes}m"
    
    html = f"""
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ - 1 ÿ®Ÿàÿ™</title>
        <style>
            * {{ margin: 0; padding: 0; box-sizing: border-box; }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 800px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2.5em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 1.1em;
            }}
            .status {{
                background: #f0f9ff;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                border-right: 5px solid #10b981;
            }}
            .status h2 {{
                color: #10b981;
                margin-bottom: 15px;
                font-size: 1.5em;
            }}
            .bot-item {{
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzcWxpdGUzCmltcG9ydCBhc3luY2lvCmltcG9ydCBvcwppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHNodXRpbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdGVsZWdyYW0gaW1wb3J0IFVwZGF0ZSwgSW5saW5lS2V5Ym9hcmRCdXR0b24sIElubGluZUtleWJvYXJkTWFya3VwCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbiwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ2FsbGJhY2tRdWVyeUhhbmRsZXIsCiAgICBNZXNzYWdlSGFuZGxlciwKICAgIGZpbHRlcnMsCiAgICBDb250ZXh0VHlwZXMsCikKCiMgPT09PT09PT09PT09PT09PT09PT0g2KfZhNil2LnYr9in2K/Yp9iqINin2YTYq9in2KjYqtipID09PT09PT09PT09PT09PT09PT09ClRFTEVHUkFNX0JPVF9UT0tFTiA9ICI3ODcxNTgzNzYwOkFBRUFqMU5NbGdNVTdIOFkzVG8zYTdsR3ZTaFZaNzRCdnpVIgpBRE1JTl9JRCA9IDEwNTg2MTYzMTYKVEVMRUdSQU1fQVBJX0xJTUlUID0gMjAgKiAxMDI0ICogMTAyNCAgIyAyME1CCk1BWF9GSUxFX1NJWkUgPSA1MDAgKiAxMDI0ICogMTAyNCAgIyAxMDBNQiDYp9mE2K3YryDYp9mE2KPZgti12Ykg2KfZhNis2K/ZitivCgojINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqgpURU1QX1NUT1JBR0VfRElSID0gInRlbXBfdmlkZW9zIgoKIyDYt9in2KjZiNixINin2YTZhdi52KfZhNis2KkKcHJvY2Vzc2luZ19xdWV1ZSA9IGFzeW5jaW8uUXVldWUoKQppc19wcm9jZXNzaW5nID0gRmFsc2UKCiMgPT09PT09PT09PT09PT09PT09PT0g2KXYr9in2LHYqSDYp9mE2YXZhNmB2KfYqiA9PT09PT09PT09PT09PT09PT09PQpkZWYgaW5pdF90ZW1wX3N0b3JhZ2UoKToKICAgICIiItil2YbYtNin2KEg2YXYrNmE2K8g2KfZhNiq2K7YstmK2YYg2KfZhNmF2KTZgtiqIiIiCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgb3MubWFrZWRpcnMoVEVNUF9TVE9SQUdFX0RJUikKICAgIHByaW50KGYi4pyFINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqjoge1RFTVBfU1RPUkFHRV9ESVJ9IikKCmRlZiBjbGVhbnVwX29sZF9maWxlcygpOgogICAgIiIi2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqINin2YTZgtiv2YrZhdipINi52YbYryDYqNiv2KEg2KfZhNiq2LTYutmK2YQiIiIKICAgIHRyeToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhURU1QX1NUT1JBR0VfRElSKToKICAgICAgICAgICAgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihURU1QX1NUT1JBR0VfRElSKToKICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihURU1QX1NUT1JBR0VfRElSLCBmaWxlKQogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgICAgIG9zLnVubGluayhmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYi8J+Xke+4jyDYrdiw2YEg2YXZhNmBINmC2K/ZitmFOiB7ZmlsZX0iKQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYi4pqg77iPINmB2LTZhCDYrdiw2YEge2ZpbGV9OiB7ZX0iKQogICAgICAgIHByaW50KCLinIUg2KrZhSDYqtmG2LjZitmBINin2YTZhdis2YTYryDZhdmGINin2YTZhdmE2YHYp9iqINin2YTZgtiv2YrZhdipIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2KrZhti42YrZgToge2V9IikKCmRlZiBkZWxldGVfZmlsZV9zYWZlKGZpbGVfcGF0aDogc3RyKToKICAgICIiItit2LDZgSDZhdmE2YEg2KjYtNmD2YQg2KLZhdmGIiIiCiAgICB0cnk6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoZmlsZV9wYXRoKToKICAgICAgICAgICAgb3MudW5saW5rKGZpbGVfcGF0aCkKICAgICAgICAgICAgcHJpbnQoZiLwn5eR77iPINiq2YUg2K3YsNmBINin2YTZhdmE2YE6IHtmaWxlX3BhdGh9IikKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2K3YsNmBINin2YTZhdmE2YEge2ZpbGVfcGF0aH06IHtlfSIpCiAgICByZXR1cm4gRmFsc2UKCmRlZiBnZXRfc3RvcmFnZV9pbmZvKCk6CiAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZhdiz2KfYrdipINin2YTYqtiu2LLZitmG2YrYqSIiIgogICAgdHJ5OgogICAgICAgIHRvdGFsX3NpemUgPSAwCiAgICAgICAgZmlsZV9jb3VudCA9IDAKICAgICAgICBmaWxlc19saXN0ID0gW10KICAgICAgICAKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhURU1QX1NUT1JBR0VfRElSKToKICAgICAgICAgICAgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihURU1QX1NUT1JBR0VfRElSKToKICAgICAgICAgICAgICAgIGZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihURU1QX1NUT1JBR0VfRElSLCBmaWxlKQogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUoZmlsZV9wYXRoKToKICAgICAgICAgICAgICAgICAgICBzaXplID0gb3MucGF0aC5nZXRzaXplKGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgICAgICB0b3RhbF9zaXplICs9IHNpemUKICAgICAgICAgICAgICAgICAgICBmaWxlX2NvdW50ICs9IDEKICAgICAgICAgICAgICAgICAgICBmaWxlc19saXN0LmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICduYW1lJzogZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3NpemUnOiBzaXplLAogICAgICAgICAgICAgICAgICAgICAgICAncGF0aCc6IGZpbGVfcGF0aAogICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgJ3RvdGFsX3NpemUnOiB0b3RhbF9zaXplLAogICAgICAgICAgICAnZmlsZV9jb3VudCc6IGZpbGVfY291bnQsCiAgICAgICAgICAgICdmaWxlcyc6IGZpbGVzX2xpc3QKICAgICAgICB9CiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2KrYrtiy2YrZhjoge2V9IikKICAgICAgICByZXR1cm4geyd0b3RhbF9zaXplJzogMCwgJ2ZpbGVfY291bnQnOiAwLCAnZmlsZXMnOiBbXX0KCmRlZiBmb3JtYXRfc2l6ZShzaXplX2J5dGVzKToKICAgICIiItiq2K3ZiNmK2YQg2KfZhNit2KzZhSDYpdmE2Ykg2LXZiti62Kkg2YLYp9io2YTYqSDZhNmE2YLYsdin2KHYqSIiIgogICAgZm9yIHVuaXQgaW4gWydCJywgJ0tCJywgJ01CJywgJ0dCJ106CiAgICAgICAgaWYgc2l6ZV9ieXRlcyA8IDEwMjQuMDoKICAgICAgICAgICAgcmV0dXJuIGYie3NpemVfYnl0ZXM6LjJmfSB7dW5pdH0iCiAgICAgICAgc2l6ZV9ieXRlcyAvPSAxMDI0LjAKICAgIHJldHVybiBmIntzaXplX2J5dGVzOi4yZn0gVEIiCgojID09PT09PT09PT09PT09PT09PT09INmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqiA9PT09PT09PT09PT09PT09PT09PQpkZWYgaW5pdF9kYXRhYmFzZSgpOgogICAgIiIi2KXZhti02KfYoSDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2Kog2YjYrNiv2KfZiNmEINin2YTZhdiz2KrYrtiv2YXZitmGINmI2KfZhNil2LnYr9in2K/Yp9iqIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIAogICAgYy5leGVjdXRlKCcnJ0NSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHVzZXJzICgKICAgICAgICB1c2VyX2lkIElOVEVHRVIgUFJJTUFSWSBLRVksCiAgICAgICAgdXNlcm5hbWUgVEVYVCwKICAgICAgICB0b3RhbF92aWRlb3MgSU5URUdFUiBERUZBVUxUIDAsCiAgICAgICAgam9pbmVkX2RhdGUgVElNRVNUQU1QIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAKICAgICknJycpCiAgICAKICAgIGMuZXhlY3V0ZSgnJydDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzZXR0aW5ncyAoCiAgICAgICAga2V5IFRFWFQgUFJJTUFSWSBLRVksCiAgICAgICAgdmFsdWUgVEVYVAogICAgKScnJykKICAgIAogICAgYy5leGVjdXRlKCJTRUxFQ1QgdmFsdWUgRlJPTSBzZXR0aW5ncyBXSEVSRSBrZXkgPSAnYXBpX2tleSciKQogICAgaWYgYy5mZXRjaG9uZSgpIGlzIE5vbmU6CiAgICAgICAgZGVmYXVsdF9hcGlfa2V5ID0gImV5SjBlWEFpT2lKS1YxUWlMQ0poYkdjaU9pSlNVekkxTmlKOS5leUpoZFdRaU9pSXhJaXdpYW5ScElqb2laakUwTjJObU5EVTBaakF6WlRNek5EQXdOVEZsWkdRNE16Rm1ZMkpoWkRNeU9UTTBOMkZpTVdNME0yUmtNVFJtTUdObVpqbGtaREF6TnpReE56RTJOemRtTW1ZNU0yRXlObUZtWXpJMllUZ2lMQ0pwWVhRaU9qRTNOalF4TlRVeE16UXVNamt5TmpRMExDSnVZbVlpT2pFM05qUXhOVFV4TXpRdU1qa3lOalExTENKbGVIQWlPalE1TVRrNE1qZzNNelF1TWpnMU1UQTNMQ0p6ZFdJaU9pSTNNelUzTlRVeU1TSXNJbk5qYjNCbGN5STZXeUowWVhOckxuZHlhWFJsSWl3aWRHRnpheTV5WldGa1pDSjkuZ2dvbEVCdGxkSklacTc0UjFIM1NJNjFBSFRQYzRpSlJ2dWdCQVdZOW1Bb1FPVzNyYmFVclFIZjhDVER1UllOZjZwbTB4cG1BZ2NGbjZTclRidzE2LXpFRVJZYzExcXZPSEdZNXFYUW9rX2FpRnlqMkdva0dUemJmM25oZGhzd1pQbXRBajY5V2xqV2NnZ3Q2WC05aXdUeUNoRFhLcUM3VTZFamVBMmFXNlhwdFg1UnR1Szl4WEZfTkFTSmV0YzdxaVdYMXI4S3pkaXdoYkZKb2s0YkkzaTlkOFZWLWRJdERXWFpKM2V1RmZQYy1sek9ocXdEZjJaRUExd1BnMjBCaTZnZDBJRTJQZ1ZRcEt5blp5Rmt0dThXTlBOVnpobk9IMHlFMVlhNm9laHZKYWdYNHRtbjdneDFtZmpyT0pqdHFBRDJFZzJGLThEbDdnZDg2ZmhleE9LZTBCZXdmTE5VMUZVNnJuaVVIM2pUZExKZkFqTDhPNlFzdXVMZUpYRzlFMnM1bUZwR3NxeHFCN0xNQ19HWE4yN0RtNDRram1Ib0I0OG02eldZUXNaNzUxREhTSjhyalZSLUJ6Y1M5QWpRZWdZVzA4bkluUmhZMlVmSU5ycU5iZnU3VTY5c2RsNEwwOVp1VklFQUdsakUya3RjUUNxeUhDcXhpNGtIaXBMYTZxLVdSRnZfNWJESXBXa0Y2QkhVamVFUVlWTjBfRi1iemUxYzhxaVg2bTduUU5IYm1HaElhQ1VpbTdOSEVJOXN6NWJ2Sk5MS2M5OFZjdFJhbnllSnZ5LVlMOVpjUC0tMTZTdy1rajF5ZFQ3NDNtQjROdDBBS1NmN0E5S3dNcEtXY2lQV2t2cTZDZXNqNmVNVHRTM0hTTjBXdndoaE9RMjB6Y0RDeFdqbm0xNmsiCiAgICAgICAgYy5leGVjdXRlKCJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIHNldHRpbmdzIChrZXksIHZhbHVlKSBWQUxVRVMgKCdhcGlfa2V5JywgPykiLCAoZGVmYXVsdF9hcGlfa2V5LCkpCiAgICAKICAgIGNvbm4uY29tbWl0KCkKICAgIGNvbm4uY2xvc2UoKQoKZGVmIGdldF9hcGlfa2V5KCk6CiAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YHYqtin2K0gQVBJINmF2YYg2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIHZhbHVlIEZST00gc2V0dGluZ3MgV0hFUkUga2V5ID0gJ2FwaV9rZXknIikKICAgIHJlc3VsdCA9IGMuZmV0Y2hvbmUoKQogICAgY29ubi5jbG9zZSgpCiAgICByZXR1cm4gcmVzdWx0WzBdIGlmIHJlc3VsdCBlbHNlIE5vbmUKCmRlZiBzZXRfYXBpX2tleShuZXdfa2V5KToKICAgICIiItit2YHYuCDZhdmB2KrYp9itIEFQSSDYrNiv2YrYryDZgdmKINmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoIklOU0VSVCBPUiBSRVBMQUNFIElOVE8gc2V0dGluZ3MgKGtleSwgdmFsdWUpIFZBTFVFUyAoJ2FwaV9rZXknLCA/KSIsIChuZXdfa2V5LCkpCiAgICBjb25uLmNvbW1pdCgpCiAgICBjb25uLmNsb3NlKCkKCmRlZiBnZXRfdXNlcih1c2VyX2lkKToKICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNmF2LPYqtiu2K/ZhSIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoJ1NFTEVDVCB1c2VyX2lkLCB1c2VybmFtZSwgdG90YWxfdmlkZW9zLCBqb2luZWRfZGF0ZSBGUk9NIHVzZXJzIFdIRVJFIHVzZXJfaWQgPSA/JywgKHVzZXJfaWQsKSkKICAgIHVzZXIgPSBjLmZldGNob25lKCkKICAgIGNvbm4uY2xvc2UoKQogICAgcmV0dXJuIHVzZXIKCmRlZiBjcmVhdGVfdXNlcih1c2VyX2lkLCB1c2VybmFtZSk6CiAgICAiIiLYpdmG2LTYp9ihINmF2LPYqtiu2K/ZhSDYrNiv2YrYryIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoJ0lOU0VSVCBPUiBJR05PUkUgSU5UTyB1c2VycyAodXNlcl9pZCwgdXNlcm5hbWUpIFZBTFVFUyAoPywgPyknLCAodXNlcl9pZCwgdXNlcm5hbWUpKQogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgpkZWYgaW5jcmVtZW50X3ZpZGVvX2NvdW50KHVzZXJfaWQpOgogICAgIiIi2LLZitin2K/YqSDYudiv2KfYryDYp9mE2YHZitiv2YrZiNmH2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoJ1VQREFURSB1c2VycyBTRVQgdG90YWxfdmlkZW9zID0gdG90YWxfdmlkZW9zICsgMSBXSEVSRSB1c2VyX2lkID0gPycsICh1c2VyX2lkLCkpCiAgICBjb25uLmNvbW1pdCgpCiAgICBjb25uLmNsb3NlKCkKCiMgPT09PT09PT09PT09PT09PT09PT0g2K/ZiNin2YQg2KrZhNmK2KzYsdin2YUgPT09PT09PT09PT09PT09PT09PT0KYXN5bmMgZGVmIHNlbmRfbWVzc2FnZShjaGF0X2lkOiBzdHIsIHRleHQ6IHN0ciwgY29udGV4dD1Ob25lKToKICAgICIiItil2LHYs9in2YQg2LHYs9in2YTYqSDZhti12YrYqSIiIgogICAgdHJ5OgogICAgICAgIGlmIGNvbnRleHQ6CiAgICAgICAgICAgIGF3YWl0IGNvbnRleHQuYm90LnNlbmRfbWVzc2FnZShjaGF0X2lkPWNoYXRfaWQsIHRleHQ9dGV4dCwgcGFyc2VfbW9kZT0nTWFya2Rvd24nKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdHtURUxFR1JBTV9CT1RfVE9LRU59L3NlbmRNZXNzYWdlIgogICAgICAgICAgICByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT17ImNoYXRfaWQiOiBjaGF0X2lkLCAidGV4dCI6IHRleHQsICJwYXJzZV9tb2RlIjogJ01hcmtkb3duJ30pCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLYrti32KMg2YHZiiDYpdix2LPYp9mEINin2YTYsdiz2KfZhNipOiB7ZX0iKQoKIyA9PT09PT09PT09PT09PT09PT09PSDYo9mI2KfZhdixINin2YTYqNmI2KogPT09PT09PT09PT09PT09PT09PT0KYXN5bmMgZGVmIHN0YXJ0X2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9zdGFydCIiIgogICAgdXNlciA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlcgogICAgY3JlYXRlX3VzZXIodXNlci5pZCwgdXNlci51c2VybmFtZSkKICAgIAogICAga2V5Ym9hcmRfcm93cyA9IFsKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfk4og2K3Ys9in2KjZiiDZiNil2K3Ytdin2KbZitin2KrZiiIsIGNhbGxiYWNrX2RhdGE9Im15X2FjY291bnQiKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLihLnvuI8g2KfZhNmF2LPYp9i52K/YqSIsIGNhbGxiYWNrX2RhdGE9ImhlbHAiKV0KICAgIF0KICAgIAogICAgaWYgdXNlci5pZCA9PSBBRE1JTl9JRDoKICAgICAgICBrZXlib2FyZF9yb3dzLmFwcGVuZChbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKame+4jyDYpdi52K/Yp9iv2KfYqiDYp9mE2YXYtNix2YEiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXSkKCiAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZF9yb3dzKQogICAgCiAgICB3ZWxjb21lX3RleHQgPSBmIiIiCvCfjqwg2YXYsdit2KjYp9mLIHt1c2VyLmZpcnN0X25hbWV9IQoK2KPZhtinINio2YjYqiDYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KouINin2YTYotmGINij2YbYpyAqKtmF2KzYp9mG2Yog2KjYp9mE2YPYp9mF2YQg2YjYqNiv2YjZhiDZgtmK2YjYryoqISDwn5qACgoqKvCfjq8g2KfZhNmF2YXZitiy2KfYqjoqKgrinKgg2YXYudin2YTYrNipINmF2YTZgdin2Kog2K3YqtmJIDEwME1CINmF2KjYp9i02LHYqQrinKgg2K/YudmFINmF2YTZgdin2Kog2KrZitmE2YrYrNix2KfZhSDZiNin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2KkK4pyoIDMg2YXYs9iq2YjZitin2Kog2KzZiNiv2Kkg2YXYuSAqKtin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkqKgrinKgg2K3YsNmBINiq2YTZgtin2KbZiiDZhNmE2YXZhNmB2KfYqiDYqNi52K8g2KfZhNil2LHYs9in2YQKCvCfk6Qg2YHZgti3INij2LHYs9mEINmB2YrYr9mK2Ygg2KPZiCDYsdin2KjYtyDZiNin2KjYr9ijIQoiIiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCh3ZWxjb21lX3RleHQsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgphc3luYyBkZWYgbXlfYWNjb3VudF9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvYWNjb3VudCAtINi52LHYtiDZhdi52YTZiNmF2KfYqiDYp9mE2K3Ys9in2KgiIiIKICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgIHVzZXJfZGF0YSA9IGdldF91c2VyKHVzZXJfaWQpCiAgICAKICAgIGlmIHVzZXJfZGF0YToKICAgICAgICB1c2VyX2lkLCB1c2VybmFtZSwgdG90YWxfdmlkZW9zLCBqb2luZWRfZGF0ZSA9IHVzZXJfZGF0YQogICAgICAgIGFjY291bnRfdGV4dCA9IGYiIiIK8J+TiiAqKtmF2LnZhNmI2YXYp9iqINit2LPYp9io2YM6KioKCvCfkaQg2KfZhNmF2LnYsdmBOiB7dXNlcl9pZH0K8J+OrCDYudiv2K8g2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmF2LbYutmI2LfYqToge3RvdGFsX3ZpZGVvc30K8J+ThSDYqtin2LHZitiuINin2YTYp9mG2LbZhdin2YU6IHtqb2luZWRfZGF0ZX0KIiIiCiAgICBlbHNlOgogICAgICAgIGFjY291bnRfdGV4dCA9ICLinYwg2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYrdiz2KfYqNmDLiDYp9iz2KrYrtiv2YUgL3N0YXJ0INij2YjZhNin2YsuIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGFjY291bnRfdGV4dCkKCmFzeW5jIGRlZiBzZXRhcGlrZXlfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL3NldGFwaWtleSAtINiq2LnZitmK2YYg2YXZgdiq2KfYrSBBUEkgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgaWYgbGVuKGNvbnRleHQuYXJncykgPT0gMDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLimqDvuI8g2KfZhNin2LPYqtiu2K/Yp9mFOiAvc2V0YXBpa2V5IDx5b3VyX2FwaV9rZXk+IikKICAgICAgICByZXR1cm4KICAgIAogICAgbmV3X2tleSA9IGNvbnRleHQuYXJnc1swXQogICAgc2V0X2FwaV9rZXkobmV3X2tleSkKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKchSDYqtmFINiq2K3Yr9mK2Ksg2YXZgdiq2KfYrSBBUEkg2KjZhtis2KfYrSEiKQoKYXN5bmMgZGVmIHN0YXRzX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9zdGF0cyAtINi52LHYtiDYpdit2LXYp9im2YrYp9iqINi52KfZhdipICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCBDT1VOVCgqKSBGUk9NIHVzZXJzIikKICAgIHRvdGFsX3VzZXJzID0gYy5mZXRjaG9uZSgpWzBdCiAgICAKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIFNVTSh0b3RhbF92aWRlb3MpIEZST00gdXNlcnMiKQogICAgdG90YWxfdmlkZW9zID0gYy5mZXRjaG9uZSgpWzBdIG9yIDAKICAgIAogICAgY29ubi5jbG9zZSgpCiAgICAKICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgCiAgICBzdGF0c190ZXh0ID0gZiIiIgrwn5OKICoq2KXYrdi12KfYptmK2KfYqiDYp9mE2KjZiNiqOioqCgrwn5GlINi52K/YryDYp9mE2YXYs9iq2K7Yr9mF2YrZhjoge3RvdGFsX3VzZXJzfQrwn46sINil2KzZhdin2YTZiiDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2YXYtti62YjYt9ipOiB7dG90YWxfdmlkZW9zfQrwn5OmINi52K/YryDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqToge3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddfQrwn5K+INmF2LPYp9it2Kkg2KfZhNiq2K7YstmK2YYg2KfZhNmF2LPYqtiu2K/ZhdipOiB7Zm9ybWF0X3NpemUoc3RvcmFnZV9pbmZvWyd0b3RhbF9zaXplJ10pfQoiIiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChzdGF0c190ZXh0KQoKYXN5bmMgZGVmIGZpbGVzX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9maWxlcyAtINi52LHYtiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAo2YTZhNmF2LTYsdmBINmB2YLYtykiIiIKICAgIGlmIHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZCAhPSBBRE1JTl9JRDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLim5Qg2YfYsNinINin2YTYo9mF2LEg2YTZhNmF2LTYsdmBINmB2YLYtyEiKQogICAgICAgIHJldHVybgogICAgCiAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgIAogICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPT0gMDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLinIUg2YTYpyDYqtmI2KzYryDZhdmE2YHYp9iqINmF2K7YstmG2Kkg2K3Yp9mE2YrYp9mLLiIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGZpbGVzX3RleHQgPSBmIvCfk6YgKirYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAoe3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddfSk6KipcblxuIgogICAgCiAgICBmb3IgaSwgZmlsZV9pbmZvIGluIGVudW1lcmF0ZShzdG9yYWdlX2luZm9bJ2ZpbGVzJ11bOjEwXSwgMSk6CiAgICAgICAgZmlsZXNfdGV4dCArPSBmIntpfS4gYHtmaWxlX2luZm9bJ25hbWUnXX1gXG4gICDYp9mE2K3YrNmFOiB7Zm9ybWF0X3NpemUoZmlsZV9pbmZvWydzaXplJ10pfVxuXG4iCiAgICAKICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID4gMTA6CiAgICAgICAgZmlsZXNfdGV4dCArPSBmIlxuLi4uINmIIHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSAtIDEwfSDZhdmE2YEg2KLYrtixIgogICAgCiAgICBmaWxlc190ZXh0ICs9IGYiXG7wn5K+INin2YTYpdis2YXYp9mE2Yo6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9IgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGZpbGVzX3RleHQpCgphc3luYyBkZWYgY2xlYW51cF9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvY2xlYW51cCAtINit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAo2YTZhNmF2LTYsdmBINmB2YLYtykiIiIKICAgIGlmIHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZCAhPSBBRE1JTl9JRDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLim5Qg2YfYsNinINin2YTYo9mF2LEg2YTZhNmF2LTYsdmBINmB2YLYtyEiKQogICAgICAgIHJldHVybgogICAgCiAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgIGRlbGV0ZWRfY291bnQgPSAwCiAgICAKICAgIGZvciBmaWxlX2luZm8gaW4gc3RvcmFnZV9pbmZvWydmaWxlcyddOgogICAgICAgIGlmIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9pbmZvWydwYXRoJ10pOgogICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDEKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmIuKchSDYqtmFINit2LDZgSB7ZGVsZXRlZF9jb3VudH0g2YXZhNmBINio2YbYrNin2K0hIikKCmFzeW5jIGRlZiBidXR0b25faGFuZGxlcih1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTYo9iy2LHYp9ixIiIiCiAgICBxdWVyeSA9IHVwZGF0ZS5jYWxsYmFja19xdWVyeQogICAgYXdhaXQgcXVlcnkuYW5zd2VyKCkKICAgIAogICAgZGF0YSA9IHF1ZXJ5LmRhdGEKICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgIAogICAgIyDZhdi52KfZhNis2Kkg2KfYrtiq2YrYp9ixINin2YTYrNmI2K/YqSDZhNmE2YXZhNmB2KfYqgogICAgaWYgZGF0YS5zdGFydHN3aXRoKCJxdWFsaXR5XyIpOgogICAgICAgIHF1YWxpdHkgPSBkYXRhLnJlcGxhY2UoInF1YWxpdHlfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGNoYXRfaWQgPSBwZW5kaW5nWydjaGF0X2lkJ10KICAgICAgICAKICAgICAgICBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLnB1dCh7CiAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgJ3NvdXJjZSc6IHBlbmRpbmdbJ2ZpbGVfaWQnXSwKICAgICAgICAgICAgJ3R5cGUnOiAnZmlsZV9pZCcsCiAgICAgICAgICAgICdmaWxlX3NpemUnOiBwZW5kaW5nWydmaWxlX3NpemUnXSwKICAgICAgICAgICAgJ3F1YWxpdHknOiBxdWFsaXR5CiAgICAgICAgfSkKICAgICAgICAKICAgICAgICBxdWV1ZV9zaXplID0gcHJvY2Vzc2luZ19xdWV1ZS5xc2l6ZSgpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLinIUg2KrZhdiqINil2LbYp9mB2Kkg2KfZhNmB2YrYr9mK2Ygg2YTZhNi32KfYqNmI2LEhXG7wn5SiINin2YTZhdmI2LbYuSDZgdmKINin2YTYt9in2KjZiNixOiB7cXVldWVfc2l6ZX0iKQogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTYsdmI2KfYqNi3CiAgICBlbGlmIGRhdGEuc3RhcnRzd2l0aCgicXVhbGl0eV91cmxfIik6CiAgICAgICAgcXVhbGl0eSA9IGRhdGEucmVwbGFjZSgicXVhbGl0eV91cmxfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNix2KfYqNi3INmF2LHYqSDYo9iu2LHZiS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBjaGF0X2lkID0gcGVuZGluZ1snY2hhdF9pZCddCiAgICAgICAgCiAgICAgICAgYXdhaXQgcHJvY2Vzc2luZ19xdWV1ZS5wdXQoewogICAgICAgICAgICAnY2hhdF9pZCc6IGNoYXRfaWQsCiAgICAgICAgICAgICdzb3VyY2UnOiBwZW5kaW5nWyd1cmwnXSwKICAgICAgICAgICAgJ3R5cGUnOiAndXJsJywKICAgICAgICAgICAgJ3F1YWxpdHknOiBxdWFsaXR5CiAgICAgICAgfSkKICAgICAgICAKICAgICAgICBxdWV1ZV9zaXplID0gcHJvY2Vzc2luZ19xdWV1ZS5xc2l6ZSgpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLinIUg2KrZhdiqINil2LbYp9mB2Kkg2KfZhNix2KfYqNi3INmE2YTYt9in2KjZiNixIVxu8J+UoiDYp9mE2YXZiNi22Lkg2YHZiiDYp9mE2LfYp9io2YjYsToge3F1ZXVlX3NpemV9IikKICAgIAogICAgIyDZhdi52KfZhNis2Kkg2KPYstix2KfYsSDYp9mE2YLYp9im2YXYqSDYp9mE2LHYptmK2LPZitipCiAgICBlbGlmIGRhdGEgPT0gIm15X2FjY291bnQiOgogICAgICAgIHVzZXJfZGF0YSA9IGdldF91c2VyKHVzZXJfaWQpCiAgICAgICAgaWYgdXNlcl9kYXRhOgogICAgICAgICAgICB1c2VyX2lkX2RiLCB1c2VybmFtZSwgdG90YWxfdmlkZW9zLCBqb2luZWRfZGF0ZSA9IHVzZXJfZGF0YQogICAgICAgICAgICBhY2NvdW50X3RleHQgPSBmIiIiCvCfk4ogKirZhdi52YTZiNmF2KfYqiDYrdiz2KfYqNmDOioqCgrwn5GkINin2YTZhdi52LHZgToge3VzZXJfaWRfZGJ9CvCfjqwg2LnYr9ivINin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdi22LrZiNi32Kk6IHt0b3RhbF92aWRlb3N9CvCfk4Ug2KrYp9ix2YrYriDYp9mE2KfZhti22YXYp9mFOiB7am9pbmVkX2RhdGV9CiIiIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGFjY291bnRfdGV4dCA9ICLinYwg2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYrdiz2KfYqNmDLiIKICAgICAgICAKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYmFja190b19zdGFydCIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoYWNjb3VudF90ZXh0LCByZXBseV9tYXJrdXA9YmFja19idXR0b24pCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiaGVscCI6CiAgICAgICAgaGVscF90ZXh0ID0gIiIiCuKEue+4jyAqKtmD2YrZgdmK2Kkg2KfYs9iq2K7Yr9in2YUg2KfZhNio2YjYqjoqKgoKMe+4j+KDoyDYo9ix2LPZhCDZgdmK2K/ZitmIINmF2YYg2KrZhNmK2KzYsdin2YUgKNit2KrZiSAxMDBNQikKMu+4j+KDoyDYo9mIINij2LHYs9mEINix2KfYqNi3INmB2YrYr9mK2Ygg2K7Yp9ix2KzZigoz77iP4oOjINin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipOgogICDwn5SlICoq2LnYp9mE2YrYqSoqIC0g2KzZiNiv2Kkg2YXZhdiq2KfYstip2Iwg2K3YrNmFINij2YLZhCDZgtmE2YrZhNin2YsKICAg4pqW77iPICoq2YXYqtmI2LPYt9ipKiogLSDYqtmI2KfYstmGINio2YrZhiDYp9mE2KzZiNiv2Kkg2YjYp9mE2K3YrNmFCiAgIPCfkr4gKirZhdmG2K7Zgdi22KkqKiAtINij2YLZhCDYrdis2YUg2YXZhdmD2YYKCuKcqCAqKtmF2YrYstipINis2K/Zitiv2KkqKjog2KfZhNio2YjYqiDZitit2KfZgdi4INi52YTZiSDYo9io2LnYp9ivINin2YTZgdmK2K/ZitmIINin2YTYo9i12YTZitipICjYp9mE2LfZiNmEINmI2KfZhNi52LHYtikhCtin2YTYtti62Lcg2YrYqtmFINmB2YLYtyDYqNiq2YLZhNmK2YQg2KfZhNis2YjYr9ipINmI2YTZitizINio2KrYutmK2YrYsSDYp9mE2KPYqNi52KfYryDwn46vCgrimqDvuI8gKirZhdmE2KfYrdi42KfYqjoqKgrigKIg2KfZhNit2K8g2KfZhNij2YLYtdmJOiAxMDBNQiDZhNmE2YXZhNmB2KfYqiDYp9mE2YXYqNin2LTYsdipCuKAoiDZitiq2YUg2K3YsNmBINin2YTZhdmE2YHYp9iqINiq2YTZgtin2KbZitin2Ysg2KjYudivINin2YTYpdix2LPYp9mECuKAoiDZhdi52KfZhNis2Kkg2KrZhNmC2KfYptmK2Kkg2KjYr9mI2YYg2KfZhtiq2LjYp9ixCiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJiYWNrX3RvX3N0YXJ0IildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChoZWxwX3RleHQsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJhZG1pbl9zZXR0aW5ncyI6CiAgICAgICAgaWYgdXNlcl9pZCAhPSBBRE1JTl9JRDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCLim5Qg2YfYsNinINmE2YTZhdi02LHZgSDZgdmC2LchIiwgc2hvd19hbGVydD1UcnVlKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINin2YTYpdit2LXYp9im2YrYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc3RhdHMiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+TpiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX2ZpbGVzIildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfl5HvuI8g2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fY2xlYW51cCIpXSwKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fc3RhcnQiKV0KICAgICAgICBdCiAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKame+4jyAqKtil2LnYr9in2K/Yp9iqINin2YTZhdi02LHZgToqKiIsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fc3RhdHMiOgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICAgICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjLmV4ZWN1dGUoIlNFTEVDVCBDT1VOVCgqKSBGUk9NIHVzZXJzIikKICAgICAgICB0b3RhbF91c2VycyA9IGMuZmV0Y2hvbmUoKVswXQogICAgICAgIGMuZXhlY3V0ZSgiU0VMRUNUIFNVTSh0b3RhbF92aWRlb3MpIEZST00gdXNlcnMiKQogICAgICAgIHRvdGFsX3ZpZGVvcyA9IGMuZmV0Y2hvbmUoKVswXSBvciAwCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgCiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgc3RhdHNfdGV4dCA9IGYiIiIK8J+TiiAqKtil2K3Ytdin2KbZitin2Kog2KfZhNio2YjYqjoqKgoK8J+RpSDYudiv2K8g2KfZhNmF2LPYqtiu2K/ZhdmK2YY6IHt0b3RhbF91c2Vyc30K8J+OrCDYpdis2YXYp9mE2Yog2KfZhNmB2YrYr9mK2YjZh9in2Ko6IHt0b3RhbF92aWRlb3N9CvCfk6Yg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2Kk6IHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0K8J+SviDYp9mE2YXYs9in2K3YqSDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9CiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoc3RhdHNfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2ZpbGVzIjoKICAgICAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgICAgICAKICAgICAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA9PSAwOgogICAgICAgICAgICBmaWxlc190ZXh0ID0gIuKchSDZhNinINiq2YjYrNivINmF2YTZgdin2Kog2YXYrtiy2YbYqSDYrdin2YTZitin2YsuIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZpbGVzX3RleHQgPSBmIvCfk6YgKirYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAoe3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddfSk6KipcblxuIgogICAgICAgICAgICBmb3IgaSwgZmlsZV9pbmZvIGluIGVudW1lcmF0ZShzdG9yYWdlX2luZm9bJ2ZpbGVzJ11bOjEwXSwgMSk6CiAgICAgICAgICAgICAgICBmaWxlc190ZXh0ICs9IGYie2l9LiBge2ZpbGVfaW5mb1snbmFtZSddWzozMF19Li4uYFxuICAge2Zvcm1hdF9zaXplKGZpbGVfaW5mb1snc2l6ZSddKX1cblxuIgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiAxMDoKICAgICAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbi4uLiDZiCB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gLSAxMH0g2YXZhNmBINii2K7YsSIKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbvCfkr4g2KfZhNil2KzZhdin2YTZijoge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0iCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmaWxlc190ZXh0LCByZXBseV9tYXJrdXA9YmFja19idXR0b24pCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fY2xlYW51cCI6CiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgZGVsZXRlZF9jb3VudCA9IDAKICAgICAgICAKICAgICAgICBmb3IgZmlsZV9pbmZvIGluIHN0b3JhZ2VfaW5mb1snZmlsZXMnXToKICAgICAgICAgICAgaWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSk6CiAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDEKICAgICAgICAKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGYi4pyFINiq2YUg2K3YsNmBIHtkZWxldGVkX2NvdW50fSDZhdmE2YEhIiwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImJhY2tfdG9fc3RhcnQiOgogICAgICAgIHVzZXIgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIKICAgICAgICBrZXlib2FyZF9yb3dzID0gWwogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfk4og2K3Ys9in2KjZiiDZiNil2K3Ytdin2KbZitin2KrZiiIsIGNhbGxiYWNrX2RhdGE9Im15X2FjY291bnQiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4oS577iPINin2YTZhdiz2KfYudiv2KkiLCBjYWxsYmFja19kYXRhPSJoZWxwIildCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGlmIHVzZXIuaWQgPT0gQURNSU5fSUQ6CiAgICAgICAgICAgIGtleWJvYXJkX3Jvd3MuYXBwZW5kKFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqZ77iPINil2LnYr9in2K/Yp9iqINin2YTZhdi02LHZgSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildKQogICAgICAgIAogICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkX3Jvd3MpCiAgICAgICAgCiAgICAgICAgd2VsY29tZV90ZXh0ID0gZiIiIgrwn46sINmF2LHYrdio2KfZiyB7dXNlci5maXJzdF9uYW1lfSEKCtij2YbYpyDYqNmI2Kog2LbYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqIC0gKirZhdis2KfZhtmKINio2KfZhNmD2KfZhdmEKiog8J+agAoKKirwn46vINin2YTZhdmF2YrYstin2Ko6KioK4pyoINmF2LnYp9mE2KzYqSDZhdmE2YHYp9iqINit2KrZiSAxMDBNQgrinKgg2K/YudmFINin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2KkK4pyoIDMg2YXYs9iq2YjZitin2Kog2KzZiNiv2KkK4pyoINit2LDZgSDYqtmE2YLYp9im2Yog2YTZhNmF2YTZgdin2KoKCvCfk6Qg2KPYsdiz2YQg2YHZitiv2YrZiCDYo9mIINix2KfYqNi3INmE2YTYqNiv2KEhCiIiIgogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KHdlbGNvbWVfdGV4dCwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCiMgPT09PT09PT09PT09PT09PT09PT0g2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBkb3dubG9hZF9maWxlX2Zyb21fdGVsZWdyYW0oY29udGV4dCwgZmlsZV9pZDogc3RyLCBmaWxlX3NpemU6IGludCkgLT4gT3B0aW9uYWxbc3RyXToKICAgICIiItiq2K3ZhdmK2YQg2YXZhNmBINmF2YYg2KrZhNmK2KzYsdin2YUg2KXZhNmJINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqiIiIgogICAgdHJ5OgogICAgICAgIHByaW50KGYi8J+TpSDYqtit2YXZitmEINmF2YYgVGVsZWdyYW0uLi4g2KfZhNit2KzZhToge2ZpbGVfc2l6ZSAvICgxMDI0KjEwMjQpOi4yZn0gTUIiKQogICAgICAgIAogICAgICAgIGZpbGUgPSBhd2FpdCBjb250ZXh0LmJvdC5nZXRfZmlsZShmaWxlX2lkKQogICAgICAgIAogICAgICAgICMg2K3Zgdi4INmB2Yog2YXYrNmE2K8g2KfZhNiq2K7YstmK2YYg2KfZhNmF2KTZgtiqCiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIHRlbXBfZmlsZW5hbWUgPSBmInZpZGVvX3t0aW1lc3RhbXB9X3tmaWxlX2lkWzoxMF19Lm1wNCIKICAgICAgICB0ZW1wX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgdGVtcF9maWxlbmFtZSkKICAgICAgICAKICAgICAgICBhd2FpdCBmaWxlLmRvd25sb2FkX3RvX2RyaXZlKHRlbXBfcGF0aCkKICAgICAgICBwcmludChmIuKchSDYqtmFINin2YTYqtit2YXZitmEOiB7dGVtcF9wYXRofSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRlbXBfcGF0aAogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTYqtit2YXZitmEOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X3F1YWxpdHlfc2V0dGluZ3MocXVhbGl0eTogc3RyKSAtPiBkaWN0OgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYpdi52K/Yp9iv2KfYqiDYp9mE2KzZiNiv2KkgLSDYqNiv2YjZhiDYqti62YrZitixINin2YTYo9io2LnYp9ivIiIiCiAgICBpZiBxdWFsaXR5ID09ICdoaWdoJzoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMjgsCiAgICAgICAgICAgICJwcmVzZXQiOiAibWVkaXVtIiwKICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiA5NiwKICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IDQ0MTAwLAogICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiAyCiAgICAgICAgfQogICAgZWxpZiBxdWFsaXR5ID09ICdtZWRpdW0nOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJjcmYiOiAzMywKICAgICAgICAgICAgInByZXNldCI6ICJtZWRpdW0iLAogICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IDY0LAogICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5IjogNDQxMDAsCiAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IDIKICAgICAgICB9CiAgICBlbHNlOiAgIyBsb3cKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMzgsCiAgICAgICAgICAgICJwcmVzZXQiOiAiZmFzdCIsCiAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogNDgsCiAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiAyMjA1MCwKICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogMQogICAgICAgIH0KCmRlZiBjb21wcmVzc192aWRlbyh2aWRlb19zb3VyY2U6IHN0ciwgY2hhdF9pZDogc3RyLCBjb250ZXh0LCBxdWFsaXR5OiBzdHIgPSAnbG93JywgaXNfdXJsOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbc3RyXToKICAgICIiIti22LrYtyDYp9mE2YHZitiv2YrZiCDYqNin2LPYqtiu2K/Yp9mFIENsb3VkQ29udmVydCAtINmF2Lkg2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSIiIgogICAgYXBpX2tleSA9IGdldF9hcGlfa2V5KCkKICAgIGlmIG5vdCBhcGlfa2V5OgogICAgICAgIHJldHVybiAiTk9fQVBJX0tFWV9TRVQiCgogICAgdHJ5OgogICAgICAgIGhlYWRlcnMgPSB7IkF1dGhvcml6YXRpb24iOiBmIkJlYXJlciB7YXBpX2tleX0ifQogICAgICAgIHNldHRpbmdzID0gZ2V0X3F1YWxpdHlfc2V0dGluZ3MocXVhbGl0eSkKICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2K8g2K3ZhdmI2YTYqSBKb2IgLSDYqNiv2YjZhiB3aWR0aCDZiCBoZWlnaHQg2YTYrdmB2Lgg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkKICAgICAgICBpZiBpc191cmw6CiAgICAgICAgICAgIGpvYl9wYXlsb2FkID0gewogICAgICAgICAgICAgICAgInRhc2tzIjogewogICAgICAgICAgICAgICAgICAgICJpbXBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJpbXBvcnQvdXJsIiwgInVybCI6IHZpZGVvX3NvdXJjZSwgImZpbGVuYW1lIjogInZpZGVvLm1wNCJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wcmVzcy12aWRlbyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJjb252ZXJ0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJpbnB1dCI6ICJpbXBvcnQtdmlkZW8iLCAKICAgICAgICAgICAgICAgICAgICAgICAgIm91dHB1dF9mb3JtYXQiOiAibXA0IiwKICAgICAgICAgICAgICAgICAgICAgICAgInZpZGVvX2NvZGVjIjogIngyNjQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImNyZiI6IHNldHRpbmdzWyJjcmYiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJwcmVzZXQiOiBzZXR0aW5nc1sicHJlc2V0Il0sCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19jb2RlYyI6ICJhYWMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiBzZXR0aW5nc1siYXVkaW9fYml0cmF0ZSJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IHNldHRpbmdzWyJhdWRpb19mcmVxdWVuY3kiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IHNldHRpbmdzWyJhdWRpb19jaGFubmVscyJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgInN0cmlwX21ldGFkYXRhIjogVHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImV4cG9ydC12aWRlbyI6IHsib3BlcmF0aW9uIjogImV4cG9ydC91cmwiLCAiaW5wdXQiOiAiY29tcHJlc3MtdmlkZW8ifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgam9iX3BheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAidGFza3MiOiB7CiAgICAgICAgICAgICAgICAgICAgImltcG9ydC12aWRlbyI6IHsib3BlcmF0aW9uIjogImltcG9ydC91cGxvYWQifSwKICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3MtdmlkZW8iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcGVyYXRpb24iOiAiY29udmVydCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiaW5wdXQiOiAiaW1wb3J0LXZpZGVvIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJvdXRwdXRfZm9ybWF0IjogIm1wNCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2aWRlb19jb2RlYyI6ICJ4MjY0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJjcmYiOiBzZXR0aW5nc1siY3JmIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAicHJlc2V0Ijogc2V0dGluZ3NbInByZXNldCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY29kZWMiOiAiYWFjIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogc2V0dGluZ3NbImF1ZGlvX2JpdHJhdGUiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiBzZXR0aW5nc1siYXVkaW9fZnJlcXVlbmN5Il0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiBzZXR0aW5nc1siYXVkaW9fY2hhbm5lbHMiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpcF9tZXRhZGF0YSI6IFRydWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJleHBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJleHBvcnQvdXJsIiwgImlucHV0IjogImNvbXByZXNzLXZpZGVvIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgImh0dHBzOi8vYXBpLmNsb3VkY29udmVydC5jb20vdjIvam9icyIsCiAgICAgICAgICAgIGpzb249am9iX3BheWxvYWQsCiAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDE6CiAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYpdmG2LTYp9ihIEpvYjoge3Jlc3BvbnNlLnRleHR9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgam9iX2RhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICAgIGpvYl9pZCA9IGpvYl9kYXRhWyJpZCJdCiAgICAgICAgCiAgICAgICAgIyDYsdmB2Lkg2KfZhNmF2YTZgSDYpdiw2Kcg2YPYp9mGINmF2K3ZhNmK2KfZiwogICAgICAgIGlmIG5vdCBpc191cmw6CiAgICAgICAgICAgIGltcG9ydF90YXNrID0gbmV4dCgodCBmb3IgdCBpbiBqb2JfZGF0YVsidGFza3MiXSBpZiB0WyJuYW1lIl0gPT0gImltcG9ydC12aWRlbyIpLCBOb25lKQogICAgICAgICAgICBpZiBub3QgaW1wb3J0X3Rhc2s6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgdXBsb2FkX3VybCA9IGltcG9ydF90YXNrWyJyZXN1bHQiXVsiZm9ybSJdWyJ1cmwiXQogICAgICAgICAgICB1cGxvYWRfcGFyYW1zID0gaW1wb3J0X3Rhc2tbInJlc3VsdCJdWyJmb3JtIl1bInBhcmFtZXRlcnMiXQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHZpZGVvX3NvdXJjZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgIGZpbGVzID0geydmaWxlJzogZn0KICAgICAgICAgICAgICAgIHVwbG9hZF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXBsb2FkX3VybCwgZGF0YT11cGxvYWRfcGFyYW1zLCBmaWxlcz1maWxlcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVwbG9hZF9yZXNwb25zZS5zdGF0dXNfY29kZSBub3QgaW4gWzIwMCwgMjAxXToKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYsdmB2Lkg2KfZhNmF2YTZgToge3VwbG9hZF9yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINix2YHYuSDYp9mE2YXZhNmBINmE2YAgQ2xvdWRDb252ZXJ0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2K3ZhNmKINmB2YjYsdin2Ysg2KjYudivINin2YTYsdmB2LkKICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh2aWRlb19zb3VyY2UpCiAgICAgICAgCiAgICAgICAgIyDYp9mG2KrYuNin2LEg2KfZg9iq2YXYp9mEINin2YTZhdi52KfZhNis2KkKICAgICAgICBtYXhfYXR0ZW1wdHMgPSAxODAKICAgICAgICBhdHRlbXB0ID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgICAgICAgICAgc3RhdHVzX3Jlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgZiJodHRwczovL2FwaS5jbG91ZGNvbnZlcnQuY29tL3YyL2pvYnMve2pvYl9pZH0iLAogICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1c19yZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2YHYrdi1INin2YTYrdin2YTYqToge3N0YXR1c19yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICBhdHRlbXB0ICs9IDEKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBqb2Jfc3RhdHVzID0gc3RhdHVzX3Jlc3BvbnNlLmpzb24oKVsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzWyJzdGF0dXMiXSA9PSAiZmluaXNoZWQiOgogICAgICAgICAgICAgICAgZXhwb3J0X3Rhc2sgPSBuZXh0KCh0IGZvciB0IGluIGpvYl9zdGF0dXNbInRhc2tzIl0gaWYgdFsibmFtZSJdID09ICJleHBvcnQtdmlkZW8iKSwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIGV4cG9ydF90YXNrIGFuZCBleHBvcnRfdGFzay5nZXQoInJlc3VsdCIpOgogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkX3VybCA9IGV4cG9ydF90YXNrWyJyZXN1bHQiXVsiZmlsZXMiXVswXVsidXJsIl0KICAgICAgICAgICAgICAgICAgICBwcmludChmIuKchSDYp9mD2KrZhdmEINin2YTYtti62LchIFVSTDoge2Rvd25sb2FkX3VybH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkb3dubG9hZF91cmwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgZWxpZiBqb2Jfc3RhdHVzWyJzdGF0dXMiXSA9PSAiZXJyb3IiOgogICAgICAgICAgICAgICAgcHJpbnQoZiLinYwg2YHYtNmEIEpvYjoge2pvYl9zdGF0dXN9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICBhdHRlbXB0ICs9IDEKICAgICAgICAgICAgcHJpbnQoZiLij7Mg2KfZhtiq2LjYp9ixLi4uICh7YXR0ZW1wdH0ve21heF9hdHRlbXB0c30pIikKICAgICAgICAKICAgICAgICBwcmludCgi4o+x77iPINin2YbYqtmH2Kog2YXZh9mE2Kkg2KfZhNin2YbYqti42KfYsSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYtti62Lcg2KfZhNmB2YrYr9mK2Yg6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBzZW5kX2NvbXByZXNzZWRfdmlkZW9fYWR2YW5jZWQoY2hhdF9pZDogc3RyLCB2aWRlb191cmw6IHN0ciwgY2FwdGlvbjogc3RyKSAtPiB0dXBsZToKICAgICIiItil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2LbYutmI2Lcg2YXYuSDYpdiv2KfYsdipINmF2K3Ys9mG2Kkg2YTZhNmF2YTZgdin2KoiIiIKICAgIG1heF9yZXRyaWVzID0gMwogICAgCiAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChmIvCfk6Ug2YXYrdin2YjZhNipINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YggKHthdHRlbXB0ICsgMX0ve21heF9yZXRyaWVzfSkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYqtit2YXZitmEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIHZpZGVvX3Jlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHZpZGVvX3VybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MzAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdmlkZW9fcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoZiLinYwg2YHYtNmEINin2YTYqtit2YXZitmEOiB7dmlkZW9fcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2YHYuCDZhdik2YLYqgogICAgICAgICAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIHRlbXBfZmlsZW5hbWUgPSBmImNvbXByZXNzZWRfe3RpbWVzdGFtcH1fe2NoYXRfaWR9Lm1wNCIKICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgdGVtcF9maWxlbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGVfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiB2aWRlb19yZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT04MTkyKToKICAgICAgICAgICAgICAgICAgICBpZiBjaHVuazoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhDoge2ZpbGVfc2l6ZSAvICgxMDI0KjEwMjQpOi4yZn0gTUIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIHByaW50KCLwn5OkINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e1RFTEVHUkFNX0JPVF9UT0tFTn0vc2VuZFZpZGVvIgogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHRlbXBfZmlsZV9wYXRoLCAncmInKSBhcyB2aWRlb19maWxlOgogICAgICAgICAgICAgICAgZmlsZXMgPSB7J3ZpZGVvJzogdmlkZW9fZmlsZX0KICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICAgICAgICAgICAgICdjYXB0aW9uJzogY2FwdGlvbiwKICAgICAgICAgICAgICAgICAgICAnc3VwcG9ydHNfc3RyZWFtaW5nJzogVHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZW5kX3Jlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGZpbGVzPWZpbGVzLCBkYXRhPWRhdGEsIHRpbWVvdXQ9MzAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc2VuZF9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBwcmludCgi4pyFINiq2YUg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiCDYqNmG2KzYp9itISIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSwgdGVtcF9maWxlX3BhdGgKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYp9mE2KXYsdiz2KfZhDoge3NlbmRfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IC0ge3NlbmRfcmVzcG9uc2UudGV4dFs6MjAwXX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZgdin2LTZhAogICAgICAgICAgICAgICAgaWYgdGVtcF9maWxlX3BhdGg6CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgICAgICAgICB0ZW1wX2ZpbGVfcGF0aCA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCB0ZW1wX2ZpbGVfcGF0aAogICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNmF2K3Yp9mI2YTYqSB7YXR0ZW1wdCArIDF9OiB7ZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdGVtcF9maWxlX3BhdGg6CiAgICAgICAgICAgICAgICBkZWxldGVfZmlsZV9zYWZlKHRlbXBfZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgCiAgICByZXR1cm4gRmFsc2UsIE5vbmUKCmFzeW5jIGRlZiBwcm9jZXNzX3ZpZGVvX3F1ZXVlKGNvbnRleHQpOgogICAgIiIi2YXYudin2YTYrCDYt9in2KjZiNixINin2YTZgdmK2K/ZitmIIiIiCiAgICBnbG9iYWwgaXNfcHJvY2Vzc2luZwogICAgCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgdmlkZW9fZGF0YSA9IGF3YWl0IHByb2Nlc3NpbmdfcXVldWUuZ2V0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlzX3Byb2Nlc3NpbmcgPSBUcnVlCiAgICAgICAgICAgIGNoYXRfaWQgPSB2aWRlb19kYXRhWydjaGF0X2lkJ10KICAgICAgICAgICAgdXNlcl9pZCA9IGludChjaGF0X2lkKQogICAgICAgICAgICB2aWRlb19zb3VyY2UgPSB2aWRlb19kYXRhWydzb3VyY2UnXQogICAgICAgICAgICBzb3VyY2VfdHlwZSA9IHZpZGVvX2RhdGFbJ3R5cGUnXQogICAgICAgICAgICBmaWxlX3NpemUgPSB2aWRlb19kYXRhLmdldCgnZmlsZV9zaXplJywgMCkKICAgICAgICAgICAgcXVhbGl0eSA9IHZpZGVvX2RhdGEuZ2V0KCdxdWFsaXR5JywgJ2xvdycpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIvCfjqwg2KjYr9ihINmF2LnYp9mE2KzYqToge2NoYXRfaWR9IC0ge3NvdXJjZV90eXBlfSAtIHtxdWFsaXR5fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBjb21wcmVzc2VkX3VybCA9IE5vbmUKICAgICAgICAgICAgbG9jYWxfZmlsZV90b19kZWxldGUgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjINmF2LnYp9mE2KzYqSDYrdiz2Kgg2KfZhNmG2YjYuQogICAgICAgICAgICBpZiBzb3VyY2VfdHlwZSA9PSAndXJsJzoKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4o+zINis2KfYsdmKINmF2LnYp9mE2KzYqSDYp9mE2LHYp9io2LcuLi4iLCBjb250ZXh0KQogICAgICAgICAgICAgICAgY29tcHJlc3NlZF91cmwgPSBjb21wcmVzc192aWRlbyh2aWRlb19zb3VyY2UsIGNoYXRfaWQsIGNvbnRleHQsIHF1YWxpdHksIGlzX3VybD1UcnVlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgc291cmNlX3R5cGUgPT0gJ2ZpbGVfaWQnOgogICAgICAgICAgICAgICAgaWYgZmlsZV9zaXplIDw9IE1BWF9GSUxFX1NJWkU6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLwn5OlINis2KfYsdmKINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iLCBjb250ZXh0KQogICAgICAgICAgICAgICAgICAgIGxvY2FsX2ZpbGUgPSBhd2FpdCBkb3dubG9hZF9maWxlX2Zyb21fdGVsZWdyYW0oY29udGV4dCwgdmlkZW9fc291cmNlLCBmaWxlX3NpemUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbG9jYWxfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfZmlsZV90b19kZWxldGUgPSBsb2NhbF9maWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4o+zINis2KfYsdmKINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRfdXJsID0gY29tcHJlc3NfdmlkZW8obG9jYWxfZmlsZSwgY2hhdF9pZCwgY29udGV4dCwgcXVhbGl0eSwgaXNfdXJsPUZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYqtit2YXZitmEINin2YTZgdmK2K/ZitmILiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCBmIuKdjCDYp9mE2YXZhNmBINmD2KjZitixINis2K/Yp9mLICh7ZmlsZV9zaXplLygxMDI0KjEwMjQpOi4yZn0gTUIpLiDYp9mE2K3YryDYp9mE2KPZgti12YkgMTAwTUIuIiwgY29udGV4dCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YbYqtmK2KzYqQogICAgICAgICAgICBpZiBjb21wcmVzc2VkX3VybCA9PSAiTk9fQVBJX0tFWV9TRVQiOgogICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YTZhSDZitiq2YUg2KrYudmK2YrZhiDZhdmB2KrYp9itIEFQSS4g2KPYqNmE2Log2KfZhNmF2LTYsdmBLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxpZiBjb21wcmVzc2VkX3VybDoKICAgICAgICAgICAgICAgIHF1YWxpdHlfbmFtZXMgPSB7J2hpZ2gnOiAn8J+UpSDYudin2YTZitipJywgJ21lZGl1bSc6ICfimpbvuI8g2YXYqtmI2LPYt9ipJywgJ2xvdyc6ICfwn5K+INmF2YbYrtmB2LbYqSd9CiAgICAgICAgICAgICAgICBjYXB0aW9uID0gZiLinIUg2KrZhSDYp9mE2LbYuti3INio2YbYrNin2K0hXG7wn46sINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZXMuZ2V0KHF1YWxpdHksICfYudin2K/ZitipJyl9XG7inKgg2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIvCfk6Qg2KzYp9ix2Yog2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbmRfc3VjY2VzcywgdGVtcF9maWxlID0gc2VuZF9jb21wcmVzc2VkX3ZpZGVvX2FkdmFuY2VkKGNoYXRfaWQsIGNvbXByZXNzZWRfdXJsLCBjYXB0aW9uKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdik2YLYqiDZgdmI2LHYp9mLINio2LnYryDYp9mE2KXYsdiz2KfZhAogICAgICAgICAgICAgICAgaWYgdGVtcF9maWxlOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodGVtcF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZW5kX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgaW5jcmVtZW50X3ZpZGVvX2NvdW50KHVzZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINil2YTZiSB7Y2hhdF9pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KrZhti42YrZgSDYo9mKINmF2YTZgdin2Kog2YXYqtio2YLZitipCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgICAgICAgICAgICAgICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID4gNToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIvCfp7kg2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmaWxlX2luZm8gaW4gc3RvcmFnZV9pbmZvWydmaWxlcyddWzozXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9pbmZvWydwYXRoJ10pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILiDYrdin2YjZhCDZhdix2Kkg2KPYrtix2YkuIiwgY29udGV4dCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYtti62Lcg2KfZhNmB2YrYr9mK2YguINiq2K3ZgtmCINmF2YYg2KfZhNil2LnYr9in2K/Yp9iqLiIsIGNvbnRleHQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYo9mKINmF2YTZgdin2Kog2YXYrdmE2YrYqSDZhdiq2KjZgtmK2KkKICAgICAgICAgICAgaWYgbG9jYWxfZmlsZV90b19kZWxldGU6CiAgICAgICAgICAgICAgICBkZWxldGVfZmlsZV9zYWZlKGxvY2FsX2ZpbGVfdG9fZGVsZXRlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJvY2Vzc2luZ19xdWV1ZS50YXNrX2RvbmUoKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2YXYudin2YTYrNipOiB7ZX0iKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQoKYXN5bmMgZGVmIGhhbmRsZV92aWRlbyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTZgdmK2K/ZitmIIiIiCiAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICBjaGF0X2lkID0gc3RyKHVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIAogICAgaWYgdXBkYXRlLm1lc3NhZ2UudmlkZW86CiAgICAgICAgZmlsZV9pZCA9IHVwZGF0ZS5tZXNzYWdlLnZpZGVvLmZpbGVfaWQKICAgICAgICBmaWxlX3NpemUgPSB1cGRhdGUubWVzc2FnZS52aWRlby5maWxlX3NpemUKICAgIGVsaWYgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQgYW5kIHVwZGF0ZS5tZXNzYWdlLmRvY3VtZW50Lm1pbWVfdHlwZSBhbmQgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQubWltZV90eXBlLnN0YXJ0c3dpdGgoInZpZGVvLyIpOgogICAgICAgIGZpbGVfaWQgPSB1cGRhdGUubWVzc2FnZS5kb2N1bWVudC5maWxlX2lkCiAgICAgICAgZmlsZV9zaXplID0gdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQuZmlsZV9zaXplCiAgICBlbHNlOgogICAgICAgIHJldHVybgogICAgCiAgICBmaWxlX3NpemVfbWIgPSBmaWxlX3NpemUgLyAoMTAyNCAqIDEwMjQpCiAgICBwcmludChmIvCfk7kg2YHZitiv2YrZiCDZhdmGIHt1c2VyX2lkfSAtIHtmaWxlX3NpemVfbWI6LjJmfSBNQiIpCiAgICAKICAgIGlmIGZpbGVfc2l6ZSA+IE1BWF9GSUxFX1NJWkU6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmIuKdjCDYp9mE2YXZhNmBINmD2KjZitixINis2K/Yp9mLICh7ZmlsZV9zaXplX21iOi4yZn0gTUIpXG5cbvCfk48g2KfZhNit2K8g2KfZhNij2YLYtdmJOiAxMDBNQlxu8J+SoSDYp9iz2KrYrtiv2YUg2LHYp9io2Lcg2K7Yp9ix2KzZiiDZhNmE2YXZhNmB2KfYqiDYp9mE2KPZg9io2LEuIikKICAgICAgICByZXR1cm4KICAgIAogICAgY29udGV4dC51c2VyX2RhdGFbJ3BlbmRpbmdfdmlkZW8nXSA9IHsKICAgICAgICAnZmlsZV9pZCc6IGZpbGVfaWQsCiAgICAgICAgJ2ZpbGVfc2l6ZSc6IGZpbGVfc2l6ZSwKICAgICAgICAnY2hhdF9pZCc6IGNoYXRfaWQKICAgIH0KICAgIAogICAga2V5Ym9hcmQgPSBbCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SlINi52KfZhNmK2KkgKNis2YjYr9ipINmF2YXYqtin2LLYqSkiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X2hpZ2giKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLimpbvuI8g2YXYqtmI2LPYt9ipICjYqtmI2KfYstmGKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfbWVkaXVtIildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+SviDZhdmG2K7Zgdi22KkgKNij2LXYutixINit2KzZhSkiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X2xvdyIpXQogICAgXQogICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAKICAgIHF1YWxpdHlfdGV4dCA9IGYiIiIK8J+OrCAqKtin2K7YqtixINis2YjYr9ipINin2YTYtti62Lc6KioKCvCfk7kg2K3YrNmFINin2YTZgdmK2K/ZitmIOiB7ZmlsZV9zaXplX21iOi4yZn0gTUIKCuKcqCAqKtmF2YTYp9it2LjYqSDZh9in2YXYqSoqOiDYs9mK2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINij2KjYudin2K8g2KfZhNmB2YrYr9mK2Ygg2KfZhNij2LXZhNmK2KkgKNin2YTYt9mI2YQgw5cg2KfZhNi52LHYtikK2KfZhNi22LrYtyDYs9mK2YPZiNmGINmB2YLYtyDYqNiq2YLZhNmK2YQg2KfZhNis2YjYr9ipIPCfjq8KCtin2K7YqtixINin2YTYrNmI2K/YqSDYp9mE2YXZhtin2LPYqNipIPCfkYcKIiIiCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQocXVhbGl0eV90ZXh0LCByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwKQoKYXN5bmMgZGVmIGhhbmRsZV91cmwodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2YXYudin2YTYrCDYp9mE2LHZiNin2KjYtyIiIgogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgY2hhdF9pZCA9IHN0cih1cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCiAgICB1cmwgPSB1cGRhdGUubWVzc2FnZS50ZXh0LnN0cmlwKCkKICAgIAogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCgnaHR0cDovLycsICdodHRwczovLycpKToKICAgICAgICByZXR1cm4KICAgIAogICAgdmlkZW9fc2l0ZXMgPSBbJy5tcDQnLCAnLmF2aScsICcubW92JywgJ2RyaXZlLmdvb2dsZS5jb20nLCAnZHJvcGJveC5jb20nLCAnbWVnYS5ueiddCiAgICBpc19saWtlbHlfdmlkZW8gPSBhbnkoc2l0ZSBpbiB1cmwubG93ZXIoKSBmb3Igc2l0ZSBpbiB2aWRlb19zaXRlcykKICAgIAogICAgaWYgbm90IGlzX2xpa2VseV92aWRlbzoKICAgICAgICByZXR1cm4KICAgIAogICAgcHJpbnQoZiLwn5SXINix2KfYqNi3INmF2YYge3VzZXJfaWR9OiB7dXJsfSIpCiAgICAKICAgIGNvbnRleHQudXNlcl9kYXRhWydwZW5kaW5nX3ZpZGVvJ10gPSB7CiAgICAgICAgJ3VybCc6IHVybCwKICAgICAgICAnY2hhdF9pZCc6IGNoYXRfaWQKICAgIH0KICAgIAogICAga2V5Ym9hcmQgPSBbCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SlINi52KfZhNmK2KkgKNis2YjYr9ipINmF2YXYqtin2LLYqSkiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X3VybF9oaWdoIildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqW77iPINmF2KrZiNiz2LfYqSAo2KrZiNin2LLZhikiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X3VybF9tZWRpdW0iKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5K+INmF2YbYrtmB2LbYqSAo2KPYtdi62LEg2K3YrNmFKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfdXJsX2xvdyIpXQogICAgXQogICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIvCfjqwgKirYp9iu2KrYsSDYrNmI2K/YqSDYp9mE2LbYuti3OioqXG5cbuKcqCDYs9mK2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipINmE2YTZgdmK2K/ZitmIIiwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCiMgPT09PT09PT09PT09PT09PT09PT0g2KfZhNio2LHZhtin2YXYrCDYp9mE2LHYptmK2LPZiiA9PT09PT09PT09PT09PT09PT09PQpkZWYgbWFpbigpOgogICAgIiIi2KfZhNio2LHZhtin2YXYrCDYp9mE2LHYptmK2LPZiiIiIgogICAgcHJpbnQoIvCfmoAg2KrZh9mK2KbYqSDYp9mE2KjZiNiqLi4uIikKICAgIAogICAgIyDYpdmG2LTYp9ihINin2YTZhdis2YTYr9in2Kog2YjYp9mE2YLZiNin2LnYrwogICAgaW5pdF90ZW1wX3N0b3JhZ2UoKQogICAgaW5pdF9kYXRhYmFzZSgpCiAgICAKICAgICMg2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqQogICAgY2xlYW51cF9vbGRfZmlsZXMoKQogICAgCiAgICBwcmludCgi4pyFINin2YTZhti42KfZhSDYrNin2YfYsiIpCiAgICAKICAgICMg2KXZhti02KfYoSDYp9mE2KrYt9io2YrZggogICAgYXBwbGljYXRpb24gPSBBcHBsaWNhdGlvbi5idWlsZGVyKCkudG9rZW4oVEVMRUdSQU1fQk9UX1RPS0VOKS5idWlsZCgpCiAgICAKICAgICMg2KfZhNmF2LnYp9mE2KzYp9iqCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzdGFydF9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhY2NvdW50IiwgbXlfYWNjb3VudF9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzZXRhcGlrZXkiLCBzZXRhcGlrZXlfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhdHMiLCBzdGF0c19jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJmaWxlcyIsIGZpbGVzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImNsZWFudXAiLCBjbGVhbnVwX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoYnV0dG9uX2hhbmRsZXIpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoTWVzc2FnZUhhbmRsZXIoZmlsdGVycy5WSURFTyB8IGZpbHRlcnMuRG9jdW1lbnQuVklERU8sIGhhbmRsZV92aWRlbykpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlRFWFQgJiB+ZmlsdGVycy5DT01NQU5ELCBoYW5kbGVfdXJsKSkKICAgIAogICAgIyDYqNiv2KEg2YXYudin2YTYrCDYp9mE2LfYp9io2YjYsQogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgIGxhbWJkYSBjb250ZXh0OiBhc3luY2lvLmNyZWF0ZV90YXNrKHByb2Nlc3NfdmlkZW9fcXVldWUoY29udGV4dCkpLAogICAgICAgIHdoZW49MAogICAgKQogICAgCiAgICBwcmludCgi4pyFINin2YTYqNmI2Kog2YrYudmF2YQg2KfZhNii2YYuLi4iKQogICAgcHJpbnQoZiLwn5GRINmF2LnYsdmBINin2YTZhdi02LHZgToge0FETUlOX0lEfSIpCiAgICBwcmludChmIvCfk6Yg2KfZhNit2K8g2KfZhNij2YLYtdmJINmE2YTZhdmE2YHYp9iqOiB7TUFYX0ZJTEVfU0laRS8oMTAyNCoxMDI0KTouMGZ9IE1CIikKICAgIHByaW50KCLwn46vINin2YTZhdmK2LLYqSDYp9mE2KzYr9mK2K/YqTog2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSEiKQogICAgCiAgICAjINiq2LTYutmK2YQg2KfZhNio2YjYqgogICAgIyDYqtmFINiq2LnYr9mK2YTZhyDZhNmE2LnZhdmEINmB2YogdGhyZWFkCgogICAgaW1wb3J0IGFzeW5jaW8KCiAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCgogICAgYXN5bmNpby5zZXRfZXZlbnRfbG9vcChsb29wKQoKICAgIGFzeW5jIGRlZiBydW4oKToKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24uaW5pdGlhbGl6ZSgpCgogICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnN0YXJ0KCkKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24udXBkYXRlci5zdGFydF9wb2xsaW5nKCkKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgogICAgICAgIGV4Y2VwdDoKCiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZmluYWxseToKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnVwZGF0ZXIuc3RvcCgpCgogICAgICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi5zdG9wKCkKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnNodXRkb3duKCkKCiAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShydW4oKSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
