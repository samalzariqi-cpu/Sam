#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    global start_time
    uptime = str(datetime.now() - start_time).split(".")[0] if start_time else "0"
    
    html = """
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</title>
        <style>
            * {{
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 600px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9em;
            }}
            .status {{
                background: #f8f9fa;
                border-radius: 15px;
                padding: 25px;
            }}
            .status h2 {{
                color: #10b981;
                text-align: center;
                margin-bottom: 20px;
            }}
            .bot-item {{
                background: white;
                border-radius: 10px;
                padding: 15px;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "IyEvdXNyL2Jpbi9lbnYgcHl0aG9uMwoiIiIK8J+OrCDYttin2LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2KfYrdiq2LHYp9mB2YogLSBUZWxlZ3JhbSBCb3QK2KfZhNmG2LPYrtipINin2YTZhdit2LPZkdmG2Kkg2YXYuSDZhdmF2YrYstin2Kog2YXYqtmC2K/ZhdipIQoK2KfZhNmF2YXZitiy2KfYqiDYp9mE2KzYr9mK2K/YqToK4pyFINi22LrYtyDZgdin2KbZgiDYp9mE2LPYsdi52KkgKDN4INij2LPYsdi5KQrinIUg2LbYuti3INij2YLZiNmJIC0g2K3YrNmFINi12LrZitixINis2K/Yp9mLCuKchSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmI2YfYp9iqINmF2YfZhdinINmD2KfZhiDYrdis2YXZh9inICjYqtmC2LPZitmFINiq2YTZgtin2KbZiikK4pyFINiz2KzZhCDYo9iu2LfYp9ihIHR4dCDZhdmB2LXZhArinIUg2LPYrNmEINiq2YLYr9mFINmF2Lkg2KPYs9io2KfYqCDYp9mE2KrYo9iu2YrYsQrinIUg2K/YudmFINis2YXZiti5INij2K3YrNin2YUg2KfZhNmB2YrYr9mK2YjZh9in2KoKCtin2YTZhdiq2LfZhNio2KfYqjoKLSBQeXRob24gMy44KwotIEZGbXBlZyAoc3VkbyBhcHQgaW5zdGFsbCBmZm1wZWcpCi0gcGlwIGluc3RhbGwgcHl0aG9uLXRlbGVncmFtLWJvdCByZXF1ZXN0cyB0cWRtCgrYp9mE2KfYs9iq2K7Yr9in2YU6CjEuINi52K/ZhCBCT1RfVE9LRU4g2KPYr9mG2KfZhwoyLiDYtNi62YQ6IHB5dGhvbjMgdmlkZW9fY29tcHJlc3Nvcl9ib3RfcHJvLnB5CjMuINij2LHYs9mEINix2KfYqNi3INin2YTZgdmK2K/ZitmIINmE2YTYqNmI2KoKIiIiCgppbXBvcnQgb3MKaW1wb3J0IGFzeW5jaW8KaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBzdWJwcm9jZXNzCmltcG9ydCByZQppbXBvcnQgdGltZQppbXBvcnQgbG9nZ2luZwppbXBvcnQganNvbgppbXBvcnQgemlwZmlsZQpmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgVXBkYXRlLCBJbmxpbmVLZXlib2FyZEJ1dHRvbiwgSW5saW5lS2V5Ym9hcmRNYXJrdXAKZnJvbSB0ZWxlZ3JhbS5leHQgaW1wb3J0IEFwcGxpY2F0aW9uLCBDb21tYW5kSGFuZGxlciwgTWVzc2FnZUhhbmRsZXIsIENhbGxiYWNrUXVlcnlIYW5kbGVyLCBDb250ZXh0VHlwZXMsIGZpbHRlcnMKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIOKame+4jyDYp9mE2KXYudiv2KfYr9in2KogLSDYudiv2YQg2YfZhtinINmB2YLYtyEKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpCT1RfVE9LRU4gPSAiODUwNDY0ODU1MDpBQUdINFRvNHZSdDczRjBlT0hIQlIzQnNEOUlTYS0wekF0SSIgICMg8J+RiCDYtti5INiq2YjZg9mGINin2YTYqNmI2Kog2YfZhtinClRFTVBfRElSID0gIi4vdGVtcF92aWRlb3MiICAjINmF2KzZhNivINin2YTZhdmE2YHYp9iqINin2YTZhdik2YLYqtipCkxPR1NfRElSID0gIi4vbG9ncyIgICMg2YXYrNmE2K8g2LPYrNmE2KfYqiDYp9mE2KPYrti32KfYoQpNQVhfVEVMRUdSQU1fU0laRV9NQiA9IDUwICAjINit2K8g2LHZgdi5INin2YTZhdmE2YHYp9iqINmB2YogVGVsZWdyYW0gKNmE2YPZhCDYrNiy2KEpCk1BWF9GSUxFX1BBUlRTID0gMTAgICMg2LnYr9ivINin2YTYo9is2LLYp9ihINin2YTYo9mC2LXZiSDZhNmE2KrZgtiz2YrZhQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+TnSDYpdi52K/Yp9ivINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mFIChMb2dnaW5nKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIERldGFpbGVkTG9nZ2VyOgogICAgIiIi2YHYptipINin2YTYqtiz2KzZitmEINin2YTZhdiq2YLYr9mF2Kkg2YXYuSDYrdmB2Lgg2KfZhNij2K7Yt9in2KEg2YHZiiB0eHQiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ3NfZGlyPUxPR1NfRElSKToKICAgICAgICBzZWxmLmxvZ3NfZGlyID0gUGF0aChsb2dzX2RpcikKICAgICAgICBzZWxmLmxvZ3NfZGlyLm1rZGlyKGV4aXN0X29rPVRydWUpCiAgICAgICAgc2VsZi5jdXJyZW50X3Nlc3Npb25fbG9nID0gTm9uZQogICAgICAgIHNlbGYuc2V0dXBfbG9nZ2luZygpCiAgICAKICAgIGRlZiBzZXR1cF9sb2dnaW5nKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YbYuNin2YUg2KfZhNiq2LPYrNmK2YQiIiIKICAgICAgICBsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgICAgICAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShuYW1lKXMgLSAlKGxldmVsbmFtZSlzIC0gJShtZXNzYWdlKXMnLAogICAgICAgICAgICBsZXZlbD1sb2dnaW5nLklORk8KICAgICAgICApCiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXykKICAgIAogICAgZGVmIHN0YXJ0X3Nlc3Npb24oc2VsZiwgdXNlcl9pZCwgdmlkZW9fdXJsKToKICAgICAgICAiIiLYqNiv2KEg2KzZhNiz2Kkg2KzYr9mK2K/YqSDZiNil2YbYtNin2KEg2YXZhNmBINiz2KzZhCIiIgogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWRfJUglTSVTIikKICAgICAgICBsb2dfZmlsZW5hbWUgPSBmInNlc3Npb25fe3VzZXJfaWR9X3t0aW1lc3RhbXB9LnR4dCIKICAgICAgICBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cgPSBzZWxmLmxvZ3NfZGlyIC8gbG9nX2ZpbGVuYW1lCiAgICAgICAgCiAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgZi53cml0ZSgi8J+OrCDYs9is2YQg2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIIC0gVGVsZWdyYW0gQm90XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgICAgICBmLndyaXRlKGYi4o+wINin2YTYqtin2LHZitiuINmI2KfZhNmI2YLYqjoge2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIikKICAgICAgICAgICAgZi53cml0ZShmIvCfkaQg2YXYudix2YEg2KfZhNmF2LPYqtiu2K/ZhToge3VzZXJfaWR9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYi8J+UlyDYsdin2KjYtyDYp9mE2YHZitiv2YrZiDoge3ZpZGVvX3VybH1cblxuIikKICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgIGYud3JpdGUoIvCfk4sg2LPYrNmEINin2YTYudmF2YTZitin2Ko6XG4iKQogICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuXG4iKQogICAgICAgIAogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKICAgIAogICAgZGVmIGxvZyhzZWxmLCBtZXNzYWdlLCBsZXZlbD0iSU5GTyIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2LHYs9in2YTYqSDZgdmKINin2YTYs9is2YQg2YjYp9mE2YXZhNmBIiIiCiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVIOiVNOiVTIikKICAgICAgICBsb2dfbWVzc2FnZSA9IGYiW3t0aW1lc3RhbXB9XSBbe2xldmVsfV0ge21lc3NhZ2V9IgogICAgICAgIAogICAgICAgICMg2LfYqNin2LnYqSDZgdmKINin2YTZg9mI2YbYs9mI2YQKICAgICAgICBpZiBsZXZlbCA9PSAiRVJST1IiOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5lcnJvcihtZXNzYWdlKQogICAgICAgIGVsaWYgbGV2ZWwgPT0gIldBUk5JTkciOgogICAgICAgICAgICBzZWxmLmxvZ2dlci53YXJuaW5nKG1lc3NhZ2UpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIuaW5mbyhtZXNzYWdlKQogICAgICAgIAogICAgICAgICMg2K3Zgdi4INmB2Yog2KfZhNmF2YTZgQogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShsb2dfbWVzc2FnZSArICJcbiIpCiAgICAKICAgIGRlZiBsb2dfZXJyb3Ioc2VsZiwgZXJyb3IsIGNvbnRleHQ9IiIpOgogICAgICAgICIiItiq2LPYrNmK2YQg2K7Yt9ijINmF2YHYtdmEIiIiCiAgICAgICAgZXJyb3JfZGV0YWlscyA9IHsKICAgICAgICAgICAgJ3RpbWVzdGFtcCc6IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpLAogICAgICAgICAgICAnY29udGV4dCc6IGNvbnRleHQsCiAgICAgICAgICAgICdlcnJvcl90eXBlJzogdHlwZShlcnJvcikuX19uYW1lX18sCiAgICAgICAgICAgICdlcnJvcl9tZXNzYWdlJzogc3RyKGVycm9yKSwKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgc2VsZi5sb2coZiLinYwg2K7Yt9ijINmB2Yoge2NvbnRleHR9OiB7ZXJyb3J9IiwgIkVSUk9SIikKICAgICAgICAKICAgICAgICBpZiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2c6CiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2csICdhJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoIuKdjCDYqtmB2KfYtdmK2YQg2KfZhNiu2LfYozpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgICAgICAgICAgICAgIGYud3JpdGUoanNvbi5kdW1wcyhlcnJvcl9kZXRhaWxzLCBlbnN1cmVfYXNjaWk9RmFsc2UsIGluZGVudD0yKSkKICAgICAgICAgICAgICAgIGYud3JpdGUoIlxuIiArICI9IiAqIDgwICsgIlxuXG4iKQogICAgCiAgICBkZWYgZmluaXNoX3Nlc3Npb24oc2VsZiwgc3VjY2Vzcz1UcnVlLCBmaW5hbF9zaXplPU5vbmUpOgogICAgICAgICIiItil2YbZh9in2KEg2KfZhNis2YTYs9ipINmI2K3Zgdi4INin2YTZhdmE2K7YtSIiIgogICAgICAgIGlmIHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZzoKICAgICAgICAgICAgd2l0aCBvcGVuKHNlbGYuY3VycmVudF9zZXNzaW9uX2xvZywgJ2EnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZSgiXG4iICsgIj0iICogODAgKyAiXG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgi8J+TiiDZhdmE2K7YtSDYp9mE2KzZhNiz2Kk6XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZSgiPSIgKiA4MCArICJcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYi4o+wINmI2YLYqiDYp9mE2KfZhtiq2YfYp9ihOiB7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZShmIuKchSDYp9mE2K3Yp9mE2Kk6IHsn2YbYrNitJyBpZiBzdWNjZXNzIGVsc2UgJ9mB2LTZhCd9XG4iKQogICAgICAgICAgICAgICAgaWYgZmluYWxfc2l6ZToKICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYi8J+TpiDYp9mE2K3YrNmFINin2YTZhtmH2KfYptmKOiB7ZmluYWxfc2l6ZTouMmZ9INmF2YrYrNin2KjYp9mK2KpcbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKCI9IiAqIDgwICsgIlxuIikKICAgIAogICAgZGVmIGdldF9sb2dfZmlsZShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTZgSDYp9mE2LPYrNmEINin2YTYrdin2YTZiiIiIgogICAgICAgIHJldHVybiBzZWxmLmN1cnJlbnRfc2Vzc2lvbl9sb2cKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfk4og2YXYr9mK2LEg2KfZhNiq2YLYr9mFIChQcm9ncmVzcyBNYW5hZ2VyKQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFByb2dyZXNzTWFuYWdlcjoKICAgICIiItil2K/Yp9ix2Kkg2YjYudix2LYg2KfZhNiq2YLYr9mFINmF2Lkg2YPYtNmBINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LEiIiIKICAgIAogICAgZGVmIF9faW5pdF9fKHNlbGYsIGxvZ2dlcik6CiAgICAgICAgc2VsZi5sb2dnZXIgPSBsb2dnZXIKICAgICAgICBzZWxmLnN0YXJ0X3RpbWUgPSBOb25lCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gTm9uZQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSAwCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5waGFzZSA9ICIiCiAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zID0gW10KICAgIAogICAgZGVmIHN0YXJ0KHNlbGYsIHBoYXNlLCB0b3RhbF9zaXplPTApOgogICAgICAgICIiItio2K/YoSDZhdix2K3ZhNipINis2K/Zitiv2KkiIiIKICAgICAgICBzZWxmLnBoYXNlID0gcGhhc2UKICAgICAgICBzZWxmLnRvdGFsX3NpemUgPSB0b3RhbF9zaXplCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgc2VsZi5zdGFydF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBzZWxmLmxhc3RfdXBkYXRlX3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIHNlbGYubGFzdF9wcm9ncmVzcyA9IDAKICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMgPSBbXQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfmoAg2KjYr9ihINmF2LHYrdmE2Kk6IHtwaGFzZX0iKQogICAgCiAgICBkZWYgdXBkYXRlKHNlbGYsIGN1cnJlbnQsIHRvdGFsPU5vbmUpOgogICAgICAgICIiItiq2K3Yr9mK2Ksg2KfZhNiq2YLYr9mFIiIiCiAgICAgICAgaWYgdG90YWw6CiAgICAgICAgICAgIHNlbGYudG90YWxfc2l6ZSA9IHRvdGFsCiAgICAgICAgc2VsZi5kb3dubG9hZGVkX3NpemUgPSBjdXJyZW50CiAgICAgICAgCiAgICAgICAgY3VycmVudF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID0gY3VycmVudF90aW1lIC0gc2VsZi5sYXN0X3VwZGF0ZV90aW1lCiAgICAgICAgCiAgICAgICAgIyDZg9i02YEg2KfZhNiq2KPYrtmK2LEKICAgICAgICBpZiB0aW1lX3NpbmNlX2xhc3RfdXBkYXRlID4gNTogICMg2KPZg9ir2LEg2YXZhiA1INir2YjYp9mG2Y0g2KjYr9mI2YYg2KrYrdiv2YrYqwogICAgICAgICAgICBwcm9ncmVzc19jaGFuZ2UgPSBjdXJyZW50IC0gc2VsZi5sYXN0X3Byb2dyZXNzCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBwcm9ncmVzc19jaGFuZ2UgPT0gMDoKICAgICAgICAgICAgICAgIHJlYXNvbiA9ICLimqDvuI8g2YTYpyDYqtmI2KzYryDYrdix2YPYqSAtINix2KjZhdinINmF2LTZg9mE2Kkg2YHZiiDYp9mE2LTYqNmD2KkiCiAgICAgICAgICAgICAgICBzZWxmLmRlbGF5X3JlYXNvbnMuYXBwZW5kKHJlYXNvbikKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhyZWFzb24sICJXQVJOSU5HIikKICAgICAgICAgICAgZWxpZiBwcm9ncmVzc19jaGFuZ2UgPCAxMDI0ICogMTAwOiAgIyDYo9mC2YQg2YXZhiAxMDBLQgogICAgICAgICAgICAgICAgcmVhc29uID0gZiLwn5CMINiz2LHYudipINio2LfZitim2Kkg2KzYr9in2YsgLSB7cHJvZ3Jlc3NfY2hhbmdlIC8gMTAyNDouMmZ9IEtCINmB2Yoge3RpbWVfc2luY2VfbGFzdF91cGRhdGU6LjFmfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgc2VsZi5kZWxheV9yZWFzb25zLmFwcGVuZChyZWFzb24pCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2cocmVhc29uLCAiV0FSTklORyIpCiAgICAgICAgCiAgICAgICAgc2VsZi5sYXN0X3VwZGF0ZV90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgc2VsZi5sYXN0X3Byb2dyZXNzID0gY3VycmVudAogICAgCiAgICBkZWYgZ2V0X3Byb2dyZXNzX3RleHQoc2VsZik6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhti1INin2YTYqtmC2K/ZhSIiIgogICAgICAgIGlmIHNlbGYudG90YWxfc2l6ZSA+IDA6CiAgICAgICAgICAgIHBlcmNlbnRhZ2UgPSAoc2VsZi5kb3dubG9hZGVkX3NpemUgLyBzZWxmLnRvdGFsX3NpemUpICogMTAwCiAgICAgICAgICAgIGRvd25sb2FkZWRfbWIgPSBzZWxmLmRvd25sb2FkZWRfc2l6ZSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgIHRvdGFsX21iID0gc2VsZi50b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHNlbGYuc3RhcnRfdGltZQogICAgICAgICAgICBpZiBzZWxmLmRvd25sb2FkZWRfc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICBzcGVlZCA9IHNlbGYuZG93bmxvYWRlZF9zaXplIC8gZWxhcHNlZAogICAgICAgICAgICAgICAgc3BlZWRfbWIgPSBzcGVlZCAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICByZW1haW5pbmdfYnl0ZXMgPSBzZWxmLnRvdGFsX3NpemUgLSBzZWxmLmRvd25sb2FkZWRfc2l6ZQogICAgICAgICAgICAgICAgZXRhID0gcmVtYWluaW5nX2J5dGVzIC8gc3BlZWQgaWYgc3BlZWQgPiAwIGVsc2UgMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIGYi8J+TpSB7c2VsZi5waGFzZX1cbiIKICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNiq2YLYr9mFOiB7cGVyY2VudGFnZTouMWZ9JVxuIgogICAgICAgICAgICAgICAgICAgIGYi8J+TpiB7ZG93bmxvYWRlZF9tYjouMWZ9IC8ge3RvdGFsX21iOi4xZn0g2YXZitis2KfYqNin2YrYqlxuIgogICAgICAgICAgICAgICAgICAgIGYi4pqhINin2YTYs9ix2LnYqToge3NwZWVkX21iOi4yZn0g2YXZitis2KfYqNin2YrYqi/Yq9in2YbZitipXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7HvuI8g2KfZhNmI2YLYqiDYp9mE2YXYqtio2YLZijoge2ludChldGEpfSDYq9in2YbZitipIgogICAgICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIHJldHVybiBmIuKPsyB7c2VsZi5waGFzZX0uLi4iCiAgICAKICAgIGRlZiBnZXRfZGVsYXlfc3VtbWFyeShzZWxmKToKICAgICAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2YTYrti1INin2YTYqtij2K7Zitix2KfYqiIiIgogICAgICAgIGlmIHNlbGYuZGVsYXlfcmVhc29uczoKICAgICAgICAgICAgcmV0dXJuICLwn5SNINij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LE6XG4iICsgIlxuIi5qb2luKGYiICDigKIge3J9IiBmb3IgciBpbiBzZWxmLmRlbGF5X3JlYXNvbnNbLTM6XSkKICAgICAgICByZXR1cm4gIiIKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIPCfjqwg2YHYptipINi22KfYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdit2LPZkdmG2KkKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CgpjbGFzcyBWaWRlb0NvbXByZXNzb3I6CiAgICAiIiLZgdim2Kkg2LTYp9mF2YTYqSDZhNiq2K3ZhdmK2YQg2YjYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KjYs9ix2LnYqSDZgdin2KbZgtipIiIiCiAgICAKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0ZW1wX2Rpcj1URU1QX0RJUiwgbG9nZ2VyPU5vbmUpOgogICAgICAgICIiItiq2YfZitim2Kkg2KfZhNi22KfYuti3IiIiCiAgICAgICAgc2VsZi50ZW1wX2RpciA9IFBhdGgodGVtcF9kaXIpCiAgICAgICAgc2VsZi50ZW1wX2Rpci5ta2RpcihleGlzdF9vaz1UcnVlKQogICAgICAgIHNlbGYubG9nZ2VyID0gbG9nZ2VyCiAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyID0gUHJvZ3Jlc3NNYW5hZ2VyKGxvZ2dlcikKICAgICAgICBsb2dnZXIubG9nKGYi8J+TgSDYqtmFINil2YbYtNin2KEg2YXYrNmE2K8g2YXYpNmC2Ko6IHtzZWxmLnRlbXBfZGlyfSIpCiAgICAKICAgIGRlZiBleHRyYWN0X2dvb2dsZV9kcml2ZV9pZChzZWxmLCB1cmwpOgogICAgICAgICIiItin2LPYqtiu2LHYp9isINmF2LnYsdmBINin2YTZhdmE2YEg2YXZhiDYsdin2KjYtyBHb29nbGUgRHJpdmUiIiIKICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgcidpZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcicvZC8oW2EtekEtWjAtOV8tXSspJywKICAgICAgICAgICAgcidvcGVuXD9pZD0oW2EtekEtWjAtOV8tXSspJywKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIHVybCkKICAgICAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2guZ3JvdXAoMSkKICAgICAgICByZXR1cm4gTm9uZQogICAgCiAgICBkZWYgZ2V0X2dvb2dsZV9kcml2ZV9kb3dubG9hZF91cmwoc2VsZiwgZmlsZV9pZCk6CiAgICAgICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsSDZhdmGIEdvb2dsZSBEcml2ZSIiIgogICAgICAgIHJldHVybiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkJmNvbmZpcm09dCIKICAgIAogICAgZGVmIF9kb3dubG9hZF9mcm9tX2dvb2dsZV9kcml2ZShzZWxmLCBmaWxlX2lkLCBvdXRwdXRfcGF0aCwgY2h1bmtfc2l6ZT02NTUzNik6CiAgICAgICAgIiIiCiAgICAgICAg2KrYrdmF2YrZhCDYs9ix2YrYuSDZhdmGIEdvb2dsZSBEcml2ZSDZhdi5INmF2LnYp9mE2KzYqSDYrNmF2YrYuSDYo9mG2YjYp9i5INin2YTZhdmE2YHYp9iqCiAgICAgICAgIiIiCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+UhCDZhdit2KfZiNmE2Kkg2KfZhNiq2K3ZhdmK2YQg2YXZhiBHb29nbGUgRHJpdmUuLi4iKQogICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDZhdmGIEdvb2dsZSBEcml2ZSIpCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINin2LPYqtiu2K/Yp9mFIGdkb3duINil2LDYpyDZg9in2YYg2YXYqtmI2YHYsdin2YsgKNij2LPYsdi5INi32LHZitmC2KkpCiAgICAgICAgICAgIGltcG9ydCBnZG93bgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIuKchSDYp9iz2KrYrtiv2KfZhSBnZG93biDZhNmE2KrYrdmF2YrZhCDYp9mE2LPYsdmK2LkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/aWQ9e2ZpbGVfaWR9IgogICAgICAgICAgICBvdXRwdXQgPSBnZG93bi5kb3dubG9hZCh1cmwsIHN0cihvdXRwdXRfcGF0aCksIHF1aWV0PUZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgb3V0cHV0IGlzIE5vbmU6CiAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCLZgdi02YQg2KfZhNiq2K3ZhdmK2YQg2KjYp9iz2KrYrtiv2KfZhSBnZG93biIpCiAgICAgICAgICAgIAogICAgICAgICAgICBmaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhCDYqNmG2KzYp9itISDYp9mE2K3YrNmFOiB7ZmluYWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3I6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygi4pqg77iPIGdkb3duINi62YrYsSDZhdiq2YjZgdix2Iwg2KfYs9iq2K7Yr9in2YUg2KfZhNi32LHZitmC2Kkg2KfZhNmK2K/ZiNmK2KkuLi4iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nX2Vycm9yKGUsICLYqtit2YXZitmEIGdkb3duIikKICAgICAgICAKICAgICAgICAjINin2YTYt9ix2YrZgtipINin2YTZitiv2YjZitipINin2YTZhdit2LPZkdmG2KkKICAgICAgICBzZXNzaW9uID0gcmVxdWVzdHMuU2Vzc2lvbigpCiAgICAgICAgCiAgICAgICAgYXR0ZW1wdHMgPSBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICd1cmwnOiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkJmNvbmZpcm09dCIsCiAgICAgICAgICAgICAgICAnbmFtZSc6ICdEaXJlY3Qgd2l0aCBjb25maXJtPXQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICd1cmwnOiBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9pZD17ZmlsZV9pZH0mZXhwb3J0PWRvd25sb2FkIiwKICAgICAgICAgICAgICAgICduYW1lJzogJ1dpdGggY29va2llcycsCiAgICAgICAgICAgICAgICAndXNlX2Nvb2tpZXMnOiBUcnVlCiAgICAgICAgICAgIH0sCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGZvciBhdHRlbXB0X251bSwgYXR0ZW1wdCBpbiBlbnVtZXJhdGUoYXR0ZW1wdHMsIDEpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5SEINin2YTZhdit2KfZiNmE2Kkge2F0dGVtcHRfbnVtfToge2F0dGVtcHRbJ25hbWUnXX0uLi4iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0LmdldCgndXNlX2Nvb2tpZXMnKToKICAgICAgICAgICAgICAgICAgICBpbml0X3Jlc3BvbnNlID0gc2Vzc2lvbi5nZXQoCiAgICAgICAgICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2lkPXtmaWxlX2lkfSIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbT1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTYwCiAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlc3Npb24uZ2V0KAogICAgICAgICAgICAgICAgICAgIGF0dGVtcHRbJ3VybCddLAogICAgICAgICAgICAgICAgICAgIHN0cmVhbT1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9MTIwLAogICAgICAgICAgICAgICAgICAgIGFsbG93X3JlZGlyZWN0cz1UcnVlCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNvbnRlbnRfdHlwZSA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LVR5cGUnLCAnJykKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgJ3RleHQvaHRtbCcgaW4gY29udGVudF90eXBlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyDYtdmB2K3YqSBIVE1MIC0g2YXYrdin2YjZhNipINin2LPYqtiu2LHYp9isINin2YTYsdin2KjYty4uLiIpCiAgICAgICAgICAgICAgICAgICAgY29udGVudCA9IHJlc3BvbnNlLnRleHQKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBwYXR0ZXJucyA9IFsKICAgICAgICAgICAgICAgICAgICAgICAgcidocmVmPSIoaHR0cHM6Ly9kcml2ZVwudXNlcmNvbnRlbnRcLmdvb2dsZVwuY29tL2Rvd25sb2FkW14iXSspIicsCiAgICAgICAgICAgICAgICAgICAgICAgIHInaHJlZj0iKC91Y1w/ZXhwb3J0PWRvd25sb2FkJmFtcDtjb25maXJtPVteIl0rJmFtcDtpZD0nICsgZmlsZV9pZCArIHInKSInLAogICAgICAgICAgICAgICAgICAgIF0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZF91cmwgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgZm9yIHBhdHRlcm4gaW4gcGF0dGVybnM6CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHBhdHRlcm4sIGNvbnRlbnQpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRfdXJsID0gbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRvd25sb2FkX3VybC5zdGFydHN3aXRoKCcvJyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRfdXJsID0gJ2h0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbScgKyBkb3dubG9hZF91cmwucmVwbGFjZSgnJmFtcDsnLCAnJicpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgZG93bmxvYWRfdXJsOgogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHNlc3Npb24uZ2V0KGRvd25sb2FkX3VybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MTIwKQogICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50X3R5cGUgPSByZXNwb25zZS5oZWFkZXJzLmdldCgnQ29udGVudC1UeXBlJywgJycpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgJ3RleHQvaHRtbCcgaW4gY29udGVudF90eXBlOgogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB0b3RhbF9zaXplID0gaW50KHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdjb250ZW50LWxlbmd0aCcsIDApKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB0b3RhbF9zaXplID4gMDoKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINit2KzZhSDYp9mE2YXZhNmBOiB7dG90YWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyLnN0YXJ0KCLYqtit2YXZitmEINin2YTZgdmK2K/ZitmIIiwgdG90YWxfc2l6ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYp9mE2KrYrdmF2YrZhCDYqNin2YTZgti32Lkg2KfZhNmD2KjZitix2KkgKNij2LPYsdi5KQogICAgICAgICAgICAgICAgZG93bmxvYWRlZF9zaXplID0gMAogICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHdpdGggb3BlbihvdXRwdXRfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBmb3IgY2h1bmsgaW4gcmVzcG9uc2UuaXRlcl9jb250ZW50KGNodW5rX3NpemU9Y2h1bmtfc2l6ZSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNodW5rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkZWRfc2l6ZSArPSBsZW4oY2h1bmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIudXBkYXRlKGRvd25sb2FkZWRfc2l6ZSwgdG90YWxfc2l6ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZWxhcHNlZCA9IHRpbWUudGltZSgpIC0gc3RhcnRfdGltZQogICAgICAgICAgICAgICAgZmluYWxfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShvdXRwdXRfcGF0aCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgZmluYWxfc2l6ZSA8IDEwMjQgKiAxMDA6CiAgICAgICAgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmItin2YTZhdmE2YEg2KfZhNmF2K3ZhdmEINi12LrZitixINis2K/Yp9mLICh7ZmluYWxfc2l6ZX0g2KjYp9mK2KopIC0g2YLYryDZitmD2YjZhiDYtdmB2K3YqSBIVE1MIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXZnX3NwZWVkID0gZmluYWxfc2l6ZSAvIGVsYXBzZWQgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQg2KjZhtis2KfYrSEiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDYp9mE2K3YrNmFOiB7ZmluYWxfc2l6ZSAvIDEwMjQgLyAxMDI0Oi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimqEg2YXYqtmI2LPYtyDYp9mE2LPYsdi52Kk6IHthdmdfc3BlZWQ6LjJmfSDZhdmK2KzYp9io2KfZitiqL9ir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZ19lcnJvcihlLCBmItmF2K3Yp9mI2YTYqSDYp9mE2KrYrdmF2YrZhCB7YXR0ZW1wdF9udW19IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgCiAgICAgICAgcmFpc2UgRXhjZXB0aW9uKCLZgdi02YQg2KrYrdmF2YrZhCDYp9mE2YXZhNmBINmF2YYgR29vZ2xlIERyaXZlINio2LnYryDYrNmF2YrYuSDYp9mE2YXYrdin2YjZhNin2KoiKQogICAgCiAgICBkZWYgZG93bmxvYWRfdmlkZW8oc2VsZiwgdXJsLCBvdXRwdXRfcGF0aCk6CiAgICAgICAgIiIi2KrYrdmF2YrZhCDZgdmK2K/ZitmIINmF2YYg2KPZiiDYsdin2KjYtyIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Ug2KjYr9ihINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflJcg2KfZhNix2KfYqNi3OiB7dXJsWzoxMDBdfS4uLiIpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDZhtmI2Lkg2KfZhNix2KfYqNi3CiAgICAgICAgZmlsZV9pZCA9IHNlbGYuZXh0cmFjdF9nb29nbGVfZHJpdmVfaWQodXJsKQogICAgICAgIAogICAgICAgIGlmIGZpbGVfaWQ6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflI0g2KrZhSDYp9mD2KrYtNin2YEg2LHYp9io2LcgR29vZ2xlIERyaXZlOiB7ZmlsZV9pZH0iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZG93bmxvYWRfZnJvbV9nb29nbGVfZHJpdmUoZmlsZV9pZCwgb3V0cHV0X3BhdGgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgIyDYsdin2KjYtyDYqtit2YXZitmEINmF2KjYp9i02LEgLSDZhtis2LHYqCBGRm1wZWcg2KPZiNmE2KfZiyDZhNij2YbZhyDZitiq2LnYp9mF2YQg2YXYuSDYp9mE2YAgc3RyZWFtcyDYqNi02YPZhCDYo9mB2LbZhAogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5SXINix2KfYqNi3INiq2K3ZhdmK2YQg2YXYqNin2LTYsSIpCiAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci5zdGFydCgi2KrYrdmF2YrZhCDZhdmGINix2KfYqNi3INmF2KjYp9i02LEiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyA9PT09PSDYp9mE2LfYsdmK2YLYqSDYp9mE2KPZiNmE2Yk6IEZGbXBlZyAo2KfZhNij2YHYttmEINmE2YTZgCBzdHJlYW1zKSA9PT09PQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIvCfjqwg2YXYrdin2YjZhNipINin2YTYqtit2YXZitmEINi52KjYsSBGRm1wZWcgKNmF2KvYp9mE2Yog2YTZhNmAIHN0cmVhbXMpLi4uIikKICAgICAgICAgICAgaWYgc2VsZi5fZG93bmxvYWRfd2l0aF9mZm1wZWcodXJsLCBvdXRwdXRfcGF0aCk6CiAgICAgICAgICAgICAgICBmaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQg2LnYqNixIEZGbXBlZyEg2KfZhNit2KzZhToge2ZpbmFsX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAgICAgcmV0dXJuIHN0cihvdXRwdXRfcGF0aCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgPT09PT0g2KfZhNi32LHZitmC2Kkg2KfZhNir2KfZhtmK2Kk6IHJlcXVlc3RzINmF2LkgUmV0cnkgPT09PT0KICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCLimqDvuI8gRkZtcGVnINmB2LTZhNiMINmF2K3Yp9mI2YTYqSDYp9mE2KrYrdmF2YrZhCDYudio2LEgcmVxdWVzdHMuLi4iKQogICAgICAgICAgICByZXR1cm4gc2VsZi5fZG93bmxvYWRfd2l0aF9yZXF1ZXN0cyh1cmwsIG91dHB1dF9wYXRoKQogICAgCiAgICBkZWYgX2Rvd25sb2FkX3dpdGhfZmZtcGVnKHNlbGYsIHVybCwgb3V0cHV0X3BhdGgpOgogICAgICAgICIiIgogICAgICAgINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2Ygg2KjYp9iz2KrYrtiv2KfZhSBGRm1wZWcgLSDZitiq2LnYp9mF2YQg2YXYuSDYp9mE2YAgc3RyZWFtcyDZiNin2YTYp9mG2YLYt9in2LnYp9iqINiq2YTZgtin2KbZitin2YsKICAgICAgICAiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgIGNtZCA9IFsKICAgICAgICAgICAgICAgICdmZm1wZWcnLAogICAgICAgICAgICAgICAgIyDYpdi52K/Yp9iv2KfYqiDYpdi52KfYr9ipINin2YTYp9iq2LXYp9mEINin2YTYqtmE2YLYp9im2YrYqQogICAgICAgICAgICAgICAgJy1yZWNvbm5lY3QnLCAnMScsCiAgICAgICAgICAgICAgICAnLXJlY29ubmVjdF9zdHJlYW1lZCcsICcxJywKICAgICAgICAgICAgICAgICctcmVjb25uZWN0X2RlbGF5X21heCcsICcxMCcsCiAgICAgICAgICAgICAgICAnLXJlY29ubmVjdF9hdF9lb2YnLCAnMScsCiAgICAgICAgICAgICAgICAjIHRpbWVvdXQg2YTZhNin2KrYtdin2YQKICAgICAgICAgICAgICAgICctdGltZW91dCcsICczMDAwMDAwMCcsICAgIyAzMCDYq9in2YbZitipINio2KfZhNmF2YrZg9ix2YjYq9in2YbZitipCiAgICAgICAgICAgICAgICAnLXJ3X3RpbWVvdXQnLCAnMzAwMDAwMDAnLAogICAgICAgICAgICAgICAgJy1pJywgdXJsLAogICAgICAgICAgICAgICAgIyDZhtiz2K4g2KjYr9mI2YYg2LbYuti3ICjYo9iz2LHYuSkKICAgICAgICAgICAgICAgICctYycsICdjb3B5JywKICAgICAgICAgICAgICAgICcteScsCiAgICAgICAgICAgICAgICBzdHIob3V0cHV0X3BhdGgpCiAgICAgICAgICAgIF0KICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKame+4jyDYo9mF2LEgRkZtcGVnINmE2YTYqtit2YXZitmEOiBmZm1wZWcgLXJlY29ubmVjdCAxIC1pIDx1cmw+IC1jIGNvcHkgLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHByb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKAogICAgICAgICAgICAgICAgY21kLAogICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlBJUEUsCiAgICAgICAgICAgICAgICB1bml2ZXJzYWxfbmV3bGluZXM9VHJ1ZQogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINmF2LHYp9mC2KjYqSDYp9mE2KrZgtiv2YUg2YXZhiBzdGRlcnIKICAgICAgICAgICAgbGFzdF9sb2dfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIGZvciBsaW5lIGluIHByb2Nlc3Muc3RkZXJyOgogICAgICAgICAgICAgICAgIyDYqtiz2KzZitmEINmD2YQgMTAg2KvZiNin2YbZjQogICAgICAgICAgICAgICAgaWYgdGltZS50aW1lKCkgLSBsYXN0X2xvZ190aW1lID4gMTA6CiAgICAgICAgICAgICAgICAgICAgaWYgJ3RpbWU9JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OlIEZGbXBlZzoge2xpbmUuc3RyaXAoKVs6ODBdfSIpCiAgICAgICAgICAgICAgICAgICAgbGFzdF9sb2dfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcm9jZXNzLndhaXQodGltZW91dD0xODAwKSAgIyDYp9mG2KrYuNin2LEg2K3YqtmJIDMwINiv2YLZitmC2KkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHByb2Nlc3MucmV0dXJuY29kZSA9PSAwIGFuZCBvcy5wYXRoLmV4aXN0cyhvdXRwdXRfcGF0aCk6CiAgICAgICAgICAgICAgICBzaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgaWYgc2l6ZSA+IDEwMjQgKiAxMDA6ICAjINij2YPYqNixINmF2YYgMTAwS0IKICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPIEZGbXBlZyDYp9mG2KrZh9mJINio2YPZiNivOiB7cHJvY2Vzcy5yZXR1cm5jb2RlfSIsICJXQVJOSU5HIikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIAogICAgICAgIGV4Y2VwdCBzdWJwcm9jZXNzLlRpbWVvdXRFeHBpcmVkOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIuKaoO+4jyBGRm1wZWcg2KrYrNin2YjYsiDZiNmC2Kog2KfZhNin2YbYqti42KfYsSIsICJXQVJOSU5HIikKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcHJvY2Vzcy5raWxsKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyDYrti32KMg2YHZiiBGRm1wZWc6IHtzdHIoZSlbOjEwMF19IiwgIldBUk5JTkciKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgZGVmIF9kb3dubG9hZF93aXRoX3JlcXVlc3RzKHNlbGYsIHVybCwgb3V0cHV0X3BhdGgpOgogICAgICAgICIiIgogICAgICAgINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2Ygg2KjYp9iz2KrYrtiv2KfZhSByZXF1ZXN0cyDZhdi5IFJldHJ5IC0g2YTZhNmF2YTZgdin2Kog2KfZhNi52KfYr9mK2KkKICAgICAgICAiIiIKICAgICAgICBNQVhfUkVUUklFUyA9IDUKICAgICAgICBDSFVOS19TSVpFID0gMTAyNCAqIDEwMjQgICMgMU1CIGNodW5rcyDYqNiv2YQgNjRLQiAo2KPYs9ix2LkpCiAgICAgICAgZG93bmxvYWRlZF9zaXplID0gMAogICAgICAgIHRvdGFsX3NpemUgPSAwCiAgICAgICAgCiAgICAgICAgIyDYrdiw2YEg2KfZhNmF2YTZgSDYp9mE2YLYr9mK2YUg2KXYsNinINmD2KfZhiDZhdmI2KzZiNiv2KfZiyDZhdmGINmF2K3Yp9mI2YTYqSDYs9in2KjZgtipCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3V0cHV0X3BhdGgpOgogICAgICAgICAgICBvcy5yZW1vdmUob3V0cHV0X3BhdGgpCiAgICAgICAgCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UoMSwgTUFYX1JFVFJJRVMgKyAxKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg2KfYs9iq2YPZhdin2YQg2KfZhNiq2K3ZhdmK2YQg2KXYsNinINmD2KfZhiDYrNiy2KEg2YXYrdmF2YQgKNmB2YLYtyDYpdiw2Kcg2KfZhNiz2YrYsdmB2LEg2YrYr9i52YXZhykKICAgICAgICAgICAgICAgIGlmIGRvd25sb2FkZWRfc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1snUmFuZ2UnXSA9IGYnYnl0ZXM9e2Rvd25sb2FkZWRfc2l6ZX0tJwogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflIQg2YXYrdin2YjZhNipIHthdHRlbXB0fS97TUFYX1JFVFJJRVN9IC0g2KfYs9iq2YPZhdin2YQg2YXZhiB7ZG93bmxvYWRlZF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSBNQi4uLiIpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCflIQg2YXYrdin2YjZhNipIHthdHRlbXB0fS97TUFYX1JFVFJJRVN9Li4uIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIHN0cmVhbT1UcnVlLAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9KDEwLCA2MCksICAjIChjb25uZWN0IHRpbWVvdXQsIHJlYWQgdGltZW91dCkKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYpdiw2Kcg2KfZhNiz2YrYsdmB2LEg2LHZgdi2IFJhbmdlICg1MDMvNDE2KdiMINin2KjYr9ijINmF2YYg2KfZhNio2K/Yp9mK2KkKICAgICAgICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1c19jb2RlIGluICg1MDMsIDQxNik6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPINin2YTYs9mK2LHZgdixINmE2Kcg2YrYr9i52YUg2KfZhNin2LPYqtmD2YXYp9mEICjZg9mI2K8ge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSkgLSDYpdi52KfYr9ipINin2YTYqNiv2KEg2YXZhiDYp9mE2LXZgdixIikKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZGVkX3NpemUgPSAwCiAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMob3V0cHV0X3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUob3V0cHV0X3BhdGgpCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycy5wb3AoJ1JhbmdlJywgTm9uZSkKICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PSgxMCwgNjApLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJlc3BvbnNlLnJhaXNlX2Zvcl9zdGF0dXMoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiB0b3RhbF9zaXplID09IDA6CiAgICAgICAgICAgICAgICAgICAgY29udGVudF9sZW5ndGggPSByZXNwb25zZS5oZWFkZXJzLmdldCgnY29udGVudC1sZW5ndGgnLCAwKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX3NpemUgPSBpbnQoY29udGVudF9sZW5ndGgpCiAgICAgICAgICAgICAgICAgICAgaWYgdG90YWxfc2l6ZSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2K3YrNmFINin2YTZhdmE2YE6IHt0b3RhbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5wcm9ncmVzc19tYW5hZ2VyLnN0YXJ0KCLYqtit2YXZitmEINin2YTZgdmK2K/ZitmIIiwgdG90YWxfc2l6ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd3JpdGVfbW9kZSA9ICdhYicgaWYgZG93bmxvYWRlZF9zaXplID4gMCBlbHNlICd3YicKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKG91dHB1dF9wYXRoLCB3cml0ZV9tb2RlKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiByZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT1DSFVOS19TSVpFKToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGNodW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRlZF9zaXplICs9IGxlbihjaHVuaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJvZ3Jlc3NfbWFuYWdlci51cGRhdGUoZG93bmxvYWRlZF9zaXplLCB0b3RhbF9zaXplKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgaWYgdG90YWxfc2l6ZSA+IDAgYW5kIGZpbmFsX3NpemUgPCB0b3RhbF9zaXplICogMC45OToKICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiLYp9mE2KrYrdmF2YrZhCDYutmK2LEg2YXZg9iq2YXZhDoge2ZpbmFsX3NpemUgLyAxMDI0IC8gMTAyNDouMWZ9INmF2YYge3RvdGFsX3NpemUgLyAxMDI0IC8gMTAyNDouMWZ9IE1CIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQhINin2YTYrdis2YU6IHtmaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICAgICAgICAgIHJldHVybiBzdHIob3V0cHV0X3BhdGgpCiAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBlcnJfbXNnID0gc3RyKGUpWzoxMjBdCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimqDvuI8g2YHYtNmE2Kog2KfZhNmF2K3Yp9mI2YTYqSB7YXR0ZW1wdH06IHtlcnJfbXNnfSIsICJXQVJOSU5HIikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYpdiw2Kcg2KfZhNiz2YrYsdmB2LEg2YrYudi32YogNTAzINio2KfYs9iq2YXYsdin2LHYjCDZhNinINmB2KfYptiv2Kkg2YXZhiDYp9mE2KfYs9iq2YPZhdin2YQKICAgICAgICAgICAgICAgIGlmICc1MDMnIGluIGVycl9tc2c6CiAgICAgICAgICAgICAgICAgICAgZG93bmxvYWRlZF9zaXplID0gMAogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKG91dHB1dF9wYXRoKToKICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKG91dHB1dF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgTUFYX1JFVFJJRVM6CiAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lID0gYXR0ZW1wdCAqIDUKICAgICAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLij7Mg2KfZhtiq2LjYp9ixIHt3YWl0X3RpbWV9INir2KfZhtmK2KkuLi4iKQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAod2FpdF90aW1lKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByYWlzZSBFeGNlcHRpb24oZiLZgdi02YQg2KfZhNiq2K3ZhdmK2YQg2KjYudivIHtNQVhfUkVUUklFU30g2YXYrdin2YjZhNin2Ko6IHtlcnJfbXNnfSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHN0cihvdXRwdXRfcGF0aCkKICAgIAogICAgZGVmIGdldF92aWRlb19pbmZvKHNlbGYsIHZpZGVvX3BhdGgpOgogICAgICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNmB2YrYr9mK2YgiIiIKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OKINis2KfYsdmKINmB2K3YtSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgCiAgICAgICAgY21kID0gWwogICAgICAgICAgICAnZmZwcm9iZScsCiAgICAgICAgICAgICctdicsICdxdWlldCcsCiAgICAgICAgICAgICctcHJpbnRfZm9ybWF0JywgJ2pzb24nLAogICAgICAgICAgICAnLXNob3dfZm9ybWF0JywKICAgICAgICAgICAgJy1zaG93X3N0cmVhbXMnLAogICAgICAgICAgICBzdHIodmlkZW9fcGF0aCkKICAgICAgICBdCiAgICAgICAgCiAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgaW5mbyA9IGpzb24ubG9hZHMocmVzdWx0LnN0ZG91dCkKICAgICAgICAKICAgICAgICAjINin2LPYqtiu2LHYp9isINin2YTZhdi52YTZiNmF2KfYqgogICAgICAgIGR1cmF0aW9uID0gZmxvYXQoaW5mb1snZm9ybWF0J10uZ2V0KCdkdXJhdGlvbicsIDApKQogICAgICAgIHNpemUgPSBpbnQoaW5mb1snZm9ybWF0J10uZ2V0KCdzaXplJywgMCkpCiAgICAgICAgCiAgICAgICAgdmlkZW9fc3RyZWFtID0gbmV4dCgocyBmb3IgcyBpbiBpbmZvWydzdHJlYW1zJ10gaWYgc1snY29kZWNfdHlwZSddID09ICd2aWRlbycpLCBOb25lKQogICAgICAgIAogICAgICAgIGlmIHZpZGVvX3N0cmVhbToKICAgICAgICAgICAgd2lkdGggPSBpbnQodmlkZW9fc3RyZWFtLmdldCgnd2lkdGgnLCAwKSkKICAgICAgICAgICAgaGVpZ2h0ID0gaW50KHZpZGVvX3N0cmVhbS5nZXQoJ2hlaWdodCcsIDApKQogICAgICAgICAgICBiaXRyYXRlID0gaW50KGluZm9bJ2Zvcm1hdCddLmdldCgnYml0X3JhdGUnLCAwKSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk7kg2KfZhNij2KjYudin2K86IHt3aWR0aH14e2hlaWdodH0iKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLij7HvuI8g2KfZhNmF2K/YqToge2R1cmF0aW9uOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk6Yg2KfZhNit2KzZhToge3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLimqEg2YXYudiv2YQg2KfZhNio2Ko6IHtiaXRyYXRlIC8gMTAwMDouMGZ9INmD2YrZhNmI2KjYqi/Yq9in2YbZitipIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbiwKICAgICAgICAgICAgICAgICdzaXplJzogc2l6ZSwKICAgICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRoLAogICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCwKICAgICAgICAgICAgICAgICdiaXRyYXRlJzogYml0cmF0ZQogICAgICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcmFpc2UgVmFsdWVFcnJvcigi2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YHZitiv2YrZiCIpCiAgICAKICAgIGRlZiBjb21wcmVzc192aWRlbyhzZWxmLCBpbnB1dF9wYXRoLCBvdXRwdXRfcGF0aCwgcXVhbGl0eT0nbWVkaXVtJyk6CiAgICAgICAgIiIiCiAgICAgICAg2LbYuti3INin2YTZgdmK2K/ZitmIINio2LPYsdi52Kkg2YHYp9im2YLYqSDZiNit2KzZhSDYtdi62YrYsSDYrNiv2KfZiwogICAgICAgIAogICAgICAgINmF2LPYqtmI2YrYp9iqINin2YTYrNmI2K/YqToKICAgICAgICAtIHVsdHJhX2xvdzog2K3YrNmFINi12LrZitixINis2K/Yp9mLIChDUkYgMzUsIDQ4MHAsINmF2LnYr9mEINil2LfYp9ix2KfYqiDZhdmG2K7Zgdi2KQogICAgICAgIC0gbG93OiDYrdis2YUg2LXYutmK2LEgKENSRiAzMiwgNzIwcCkKICAgICAgICAtIG1lZGl1bTog2YXYqtmI2KfYstmGIChDUkYgMjgsIDcyMHApCiAgICAgICAgLSBoaWdoOiDYrNmI2K/YqSDYudin2YTZitipIChDUkYgMjMsIDEwODBwKQogICAgICAgICIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfjqwg2KjYr9ihINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TiiDZhdiz2KrZiNmJINin2YTYrNmI2K/YqToge3F1YWxpdHl9IikKICAgICAgICBzZWxmLnByb2dyZXNzX21hbmFnZXIuc3RhcnQoIti22LrYtyDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgCiAgICAgICAgIyDYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZgdmK2K/ZitmICiAgICAgICAgdmlkZW9faW5mbyA9IHNlbGYuZ2V0X3ZpZGVvX2luZm8oaW5wdXRfcGF0aCkKICAgICAgICBkdXJhdGlvbiA9IHZpZGVvX2luZm9bJ2R1cmF0aW9uJ10KICAgICAgICAKICAgICAgICAjINil2LnYr9in2K/Yp9iqINin2YTYrNmI2K/YqSDYp9mE2YXYrdiz2ZHZhtipCiAgICAgICAgcXVhbGl0eV9zZXR0aW5ncyA9IHsKICAgICAgICAgICAgJ25hbm8nOiB7CiAgICAgICAgICAgICAgICAnY3JmJzogJzQyJywKICAgICAgICAgICAgICAgICdwcmVzZXQnOiAndWx0cmFmYXN0JywKICAgICAgICAgICAgICAgICdzY2FsZSc6ICc0MjY6LTInLAogICAgICAgICAgICAgICAgJ2Zwcyc6ICc4JywKICAgICAgICAgICAgICAgICdhdWRpb19iaXRyYXRlJzogJzE2aycsCiAgICAgICAgICAgICAgICAndmNvZGVjJzogJ2xpYngyNjQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICd1bHRyYV9sb3cnOiB7CiAgICAgICAgICAgICAgICAnY3JmJzogJzM1JywKICAgICAgICAgICAgICAgICdwcmVzZXQnOiAndmVyeWZhc3QnLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzY0MDotMicsCiAgICAgICAgICAgICAgICAnZnBzJzogJzE1JywKICAgICAgICAgICAgICAgICdhdWRpb19iaXRyYXRlJzogJzMyaycsCiAgICAgICAgICAgICAgICAndmNvZGVjJzogJ2xpYngyNjQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdsb3cnOiB7CiAgICAgICAgICAgICAgICAnY3JmJzogJzMyJywKICAgICAgICAgICAgICAgICdwcmVzZXQnOiAndmVyeWZhc3QnLAogICAgICAgICAgICAgICAgJ3NjYWxlJzogJzg1NDotMicsCiAgICAgICAgICAgICAgICAnZnBzJzogJzI0JywKICAgICAgICAgICAgICAgICdhdWRpb19iaXRyYXRlJzogJzY0aycsCiAgICAgICAgICAgICAgICAndmNvZGVjJzogJ2xpYngyNjQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdtZWRpdW0nOiB7CiAgICAgICAgICAgICAgICAnY3JmJzogJzI4JywKICAgICAgICAgICAgICAgICdwcmVzZXQnOiAnZmFzdCcsCiAgICAgICAgICAgICAgICAnc2NhbGUnOiAnMTI4MDotMicsCiAgICAgICAgICAgICAgICAnZnBzJzogJzMwJywKICAgICAgICAgICAgICAgICdhdWRpb19iaXRyYXRlJzogJzk2aycsCiAgICAgICAgICAgICAgICAndmNvZGVjJzogJ2xpYngyNjQnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdoaWdoJzogewogICAgICAgICAgICAgICAgJ2NyZic6ICcyMycsCiAgICAgICAgICAgICAgICAncHJlc2V0JzogJ21lZGl1bScsCiAgICAgICAgICAgICAgICAnc2NhbGUnOiAnMTkyMDotMicsCiAgICAgICAgICAgICAgICAnZnBzJzogJzMwJywKICAgICAgICAgICAgICAgICdhdWRpb19iaXRyYXRlJzogJzEyOGsnLAogICAgICAgICAgICAgICAgJ3Zjb2RlYyc6ICdsaWJ4MjY0JwogICAgICAgICAgICB9LAogICAgICAgIH0KICAgICAgICAKICAgICAgICBzZXR0aW5ncyA9IHF1YWxpdHlfc2V0dGluZ3MuZ2V0KHF1YWxpdHksIHF1YWxpdHlfc2V0dGluZ3NbJ21lZGl1bSddKQogICAgICAgIAogICAgICAgICMg2KjZhtin2KEg2KPZhdixIEZGbXBlZyDYp9mE2YXYrdiz2ZHZhgogICAgICAgIGNtZCA9IFsKICAgICAgICAgICAgJ2ZmbXBlZycsCiAgICAgICAgICAgICctaScsIHN0cihpbnB1dF9wYXRoKSwKICAgICAgICAgICAgJy1jOnYnLCBzZXR0aW5nc1sndmNvZGVjJ10sCiAgICAgICAgICAgICctcHJlc2V0Jywgc2V0dGluZ3NbJ3ByZXNldCddLAogICAgICAgICAgICAnLWNyZicsIHNldHRpbmdzWydjcmYnXSwKICAgICAgICAgICAgJy12ZicsIGYic2NhbGU9e3NldHRpbmdzWydzY2FsZSddfSxmcHM9e3NldHRpbmdzWydmcHMnXX0iLAogICAgICAgICAgICAnLWM6YScsICdhYWMnLAogICAgICAgICAgICAnLWI6YScsIHNldHRpbmdzWydhdWRpb19iaXRyYXRlJ10sCiAgICAgICAgICAgICctYWMnLCAnMScsICAjINij2K3Yp9iv2Yog2KfZhNmC2YbYp9ipIChtb25vKSDZhNiq2YLZhNmK2YQg2KfZhNit2KzZhQogICAgICAgICAgICAnLW1vdmZsYWdzJywgJytmYXN0c3RhcnQnLAogICAgICAgICAgICAnLXknLAogICAgICAgICAgICBzdHIob3V0cHV0X3BhdGgpCiAgICAgICAgXQogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKame+4jyDYo9mF2LEgRkZtcGVnOiB7JyAnLmpvaW4oY21kKX0iKQogICAgICAgIAogICAgICAgICMg2KrYtNi62YrZhCBGRm1wZWcg2YXYuSDZhdix2KfZgtio2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oCiAgICAgICAgICAgIGNtZCwKICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuUElQRSwKICAgICAgICAgICAgdW5pdmVyc2FsX25ld2xpbmVzPVRydWUKICAgICAgICApCiAgICAgICAgCiAgICAgICAgIyDZhdix2KfZgtio2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgbGFzdF90aW1lID0gdGltZS50aW1lKCkKICAgICAgICBmb3IgbGluZSBpbiBwcm9jZXNzLnN0ZGVycjoKICAgICAgICAgICAgaWYgJ3RpbWU9JyBpbiBsaW5lOgogICAgICAgICAgICAgICAgbWF0Y2ggPSByZS5zZWFyY2gocid0aW1lPShcZCspOihcZCspOihcZCspJywgbGluZSkKICAgICAgICAgICAgICAgIGlmIG1hdGNoOgogICAgICAgICAgICAgICAgICAgIGgsIG0sIHMgPSBtYXAoaW50LCBtYXRjaC5ncm91cHMoKSkKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBoICogMzYwMCArIG0gKiA2MCArIHMKICAgICAgICAgICAgICAgICAgICBwcm9ncmVzcyA9IChjdXJyZW50X3RpbWUgLyBkdXJhdGlvbikgKiAxMDAgaWYgZHVyYXRpb24gPiAwIGVsc2UgMAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KrYrdiv2YrYqyDZg9mEIDMg2KvZiNin2YbZjQogICAgICAgICAgICAgICAgICAgIGlmIHRpbWUudGltZSgpIC0gbGFzdF90aW1lID4gMzoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+OrCDYqtmC2K/ZhSDYp9mE2LbYuti3OiB7cHJvZ3Jlc3M6LjFmfSUgKHtjdXJyZW50X3RpbWU6LjBmfS97ZHVyYXRpb246LjBmfSDYq9in2YbZitipKSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgCiAgICAgICAgcHJvY2Vzcy53YWl0KCkKICAgICAgICAKICAgICAgICBpZiBwcm9jZXNzLnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgZXJyb3Jfb3V0cHV0ID0gcHJvY2Vzcy5zdGRlcnIucmVhZCgpIGlmIHByb2Nlc3Muc3RkZXJyIGVsc2UgIlVua25vd24gZXJyb3IiCiAgICAgICAgICAgIHJhaXNlIEV4Y2VwdGlvbihmItmB2LTZhCDYtti62Lcg2KfZhNmB2YrYr9mK2Yg6IHtlcnJvcl9vdXRwdXR9IikKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINmG2LPYqNipINin2YTYtti62LcKICAgICAgICBvcmlnaW5hbF9zaXplID0gb3MucGF0aC5nZXRzaXplKGlucHV0X3BhdGgpCiAgICAgICAgY29tcHJlc3NlZF9zaXplID0gb3MucGF0aC5nZXRzaXplKG91dHB1dF9wYXRoKQogICAgICAgIGNvbXByZXNzaW9uX3JhdGlvID0gKDEgLSBjb21wcmVzc2VkX3NpemUgLyBvcmlnaW5hbF9zaXplKSAqIDEwMAogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSEiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2KfZhNit2KzZhSDYp9mE2KPYtdmE2Yo6IHtvcmlnaW5hbF9zaXplIC8gMTAyNCAvIDEwMjQ6LjJmfSDZhdmK2KzYp9io2KfZitiqIikKICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLwn5OmINin2YTYrdis2YUg2KfZhNmF2LbYutmI2Lc6IHtjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNDouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4kg2YbYs9io2Kkg2KfZhNi22LrYtzoge2NvbXByZXNzaW9uX3JhdGlvOi4xZn0lIikKICAgICAgICAKICAgICAgICByZXR1cm4gc3RyKG91dHB1dF9wYXRoKQogICAgCiAgICBkZWYgc3BsaXRfdmlkZW8oc2VsZiwgaW5wdXRfcGF0aCwgbWF4X3NpemVfbWI9TUFYX1RFTEVHUkFNX1NJWkVfTUIpOgogICAgICAgICIiItiq2YLYs9mK2YUg2KfZhNmB2YrYr9mK2Ygg2KXZhNmJINij2KzYstin2KEg2LXYutmK2LHYqSIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKcgu+4jyDYqNiv2KEg2KrZgtiz2YrZhSDYp9mE2YHZitiv2YrZiC4uLiIpCiAgICAgICAgCiAgICAgICAgdmlkZW9faW5mbyA9IHNlbGYuZ2V0X3ZpZGVvX2luZm8oaW5wdXRfcGF0aCkKICAgICAgICBkdXJhdGlvbiA9IHZpZGVvX2luZm9bJ2R1cmF0aW9uJ10KICAgICAgICAKICAgICAgICAjIOKchSDYpdi12YTYp9itOiDYp9iz2KrYrtiv2KfZhSBvcy5wYXRoLmdldHNpemUg2KjYr9mE2KfZiyDZhdmGIGZmcHJvYmUg2YTYttmF2KfZhiDYp9mE2K3YrNmFINin2YTYtdit2YrYrQogICAgICAgIHRvdGFsX3NpemUgPSBvcy5wYXRoLmdldHNpemUoaW5wdXRfcGF0aCkKICAgICAgICAKICAgICAgICAjINit2LPYp9ioINi52K/YryDYp9mE2KPYrNiy2KfYoSDZhdi5INmH2KfZhdi0INij2YXYp9mGIDEwJQogICAgICAgIG1heF9zaXplX2J5dGVzID0gbWF4X3NpemVfbWIgKiAxMDI0ICogMTAyNCAqIDAuOQogICAgICAgIG51bV9wYXJ0cyA9IG1heCgyLCBpbnQodG90YWxfc2l6ZSAvIG1heF9zaXplX2J5dGVzKSArIDEpCiAgICAgICAgCiAgICAgICAgIyDYsdmB2Lkg2KfZhNit2K8g2KrZhNmC2KfYptmK2KfZiyDYpdiw2Kcg2YTYstmFCiAgICAgICAgaWYgbnVtX3BhcnRzID4gTUFYX0ZJTEVfUEFSVFM6CiAgICAgICAgICAgIG51bV9wYXJ0cyA9IE1BWF9GSUxFX1BBUlRTCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyDYqtit2K/ZitivINi52K/YryDYp9mE2KPYrNiy2KfYoSDYqNmAIHtNQVhfRklMRV9QQVJUU30gKNin2YTYrdivINin2YTYo9mC2LXZiSkiKQogICAgICAgIAogICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIvCfk4og2LnYr9ivINin2YTYo9is2LLYp9ihOiB7bnVtX3BhcnRzfSIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4o+x77iPINmF2K/YqSDZg9mEINis2LLYoToge2R1cmF0aW9uIC8gbnVtX3BhcnRzOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgCiAgICAgICAgcGFydF9kdXJhdGlvbiA9IGR1cmF0aW9uIC8gbnVtX3BhcnRzCiAgICAgICAgcGFydHMgPSBbXQogICAgICAgIAogICAgICAgIGZvciBpIGluIHJhbmdlKG51bV9wYXJ0cyk6CiAgICAgICAgICAgIHN0YXJ0X3RpbWUgPSBpICogcGFydF9kdXJhdGlvbgogICAgICAgICAgICBvdXRwdXRfcGFydCA9IHNlbGYudGVtcF9kaXIgLyBmInBhcnRfe2krMTowMmR9Lm1wNCIKICAgICAgICAgICAgCiAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKcgu+4jyDYpdmG2LTYp9ihINin2YTYrNiy2KEge2krMX0ve251bV9wYXJ0c30uLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgY21kID0gWwogICAgICAgICAgICAgICAgJ2ZmbXBlZycsCiAgICAgICAgICAgICAgICAnLXNzJywgc3RyKHN0YXJ0X3RpbWUpLAogICAgICAgICAgICAgICAgJy1pJywgc3RyKGlucHV0X3BhdGgpLAogICAgICAgICAgICAgICAgJy10Jywgc3RyKHBhcnRfZHVyYXRpb24pLAogICAgICAgICAgICAgICAgJy1jJywgJ2NvcHknLAogICAgICAgICAgICAgICAgJy1hdm9pZF9uZWdhdGl2ZV90cycsICdtYWtlX3plcm8nLAogICAgICAgICAgICAgICAgJy15JywKICAgICAgICAgICAgICAgIHN0cihvdXRwdXRfcGFydCkKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0aW1lb3V0PTYwMCkKICAgICAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKaoO+4jyDYqtit2LDZitixINmB2Yog2KfZhNis2LLYoSB7aSsxfToge3Jlc3VsdC5zdGRlcnIuZGVjb2RlKClbOjIwMF19IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIG91dHB1dF9wYXJ0LmV4aXN0cygpOgogICAgICAgICAgICAgICAgcGFydHMuYXBwZW5kKHN0cihvdXRwdXRfcGFydCkpCiAgICAgICAgICAgICAgICBwYXJ0X3NpemUgPSBvcy5wYXRoLmdldHNpemUob3V0cHV0X3BhcnQpIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYp9mE2KzYstihIHtpKzF9OiB7cGFydF9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHBhcnRzCiAgICAKICAgIGRlZiBwcm9jZXNzX3ZpZGVvX2Zyb21fdXJsKHNlbGYsIHVybCwgcXVhbGl0eT0nbWVkaXVtJyk6CiAgICAgICAgIiIi2YXYudin2YTYrNipINmD2KfZhdmE2Kkg2YTZhNmB2YrYr9mK2Ygg2YXZhiDYsdin2KjYtyIiIgogICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICBzZWxmLmxvZ2dlci5sb2coIvCfmoAg2KjYr9ihINmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgc2VsZi5sb2dnZXIubG9nKCI9IiAqIDgwKQogICAgICAgIAogICAgICAgIHN0YXJ0X3RpbWUgPSB0aW1lLnRpbWUoKQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgIyAxLiDYqtit2YXZitmEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIGRvd25sb2FkX3BhdGggPSBzdHIoc2VsZi50ZW1wX2RpciAvICJkb3dubG9hZGVkX3ZpZGVvLm1wNCIpCiAgICAgICAgICAgIHNlbGYuZG93bmxvYWRfdmlkZW8odXJsLCBkb3dubG9hZF9wYXRoKQogICAgICAgICAgICAKICAgICAgICAgICAgIyAyLiDYtti62Lcg2KfZhNmB2YrYr9mK2YgKICAgICAgICAgICAgY29tcHJlc3NlZF9wYXRoID0gc3RyKHNlbGYudGVtcF9kaXIgLyAiY29tcHJlc3NlZF92aWRlby5tcDQiKQogICAgICAgICAgICBzZWxmLmNvbXByZXNzX3ZpZGVvKGRvd25sb2FkX3BhdGgsIGNvbXByZXNzZWRfcGF0aCwgcXVhbGl0eSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgMy4g2KfZhNiq2K3ZgtmCINmF2YYg2KfZhNit2KzZhQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemUgPSBvcy5wYXRoLmdldHNpemUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICBjb21wcmVzc2VkX3NpemVfbWIgPSBjb21wcmVzc2VkX3NpemUgLyAxMDI0IC8gMTAyNAogICAgICAgICAgICAKICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi8J+TpiDYrdis2YUg2KfZhNmF2YTZgSDYp9mE2YXYtti62YjYtzoge2NvbXByZXNzZWRfc2l6ZV9tYjouMmZ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdiw2Kcg2YPYp9mGINin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2YvYjCDZhtmC2LPZhdmHCiAgICAgICAgICAgIGlmIGNvbXByZXNzZWRfc2l6ZV9tYiA+IE1BWF9URUxFR1JBTV9TSVpFX01COgogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKGYi4pqg77iPINin2YTZhdmE2YEg2KPZg9io2LEg2YXZhiB7TUFYX1RFTEVHUkFNX1NJWkVfTUJ9INmF2YrYrNin2KjYp9mK2KogLSDYs9mK2KrZhSDYp9mE2KrZgtiz2YrZhSIpCiAgICAgICAgICAgICAgICBwYXJ0cyA9IHNlbGYuc3BsaXRfdmlkZW8oY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYpNmC2KrYqQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoY29tcHJlc3NlZF9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBlbGFwc2VkID0gdGltZS50aW1lKCkgLSBzdGFydF90aW1lCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coZiLinIUg2KfZg9iq2YXZhNiqINin2YTZhdi52KfZhNis2Kkg2YHZiiB7ZWxhcHNlZDouMWZ9INir2KfZhtmK2KkiKQogICAgICAgICAgICAgICAgc2VsZi5sb2dnZXIubG9nKCI9IiAqIDgwKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXR1cm4geyd0eXBlJzogJ3BhcnRzJywgJ2ZpbGVzJzogcGFydHN9CiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTYo9i12YTZigogICAgICAgICAgICAgICAgb3MucmVtb3ZlKGRvd25sb2FkX3BhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsYXBzZWQgPSB0aW1lLnRpbWUoKSAtIHN0YXJ0X3RpbWUKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZygiPSIgKiA4MCkKICAgICAgICAgICAgICAgIHNlbGYubG9nZ2VyLmxvZyhmIuKchSDYp9mD2KrZhdmE2Kog2KfZhNmF2LnYp9mE2KzYqSDZgdmKIHtlbGFwc2VkOi4xZn0g2KvYp9mG2YrYqSIpCiAgICAgICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2coIj0iICogODApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiB7J3R5cGUnOiAnc2luZ2xlJywgJ2ZpbGUnOiBjb21wcmVzc2VkX3BhdGh9CiAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBzZWxmLmxvZ2dlci5sb2dfZXJyb3IoZSwgItmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCIpCiAgICAgICAgICAgIHJhaXNlCgojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyDwn6SWINio2YjYqiBUZWxlZ3JhbQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmNsYXNzIFZpZGVvQ29tcHJlc3NvckJvdDoKICAgICIiItio2YjYqiBUZWxlZ3JhbSDZhNi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiIiIgogICAgCiAgICBkZWYgX19pbml0X18oc2VsZiwgdG9rZW4pOgogICAgICAgICIiItiq2YfZitim2Kkg2KfZhNio2YjYqiIiIgogICAgICAgIHNlbGYuYXBwID0gQXBwbGljYXRpb24uYnVpbGRlcigpLnRva2VuKHRva2VuKS5idWlsZCgpCiAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIgPSBEZXRhaWxlZExvZ2dlcigpCiAgICAgICAgc2VsZi5jb21wcmVzc29yID0gVmlkZW9Db21wcmVzc29yKGxvZ2dlcj1zZWxmLmRldGFpbGVkX2xvZ2dlcikKICAgICAgICBzZWxmLnNldHVwX2hhbmRsZXJzKCkKICAgIAogICAgZGVmIHNldHVwX2hhbmRsZXJzKHNlbGYpOgogICAgICAgICIiItil2LnYr9in2K8g2YXYudin2YTYrNin2Kog2KfZhNij2YjYp9mF2LEiIiIKICAgICAgICBzZWxmLmFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzZWxmLnN0YXJ0X2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJoZWxwIiwgc2VsZi5oZWxwX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsb2dzIiwgc2VsZi5sb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJsYXN0bG9nIiwgc2VsZi5sYXN0bG9nX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhbGxsb2dzIiwgc2VsZi5hbGxsb2dzX2NvbW1hbmQpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJjbGVhbnRlbXAiLCBzZWxmLmNsZWFudGVtcF9jb21tYW5kKSkKICAgICAgICBzZWxmLmFwcC5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlRFWFQgJiB+ZmlsdGVycy5DT01NQU5ELCBzZWxmLmhhbmRsZV91cmwpKQogICAgICAgIHNlbGYuYXBwLmFkZF9oYW5kbGVyKENhbGxiYWNrUXVlcnlIYW5kbGVyKHNlbGYuaGFuZGxlX3F1YWxpdHlfc2VsZWN0aW9uKSkKICAgIAogICAgYXN5bmMgZGVmIHN0YXJ0X2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItij2YXYsSDYp9mE2KjYr9in2YrYqSIiIgogICAgICAgIHdlbGNvbWVfdGV4dCA9ICgKICAgICAgICAgICAgIvCfjqwgKirZhdix2K3YqNin2Ysg2KjZgyDZgdmKINi22KfYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTYp9it2KrYsdin2YHZiiEqKlxuXG4iCiAgICAgICAgICAgICLinKggKirYp9mE2YXZhdmK2LLYp9iqINin2YTYrNiv2YrYr9ipOioqXG4iCiAgICAgICAgICAgICLinIUg2LbYuti3INmB2KfYptmCINin2YTYs9ix2LnYqSAoM3gg2KPYs9ix2LkpXG4iCiAgICAgICAgICAgICLinIUg2KXYsdiz2KfZhCDZgdmK2K/ZitmI2YfYp9iqINio2KPZiiDYrdis2YUgKNiq2YLYs9mK2YUg2KrZhNmC2KfYptmKKVxuIgogICAgICAgICAgICAi4pyFINiz2KzZhCDYo9iu2LfYp9ihIHR4dCDZhdmB2LXZhFxuIgogICAgICAgICAgICAi4pyFINiz2KzZhCDYqtmC2K/ZhSDZhdi5INij2LPYqNin2Kgg2KfZhNiq2KPYrtmK2LFcbiIKICAgICAgICAgICAgIuKchSDYtti62Lcg2KPZgtmI2YkgLSDYrdis2YUg2LXYutmK2LEg2KzYr9in2YtcblxuIgogICAgICAgICAgICAi8J+TnSAqKtmD2YrZgdmK2Kkg2KfZhNin2LPYqtiu2K/Yp9mFOioqXG4iCiAgICAgICAgICAgICIx77iP4oOjINij2LHYs9mEINix2KfYqNi3INin2YTZgdmK2K/ZitmIIChHb29nbGUgRHJpdmUg2KPZiCDYsdin2KjYtyDZhdio2KfYtNixKVxuIgogICAgICAgICAgICAiMu+4j+KDoyDYp9iu2KrYsSDZhdiz2KrZiNmJINin2YTYrNmI2K/YqVxuIgogICAgICAgICAgICAiM++4j+KDoyDYp9mG2KrYuNixINit2KrZiSDZitiq2YUg2KfZhNi22LrYt1xuIgogICAgICAgICAgICAiNO+4j+KDoyDYp9iz2KrZhNmFINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3INmF2Lkg2LPYrNmEINin2YTYudmF2YTZitin2KohXG5cbiIKICAgICAgICAgICAgIvCfm6DvuI8gKirYp9mE2KPZiNin2YXYsSDYp9mE2YXYqtin2K3YqToqKlxuIgogICAgICAgICAgICAi4oCiIC9oZWxwIC0g2K/ZhNmK2YQg2KfZhNin2LPYqtiu2K/Yp9mFINin2YTZg9in2YXZhFxuIgogICAgICAgICAgICAi4oCiIC9sb2dzIC0g2LnYsdi2INmC2KfYptmF2Kkg2KfZhNiz2KzZhNin2KpcbiIKICAgICAgICAgICAgIuKAoiAvbGFzdGxvZyAtINii2K7YsSDYs9is2YQg2YXYudin2YTYrNipXG4iCiAgICAgICAgICAgICLigKIgL2FsbGxvZ3MgLSDYrNmF2YrYuSDYp9mE2LPYrNmE2KfYqiDZhdi22LrZiNi32KlcblxuIgogICAgICAgICAgICAi8J+GmCDZhNmE2YXYs9in2LnYr9ipOiAvaGVscCIKICAgICAgICApCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCh3ZWxjb21lX3RleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgIAogICAgYXN5bmMgZGVmIGhlbHBfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KPZhdixINin2YTZhdiz2KfYudiv2KkiIiIKICAgICAgICBoZWxwX3RleHQgPSAoCiAgICAgICAgICAgICLinZMgKirYr9mE2YrZhCDYp9mE2KfYs9iq2K7Yr9in2YUqKlxuXG4iCiAgICAgICAgICAgICIqKvCfk6Ug2KfZhNix2YjYp9io2Lcg2KfZhNmF2K/YudmI2YXYqToqKlxuIgogICAgICAgICAgICAi4oCiIEdvb2dsZSBEcml2ZTogaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tLy4uLlxuIgogICAgICAgICAgICAi4oCiINix2YjYp9io2Lcg2YXYqNin2LTYsdipOiBodHRwOi8vZXhhbXBsZS5jb20vdmlkZW8ubXA0XG5cbiIKICAgICAgICAgICAgIioq8J+OryDZhdiz2KrZiNmK2KfYqiDYp9mE2KzZiNiv2Kk6KipcbiIKICAgICAgICAgICAgIuKAoiDwn5+jICoq2YHYp9im2YIg2KfZhNin2YbYrtmB2KfYtioqOiDYrdis2YUg2LXYutmK2LEg2KzYr9in2YsgKDQ4MHAsIENSRiAzNSlcbiIKICAgICAgICAgICAgIuKAoiDwn5S0ICoq2YXZhtiu2YHYttipKio6INit2KzZhSDYtdi62YrYsSAoNzIwcCwgQ1JGIDMyKVxuIgogICAgICAgICAgICAi4oCiIPCfn6EgKirZhdiq2YjYs9i32KkqKjog2YXYqtmI2KfYstmGICg3MjBwLCBDUkYgMjgpXG4iCiAgICAgICAgICAgICLigKIg8J+foiAqKti52KfZhNmK2KkqKjog2KzZiNiv2Kkg2LnYp9mE2YrYqSAoMTA4MHAsIENSRiAyMylcblxuIgogICAgICAgICAgICAiKirwn5ug77iPINin2YTYo9mI2KfZhdixINin2YTZhdiq2KfYrdipOioqXG4iCiAgICAgICAgICAgICLigKIgL3N0YXJ0IC0g2KjYr9ihINin2YTYqNmI2KpcbiIKICAgICAgICAgICAgIuKAoiAvaGVscCAtINi52LHYtiDYp9mE2YXYs9in2LnYr9ipXG4iCiAgICAgICAgICAgICLigKIgL2xvZ3MgLSDYudix2LYg2YLYp9im2YXYqSDYp9mE2LPYrNmE2KfYqlxuIgogICAgICAgICAgICAi4oCiIC9sYXN0bG9nIC0g2KLYrtixINiz2KzZhCDZhdi52KfZhNis2KlcbiIKICAgICAgICAgICAgIuKAoiAvYWxsbG9ncyAtINis2YXZiti5INin2YTYs9is2YTYp9iqINmB2Yog2YXZhNmBINmF2LbYutmI2LdcblxuIgogICAgICAgICAgICAiKirwn5KhINmG2LXYp9im2K06KipcbiIKICAgICAgICAgICAgIuKAoiDZhNmE2K3YtdmI2YQg2LnZhNmJINij2LXYutixINit2KzZhTog2KfYrtiq2LEg8J+foyDZgdin2KbZgiDYp9mE2KfZhtiu2YHYp9i2XG4iCiAgICAgICAgICAgICLigKIg2KfZhNmF2YTZgdin2Kog2KfZhNmD2KjZitix2Kkg2YrYqtmFINiq2YLYs9mK2YXZh9inINiq2YTZgtin2KbZitin2YtcbiIKICAgICAgICAgICAgIuKAoiDYs9iq2K3YtdmEINi52YTZiSDZhdmE2YEgdHh0INmK2K3YqtmI2Yog2LnZhNmJINiz2KzZhCDYp9mE2LnZhdmE2YrYp9iqXG5cbiIKICAgICAgICAgICAgIioq4p2TINmF2LTYp9mD2YQg2LTYp9im2LnYqToqKlxuIgogICAgICAgICAgICAi4oCiIEdvb2dsZSBEcml2ZTog2KrYo9mD2K8g2YXZhiDYo9mGINin2YTZhdmE2YEg2LnYp9mFXG4iCiAgICAgICAgICAgICLigKIg2KfZhNiq2K3ZhdmK2YQg2KjYt9mK2KE6INiq2K3ZgtmCINmF2YYg2KfYqti12KfZhCDYp9mE2KXZhtiq2LHZhtiqXG5cbiIKICAgICAgICAgICAgIvCfk6cg2YTZhNmF2LPYp9i52K/YqTog2KPYsdiz2YQg2LHYs9in2YTYqSDZhNmE2YXYt9mI2LEiCiAgICAgICAgKQogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoaGVscF90ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAKICAgIGFzeW5jIGRlZiBsb2dzX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiIti52LHYtiDZgtin2KbZhdipINin2YTYs9is2YTYp9iqINin2YTZhdiq2KfYrdipIiIiCiAgICAgICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgICAgIGxvZ3NfZGlyID0gUGF0aChMT0dTX0RJUikKICAgICAgICAKICAgICAgICBpZiBub3QgbG9nc19kaXIuZXhpc3RzKCk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi8J+TiyAqKtmE2Kcg2KrZiNis2K8g2LPYrNmE2KfYqiDZhdiq2KfYrdipKipcblxuIgogICAgICAgICAgICAgICAgItmE2YUg2YrYqtmFINil2YbYtNin2KEg2KPZiiDYs9is2YTYp9iqINio2LnYry5cbiIKICAgICAgICAgICAgICAgICLYp9io2K/YoyDYqNmF2LnYp9mE2KzYqSDZgdmK2K/ZitmIINij2YjZhNin2YshIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KfZhNio2K3YqyDYudmGINiz2KzZhNin2Kog2KfZhNmF2LPYqtiu2K/ZhQogICAgICAgIHVzZXJfbG9ncyA9IHNvcnRlZCgKICAgICAgICAgICAgbG9nc19kaXIuZ2xvYihmInNlc3Npb25fe3VzZXJfaWR9XyoudHh0IiksCiAgICAgICAgICAgIGtleT1sYW1iZGEgeDogeC5zdGF0KCkuc3RfbXRpbWUsCiAgICAgICAgICAgIHJldmVyc2U9VHJ1ZQogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIvCfk4sgKirZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyoqXG5cbiIKICAgICAgICAgICAgICAgICLZhNmFINiq2YLZhSDYqNmF2LnYp9mE2KzYqSDYo9mKINmB2YrYr9mK2Ygg2KjYudivLlxuIgogICAgICAgICAgICAgICAgItij2LHYs9mEINix2KfYqNi3INmB2YrYr9mK2Ygg2YTZhNio2K/YoSEiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYudix2LYg2KLYrtixIDEwINiz2KzZhNin2KoKICAgICAgICBsb2dzX2xpc3QgPSAi8J+TiyAqKtiz2KzZhNin2KrZgyDYp9mE2KPYrtmK2LHYqToqKlxuXG4iCiAgICAgICAgCiAgICAgICAgZm9yIGksIGxvZ19maWxlIGluIGVudW1lcmF0ZSh1c2VyX2xvZ3NbOjEwXSwgMSk6CiAgICAgICAgICAgICMg2KfYs9iq2K7Ysdin2Kwg2KfZhNiq2KfYsdmK2K4g2YXZhiDYp9iz2YUg2KfZhNmF2YTZgQogICAgICAgICAgICAjIHNlc3Npb25fMTIzNDU2XzIwMjYwMjA0XzE1MDUzMC50eHQKICAgICAgICAgICAgcGFydHMgPSBsb2dfZmlsZS5zdGVtLnNwbGl0KCdfJykKICAgICAgICAgICAgaWYgbGVuKHBhcnRzKSA+PSA0OgogICAgICAgICAgICAgICAgZGF0ZV9zdHIgPSBwYXJ0c1syXSAgIyAyMDI2MDIwNAogICAgICAgICAgICAgICAgdGltZV9zdHIgPSBwYXJ0c1szXSAgIyAxNTA1MzAKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYqtmG2LPZitmCINin2YTYqtin2LHZitiuINmI2KfZhNmI2YLYqgogICAgICAgICAgICAgICAgZm9ybWF0dGVkX2RhdGUgPSBmIntkYXRlX3N0clswOjRdfS17ZGF0ZV9zdHJbNDo2XX0te2RhdGVfc3RyWzY6OF19IgogICAgICAgICAgICAgICAgZm9ybWF0dGVkX3RpbWUgPSBmInt0aW1lX3N0clswOjJdfTp7dGltZV9zdHJbMjo0XX06e3RpbWVfc3RyWzQ6Nl19IgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBsb2dfZmlsZS5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQgICMgS0IKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9nc19saXN0ICs9IGYie2l9LiDwn5OEIHtmb3JtYXR0ZWRfZGF0ZX0ge2Zvcm1hdHRlZF90aW1lfVxuIgogICAgICAgICAgICAgICAgbG9nc19saXN0ICs9IGYiICAg8J+TpiB7ZmlsZV9zaXplOi4xZn0gS0JcblxuIgogICAgICAgIAogICAgICAgIGxvZ3NfbGlzdCArPSAoCiAgICAgICAgICAgICIqKvCfk4wg2YTZhNit2LXZiNmEINi52YTZiSDYs9is2YQ6KipcbiIKICAgICAgICAgICAgIuKAoiAvbGFzdGxvZyAtINii2K7YsSDYs9is2YRcbiIKICAgICAgICAgICAgIuKAoiAvYWxsbG9ncyAtINis2YXZiti5INin2YTYs9is2YTYp9iqINmF2LbYutmI2LfYqSIKICAgICAgICApCiAgICAgICAgCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChsb2dzX2xpc3QsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgIAogICAgYXN5bmMgZGVmIGxhc3Rsb2dfY29tbWFuZChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2KXYsdiz2KfZhCDYotiu2LEg2YXZhNmBINiz2KzZhCIiIgogICAgICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgICAgICBsb2dzX2RpciA9IFBhdGgoTE9HU19ESVIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IGxvZ3NfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YXYqtin2K3YqSIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2YTYqNit2Ksg2LnZhiDYotiu2LEg2LPYrNmEINmE2YTZhdiz2KrYrtiv2YUKICAgICAgICB1c2VyX2xvZ3MgPSBzb3J0ZWQoCiAgICAgICAgICAgIGxvZ3NfZGlyLmdsb2IoZiJzZXNzaW9uX3t1c2VyX2lkfV8qLnR4dCIpLAogICAgICAgICAgICBrZXk9bGFtYmRhIHg6IHguc3RhdCgpLnN0X210aW1lLAogICAgICAgICAgICByZXZlcnNlPVRydWUKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgbm90IHVzZXJfbG9nczoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinYwg2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmE2YMg2KjYudivIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGxhc3RfbG9nID0gdXNlcl9sb2dzWzBdCiAgICAgICAgCiAgICAgICAgIyDYpdix2LPYp9mEINin2YTZhdmE2YEKICAgICAgICB3aXRoIG9wZW4obGFzdF9sb2csICdyYicpIGFzIGY6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X2RvY3VtZW50KAogICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OLICoq2KLYrtixINiz2KzZhCDZhdi52KfZhNis2KkqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+ThSDYp9mE2KrYp9ix2YrYrjoge2RhdGV0aW1lLmZyb210aW1lc3RhbXAobGFzdF9sb2cuc3RhdCgpLnN0X210aW1lKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKX1cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLwn5OmINin2YTYrdis2YU6IHtsYXN0X2xvZy5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQ6LjFmfSBLQiIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgCiAgICBhc3luYyBkZWYgYWxsbG9nc19jb21tYW5kKHNlbGYsIHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICAgICAiIiLYpdix2LPYp9mEINis2YXZiti5INin2YTYs9is2YTYp9iqINmB2Yog2YXZhNmBINmF2LbYutmI2LciIiIKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICAgICAgbG9nc19kaXIgPSBQYXRoKExPR1NfRElSKQogICAgICAgIAogICAgICAgIGlmIG5vdCBsb2dzX2Rpci5leGlzdHMoKToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgICLinYwg2YTYpyDYqtmI2KzYryDYs9is2YTYp9iqINmF2KrYp9it2KkiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYp9mE2KjYrdirINi52YYg2LPYrNmE2KfYqiDYp9mE2YXYs9iq2K7Yr9mFCiAgICAgICAgdXNlcl9sb2dzID0gbGlzdChsb2dzX2Rpci5nbG9iKGYic2Vzc2lvbl97dXNlcl9pZH1fKi50eHQiKSkKICAgICAgICAKICAgICAgICBpZiBub3QgdXNlcl9sb2dzOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCDZhNinINiq2YjYrNivINiz2KzZhNin2Kog2YTZgyDYqNi52K8iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYpdix2LPYp9mEINix2LPYp9mE2Kkg2KfZhtiq2LjYp9ixCiAgICAgICAgd2FpdF9tc2cgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAi8J+TpiDYrNin2LHZiiDYqtis2YfZitiyINis2YXZiti5INin2YTYs9is2YTYp9iqLi4uIiwKICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgKQogICAgICAgIAogICAgICAgICMg2KXZhti02KfYoSDZhdmE2YEg2YXYtti62YjYtwogICAgICAgIGltcG9ydCB6aXBmaWxlCiAgICAgICAgCiAgICAgICAgemlwX3BhdGggPSBQYXRoKFRFTVBfRElSKSAvIGYibG9nc197dXNlcl9pZH1fe2ludCh0aW1lLnRpbWUoKSl9LnppcCIKICAgICAgICAKICAgICAgICB3aXRoIHppcGZpbGUuWmlwRmlsZSh6aXBfcGF0aCwgJ3cnLCB6aXBmaWxlLlpJUF9ERUZMQVRFRCkgYXMgemlwZjoKICAgICAgICAgICAgZm9yIGxvZ19maWxlIGluIHVzZXJfbG9nczoKICAgICAgICAgICAgICAgIHppcGYud3JpdGUobG9nX2ZpbGUsIGxvZ19maWxlLm5hbWUpCiAgICAgICAgCiAgICAgICAgIyDYrdiw2YEg2LHYs9in2YTYqSDYp9mE2KfZhtiq2LjYp9ixCiAgICAgICAgdHJ5OgogICAgICAgICAgICBhd2FpdCB3YWl0X21zZy5kZWxldGUoKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgcGFzcwogICAgICAgIAogICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YXZhNmBINin2YTZhdi22LrZiNi3CiAgICAgICAgemlwX3NpemUgPSB6aXBfcGF0aC5zdGF0KCkuc3Rfc2l6ZSAvIDEwMjQKICAgICAgICAKICAgICAgICB3aXRoIG9wZW4oemlwX3BhdGgsICdyYicpIGFzIGY6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X2RvY3VtZW50KAogICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OmICoq2KzZhdmK2Lkg2LPYrNmE2KfYqtmDKipcblxuIgogICAgICAgICAgICAgICAgICAgICAgICBmIvCfk4og2LnYr9ivINin2YTYs9is2YTYp9iqOiB7bGVuKHVzZXJfbG9ncyl9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7emlwX3NpemU6LjFmfSBLQlxuXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi2YrYrdiq2YjZiiDYudmE2Ykg2KzZhdmK2Lkg2LPYrNmE2KfYqiDZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNiu2KfYtdipINio2YMiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAKICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdi22LrZiNi3CiAgICAgICAgb3MucmVtb3ZlKHppcF9wYXRoKQogICAgCiAgICBhc3luYyBkZWYgY2xlYW50ZW1wX2NvbW1hbmQoc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItit2LDZgSDZhdmE2YHYp9iqINin2YTZgdmK2K/ZitmIINin2YTZhdik2YLYqtipINmE2KrZgdix2YrYuiDZhdiz2KfYrdipINin2YTYp9iz2KrYttin2YHYqSIiIgogICAgICAgIGltcG9ydCBzaHV0aWwKICAgICAgICB0ZW1wX2RpciA9IFBhdGgoVEVNUF9ESVIpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHRlbXBfZGlyLmV4aXN0cygpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLwn5OBICoq2KfZhNmF2KzZhNivINin2YTZhdik2YLYqiDZgdin2LHYuiDYo9i12YTYp9mLKioiLCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHRvdGFsX3NpemUgPSBzdW0oZi5zdGF0KCkuc3Rfc2l6ZSBmb3IgZiBpbiB0ZW1wX2Rpci5yZ2xvYignKicpIGlmIGYuaXNfZmlsZSgpKQogICAgICAgIHRvdGFsX2ZpbGVzID0gc3VtKDEgZm9yIGYgaW4gdGVtcF9kaXIucmdsb2IoJyonKSBpZiBmLmlzX2ZpbGUoKSkKICAgICAgICAKICAgICAgICBpZiB0b3RhbF9maWxlcyA9PSAwOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLwn5OBICoq2KfZhNmF2KzZhNivINin2YTZhdik2YLYqiDZgdin2LHYuiDYo9i12YTYp9mLKioiLCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgZm9yIGl0ZW0gaW4gdGVtcF9kaXIuaXRlcmRpcigpOgogICAgICAgICAgICAgICAgaWYgaXRlbS5pc19maWxlKCk6CiAgICAgICAgICAgICAgICAgICAgaXRlbS51bmxpbmsoKQogICAgICAgICAgICAgICAgZWxpZiBpdGVtLmlzX2RpcigpOgogICAgICAgICAgICAgICAgICAgIHNodXRpbC5ybXRyZWUoaXRlbSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGZyZWVkX21iID0gdG90YWxfc2l6ZSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICBmIvCfl5HvuI8gKirYqtmFINiq2YbYuNmK2YEg2KfZhNmF2KzZhNivINin2YTZhdik2YLYqiEqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNmF2YTZgdin2Kog2KfZhNmF2K3YsNmI2YHYqToge3RvdGFsX2ZpbGVzfSDZhdmE2YFcbiIKICAgICAgICAgICAgICAgIGYi8J+SviDYp9mE2YXYs9in2K3YqSDYp9mE2YXYrdix2LHYqToge2ZyZWVkX21iOi4yZn0g2YXZitis2KfYqNin2YrYqiIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgKICAgICAgICAgICAgICAgIGYi4p2MICoq2K7Yt9ijINij2KvZhtin2KEg2KfZhNit2LDZgSoqXG5cbmB7c3RyKGUpWzoyMDBdfWAiLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKCiAgICBhc3luYyBkZWYgaGFuZGxlX3VybChzZWxmLCB1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgIiIi2YXYudin2YTYrNipINix2KfYqNi3INin2YTZgdmK2K/ZitmIIiIiCiAgICAgICAgdXJsID0gdXBkYXRlLm1lc3NhZ2UudGV4dC5zdHJpcCgpCiAgICAgICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgICAgIAogICAgICAgICMg2KjYr9ihINis2YTYs9ipINin2YTYs9is2YQKICAgICAgICBzZWxmLmRldGFpbGVkX2xvZ2dlci5zdGFydF9zZXNzaW9uKHVzZXJfaWQsIHVybCkKICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINi12K3YqSDYp9mE2LHYp9io2LcKICAgICAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoKCdodHRwOi8vJywgJ2h0dHBzOi8vJykpOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgIuKdjCAqKtix2KfYqNi3INi62YrYsSDYtdit2YrYrSEqKlxuXG4iCiAgICAgICAgICAgICAgICAi2KfZhNix2KzYp9ihINil2LHYs9in2YQg2LHYp9io2Lcg2YrYqNiv2KMg2KjZgCBodHRwOi8vINij2YggaHR0cHM6Ly8iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyDYrdmB2Lgg2KfZhNix2KfYqNi3CiAgICAgICAgY29udGV4dC51c2VyX2RhdGFbJ3ZpZGVvX3VybCddID0gdXJsCiAgICAgICAgCiAgICAgICAgIyDYudix2LYg2K7Zitin2LHYp9iqINin2YTYrNmI2K/YqQogICAgICAgIGtleWJvYXJkID0gWwogICAgICAgICAgICBbCiAgICAgICAgICAgICAgICBJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqrINmG2KfZhtmIICjYo9i12LrYsSDYrdis2YUpIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9uYW5vJyksCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgIFsKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+jINmB2KfYptmCINin2YTYp9mG2K7Zgdin2LYiLCBjYWxsYmFja19kYXRhPSdxdWFsaXR5X3VsdHJhX2xvdycpLAogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflLQg2YXZhtiu2YHYttipIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9sb3cnKSwKICAgICAgICAgICAgXSwKICAgICAgICAgICAgWwogICAgICAgICAgICAgICAgSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfn6Eg2YXYqtmI2LPYt9ipIiwgY2FsbGJhY2tfZGF0YT0ncXVhbGl0eV9tZWRpdW0nKSwKICAgICAgICAgICAgICAgIElubGluZUtleWJvYXJkQnV0dG9uKCLwn5+iINi52KfZhNmK2KkiLCBjYWxsYmFja19kYXRhPSdxdWFsaXR5X2hpZ2gnKSwKICAgICAgICAgICAgXQogICAgICAgIF0KICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgICAgICAKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAi8J+OryAqKtin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipOioqXG5cbiIKICAgICAgICAgICAgIuKaqyAqKtmG2KfZhtmIKio6INij2LXYutixINit2KzZhSDZhdmF2YPZhiAoMjQwcCkgLSDZhdi62LTZiNi0INmE2YPZhiDYrdis2YUg2LbYptmK2YQg2KzYr9in2YtcbiIKICAgICAgICAgICAgIvCfn6MgKirZgdin2KbZgiDYp9mE2KfZhtiu2YHYp9i2Kio6INit2KzZhSDYtdi62YrYsSDYrNiv2KfZiyAoNDgwcClcbiIKICAgICAgICAgICAgIvCflLQgKirZhdmG2K7Zgdi22KkqKjog2K3YrNmFINi12LrZitixICg3MjBwKVxuIgogICAgICAgICAgICAi8J+foSAqKtmF2KrZiNiz2LfYqSoqOiDZhdiq2YjYp9iy2YYgKDcyMHApIC0g2YXZj9mI2LXZiSDYqNmHXG4iCiAgICAgICAgICAgICLwn5+iICoq2LnYp9mE2YrYqSoqOiDYrNmI2K/YqSDZhdmF2KrYp9iy2KkgKDEwODBwKVxuXG4iCiAgICAgICAgICAgICLwn5KhINmE2YTYrdi12YjZhCDYudmE2Ykg2KPYtdi62LEg2K3YrNmFOiDYp9iu2KrYsSDimqsiLAogICAgICAgICAgICByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAKICAgIGFzeW5jIGRlZiBoYW5kbGVfcXVhbGl0eV9zZWxlY3Rpb24oc2VsZiwgdXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgICAgICIiItmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipIiIiCiAgICAgICAgcXVlcnkgPSB1cGRhdGUuY2FsbGJhY2tfcXVlcnkKICAgICAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQogICAgICAgIAogICAgICAgICMg2KfYs9iq2K7Ysdin2Kwg2KfZhNis2YjYr9ipCiAgICAgICAgcXVhbGl0eV9tYXAgPSB7CiAgICAgICAgICAgICdxdWFsaXR5X25hbm8nOiAoJ25hbm8nLCAn4pqrINmG2KfZhtmIJyksCiAgICAgICAgICAgICdxdWFsaXR5X3VsdHJhX2xvdyc6ICgndWx0cmFfbG93JywgJ/Cfn6Mg2YHYp9im2YIg2KfZhNin2YbYrtmB2KfYticpLAogICAgICAgICAgICAncXVhbGl0eV9sb3cnOiAoJ2xvdycsICfwn5S0INmF2YbYrtmB2LbYqScpLAogICAgICAgICAgICAncXVhbGl0eV9tZWRpdW0nOiAoJ21lZGl1bScsICfwn5+hINmF2KrZiNiz2LfYqScpLAogICAgICAgICAgICAncXVhbGl0eV9oaWdoJzogKCdoaWdoJywgJ/Cfn6Ig2LnYp9mE2YrYqScpLAogICAgICAgIH0KICAgICAgICAKICAgICAgICBxdWFsaXR5LCBxdWFsaXR5X25hbWUgPSBxdWFsaXR5X21hcC5nZXQocXVlcnkuZGF0YSwgKCdtZWRpdW0nLCAn8J+foSDZhdiq2YjYs9i32KknKSkKICAgICAgICB1cmwgPSBjb250ZXh0LnVzZXJfZGF0YS5nZXQoJ3ZpZGVvX3VybCcpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHVybDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYrti32KM6INmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2KfZhNix2KfYqNi3LiDYo9ix2LPZhCDYsdin2KjYtyDYrNiv2YrYry4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2Ksg2KfZhNix2LPYp9mE2KkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgKICAgICAgICAgICAgZiLij7MgKirYrNin2LHZiiDYp9mE2YXYudin2YTYrNipLi4uKipcblxuIgogICAgICAgICAgICBmIvCflJcg2KfZhNix2KfYqNi3OiBge3VybFs6NTBdfS4uLmBcbiIKICAgICAgICAgICAgZiLwn5OKINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZX1cblxuIgogICAgICAgICAgICBmIuKPse+4jyDZgtivINiq2LPYqti62LHZgiDYp9mE2LnZhdmE2YrYqSDYudiv2Kkg2K/Zgtin2KbZgi4uLlxuIgogICAgICAgICAgICBmItiz2KPYsdiz2YQg2YTZgyDYs9is2YQg2KfZhNiq2YLYr9mFINmC2LHZitio2KfZiyEiLAogICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICApCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgICAgIHByb2dyZXNzX21lc3NhZ2UgPSBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAi8J+TpSAqKtmF2LHYrdmE2KkgMS8zOioqINis2KfYsdmKINin2YTYqtit2YXZitmELi4uXG4iCiAgICAgICAgICAgICAgICAi4o+zINin2YTYsdis2KfYoSDYp9mE2KfZhtiq2LjYp9ixLi4uIiwKICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICByZXN1bHQgPSBhd2FpdCBhc3luY2lvLnRvX3RocmVhZCgKICAgICAgICAgICAgICAgIHNlbGYuY29tcHJlc3Nvci5wcm9jZXNzX3ZpZGVvX2Zyb21fdXJsLAogICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgcXVhbGl0eT1xdWFsaXR5CiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINix2LPYp9mE2Kkg2KfZhNiq2YLYr9mFCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGF3YWl0IHByb2dyZXNzX21lc3NhZ2UuZGVsZXRlKCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICAKICAgICAgICAgICAgIyDYsdmB2Lkg2KfZhNmB2YrYr9mK2Ygv2KfZhNmB2YrYr9mK2YjZh9in2KoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBmIuKchSAqKtiq2YUg2KfZhNi22LrYtyDYqNmG2KzYp9itISoqXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+TpCDYrNin2LHZiiDYsdmB2Lkg2KfZhNmB2YrYr9mK2YguLi4iLAogICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0nTWFya2Rvd24nCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHJlc3VsdFsndHlwZSddID09ICdzaW5nbGUnOgogICAgICAgICAgICAgICAgIyDZgdmK2K/ZitmIINmI2KfYrdivCiAgICAgICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUocmVzdWx0WydmaWxlJ10pIC8gMTAyNCAvIDEwMjQKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgd2l0aCBvcGVuKHJlc3VsdFsnZmlsZSddLCAncmInKSBhcyB2aWRlbzoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3ZpZGVvKAogICAgICAgICAgICAgICAgICAgICAgICB2aWRlbz12aWRlbywKICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj1mIuKchSAqKtiq2YUg2KfZhNi22LrYtyDYqNmG2KzYp9itISoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7ZmlsZV9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHN1cHBvcnRzX3N0cmVhbWluZz1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShyZXN1bHRbJ2ZpbGUnXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjINi52K/YqSDYo9is2LLYp9ihCiAgICAgICAgICAgICAgICB0b3RhbF9wYXJ0cyA9IGxlbihyZXN1bHRbJ2ZpbGVzJ10pCiAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5tZXNzYWdlLnJlcGx5X3RleHQoCiAgICAgICAgICAgICAgICAgICAgZiLwn5OmICoq2KfZhNmB2YrYr9mK2Ygg2YPYqNmK2LEgLSDYqtmFINin2YTYqtmC2LPZitmFINil2YTZiSB7dG90YWxfcGFydHN9INij2KzYstin2KEqKlxuXG4iCiAgICAgICAgICAgICAgICAgICAgZiLij7Mg2KzYp9ix2Yog2LHZgdi5INin2YTYo9is2LLYp9ihLi4uIiwKICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9yIGksIHBhcnRfZmlsZSBpbiBlbnVtZXJhdGUocmVzdWx0WydmaWxlcyddLCAxKToKICAgICAgICAgICAgICAgICAgICBwYXJ0X3NpemUgPSBvcy5wYXRoLmdldHNpemUocGFydF9maWxlKSAvIDEwMjQgLyAxMDI0CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhcnRfZmlsZSwgJ3JiJykgYXMgdmlkZW86CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHF1ZXJ5Lm1lc3NhZ2UucmVwbHlfdmlkZW8oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWRlbz12aWRlbywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHRpb249ZiLwn5OmICoq2KfZhNis2LLYoSB7aX0ve3RvdGFsX3BhcnRzfSoqXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TiiDYp9mE2KzZiNiv2Kk6IHtxdWFsaXR5X25hbWV9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi8J+TpiDYp9mE2K3YrNmFOiB7cGFydF9zaXplOi4yZn0g2YXZitis2KfYqNin2YrYqiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXBwb3J0c19zdHJlYW1pbmc9VHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKHBhcnRfZmlsZSkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYs9is2YQg2KfZhNi52YXZhNmK2KfYqgogICAgICAgICAgICBsb2dfZmlsZSA9IHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmdldF9sb2dfZmlsZSgpCiAgICAgICAgICAgIGlmIGxvZ19maWxlIGFuZCBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX2ZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV9kb2N1bWVudCgKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj0i8J+TiyAqKtiz2KzZhCDYp9mE2LnZhdmE2YrYp9iqINin2YTZg9in2YXZhCoqXG5cbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAi2YrYrdiq2YjZiiDYudmE2Ykg2KzZhdmK2Lkg2KrZgdin2LXZitmEINin2YTZhdi52KfZhNis2Kkg2YjYp9mE2KPYrti32KfYoSAo2KXZhiDZiNis2K/YqikiLAogICAgICAgICAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICAjINil2YbZh9in2KEg2KfZhNis2YTYs9ipINio2YbYrNin2K0KICAgICAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIuZmluaXNoX3Nlc3Npb24oc3VjY2Vzcz1UcnVlKQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBmIuKchSAqKtiq2YUg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiCDYp9mE2YXYtti62YjYtyEqKlxuXG4iCiAgICAgICAgICAgICAgICBmIvCfk4og2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lfVxuIgogICAgICAgICAgICAgICAgZiLwn5OLINiq2YUg2KXYsdiz2KfZhCDYs9is2YQg2KfZhNi52YXZhNmK2KfYqiDYo9mK2LbYp9mLXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+UhCDYo9ix2LPZhCDYsdin2KjYtyDYotiu2LEg2YTZhNmF2LLZitivISIsCiAgICAgICAgICAgICAgICBwYXJzZV9tb2RlPSdNYXJrZG93bicKICAgICAgICAgICAgKQogICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgIyDYqtiz2KzZitmEINin2YTYrti32KMKICAgICAgICAgICAgc2VsZi5kZXRhaWxlZF9sb2dnZXIubG9nX2Vycm9yKGUsICLZhdi52KfZhNis2Kkg2KfZhNmB2YrYr9mK2Ygg2KfZhNmD2KfZhdmE2KkiKQogICAgICAgICAgICBzZWxmLmRldGFpbGVkX2xvZ2dlci5maW5pc2hfc2Vzc2lvbihzdWNjZXNzPUZhbHNlKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdix2LPYp9mEINiz2KzZhCDYp9mE2KPYrti32KfYoQogICAgICAgICAgICBsb2dfZmlsZSA9IHNlbGYuZGV0YWlsZWRfbG9nZ2VyLmdldF9sb2dfZmlsZSgpCiAgICAgICAgICAgIGlmIGxvZ19maWxlIGFuZCBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX2ZpbGUsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkubWVzc2FnZS5yZXBseV9kb2N1bWVudCgKICAgICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQ9ZiwKICAgICAgICAgICAgICAgICAgICAgICAgY2FwdGlvbj0i4p2MICoq2LPYrNmEINin2YTYo9iu2LfYp9ihKipcblxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLYrdiv2Ksg2K7Yt9ijINij2KvZhtin2KEg2KfZhNmF2LnYp9mE2KzYqS4g2KfZhNmF2YTZgSDZitit2KrZiNmKINi52YTZiSDYp9mE2KrZgdin2LXZitmEINin2YTZg9in2YXZhNipLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9J01hcmtkb3duJwogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2LHYs9in2YTYqSDYp9mE2K7Yt9ijCiAgICAgICAgICAgIGVycm9yX3RleHQgPSAoCiAgICAgICAgICAgICAgICBmIuKdjCAqKtit2K/YqyDYrti32KMg2KPYq9mG2KfYoSDYp9mE2YXYudin2YTYrNipKipcblxuIgogICAgICAgICAgICAgICAgZiLwn5OdINin2YTYrti32KM6IGB7c3RyKGUpWzoyMDBdfWBcblxuIgogICAgICAgICAgICAgICAgZiLwn5KhICoq2KfZhNit2YTZiNmEINin2YTZhdmC2KrYsdit2Kk6KipcbiIKICAgICAgICAgICAgICAgIGYi4oCiINiq2KPZg9ivINmF2YYg2LXYrdipINin2YTYsdin2KjYt1xuIgogICAgICAgICAgICAgICAgZiLigKIg2KrYrdmC2YIg2YXZhiDYo9mGINin2YTZhdmE2YEg2LnYp9mFIChHb29nbGUgRHJpdmUpXG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYrNix2Kgg2KzZiNiv2Kkg2KPZgtmEXG4iCiAgICAgICAgICAgICAgICBmIuKAoiDYsdin2KzYuSDZhdmE2YEg2KfZhNiz2KzZhCDZhNmE2KrZgdin2LXZitmEXG5cbiIKICAgICAgICAgICAgICAgIGYi8J+GmCDZhNmE2YXYs9in2LnYr9ipOiAvaGVscCIKICAgICAgICAgICAgKQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZXJyb3JfdGV4dCwgcGFyc2VfbW9kZT0nTWFya2Rvd24nKQogICAgCiAgICBkZWYgcnVuKHNlbGYpOgogICAgICAgICIiItiq2LTYutmK2YQg2KfZhNio2YjYqiIiIgogICAgICAgIHByaW50KCI9IiAqIDcwKQogICAgICAgIHByaW50KCLwn5qAINio2K/YoSDYqti02LrZitmEINio2YjYqiDYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNin2K3Yqtix2KfZgdmKIikKICAgICAgICBwcmludCgiPSIgKiA3MCkKICAgICAgICBwcmludChmIvCfk4Eg2KfZhNmF2KzZhNivINin2YTZhdik2YLYqjoge1RFTVBfRElSfSIpCiAgICAgICAgcHJpbnQoZiLwn5OLINmF2KzZhNivINin2YTYs9is2YTYp9iqOiB7TE9HU19ESVJ9IikKICAgICAgICBwcmludChmIvCfk6Yg2K3YryDYsdmB2LkgVGVsZWdyYW0gKNmE2YPZhCDYrNiy2KEpOiB7TUFYX1RFTEVHUkFNX1NJWkVfTUJ9INmF2YrYrNin2KjYp9mK2KoiKQogICAgICAgIHByaW50KCLinIUg2KfZhNio2YjYqiDYrNin2YfYsiDZhNmE2LnZhdmEISIpCiAgICAgICAgcHJpbnQoIj0iICogNzApCiAgICAgICAgCiAgICAgICAgIyDYqtmFINiq2LnYr9mK2YTZhyDZhNmE2LnZhdmEINmB2YogdGhyZWFkCgogICAgICAgIAogICAgICAgIGltcG9ydCBhc3luY2lvCgogICAgICAgIAogICAgICAgIGxvb3AgPSBhc3luY2lvLm5ld19ldmVudF9sb29wKCkKCiAgICAgICAgCiAgICAgICAgYXN5bmNpby5zZXRfZXZlbnRfbG9vcChsb29wKQoKICAgICAgICAKICAgICAgICBhc3luYyBkZWYgcnVuKCk6CgogICAgICAgIAogICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC5pbml0aWFsaXplKCkKCiAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnN0YXJ0KCkKCiAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IHNlbGYuYXBwLnVwZGF0ZXIuc3RhcnRfcG9sbGluZygpCgogICAgICAgIAogICAgICAgICAgICB0cnk6CgogICAgICAgIAogICAgICAgICAgICAgICAgd2hpbGUgVHJ1ZToKCiAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQoKICAgICAgICAKICAgICAgICAgICAgZXhjZXB0OgoKICAgICAgICAKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgCiAgICAgICAgICAgIGZpbmFsbHk6CgogICAgICAgIAogICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5hcHAudXBkYXRlci5zdG9wKCkKCiAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC5zdG9wKCkKCiAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmFwcC5zaHV0ZG93bigpCgogICAgICAgIAogICAgICAgIGxvb3AucnVuX3VudGlsX2NvbXBsZXRlKHJ1bigpKQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiMg8J+OryDZhtmC2LfYqSDYp9mE2KjYr9in2YrYqQojID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6CiAgICB0cnk6CiAgICAgICAgIyDYp9mE2KrYrdmC2YIg2YXZhiBGRm1wZWcKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnZmZtcGVnJywgJy12ZXJzaW9uJ10sIGNhcHR1cmVfb3V0cHV0PVRydWUsIGNoZWNrPVRydWUpCiAgICAgICAgICAgIHByaW50KCLinIUg2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJIEZGbXBlZyIpCiAgICAgICAgZXhjZXB0IChzdWJwcm9jZXNzLkNhbGxlZFByb2Nlc3NFcnJvciwgRmlsZU5vdEZvdW5kRXJyb3IpOgogICAgICAgICAgICBwcmludCgi4p2MIEZGbXBlZyDYutmK2LEg2YXYq9io2KohIikKICAgICAgICAgICAgcHJpbnQoItin2YTYsdis2KfYoSDYqtir2KjZitiq2Ycg2KjYp9mE2KPZhdixOiBzdWRvIGFwdCBpbnN0YWxsIGZmbXBlZyIpCiAgICAgICAgICAgIGV4aXQoMSkKICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINiq2YjZg9mGINin2YTYqNmI2KoKICAgICAgICBpZiBCT1RfVE9LRU4gPT0gIllPVVJfQk9UX1RPS0VOX0hFUkUiOgogICAgICAgICAgICBwcmludCgi4p2MINin2YTYsdis2KfYoSDYqti52K/ZitmEIEJPVF9UT0tFTiDZgdmKINin2YTZg9mI2K8hIikKICAgICAgICAgICAgZXhpdCgxKQogICAgICAgIAogICAgICAgICMg2KrYtNi62YrZhCDYp9mE2KjZiNiqCiAgICAgICAgYm90ID0gVmlkZW9Db21wcmVzc29yQm90KEJPVF9UT0tFTikKICAgICAgICBib3QucnVuKCkKICAgIAogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCJcbvCfkYsg2KrZhSDYpdmK2YLYp9mBINin2YTYqNmI2Kog2KjZiNin2LPYt9ipINin2YTZhdiz2KrYrtiv2YUiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdin2K/YrToge2V9IikKICAgICAgICBleGl0KDEpCg==",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
