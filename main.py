#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    uptime = ""
    if start_time:
        delta = datetime.now() - start_time
        hours = delta.seconds // 3600
        minutes = (delta.seconds % 3600) // 60
        uptime = f"{delta.days}d {hours}h {minutes}m"
    
    html = f"""
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ - 1 ÿ®Ÿàÿ™</title>
        <style>
            * {{ margin: 0; padding: 0; box-sizing: border-box; }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 800px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2.5em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 1.1em;
            }}
            .status {{
                background: #f0f9ff;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                border-right: 5px solid #10b981;
            }}
            .status h2 {{
                color: #10b981;
                margin-bottom: 15px;
                font-size: 1.5em;
            }}
            .bot-item {{
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzcWxpdGUzCmltcG9ydCBhc3luY2lvCmltcG9ydCBvcwppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHNodXRpbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdGVsZWdyYW0gaW1wb3J0IFVwZGF0ZSwgSW5saW5lS2V5Ym9hcmRCdXR0b24sIElubGluZUtleWJvYXJkTWFya3VwCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbiwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ2FsbGJhY2tRdWVyeUhhbmRsZXIsCiAgICBNZXNzYWdlSGFuZGxlciwKICAgIGZpbHRlcnMsCiAgICBDb250ZXh0VHlwZXMsCikKCiMgPT09PT09PT09PT09PT09PT09PT0g2KfZhNil2LnYr9in2K/Yp9iqINin2YTYq9in2KjYqtipID09PT09PT09PT09PT09PT09PT09ClRFTEVHUkFNX0JPVF9UT0tFTiA9ICI3ODcxNTgzNzYwOkFBRUFqMU5NbGdNVTdIOFkzVG8zYTdsR3ZTaFZaNzRCdnpVIgpBRE1JTl9JRCA9IDEwNTg2MTYzMTYKVEVMRUdSQU1fQVBJX0xJTUlUID0gMjAgKiAxMDI0ICogMTAyNCAgIyAyME1CCk1BWF9GSUxFX1NJWkUgPSAyMDAwICogMTAyNCAqIDEwMjQgICMgMkdCINin2YTYrdivINin2YTYo9mC2LXZiSDZhNmE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqQpESVJFQ1RfRE9XTkxPQURfTElNSVQgPSAyMCAqIDEwMjQgKiAxMDI0ICAjIDIwTUIg2K3YryDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsQoKIyDZhdis2YTYryDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoKVEVNUF9TVE9SQUdFX0RJUiA9ICJ0ZW1wX3ZpZGVvcyIKCiMg2LfYp9io2YjYsSDYp9mE2YXYudin2YTYrNipCnByb2Nlc3NpbmdfcXVldWUgPSBhc3luY2lvLlF1ZXVlKCkKaXNfcHJvY2Vzc2luZyA9IEZhbHNlCgojID09PT09PT09PT09PT09PT09PT09INil2K/Yp9ix2Kkg2KfZhNmF2YTZgdin2KogPT09PT09PT09PT09PT09PT09PT0KZGVmIGluaXRfdGVtcF9zdG9yYWdlKCk6CiAgICAiIiLYpdmG2LTYp9ihINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqiIiIgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgIG9zLm1ha2VkaXJzKFRFTVBfU1RPUkFHRV9ESVIpCiAgICBwcmludChmIuKchSDZhdis2YTYryDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2Ko6IHtURU1QX1NUT1JBR0VfRElSfSIpCgpkZWYgY2xlYW51cF9vbGRfZmlsZXMoKToKICAgICIiItit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqSDYudmG2K8g2KjYr9ihINin2YTYqti02LrZitmEIiIiCiAgICB0cnk6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgZmlsZSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShmaWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBvcy51bmxpbmsoZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIvCfl5HvuI8g2K3YsNmBINmF2YTZgSDZgtiv2YrZhToge2ZpbGV9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2K3YsNmBIHtmaWxlfToge2V9IikKICAgICAgICBwcmludCgi4pyFINiq2YUg2KrZhti42YrZgSDYp9mE2YXYrNmE2K8g2YXZhiDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNiq2YbYuNmK2YE6IHtlfSIpCgpkZWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX3BhdGg6IHN0cik6CiAgICAiIiLYrdiw2YEg2YXZhNmBINio2LTZg9mEINii2YXZhiIiIgogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIG9zLnVubGluayhmaWxlX3BhdGgpCiAgICAgICAgICAgIHByaW50KGYi8J+Xke+4jyDYqtmFINit2LDZgSDYp9mE2YXZhNmBOiB7ZmlsZV9wYXRofSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLimqDvuI8g2YHYtNmEINit2LDZgSDYp9mE2YXZhNmBIHtmaWxlX3BhdGh9OiB7ZX0iKQogICAgcmV0dXJuIEZhbHNlCgpkZWYgZ2V0X3N0b3JhZ2VfaW5mbygpOgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YXYs9in2K3YqSDYp9mE2KrYrtiy2YrZhtmK2KkiIiIKICAgIHRyeToKICAgICAgICB0b3RhbF9zaXplID0gMAogICAgICAgIGZpbGVfY291bnQgPSAwCiAgICAgICAgZmlsZXNfbGlzdCA9IFtdCiAgICAgICAgCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgZmlsZSkKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgdG90YWxfc2l6ZSArPSBzaXplCiAgICAgICAgICAgICAgICAgICAgZmlsZV9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgZmlsZXNfbGlzdC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdzaXplJzogc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnOiBmaWxlX3BhdGgKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICd0b3RhbF9zaXplJzogdG90YWxfc2l6ZSwKICAgICAgICAgICAgJ2ZpbGVfY291bnQnOiBmaWxlX2NvdW50LAogICAgICAgICAgICAnZmlsZXMnOiBmaWxlc19saXN0CiAgICAgICAgfQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNiq2K7YstmK2YY6IHtlfSIpCiAgICAgICAgcmV0dXJuIHsndG90YWxfc2l6ZSc6IDAsICdmaWxlX2NvdW50JzogMCwgJ2ZpbGVzJzogW119CgpkZWYgZm9ybWF0X3NpemUoc2l6ZV9ieXRlcyk6CiAgICAiIiLYqtit2YjZitmEINin2YTYrdis2YUg2KXZhNmJINi12YrYutipINmC2KfYqNmE2Kkg2YTZhNmC2LHYp9ih2KkiIiIKICAgIGZvciB1bml0IGluIFsnQicsICdLQicsICdNQicsICdHQiddOgogICAgICAgIGlmIHNpemVfYnl0ZXMgPCAxMDI0LjA6CiAgICAgICAgICAgIHJldHVybiBmIntzaXplX2J5dGVzOi4yZn0ge3VuaXR9IgogICAgICAgIHNpemVfYnl0ZXMgLz0gMTAyNC4wCiAgICByZXR1cm4gZiJ7c2l6ZV9ieXRlczouMmZ9IFRCIgoKIyA9PT09PT09PT09PT09PT09PT09PSDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KogPT09PT09PT09PT09PT09PT09PT0KZGVmIGluaXRfZGF0YWJhc2UoKToKICAgICIiItil2YbYtNin2KEg2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqINmI2KzYr9in2YjZhCDYp9mE2YXYs9iq2K7Yr9mF2YrZhiDZiNin2YTYpdi52K/Yp9iv2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICAKICAgIGMuZXhlY3V0ZSgnJydDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB1c2VycyAoCiAgICAgICAgdXNlcl9pZCBJTlRFR0VSIFBSSU1BUlkgS0VZLAogICAgICAgIHVzZXJuYW1lIFRFWFQsCiAgICAgICAgdG90YWxfdmlkZW9zIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgIGpvaW5lZF9kYXRlIFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QCiAgICApJycnKQogICAgCiAgICBjLmV4ZWN1dGUoJycnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgc2V0dGluZ3MgKAogICAgICAgIGtleSBURVhUIFBSSU1BUlkgS0VZLAogICAgICAgIHZhbHVlIFRFWFQKICAgICknJycpCiAgICAKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIHZhbHVlIEZST00gc2V0dGluZ3MgV0hFUkUga2V5ID0gJ2FwaV9rZXknIikKICAgIGlmIGMuZmV0Y2hvbmUoKSBpcyBOb25lOgogICAgICAgIGRlZmF1bHRfYXBpX2tleSA9ICJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpTVXpJMU5pSjkuZXlKaGRXUWlPaUl4SWl3aWFuUnBJam9pWmpFME4yTm1ORFUwWmpBelpUTXpOREF3TlRGbFpHUTRNekZtWTJKaFpETXlPVE0wTjJGaU1XTTBNMlJrTVRSbU1HTm1aamxrWkRBek56UXhOekUyTnpkbU1tWTVNMkV5Tm1GbVl6STJZVGdpTENKcFlYUWlPakUzTmpReE5UVXhNelF1TWpreU5qUTBMQ0p1WW1ZaU9qRTNOalF4TlRVeE16UXVNamt5TmpRMUxDSmxlSEFpT2pRNU1UazRNamczTXpRdU1qZzFNVEEzTENKemRXSWlPaUkzTXpVM05UVXlNU0lzSW5OamIzQmxjeUk2V3lKMFlYTnJMbmR5YVhSbElpd2lkR0Z6YXk1eVpXRmtaQ0o5Lmdnb2xFQnRsZEpJWnE3NFIxSDNTSTYxQUhUUGM0aUpSdnVnQkFXWTltQW9RT1czcmJhVXJRSGY4Q1REdVJZTmY2cG0weHBtQWdjRm42U3JUYncxNi16RUVSWWMxMXF2T0hHWTVxWFFva19haUZ5ajJHb2tHVHpiZjNuaGRoc3daUG10QWo2OVdsaldjZ2d0NlgtOWl3VHlDaERYS3FDN1U2RWplQTJhVzZYcHRYNVJ0dUs5eFhGX05BU0pldGM3cWlXWDFyOEt6ZGl3aGJGSm9rNGJJM2k5ZDhWVi1kSXREV1haSjNldUZmUGMtbHpPaHF3RGYyWkVBMXdQZzIwQmk2Z2QwSUUyUGdWUXBLeW5aeUZrdHU4V05QTlZ6aG5PSDB5RTFZYTZvZWh2SmFnWDR0bW43Z3gxbWZqck9KanRxQUQyRWcyRi04RGw3Z2Q4NmZoZXhPS2UwQmV3ZkxOVTFGVTZybmlVSDNqVGRMSmZBakw4TzZRc3V1TGVKWEc5RTJzNW1GcEdzcXhxQjdMTUNfR1hOMjdEbTQ0a2ptSG9CNDhtNnpXWVFzWjc1MURIU0o4cmpWUi1CemNTOUFqUWVnWVcwOG5JblJoWTJVZklOcnFOYmZ1N1U2OXNkbDRMMDladVZJRUFHbGpFMmt0Y1FDcXlIQ3F4aTRrSGlwTGE2cS1XUkZ2XzViRElwV2tGNkJIVWplRVFZVk4wX0YtYnplMWM4cWlYNm03blFOSGJtR2hJYUNVaW03TkhFSTlzejVidkpOTEtjOThWY3RSYW55ZUp2eS1ZTDlaY1AtLTE2U3cta2oxeWRUNzQzbUI0TnQwQUtTZjdBOUt3TXBLV2NpUFdrdnE2Q2VzajZlTVR0UzNIU04wV3Z3aGhPUTIwemNEQ3hXam5tMTZrIgogICAgICAgIGMuZXhlY3V0ZSgiSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyBzZXR0aW5ncyAoa2V5LCB2YWx1ZSkgVkFMVUVTICgnYXBpX2tleScsID8pIiwgKGRlZmF1bHRfYXBpX2tleSwpKQogICAgCiAgICBjb25uLmNvbW1pdCgpCiAgICBjb25uLmNsb3NlKCkKCmRlZiBnZXRfYXBpX2tleSgpOgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdmB2KrYp9itIEFQSSDZhdmGINmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCB2YWx1ZSBGUk9NIHNldHRpbmdzIFdIRVJFIGtleSA9ICdhcGlfa2V5JyIpCiAgICByZXN1bHQgPSBjLmZldGNob25lKCkKICAgIGNvbm4uY2xvc2UoKQogICAgcmV0dXJuIHJlc3VsdFswXSBpZiByZXN1bHQgZWxzZSBOb25lCgpkZWYgc2V0X2FwaV9rZXkobmV3X2tleSk6CiAgICAiIiLYrdmB2Lgg2YXZgdiq2KfYrSBBUEkg2KzYr9mK2K8g2YHZiiDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIHNldHRpbmdzIChrZXksIHZhbHVlKSBWQUxVRVMgKCdhcGlfa2V5JywgPykiLCAobmV3X2tleSwpKQogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgpkZWYgZ2V0X3VzZXIodXNlcl9pZCk6CiAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZhdiz2KrYrtiv2YUiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdTRUxFQ1QgdXNlcl9pZCwgdXNlcm5hbWUsIHRvdGFsX3ZpZGVvcywgam9pbmVkX2RhdGUgRlJPTSB1c2VycyBXSEVSRSB1c2VyX2lkID0gPycsICh1c2VyX2lkLCkpCiAgICB1c2VyID0gYy5mZXRjaG9uZSgpCiAgICBjb25uLmNsb3NlKCkKICAgIHJldHVybiB1c2VyCgpkZWYgY3JlYXRlX3VzZXIodXNlcl9pZCwgdXNlcm5hbWUpOgogICAgIiIi2KXZhti02KfYoSDZhdiz2KrYrtiv2YUg2KzYr9mK2K8iIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdJTlNFUlQgT1IgSUdOT1JFIElOVE8gdXNlcnMgKHVzZXJfaWQsIHVzZXJuYW1lKSBWQUxVRVMgKD8sID8pJywgKHVzZXJfaWQsIHVzZXJuYW1lKSkKICAgIGNvbm4uY29tbWl0KCkKICAgIGNvbm4uY2xvc2UoKQoKZGVmIGluY3JlbWVudF92aWRlb19jb3VudCh1c2VyX2lkKToKICAgICIiItiy2YrYp9iv2Kkg2LnYr9in2K8g2KfZhNmB2YrYr9mK2YjZh9in2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdVUERBVEUgdXNlcnMgU0VUIHRvdGFsX3ZpZGVvcyA9IHRvdGFsX3ZpZGVvcyArIDEgV0hFUkUgdXNlcl9pZCA9ID8nLCAodXNlcl9pZCwpKQogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgojID09PT09PT09PT09PT09PT09PT09INiv2YjYp9mEINiq2YTZitis2LHYp9mFID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBzZW5kX21lc3NhZ2UoY2hhdF9pZDogc3RyLCB0ZXh0OiBzdHIsIGNvbnRleHQ9Tm9uZSk6CiAgICAiIiLYpdix2LPYp9mEINix2LPYp9mE2Kkg2YbYtdmK2KkiIiIKICAgIHRyeToKICAgICAgICBpZiBjb250ZXh0OgogICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoY2hhdF9pZD1jaGF0X2lkLCB0ZXh0PXRleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgICAgICBlbHNlOgogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7VEVMRUdSQU1fQk9UX1RPS0VOfS9zZW5kTWVzc2FnZSIKICAgICAgICAgICAgcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9eyJjaGF0X2lkIjogY2hhdF9pZCwgInRleHQiOiB0ZXh0LCAicGFyc2VfbW9kZSI6ICdNYXJrZG93bid9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi2K7Yt9ijINmB2Yog2KXYsdiz2KfZhCDYp9mE2LHYs9in2YTYqToge2V9IikKCiMgPT09PT09PT09PT09PT09PT09PT0g2KPZiNin2YXYsSDYp9mE2KjZiNiqID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBzdGFydF9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvc3RhcnQiIiIKICAgIHVzZXIgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIKICAgIGNyZWF0ZV91c2VyKHVzZXIuaWQsIHVzZXIudXNlcm5hbWUpCiAgICAKICAgIGtleWJvYXJkX3Jvd3MgPSBbCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINit2LPYp9io2Yog2YjYpdit2LXYp9im2YrYp9iq2YoiLCBjYWxsYmFja19kYXRhPSJteV9hY2NvdW50IildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4oS577iPINin2YTZhdiz2KfYudiv2KkiLCBjYWxsYmFja19kYXRhPSJoZWxwIildCiAgICBdCiAgICAKICAgIGlmIHVzZXIuaWQgPT0gQURNSU5fSUQ6CiAgICAgICAga2V5Ym9hcmRfcm93cy5hcHBlbmQoW0lubGluZUtleWJvYXJkQnV0dG9uKCLimpnvuI8g2KXYudiv2KfYr9in2Kog2KfZhNmF2LTYsdmBIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV0pCgogICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmRfcm93cykKICAgIAogICAgd2VsY29tZV90ZXh0ID0gZiIiIgrwn46sINmF2LHYrdio2KfZiyB7dXNlci5maXJzdF9uYW1lfSEKCtij2YbYpyDYqNmI2Kog2LbYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqLiDYp9mE2KLZhiDYo9mG2KcgKirZhdis2KfZhtmKINio2KfZhNmD2KfZhdmEINmI2KjYr9mI2YYg2YLZitmI2K8qKiEg8J+agAoKKirwn46vINin2YTZhdmF2YrYstin2Ko6KioK4pyoINmF2LnYp9mE2KzYqSDZhdmE2YHYp9iqINit2KrZiSAqKjJHQioqINi52KjYsSDYp9mE2LHZiNin2KjYtwrinKgg2KrYrdmF2YrZhCDZhdio2KfYtNixINit2KrZiSAyME1CINmF2YYg2KrZitmE2YrYrNix2KfZhQrinKgg2K/YudmFINin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2KkgKEdvb2dsZSBEcml2ZSwgRHJvcGJveCwg2KXZhNiuKQrinKggMyDZhdiz2KrZiNmK2KfYqiDYtti62Lcg2YLZiNmK2Kkg2YXYuSAqKtin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkqKgrinKgg2K3YsNmBINiq2YTZgtin2KbZiiDZhNmE2YXZhNmB2KfYqiDYqNi52K8g2KfZhNil2LHYs9in2YQKCvCfk6QgKirZhNmE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqSAoKzIwTUIpOioqCtin2LHZgdi5INin2YTZgdmK2K/ZitmIINmE2YAgR29vZ2xlIERyaXZlINij2YggRHJvcGJveCDZiNij2LHYs9mEINin2YTYsdin2KjYtyDYp9mE2YXYqNin2LTYsSEKCvCfk6QgKirZhNmE2YXZhNmB2KfYqiDYp9mE2LXYutmK2LHYqSAoLTIwTUIpOioqCtij2LHYs9mEINin2YTZgdmK2K/ZitmIINmF2KjYp9i02LHYqSDZhdmGINiq2YrZhNmK2KzYsdin2YUhCiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHdlbGNvbWVfdGV4dCwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCmFzeW5jIGRlZiBteV9hY2NvdW50X2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9hY2NvdW50IC0g2LnYsdi2INmF2LnZhNmI2YXYp9iqINin2YTYrdiz2KfYqCIiIgogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgdXNlcl9kYXRhID0gZ2V0X3VzZXIodXNlcl9pZCkKICAgIAogICAgaWYgdXNlcl9kYXRhOgogICAgICAgIHVzZXJfaWQsIHVzZXJuYW1lLCB0b3RhbF92aWRlb3MsIGpvaW5lZF9kYXRlID0gdXNlcl9kYXRhCiAgICAgICAgYWNjb3VudF90ZXh0ID0gZiIiIgrwn5OKICoq2YXYudmE2YjZhdin2Kog2K3Ys9in2KjZgzoqKgoK8J+RpCDYp9mE2YXYudix2YE6IHt1c2VyX2lkfQrwn46sINi52K/YryDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2YXYtti62YjYt9ipOiB7dG90YWxfdmlkZW9zfQrwn5OFINiq2KfYsdmK2K4g2KfZhNin2YbYttmF2KfZhToge2pvaW5lZF9kYXRlfQoiIiIKICAgIGVsc2U6CiAgICAgICAgYWNjb3VudF90ZXh0ID0gIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINit2LPYp9io2YMuINin2LPYqtiu2K/ZhSAvc3RhcnQg2KPZiNmE2KfZiy4iCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoYWNjb3VudF90ZXh0KQoKYXN5bmMgZGVmIHNldGFwaWtleV9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvc2V0YXBpa2V5IC0g2KrYudmK2YrZhiDZhdmB2KrYp9itIEFQSSAo2YTZhNmF2LTYsdmBINmB2YLYtykiIiIKICAgIGlmIHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZCAhPSBBRE1JTl9JRDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLim5Qg2YfYsNinINin2YTYo9mF2LEg2YTZhNmF2LTYsdmBINmB2YLYtyEiKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBsZW4oY29udGV4dC5hcmdzKSA9PSAwOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKaoO+4jyDYp9mE2KfYs9iq2K7Yr9in2YU6IC9zZXRhcGlrZXkgPHlvdXJfYXBpX2tleT4iKQogICAgICAgIHJldHVybgogICAgCiAgICBuZXdfa2V5ID0gY29udGV4dC5hcmdzWzBdCiAgICBzZXRfYXBpX2tleShuZXdfa2V5KQogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINiq2YUg2KrYrdiv2YrYqyDZhdmB2KrYp9itIEFQSSDYqNmG2KzYp9itISIpCgphc3luYyBkZWYgc3RhdHNfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL3N0YXRzIC0g2LnYsdi2INil2K3Ytdin2KbZitin2Kog2LnYp9mF2KkgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICAKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIENPVU5UKCopIEZST00gdXNlcnMiKQogICAgdG90YWxfdXNlcnMgPSBjLmZldGNob25lKClbMF0KICAgIAogICAgYy5leGVjdXRlKCJTRUxFQ1QgU1VNKHRvdGFsX3ZpZGVvcykgRlJPTSB1c2VycyIpCiAgICB0b3RhbF92aWRlb3MgPSBjLmZldGNob25lKClbMF0gb3IgMAogICAgCiAgICBjb25uLmNsb3NlKCkKICAgIAogICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAKICAgIHN0YXRzX3RleHQgPSBmIiIiCvCfk4ogKirYpdit2LXYp9im2YrYp9iqINin2YTYqNmI2Ko6KioKCvCfkaUg2LnYr9ivINin2YTZhdiz2KrYrtiv2YXZitmGOiB7dG90YWxfdXNlcnN9CvCfjqwg2KXYrNmF2KfZhNmKINin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdi22LrZiNi32Kk6IHt0b3RhbF92aWRlb3N9CvCfk6Yg2LnYr9ivINin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipOiB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J119CvCfkr4g2YXYs9in2K3YqSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9CiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHN0YXRzX3RleHQpCgphc3luYyBkZWYgZmlsZXNfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL2ZpbGVzIC0g2LnYsdi2INin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgCiAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA9PSAwOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKchSDZhNinINiq2YjYrNivINmF2YTZgdin2Kog2YXYrtiy2YbYqSDYrdin2YTZitin2YsuIikKICAgICAgICByZXR1cm4KICAgIAogICAgZmlsZXNfdGV4dCA9IGYi8J+TpiAqKtin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICh7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J119KToqKlxuXG4iCiAgICAKICAgIGZvciBpLCBmaWxlX2luZm8gaW4gZW51bWVyYXRlKHN0b3JhZ2VfaW5mb1snZmlsZXMnXVs6MTBdLCAxKToKICAgICAgICBmaWxlc190ZXh0ICs9IGYie2l9LiBge2ZpbGVfaW5mb1snbmFtZSddfWBcbiAgINin2YTYrdis2YU6IHtmb3JtYXRfc2l6ZShmaWxlX2luZm9bJ3NpemUnXSl9XG5cbiIKICAgIAogICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiAxMDoKICAgICAgICBmaWxlc190ZXh0ICs9IGYiXG4uLi4g2Ygge3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddIC0gMTB9INmF2YTZgSDYotiu2LEiCiAgICAKICAgIGZpbGVzX3RleHQgKz0gZiJcbvCfkr4g2KfZhNil2KzZhdin2YTZijoge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0iCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZmlsZXNfdGV4dCkKCmFzeW5jIGRlZiBjbGVhbnVwX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9jbGVhbnVwIC0g2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgZGVsZXRlZF9jb3VudCA9IDAKICAgIAogICAgZm9yIGZpbGVfaW5mbyBpbiBzdG9yYWdlX2luZm9bJ2ZpbGVzJ106CiAgICAgICAgaWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSk6CiAgICAgICAgICAgIGRlbGV0ZWRfY291bnQgKz0gMQogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFINiq2YUg2K3YsNmBIHtkZWxldGVkX2NvdW50fSDZhdmE2YEg2KjZhtis2KfYrSEiKQoKYXN5bmMgZGVmIGJ1dHRvbl9oYW5kbGVyKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItmF2LnYp9mE2Kwg2KfZhNij2LLYsdin2LEiIiIKICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQogICAgCiAgICBkYXRhID0gcXVlcnkuZGF0YQogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTZhdmE2YHYp9iqCiAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoInF1YWxpdHlfIik6CiAgICAgICAgcXVhbGl0eSA9IGRhdGEucmVwbGFjZSgicXVhbGl0eV8iLCAiIikKICAgICAgICAKICAgICAgICBwZW5kaW5nID0gY29udGV4dC51c2VyX2RhdGEuZ2V0KCdwZW5kaW5nX3ZpZGVvJykKICAgICAgICBpZiBub3QgcGVuZGluZzoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYp9mG2KrZh9iqINi12YTYp9it2YrYqSDYp9mE2LfZhNioLiDYo9ix2LPZhCDYp9mE2YHZitiv2YrZiCDZhdix2Kkg2KPYrtix2YkuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgY2hhdF9pZCA9IHBlbmRpbmdbJ2NoYXRfaWQnXQogICAgICAgIAogICAgICAgIGF3YWl0IHByb2Nlc3NpbmdfcXVldWUucHV0KHsKICAgICAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICAgICAnc291cmNlJzogcGVuZGluZ1snZmlsZV9pZCddLAogICAgICAgICAgICAndHlwZSc6ICdmaWxlX2lkJywKICAgICAgICAgICAgJ2ZpbGVfc2l6ZSc6IHBlbmRpbmdbJ2ZpbGVfc2l6ZSddLAogICAgICAgICAgICAncXVhbGl0eSc6IHF1YWxpdHkKICAgICAgICB9KQogICAgICAgIAogICAgICAgIHF1ZXVlX3NpemUgPSBwcm9jZXNzaW5nX3F1ZXVlLnFzaXplKCkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmIuKchSDYqtmF2Kog2KXYttin2YHYqSDYp9mE2YHZitiv2YrZiCDZhNmE2LfYp9io2YjYsSFcbvCflKIg2KfZhNmF2YjYtti5INmB2Yog2KfZhNi32KfYqNmI2LE6IHtxdWV1ZV9zaXplfSIpCiAgICAKICAgICMg2YXYudin2YTYrNipINin2K7YqtmK2KfYsSDYp9mE2KzZiNiv2Kkg2YTZhNix2YjYp9io2LcKICAgIGVsaWYgZGF0YS5zdGFydHN3aXRoKCJxdWFsaXR5X3VybF8iKToKICAgICAgICBxdWFsaXR5ID0gZGF0YS5yZXBsYWNlKCJxdWFsaXR5X3VybF8iLCAiIikKICAgICAgICAKICAgICAgICBwZW5kaW5nID0gY29udGV4dC51c2VyX2RhdGEuZ2V0KCdwZW5kaW5nX3ZpZGVvJykKICAgICAgICBpZiBub3QgcGVuZGluZzoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYp9mG2KrZh9iqINi12YTYp9it2YrYqSDYp9mE2LfZhNioLiDYo9ix2LPZhCDYp9mE2LHYp9io2Lcg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGNoYXRfaWQgPSBwZW5kaW5nWydjaGF0X2lkJ10KICAgICAgICAKICAgICAgICBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLnB1dCh7CiAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgJ3NvdXJjZSc6IHBlbmRpbmdbJ3VybCddLAogICAgICAgICAgICAndHlwZSc6ICd1cmwnLAogICAgICAgICAgICAncXVhbGl0eSc6IHF1YWxpdHkKICAgICAgICB9KQogICAgICAgIAogICAgICAgIHF1ZXVlX3NpemUgPSBwcm9jZXNzaW5nX3F1ZXVlLnFzaXplKCkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmIuKchSDYqtmF2Kog2KXYttin2YHYqSDYp9mE2LHYp9io2Lcg2YTZhNi32KfYqNmI2LEhXG7wn5SiINin2YTZhdmI2LbYuSDZgdmKINin2YTYt9in2KjZiNixOiB7cXVldWVfc2l6ZX0iKQogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYo9iy2LHYp9ixINin2YTZgtin2KbZhdipINin2YTYsdim2YrYs9mK2KkKICAgIGVsaWYgZGF0YSA9PSAibXlfYWNjb3VudCI6CiAgICAgICAgdXNlcl9kYXRhID0gZ2V0X3VzZXIodXNlcl9pZCkKICAgICAgICBpZiB1c2VyX2RhdGE6CiAgICAgICAgICAgIHVzZXJfaWRfZGIsIHVzZXJuYW1lLCB0b3RhbF92aWRlb3MsIGpvaW5lZF9kYXRlID0gdXNlcl9kYXRhCiAgICAgICAgICAgIGFjY291bnRfdGV4dCA9IGYiIiIK8J+TiiAqKtmF2LnZhNmI2YXYp9iqINit2LPYp9io2YM6KioKCvCfkaQg2KfZhNmF2LnYsdmBOiB7dXNlcl9pZF9kYn0K8J+OrCDYudiv2K8g2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmF2LbYutmI2LfYqToge3RvdGFsX3ZpZGVvc30K8J+ThSDYqtin2LHZitiuINin2YTYp9mG2LbZhdin2YU6IHtqb2luZWRfZGF0ZX0KIiIiCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYWNjb3VudF90ZXh0ID0gIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINit2LPYp9io2YMuIgogICAgICAgIAogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJiYWNrX3RvX3N0YXJ0IildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChhY2NvdW50X3RleHQsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJoZWxwIjoKICAgICAgICBoZWxwX3RleHQgPSAiIiIK4oS577iPICoq2YPZitmB2YrYqSDYp9iz2KrYrtiv2KfZhSDYp9mE2KjZiNiqOioqCgoqKvCfk6Ug2YTZhNmF2YTZgdin2Kog2KfZhNi12LrZitix2KkgKNij2YLZhCDZhdmGIDIwTUIpOioqCjHvuI/ig6Mg2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYqNin2LTYsdipINmF2YYg2KrZitmE2YrYrNix2KfZhQoy77iP4oOjINin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipCjPvuI/ig6Mg2KfZhtiq2LjYsSDYrdiq2Ykg2YrYqtmFINin2YTYtti62Lcg2YjYp9mE2KXYsdiz2KfZhAoKKirwn5OkINmE2YTZhdmE2YHYp9iqINin2YTZg9io2YrYsdipICjYo9mD2KjYsSDZhdmGIDIwTUIpOioqCjHvuI/ig6Mg2KfYsdmB2Lkg2KfZhNmB2YrYr9mK2Ygg2LnZhNmJINil2K3Yr9mJINin2YTZhdmG2LXYp9iqOgogICDigKIgR29vZ2xlIERyaXZlICjYrdiq2YkgMTVHQiDZhdis2KfZhtin2YspCiAgIOKAoiBEcm9wYm94ICjYrdiq2YkgMkdCINmF2KzYp9mG2KfZiykKICAg4oCiIE1lZGlhRmlyZQogICAKMu+4j+KDoyDYp9it2LXZhCDYudmE2Ykg2LHYp9io2Lcg2KfZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LE6CiAgIAogICAqKkdvb2dsZSBEcml2ZToqKgogICBgaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD1GSUxFX0lEYAogICAKICAgKipEcm9wYm94OioqCiAgIGBodHRwczovL3d3dy5kcm9wYm94LmNvbS9zL3h4eHh4L3ZpZGVvLm1wND9kbD0xYAogICAKM++4j+KDoyDYo9ix2LPZhCDYp9mE2LHYp9io2Lcg2YTZhNio2YjYqgo077iP4oOjINin2K7YqtixINmF2LPYqtmI2Ykg2KfZhNis2YjYr9ipCgoqKvCfjq8g2YXYs9iq2YjZitin2Kog2KfZhNis2YjYr9ipOioqCvCflKUgKirYudin2YTZitipKiogLSDYrNmI2K/YqSDZhdmF2KrYp9iy2KnYjCDYrdis2YUg2KPZgtmEINmC2YTZitmE2KfZiwrimpbvuI8gKirZhdiq2YjYs9i32KkqKiAtINiq2YjYp9iy2YYg2KjZitmGINin2YTYrNmI2K/YqSDZiNin2YTYrdis2YUgIArwn5K+ICoq2YXZhtiu2YHYttipKiogLSDYo9mC2YQg2K3YrNmFINmF2YXZg9mG2Iwg2KzZiNiv2Kkg2YXZgtio2YjZhNipCgrinKggKirZhdmK2LLYqSDZhdmH2YXYqSoqOiDYp9mE2KjZiNiqINmK2K3Zgdi4INij2KjYudin2K8g2KfZhNmB2YrYr9mK2Ygg2KfZhNij2LXZhNmK2KkhCtin2YTYtti62Lcg2YrYqtmFINmB2YLYtyDYqNiq2YLZhNmK2YQg2KfZhNis2YjYr9ipIPCfjq8KCuKaoO+4jyAqKtmF2YTYp9it2LjYp9iqOioqCuKAoiDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsTog2K3YqtmJIDIwTUIg2YHZgti3CuKAoiDYp9mE2LHZiNin2KjYtyDYp9mE2K7Yp9ix2KzZitipOiDYrdiq2YkgMkdCCuKAoiDYrdiw2YEg2KrZhNmC2KfYptmKINmE2YTZhdmE2YHYp9iqINio2LnYryDYp9mE2KXYsdiz2KfZhAoiIiIKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYmFja190b19zdGFydCIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoaGVscF90ZXh0LCByZXBseV9tYXJrdXA9YmFja19idXR0b24pCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fc2V0dGluZ3MiOgogICAgICAgIGlmIHVzZXJfaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigi4puUINmH2LDYpyDZhNmE2YXYtNix2YEg2YHZgti3ISIsIHNob3dfYWxlcnQ9VHJ1ZSkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAga2V5Ym9hcmQgPSBbCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+TiiDYp9mE2KXYrdi12KfYptmK2KfYqiIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3N0YXRzIildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfk6Yg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9maWxlcyIpXSwKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5eR77iPINit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX2NsZWFudXAiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJiYWNrX3RvX3N0YXJ0IildCiAgICAgICAgXQogICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLimpnvuI8gKirYpdi52K/Yp9iv2KfYqiDYp9mE2YXYtNix2YE6KioiLCByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX3N0YXRzIjoKICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICAgICAgYy5leGVjdXRlKCJTRUxFQ1QgQ09VTlQoKikgRlJPTSB1c2VycyIpCiAgICAgICAgdG90YWxfdXNlcnMgPSBjLmZldGNob25lKClbMF0KICAgICAgICBjLmV4ZWN1dGUoIlNFTEVDVCBTVU0odG90YWxfdmlkZW9zKSBGUk9NIHVzZXJzIikKICAgICAgICB0b3RhbF92aWRlb3MgPSBjLmZldGNob25lKClbMF0gb3IgMAogICAgICAgIGNvbm4uY2xvc2UoKQogICAgICAgIAogICAgICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgICAgIAogICAgICAgIHN0YXRzX3RleHQgPSBmIiIiCvCfk4ogKirYpdit2LXYp9im2YrYp9iqINin2YTYqNmI2Ko6KioKCvCfkaUg2LnYr9ivINin2YTZhdiz2KrYrtiv2YXZitmGOiB7dG90YWxfdXNlcnN9CvCfjqwg2KXYrNmF2KfZhNmKINin2YTZgdmK2K/ZitmI2YfYp9iqOiB7dG90YWxfdmlkZW9zfQrwn5OmINin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipOiB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J119CvCfkr4g2KfZhNmF2LPYp9it2Kkg2KfZhNmF2LPYqtiu2K/ZhdipOiB7Zm9ybWF0X3NpemUoc3RvcmFnZV9pbmZvWyd0b3RhbF9zaXplJ10pfQoiIiIKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KHN0YXRzX3RleHQsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJhZG1pbl9maWxlcyI6CiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPT0gMDoKICAgICAgICAgICAgZmlsZXNfdGV4dCA9ICLinIUg2YTYpyDYqtmI2KzYryDZhdmE2YHYp9iqINmF2K7YstmG2Kkg2K3Yp9mE2YrYp9mLLiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBmaWxlc190ZXh0ID0gZiLwn5OmICoq2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2KkgKHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0pOioqXG5cbiIKICAgICAgICAgICAgZm9yIGksIGZpbGVfaW5mbyBpbiBlbnVtZXJhdGUoc3RvcmFnZV9pbmZvWydmaWxlcyddWzoxMF0sIDEpOgogICAgICAgICAgICAgICAgZmlsZXNfdGV4dCArPSBmIntpfS4gYHtmaWxlX2luZm9bJ25hbWUnXVs6MzBdfS4uLmBcbiAgIHtmb3JtYXRfc2l6ZShmaWxlX2luZm9bJ3NpemUnXSl9XG5cbiIKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID4gMTA6CiAgICAgICAgICAgICAgICBmaWxlc190ZXh0ICs9IGYiXG4uLi4g2Ygge3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddIC0gMTB9INmF2YTZgSDYotiu2LEiCiAgICAgICAgICAgIAogICAgICAgICAgICBmaWxlc190ZXh0ICs9IGYiXG7wn5K+INin2YTYpdis2YXYp9mE2Yo6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9IgogICAgICAgIAogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZmlsZXNfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2NsZWFudXAiOgogICAgICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgICAgIGRlbGV0ZWRfY291bnQgPSAwCiAgICAgICAgCiAgICAgICAgZm9yIGZpbGVfaW5mbyBpbiBzdG9yYWdlX2luZm9bJ2ZpbGVzJ106CiAgICAgICAgICAgIGlmIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9pbmZvWydwYXRoJ10pOgogICAgICAgICAgICAgICAgZGVsZXRlZF9jb3VudCArPSAxCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmIuKchSDYqtmFINit2LDZgSB7ZGVsZXRlZF9jb3VudH0g2YXZhNmBISIsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJiYWNrX3RvX3N0YXJ0IjoKICAgICAgICB1c2VyID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyCiAgICAgICAga2V5Ym9hcmRfcm93cyA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINit2LPYp9io2Yog2YjYpdit2LXYp9im2YrYp9iq2YoiLCBjYWxsYmFja19kYXRhPSJteV9hY2NvdW50IildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKEue+4jyDYp9mE2YXYs9in2LnYr9ipIiwgY2FsbGJhY2tfZGF0YT0iaGVscCIpXQogICAgICAgIF0KICAgICAgICAKICAgICAgICBpZiB1c2VyLmlkID09IEFETUlOX0lEOgogICAgICAgICAgICBrZXlib2FyZF9yb3dzLmFwcGVuZChbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKame+4jyDYpdi52K/Yp9iv2KfYqiDYp9mE2YXYtNix2YEiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXSkKICAgICAgICAKICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZF9yb3dzKQogICAgICAgIAogICAgICAgIHdlbGNvbWVfdGV4dCA9IGYiIiIK8J+OrCDZhdix2K3YqNin2Ysge3VzZXIuZmlyc3RfbmFtZX0hCgrYo9mG2Kcg2KjZiNiqINi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiAtICoq2YXYrNin2YbZiiDYqNin2YTZg9in2YXZhCoqIPCfmoAKCioq8J+OryDYp9mE2YXZhdmK2LLYp9iqOioqCuKcqCDZhdmE2YHYp9iqINit2KrZiSAqKjJHQioqINi52KjYsSDYp9mE2LHZiNin2KjYtwrinKgg2KrYrdmF2YrZhCDZhdio2KfYtNixINit2KrZiSAyME1CCuKcqCAzINmF2LPYqtmI2YrYp9iqINi22LrYtyDZgtmI2YrYqQrinKgg2K3YsNmBINiq2YTZgtin2KbZiiDZhNmE2YXZhNmB2KfYqgoKKirwn5OkINmD2YrZgSDYqtio2K/YozoqKgrigKIg2YXZhNmB2KfYqiDYtdi62YrYsdipOiDYo9ix2LPZhCDZhdio2KfYtNix2KkK4oCiINmF2YTZgdin2Kog2YPYqNmK2LHYqTog2KfYsdmB2Lkg2LnZhNmJIERyaXZlL0Ryb3Bib3gg2YjYo9ix2LPZhCDYp9mE2LHYp9io2LcKCtin2LbYuti3ICLYp9mE2YXYs9in2LnYr9ipIiDZhNmF2LnYsdmB2Kkg2KfZhNiq2YHYp9i12YrZhCEg8J+TmgoiIiIKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCh3ZWxjb21lX3RleHQsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgojID09PT09PT09PT09PT09PT09PT09INmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCA9PT09PT09PT09PT09PT09PT09PQphc3luYyBkZWYgZG93bmxvYWRfZmlsZV9mcm9tX3RlbGVncmFtKGNvbnRleHQsIGZpbGVfaWQ6IHN0ciwgZmlsZV9zaXplOiBpbnQpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAiIiLYqtit2YXZitmEINmF2YTZgSDZhdmGINiq2YTZitis2LHYp9mFINil2YTZiSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoiIiIKICAgIHRyeToKICAgICAgICBwcmludChmIvCfk6Ug2KrYrdmF2YrZhCDZhdmGIFRlbGVncmFtLi4uINin2YTYrdis2YU6IHtmaWxlX3NpemUgLyAoMTAyNCoxMDI0KTouMmZ9IE1CIikKICAgICAgICAKICAgICAgICBmaWxlID0gYXdhaXQgY29udGV4dC5ib3QuZ2V0X2ZpbGUoZmlsZV9pZCkKICAgICAgICAKICAgICAgICAjINit2YHYuCDZgdmKINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqgogICAgICAgIHRpbWVzdGFtcCA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICB0ZW1wX2ZpbGVuYW1lID0gZiJ2aWRlb197dGltZXN0YW1wfV97ZmlsZV9pZFs6MTBdfS5tcDQiCiAgICAgICAgdGVtcF9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIHRlbXBfZmlsZW5hbWUpCiAgICAgICAgCiAgICAgICAgYXdhaXQgZmlsZS5kb3dubG9hZF90b19kcml2ZSh0ZW1wX3BhdGgpCiAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhDoge3RlbXBfcGF0aH0iKQogICAgICAgIAogICAgICAgIHJldHVybiB0ZW1wX3BhdGgKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2KrYrdmF2YrZhDoge2V9IikKICAgICAgICByZXR1cm4gTm9uZQoKZGVmIGdldF9xdWFsaXR5X3NldHRpbmdzKHF1YWxpdHk6IHN0cikgLT4gZGljdDoKICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2KXYudiv2KfYr9in2Kog2KfZhNis2YjYr9ipIC0g2KjYr9mI2YYg2KrYutmK2YrYsSDYp9mE2KPYqNi52KfYryIiIgogICAgaWYgcXVhbGl0eSA9PSAnaGlnaCc6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImNyZiI6IDI4LAogICAgICAgICAgICAicHJlc2V0IjogIm1lZGl1bSIsCiAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogOTYsCiAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiA0NDEwMCwKICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogMgogICAgICAgIH0KICAgIGVsaWYgcXVhbGl0eSA9PSAnbWVkaXVtJzoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMzMsCiAgICAgICAgICAgICJwcmVzZXQiOiAibWVkaXVtIiwKICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiA2NCwKICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IDQ0MTAwLAogICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiAyCiAgICAgICAgfQogICAgZWxzZTogICMgbG93CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgImNyZiI6IDM4LAogICAgICAgICAgICAicHJlc2V0IjogImZhc3QiLAogICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IDQ4LAogICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5IjogMjIwNTAsCiAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IDEKICAgICAgICB9CgpkZWYgY29tcHJlc3NfdmlkZW8odmlkZW9fc291cmNlOiBzdHIsIGNoYXRfaWQ6IHN0ciwgY29udGV4dCwgcXVhbGl0eTogc3RyID0gJ2xvdycsIGlzX3VybDogYm9vbCA9IFRydWUpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAiIiLYtti62Lcg2KfZhNmB2YrYr9mK2Ygg2KjYp9iz2KrYrtiv2KfZhSBDbG91ZENvbnZlcnQgLSDZhdi5INin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkiIiIKICAgIGFwaV9rZXkgPSBnZXRfYXBpX2tleSgpCiAgICBpZiBub3QgYXBpX2tleToKICAgICAgICByZXR1cm4gIk5PX0FQSV9LRVlfU0VUIgoKICAgIHRyeToKICAgICAgICBoZWFkZXJzID0geyJBdXRob3JpemF0aW9uIjogZiJCZWFyZXIge2FwaV9rZXl9In0KICAgICAgICBzZXR0aW5ncyA9IGdldF9xdWFsaXR5X3NldHRpbmdzKHF1YWxpdHkpCiAgICAgICAgCiAgICAgICAgIyDYqtit2K/ZitivINit2YXZiNmE2KkgSm9iIC0g2KjYr9mI2YYgd2lkdGgg2YggaGVpZ2h0INmE2K3Zgdi4INin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipCiAgICAgICAgaWYgaXNfdXJsOgogICAgICAgICAgICBqb2JfcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJ0YXNrcyI6IHsKICAgICAgICAgICAgICAgICAgICAiaW1wb3J0LXZpZGVvIjogeyJvcGVyYXRpb24iOiAiaW1wb3J0L3VybCIsICJ1cmwiOiB2aWRlb19zb3VyY2UsICJmaWxlbmFtZSI6ICJ2aWRlby5tcDQifSwKICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3MtdmlkZW8iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcGVyYXRpb24iOiAiY29udmVydCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiaW5wdXQiOiAiaW1wb3J0LXZpZGVvIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJvdXRwdXRfZm9ybWF0IjogIm1wNCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2aWRlb19jb2RlYyI6ICJ4MjY0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJjcmYiOiBzZXR0aW5nc1siY3JmIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAicHJlc2V0Ijogc2V0dGluZ3NbInByZXNldCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY29kZWMiOiAiYWFjIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogc2V0dGluZ3NbImF1ZGlvX2JpdHJhdGUiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiBzZXR0aW5nc1siYXVkaW9fZnJlcXVlbmN5Il0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiBzZXR0aW5nc1siYXVkaW9fY2hhbm5lbHMiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpcF9tZXRhZGF0YSI6IFRydWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJleHBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJleHBvcnQvdXJsIiwgImlucHV0IjogImNvbXByZXNzLXZpZGVvIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGpvYl9wYXlsb2FkID0gewogICAgICAgICAgICAgICAgInRhc2tzIjogewogICAgICAgICAgICAgICAgICAgICJpbXBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJpbXBvcnQvdXBsb2FkIn0sCiAgICAgICAgICAgICAgICAgICAgImNvbXByZXNzLXZpZGVvIjogewogICAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogImNvbnZlcnQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0IjogImltcG9ydC12aWRlbyIsIAogICAgICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2Zvcm1hdCI6ICJtcDQiLAogICAgICAgICAgICAgICAgICAgICAgICAidmlkZW9fY29kZWMiOiAieDI2NCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiY3JmIjogc2V0dGluZ3NbImNyZiJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgInByZXNldCI6IHNldHRpbmdzWyJwcmVzZXQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2NvZGVjIjogImFhYyIsIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IHNldHRpbmdzWyJhdWRpb19iaXRyYXRlIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5Ijogc2V0dGluZ3NbImF1ZGlvX2ZyZXF1ZW5jeSJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogc2V0dGluZ3NbImF1ZGlvX2NoYW5uZWxzIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAic3RyaXBfbWV0YWRhdGEiOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiZXhwb3J0LXZpZGVvIjogeyJvcGVyYXRpb24iOiAiZXhwb3J0L3VybCIsICJpbnB1dCI6ICJjb21wcmVzcy12aWRlbyJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICJodHRwczovL2FwaS5jbG91ZGNvbnZlcnQuY29tL3YyL2pvYnMiLAogICAgICAgICAgICBqc29uPWpvYl9wYXlsb2FkLAogICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAxOgogICAgICAgICAgICBwcmludChmIuKdjCDZgdi02YQg2KXZhti02KfYoSBKb2I6IHtyZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgIGpvYl9kYXRhID0gcmVzcG9uc2UuanNvbigpWyJkYXRhIl0KICAgICAgICBqb2JfaWQgPSBqb2JfZGF0YVsiaWQiXQogICAgICAgIAogICAgICAgICMg2LHZgdi5INin2YTZhdmE2YEg2KXYsNinINmD2KfZhiDZhdit2YTZitin2YsKICAgICAgICBpZiBub3QgaXNfdXJsOgogICAgICAgICAgICBpbXBvcnRfdGFzayA9IG5leHQoKHQgZm9yIHQgaW4gam9iX2RhdGFbInRhc2tzIl0gaWYgdFsibmFtZSJdID09ICJpbXBvcnQtdmlkZW8iKSwgTm9uZSkKICAgICAgICAgICAgaWYgbm90IGltcG9ydF90YXNrOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIHVwbG9hZF91cmwgPSBpbXBvcnRfdGFza1sicmVzdWx0Il1bImZvcm0iXVsidXJsIl0KICAgICAgICAgICAgdXBsb2FkX3BhcmFtcyA9IGltcG9ydF90YXNrWyJyZXN1bHQiXVsiZm9ybSJdWyJwYXJhbWV0ZXJzIl0KICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3Blbih2aWRlb19zb3VyY2UsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICBmaWxlcyA9IHsnZmlsZSc6IGZ9CiAgICAgICAgICAgICAgICB1cGxvYWRfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVwbG9hZF91cmwsIGRhdGE9dXBsb2FkX3BhcmFtcywgZmlsZXM9ZmlsZXMpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1cGxvYWRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgbm90IGluIFsyMDAsIDIwMV06CiAgICAgICAgICAgICAgICBwcmludChmIuKdjCDZgdi02YQg2LHZgdi5INin2YTZhdmE2YE6IHt1cGxvYWRfcmVzcG9uc2UudGV4dH0iKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KCLinIUg2KrZhSDYsdmB2Lkg2KfZhNmF2YTZgSDZhNmAIENsb3VkQ29udmVydCIpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdit2YTZiiDZgdmI2LHYp9mLINio2LnYryDYp9mE2LHZgdi5CiAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodmlkZW9fc291cmNlKQogICAgICAgIAogICAgICAgICMg2KfZhtiq2LjYp9ixINin2YPYqtmF2KfZhCDYp9mE2YXYudin2YTYrNipCiAgICAgICAgbWF4X2F0dGVtcHRzID0gMTgwCiAgICAgICAgYXR0ZW1wdCA9IDAKICAgICAgICAKICAgICAgICB3aGlsZSBhdHRlbXB0IDwgbWF4X2F0dGVtcHRzOgogICAgICAgICAgICB0aW1lLnNsZWVwKDUpCiAgICAgICAgICAgIHN0YXR1c19yZXNwb25zZSA9IHJlcXVlc3RzLmdldCgKICAgICAgICAgICAgICAgIGYiaHR0cHM6Ly9hcGkuY2xvdWRjb252ZXJ0LmNvbS92Mi9qb2JzL3tqb2JfaWR9IiwKICAgICAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICAgICApCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBzdGF0dXNfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoZiLimqDvuI8g2YHYtNmEINmB2K3YtSDYp9mE2K3Yp9mE2Kk6IHtzdGF0dXNfcmVzcG9uc2UudGV4dH0iKQogICAgICAgICAgICAgICAgYXR0ZW1wdCArPSAxCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgam9iX3N0YXR1cyA9IHN0YXR1c19yZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgam9iX3N0YXR1c1sic3RhdHVzIl0gPT0gImZpbmlzaGVkIjoKICAgICAgICAgICAgICAgIGV4cG9ydF90YXNrID0gbmV4dCgodCBmb3IgdCBpbiBqb2Jfc3RhdHVzWyJ0YXNrcyJdIGlmIHRbIm5hbWUiXSA9PSAiZXhwb3J0LXZpZGVvIiksIE5vbmUpCiAgICAgICAgICAgICAgICBpZiBleHBvcnRfdGFzayBhbmQgZXhwb3J0X3Rhc2suZ2V0KCJyZXN1bHQiKToKICAgICAgICAgICAgICAgICAgICBkb3dubG9hZF91cmwgPSBleHBvcnRfdGFza1sicmVzdWx0Il1bImZpbGVzIl1bMF1bInVybCJdCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLinIUg2KfZg9iq2YXZhCDYp9mE2LbYuti3ISBVUkw6IHtkb3dubG9hZF91cmx9IikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZG93bmxvYWRfdXJsCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KCLinYwg2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgam9iX3N0YXR1c1sic3RhdHVzIl0gPT0gImVycm9yIjoKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCBKb2I6IHtqb2Jfc3RhdHVzfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgYXR0ZW1wdCArPSAxCiAgICAgICAgICAgIHByaW50KGYi4o+zINin2YbYqti42KfYsS4uLiAoe2F0dGVtcHR9L3ttYXhfYXR0ZW1wdHN9KSIpCiAgICAgICAgCiAgICAgICAgcHJpbnQoIuKPse+4jyDYp9mG2KrZh9iqINmF2YfZhNipINin2YTYp9mG2KrYuNin2LEiKQogICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2LbYuti3INin2YTZgdmK2K/ZitmIOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgc2VuZF9jb21wcmVzc2VkX3ZpZGVvX2FkdmFuY2VkKGNoYXRfaWQ6IHN0ciwgdmlkZW9fdXJsOiBzdHIsIGNhcHRpb246IHN0cikgLT4gdHVwbGU6CiAgICAiIiLYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3INmF2Lkg2KXYr9in2LHYqSDZhdit2LPZhtipINmE2YTZhdmE2YHYp9iqIiIiCiAgICBtYXhfcmV0cmllcyA9IDMKICAgIAogICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgIHRlbXBfZmlsZV9wYXRoID0gTm9uZQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoZiLwn5OlINmF2K3Yp9mI2YTYqSDYqtit2YXZitmEINin2YTZgdmK2K/ZitmIICh7YXR0ZW1wdCArIDF9L3ttYXhfcmV0cmllc30pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICB2aWRlb19yZXNwb25zZSA9IHJlcXVlc3RzLmdldCh2aWRlb191cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PTMwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHZpZGVvX3Jlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYp9mE2KrYrdmF2YrZhDoge3ZpZGVvX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYrdmB2Lgg2YXYpNmC2KoKICAgICAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB0ZW1wX2ZpbGVuYW1lID0gZiJjb21wcmVzc2VkX3t0aW1lc3RhbXB9X3tjaGF0X2lkfS5tcDQiCiAgICAgICAgICAgIHRlbXBfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIHRlbXBfZmlsZW5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4odGVtcF9maWxlX3BhdGgsICd3YicpIGFzIGY6CiAgICAgICAgICAgICAgICBmb3IgY2h1bmsgaW4gdmlkZW9fcmVzcG9uc2UuaXRlcl9jb250ZW50KGNodW5rX3NpemU9ODE5Mik6CiAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCiAgICAgICAgICAgIAogICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUodGVtcF9maWxlX3BhdGgpCiAgICAgICAgICAgIHByaW50KGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQ6IHtmaWxlX3NpemUgLyAoMTAyNCoxMDI0KTouMmZ9IE1CIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICBwcmludCgi8J+TpCDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdHtURUxFR1JBTV9CT1RfVE9LRU59L3NlbmRWaWRlbyIKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGVfcGF0aCwgJ3JiJykgYXMgdmlkZW9fZmlsZToKICAgICAgICAgICAgICAgIGZpbGVzID0geyd2aWRlbyc6IHZpZGVvX2ZpbGV9CiAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgICAgICAgICAnY2FwdGlvbic6IGNhcHRpb24sCiAgICAgICAgICAgICAgICAgICAgJ3N1cHBvcnRzX3N0cmVhbWluZyc6IFRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VuZF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcywgZGF0YT1kYXRhLCB0aW1lb3V0PTMwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlbmRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KjZhtis2KfYrSEiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUsIHRlbXBfZmlsZV9wYXRoCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIuKdjCDZgdi02YQg2KfZhNil2LHYs9in2YQ6IHtzZW5kX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSAtIHtzZW5kX3Jlc3BvbnNlLnRleHRbOjIwMF19IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYrdiw2YEg2KfZhNmF2YTZgSDYp9mE2YHYp9i02YQKICAgICAgICAgICAgICAgIGlmIHRlbXBfZmlsZV9wYXRoOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodGVtcF9maWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSwgdGVtcF9maWxlX3BhdGgKICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTZhdit2KfZiNmE2Kkge2F0dGVtcHQgKyAxfToge2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHRlbXBfZmlsZV9wYXRoOgogICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgICAgIHRlbXBfZmlsZV9wYXRoID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgIAogICAgcmV0dXJuIEZhbHNlLCBOb25lCgphc3luYyBkZWYgcHJvY2Vzc192aWRlb19xdWV1ZShjb250ZXh0KToKICAgICIiItmF2LnYp9mE2Kwg2LfYp9io2YjYsSDYp9mE2YHZitiv2YrZiCIiIgogICAgZ2xvYmFsIGlzX3Byb2Nlc3NpbmcKICAgIAogICAgd2hpbGUgVHJ1ZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZpZGVvX2RhdGEgPSBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLmdldCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gVHJ1ZQogICAgICAgICAgICBjaGF0X2lkID0gdmlkZW9fZGF0YVsnY2hhdF9pZCddCiAgICAgICAgICAgIHVzZXJfaWQgPSBpbnQoY2hhdF9pZCkKICAgICAgICAgICAgdmlkZW9fc291cmNlID0gdmlkZW9fZGF0YVsnc291cmNlJ10KICAgICAgICAgICAgc291cmNlX3R5cGUgPSB2aWRlb19kYXRhWyd0eXBlJ10KICAgICAgICAgICAgZmlsZV9zaXplID0gdmlkZW9fZGF0YS5nZXQoJ2ZpbGVfc2l6ZScsIDApCiAgICAgICAgICAgIHF1YWxpdHkgPSB2aWRlb19kYXRhLmdldCgncXVhbGl0eScsICdsb3cnKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLwn46sINio2K/YoSDZhdi52KfZhNis2Kk6IHtjaGF0X2lkfSAtIHtzb3VyY2VfdHlwZX0gLSB7cXVhbGl0eX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgY29tcHJlc3NlZF91cmwgPSBOb25lCiAgICAgICAgICAgIGxvY2FsX2ZpbGVfdG9fZGVsZXRlID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDZhdi52KfZhNis2Kkg2K3Ys9ioINin2YTZhtmI2LkKICAgICAgICAgICAgaWYgc291cmNlX3R5cGUgPT0gJ3VybCc6CiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIuKPsyDYrNin2LHZiiDZhdi52KfZhNis2Kkg2KfZhNix2KfYqNi3Li4uIiwgY29udGV4dCkKICAgICAgICAgICAgICAgIGNvbXByZXNzZWRfdXJsID0gY29tcHJlc3NfdmlkZW8odmlkZW9fc291cmNlLCBjaGF0X2lkLCBjb250ZXh0LCBxdWFsaXR5LCBpc191cmw9VHJ1ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHNvdXJjZV90eXBlID09ICdmaWxlX2lkJzoKICAgICAgICAgICAgICAgIGlmIGZpbGVfc2l6ZSA8PSBESVJFQ1RfRE9XTkxPQURfTElNSVQ6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLwn5OlINis2KfYsdmKINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iLCBjb250ZXh0KQogICAgICAgICAgICAgICAgICAgIGxvY2FsX2ZpbGUgPSBhd2FpdCBkb3dubG9hZF9maWxlX2Zyb21fdGVsZWdyYW0oY29udGV4dCwgdmlkZW9fc291cmNlLCBmaWxlX3NpemUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbG9jYWxfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfZmlsZV90b19kZWxldGUgPSBsb2NhbF9maWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4o+zINis2KfYsdmKINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRfdXJsID0gY29tcHJlc3NfdmlkZW8obG9jYWxfZmlsZSwgY2hhdF9pZCwgY29udGV4dCwgcXVhbGl0eSwgaXNfdXJsPUZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYqtit2YXZitmEINin2YTZgdmK2K/ZitmILiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCBmIuKdjCDYp9mE2YXZhNmBINmD2KjZitixINis2K/Yp9mLICh7ZmlsZV9zaXplLygxMDI0KjEwMjQpOi4yZn0gTUIpLiDYp9mE2K3YryDYp9mE2KPZgti12YkgMjBNQi5cblxu8J+SoSDYp9iz2KrYrtiv2YUgR29vZ2xlIERyaXZlINij2YggRHJvcGJveCDZhNmE2YXZhNmB2KfYqiDYp9mE2KPZg9io2LEhIiwgY29udGV4dCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YbYqtmK2KzYqQogICAgICAgICAgICBpZiBjb21wcmVzc2VkX3VybCA9PSAiTk9fQVBJX0tFWV9TRVQiOgogICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YTZhSDZitiq2YUg2KrYudmK2YrZhiDZhdmB2KrYp9itIEFQSS4g2KPYqNmE2Log2KfZhNmF2LTYsdmBLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxpZiBjb21wcmVzc2VkX3VybDoKICAgICAgICAgICAgICAgIHF1YWxpdHlfbmFtZXMgPSB7J2hpZ2gnOiAn8J+UpSDYudin2YTZitipJywgJ21lZGl1bSc6ICfimpbvuI8g2YXYqtmI2LPYt9ipJywgJ2xvdyc6ICfwn5K+INmF2YbYrtmB2LbYqSd9CiAgICAgICAgICAgICAgICBjYXB0aW9uID0gZiLinIUg2KrZhSDYp9mE2LbYuti3INio2YbYrNin2K0hXG7wn46sINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZXMuZ2V0KHF1YWxpdHksICfYudin2K/ZitipJyl9XG7inKgg2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIvCfk6Qg2KzYp9ix2Yog2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbmRfc3VjY2VzcywgdGVtcF9maWxlID0gc2VuZF9jb21wcmVzc2VkX3ZpZGVvX2FkdmFuY2VkKGNoYXRfaWQsIGNvbXByZXNzZWRfdXJsLCBjYXB0aW9uKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdik2YLYqiDZgdmI2LHYp9mLINio2LnYryDYp9mE2KXYsdiz2KfZhAogICAgICAgICAgICAgICAgaWYgdGVtcF9maWxlOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodGVtcF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZW5kX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgaW5jcmVtZW50X3ZpZGVvX2NvdW50KHVzZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINil2YTZiSB7Y2hhdF9pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KrZhti42YrZgSDYo9mKINmF2YTZgdin2Kog2YXYqtio2YLZitipCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgICAgICAgICAgICAgICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID4gNToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIvCfp7kg2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmaWxlX2luZm8gaW4gc3RvcmFnZV9pbmZvWydmaWxlcyddWzozXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9pbmZvWydwYXRoJ10pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILiDYrdin2YjZhCDZhdix2Kkg2KPYrtix2YkuIiwgY29udGV4dCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYtti62Lcg2KfZhNmB2YrYr9mK2YguINiq2K3ZgtmCINmF2YYg2KfZhNil2LnYr9in2K/Yp9iqLiIsIGNvbnRleHQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYo9mKINmF2YTZgdin2Kog2YXYrdmE2YrYqSDZhdiq2KjZgtmK2KkKICAgICAgICAgICAgaWYgbG9jYWxfZmlsZV90b19kZWxldGU6CiAgICAgICAgICAgICAgICBkZWxldGVfZmlsZV9zYWZlKGxvY2FsX2ZpbGVfdG9fZGVsZXRlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJvY2Vzc2luZ19xdWV1ZS50YXNrX2RvbmUoKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2YXYudin2YTYrNipOiB7ZX0iKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQoKYXN5bmMgZGVmIGhhbmRsZV92aWRlbyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTZgdmK2K/ZitmIIiIiCiAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICBjaGF0X2lkID0gc3RyKHVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIAogICAgaWYgdXBkYXRlLm1lc3NhZ2UudmlkZW86CiAgICAgICAgZmlsZV9pZCA9IHVwZGF0ZS5tZXNzYWdlLnZpZGVvLmZpbGVfaWQKICAgICAgICBmaWxlX3NpemUgPSB1cGRhdGUubWVzc2FnZS52aWRlby5maWxlX3NpemUKICAgIGVsaWYgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQgYW5kIHVwZGF0ZS5tZXNzYWdlLmRvY3VtZW50Lm1pbWVfdHlwZSBhbmQgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQubWltZV90eXBlLnN0YXJ0c3dpdGgoInZpZGVvLyIpOgogICAgICAgIGZpbGVfaWQgPSB1cGRhdGUubWVzc2FnZS5kb2N1bWVudC5maWxlX2lkCiAgICAgICAgZmlsZV9zaXplID0gdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQuZmlsZV9zaXplCiAgICBlbHNlOgogICAgICAgIHJldHVybgogICAgCiAgICBmaWxlX3NpemVfbWIgPSBmaWxlX3NpemUgLyAoMTAyNCAqIDEwMjQpCiAgICBwcmludChmIvCfk7kg2YHZitiv2YrZiCDZhdmGIHt1c2VyX2lkfSAtIHtmaWxlX3NpemVfbWI6LjJmfSBNQiIpCiAgICAKICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2K3YrNmFINin2YTZhdmE2YEKICAgIGlmIGZpbGVfc2l6ZSA+IERJUkVDVF9ET1dOTE9BRF9MSU1JVDoKICAgICAgICBoZWxwX3RleHQgPSBmIiIiCuKdjCAqKtin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2Ysg2YTZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LEhKioKCvCfk4og2K3YrNmFINin2YTZgdmK2K/ZitmIOiAqKntmaWxlX3NpemVfbWI6LjJmfSBNQioqCvCfk48g2KfZhNit2K8g2KfZhNij2YLYtdmJINmE2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixOiAqKjIwIE1CKioKCuKchSAqKtin2YTYrdmEINin2YTYs9mH2YQ6KioKMe+4j+KDoyDYp9ix2YHYuSDYp9mE2YHZitiv2YrZiCDYudmE2YkgR29vZ2xlIERyaXZlINij2YggRHJvcGJveAoy77iP4oOjINin2K3YtdmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsQoz77iP4oOjINij2LHYs9mEINin2YTYsdin2KjYtyDZh9mG2KcKCvCfk5ogKirZhdir2KfZhCDZhNmE2LHYp9io2Lcg2KfZhNmF2KjYp9i02LE6KioKYGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9RklMRV9JRGAK2KPZiApgaHR0cHM6Ly93d3cuZHJvcGJveC5jb20vcy94eHh4eC92aWRlby5tcDQ/ZGw9MWAKCvCfkqEgKirZhti12YrYrdipOioqINmK2YXZg9mG2YMg2KfYs9iq2K7Yr9in2YUg2YXZiNin2YLYuSDZhdir2YQ6CuKAoiBHb29nbGUgRHJpdmU6INix2YHYuSDZhdis2KfZhtmKINit2KrZiSAxNUdCCuKAoiBEcm9wYm94OiDYsdmB2Lkg2YXYrNin2YbZiiDYrdiq2YkgMkdCCuKAoiBNZWRpYUZpcmU6INix2YHYuSDZhdis2KfZhtmKCgrwn46vINio2LnYryDYp9mE2LHZgdi52Iwg2KPYsdiz2YQg2KfZhNix2KfYqNi3INin2YTZhdio2KfYtNixINmI2LPYo9i22LrYt9mHINmE2YMhCiIiIgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoaGVscF90ZXh0KQogICAgICAgIHJldHVybgogICAgCiAgICBjb250ZXh0LnVzZXJfZGF0YVsncGVuZGluZ192aWRlbyddID0gewogICAgICAgICdmaWxlX2lkJzogZmlsZV9pZCwKICAgICAgICAnZmlsZV9zaXplJzogZmlsZV9zaXplLAogICAgICAgICdjaGF0X2lkJzogY2hhdF9pZAogICAgfQogICAgCiAgICBrZXlib2FyZCA9IFsKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflKUg2LnYp9mE2YrYqSAo2KzZiNiv2Kkg2YXZhdiq2KfYstipKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfaGlnaCIpXSwKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKalu+4jyDZhdiq2YjYs9i32KkgKNiq2YjYp9iy2YYpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9tZWRpdW0iKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5K+INmF2YbYrtmB2LbYqSAo2KPYtdi62LEg2K3YrNmFKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfbG93IildCiAgICBdCiAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgIAogICAgcXVhbGl0eV90ZXh0ID0gZiIiIgrwn46sICoq2KfYrtiq2LEg2KzZiNiv2Kkg2KfZhNi22LrYtzoqKgoK8J+TuSDYrdis2YUg2KfZhNmB2YrYr9mK2Yg6IHtmaWxlX3NpemVfbWI6LjJmfSBNQgoK4pyoICoq2YXZhNin2K3YuNipINmH2KfZhdipKio6INiz2YrYqtmFINin2YTYrdmB2KfYuCDYudmE2Ykg2KPYqNi52KfYryDYp9mE2YHZitiv2YrZiCDYp9mE2KPYtdmE2YrYqSAo2KfZhNi32YjZhCDDlyDYp9mE2LnYsdi2KQrYp9mE2LbYuti3INiz2YrZg9mI2YYg2YHZgti3INio2KrZgtmE2YrZhCDYp9mE2KzZiNiv2Kkg8J+OrwoK2KfYrtiq2LEg2KfZhNis2YjYr9ipINin2YTZhdmG2KfYs9io2Kkg8J+RhwoiIiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChxdWFsaXR5X3RleHQsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgphc3luYyBkZWYgaGFuZGxlX3VybCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTYsdmI2KfYqNi3IiIiCiAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICBjaGF0X2lkID0gc3RyKHVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIHVybCA9IHVwZGF0ZS5tZXNzYWdlLnRleHQuc3RyaXAoKQogICAgCiAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoKCdodHRwOi8vJywgJ2h0dHBzOi8vJykpOgogICAgICAgIHJldHVybgogICAgCiAgICAjINmC2KfYptmF2Kkg2YXZiNiz2LnYqSDZhNmF2YjYp9mC2Lkg2KfZhNmB2YrYr9mK2Ygg2YjYp9mE2KrYrtiy2YrZhiDYp9mE2LPYrdin2KjZigogICAgdmlkZW9fc2l0ZXMgPSBbCiAgICAgICAgJy5tcDQnLCAnLmF2aScsICcubW92JywgJy5ta3YnLCAnLmZsdicsICcud212JywgJy53ZWJtJywKICAgICAgICAnZHJpdmUuZ29vZ2xlLmNvbScsICdkcm9wYm94LmNvbScsICdtZWdhLm56JywgJ21lZGlhZmlyZS5jb20nLAogICAgICAgICdvbmVkcml2ZS5saXZlLmNvbScsICdib3guY29tJywgJ3dldHJhbnNmZXIuY29tJywKICAgICAgICAnc3RyZWFtYWJsZS5jb20nLCAndmltZW8uY29tJywgJ3lvdXR1YmUuY29tJywgJ3lvdXR1LmJlJwogICAgXQogICAgaXNfbGlrZWx5X3ZpZGVvID0gYW55KHNpdGUgaW4gdXJsLmxvd2VyKCkgZm9yIHNpdGUgaW4gdmlkZW9fc2l0ZXMpCiAgICAKICAgIGlmIG5vdCBpc19saWtlbHlfdmlkZW86CiAgICAgICAgcmV0dXJuCiAgICAKICAgIHByaW50KGYi8J+UlyDYsdin2KjYtyDZhdmGIHt1c2VyX2lkfToge3VybH0iKQogICAgCiAgICAjINiq2K3ZiNmK2YQg2LHZiNin2KjYtyBHb29nbGUgRHJpdmUg2YggRHJvcGJveCDZhNmE2LXZiti62Kkg2KfZhNmF2KjYp9i02LHYqQogICAgZGlyZWN0X3VybCA9IHVybAogICAgCiAgICAjIEdvb2dsZSBEcml2ZQogICAgaWYgJ2RyaXZlLmdvb2dsZS5jb20nIGluIHVybDoKICAgICAgICBpZiAnL2ZpbGUvZC8nIGluIHVybDoKICAgICAgICAgICAgZmlsZV9pZCA9IHVybC5zcGxpdCgnL2ZpbGUvZC8nKVsxXS5zcGxpdCgnLycpWzBdCiAgICAgICAgICAgIGRpcmVjdF91cmwgPSBmImh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9e2ZpbGVfaWR9IgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFINiq2YUg2KrYrdmI2YrZhCDYsdin2KjYtyBHb29nbGUgRHJpdmUg2YTZhNi12YrYutipINin2YTZhdio2KfYtNix2KkhIikKICAgIAogICAgIyBEcm9wYm94CiAgICBlbGlmICdkcm9wYm94LmNvbScgaW4gdXJsOgogICAgICAgIGlmICc/ZGw9MCcgaW4gdXJsOgogICAgICAgICAgICBkaXJlY3RfdXJsID0gdXJsLnJlcGxhY2UoJz9kbD0wJywgJz9kbD0xJykKICAgICAgICBlbGlmICdkbD0nIG5vdCBpbiB1cmw6CiAgICAgICAgICAgIGRpcmVjdF91cmwgPSB1cmwgKyAoJyYnIGlmICc/JyBpbiB1cmwgZWxzZSAnPycpICsgJ2RsPTEnCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmIuKchSDYqtmFINiq2K3ZiNmK2YQg2LHYp9io2LcgRHJvcGJveCDZhNmE2LXZiti62Kkg2KfZhNmF2KjYp9i02LHYqSEiKQogICAgCiAgICBjb250ZXh0LnVzZXJfZGF0YVsncGVuZGluZ192aWRlbyddID0gewogICAgICAgICd1cmwnOiBkaXJlY3RfdXJsLAogICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAnb3JpZ2luYWxfdXJsJzogdXJsCiAgICB9CiAgICAKICAgIGtleWJvYXJkID0gWwogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UpSDYudin2YTZitipICjYrNmI2K/YqSDZhdmF2KrYp9iy2KkpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV91cmxfaGlnaCIpXSwKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKalu+4jyDZhdiq2YjYs9i32KkgKNiq2YjYp9iy2YYpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV91cmxfbWVkaXVtIildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+SviDZhdmG2K7Zgdi22KkgKNij2LXYutixINit2KzZhSkiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X3VybF9sb3ciKV0KICAgIF0KICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQogICAgCiAgICBoZWxwX21lc3NhZ2UgPSAiIiIK8J+OrCAqKtin2K7YqtixINis2YjYr9ipINin2YTYtti62Lc6KioKCuKcqCDYs9mK2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipINmE2YTZgdmK2K/ZitmICgrwn5KhICoq2YbYtdmK2K3YqToqKiDYpdiw2Kcg2YPYp9mGINin2YTZgdmK2K/ZitmIINmF2YYgR29vZ2xlIERyaXZlINij2YggRHJvcGJveDoK4oCiINiq2KPZg9ivINij2YYg2KfZhNix2KfYqNi3ICoq2YXYqNin2LTYsSoqINmE2YTYqtit2YXZitmECuKAoiBHb29nbGUgRHJpdmU6INin2LPYqtiu2K/ZhSDYsdin2KjYtyDYqNi12YrYutipIGAvdWM/ZXhwb3J0PWRvd25sb2FkJmlkPWAK4oCiIERyb3Bib3g6INin2LPYqtiu2K/ZhSBgP2RsPTFgINmB2Yog2YbZh9in2YrYqSDYp9mE2LHYp9io2LcKIiIiCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoaGVscF9tZXNzYWdlLCByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwKQoKIyA9PT09PT09PT09PT09PT09PT09PSDYp9mE2KjYsdmG2KfZhdisINin2YTYsdim2YrYs9mKID09PT09PT09PT09PT09PT09PT09CmRlZiBtYWluKCk6CiAgICAiIiLYp9mE2KjYsdmG2KfZhdisINin2YTYsdim2YrYs9mKIiIiCiAgICBwcmludCgi8J+agCDYqtmH2YrYptipINin2YTYqNmI2KouLi4iKQogICAgCiAgICAjINil2YbYtNin2KEg2KfZhNmF2KzZhNiv2KfYqiDZiNin2YTZgtmI2KfYudivCiAgICBpbml0X3RlbXBfc3RvcmFnZSgpCiAgICBpbml0X2RhdGFiYXNlKCkKICAgIAogICAgIyDYqtmG2LjZitmBINin2YTZhdmE2YHYp9iqINin2YTZgtiv2YrZhdipCiAgICBjbGVhbnVwX29sZF9maWxlcygpCiAgICAKICAgIHByaW50KCLinIUg2KfZhNmG2LjYp9mFINis2KfZh9iyIikKICAgIAogICAgIyDYpdmG2LTYp9ihINin2YTYqti32KjZitmCCiAgICBhcHBsaWNhdGlvbiA9IEFwcGxpY2F0aW9uLmJ1aWxkZXIoKS50b2tlbihURUxFR1JBTV9CT1RfVE9LRU4pLmJ1aWxkKCkKICAgIAogICAgIyDYp9mE2YXYudin2YTYrNin2KoKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGFydCIsIHN0YXJ0X2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImFjY291bnQiLCBteV9hY2NvdW50X2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInNldGFwaWtleSIsIHNldGFwaWtleV9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGF0cyIsIHN0YXRzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImZpbGVzIiwgZmlsZXNfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiY2xlYW51cCIsIGNsZWFudXBfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDYWxsYmFja1F1ZXJ5SGFuZGxlcihidXR0b25faGFuZGxlcikpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlZJREVPIHwgZmlsdGVycy5Eb2N1bWVudC5WSURFTywgaGFuZGxlX3ZpZGVvKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKE1lc3NhZ2VIYW5kbGVyKGZpbHRlcnMuVEVYVCAmIH5maWx0ZXJzLkNPTU1BTkQsIGhhbmRsZV91cmwpKQogICAgCiAgICAjINio2K/YoSDZhdi52KfZhNisINin2YTYt9in2KjZiNixCiAgICBhcHBsaWNhdGlvbi5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgbGFtYmRhIGNvbnRleHQ6IGFzeW5jaW8uY3JlYXRlX3Rhc2socHJvY2Vzc192aWRlb19xdWV1ZShjb250ZXh0KSksCiAgICAgICAgd2hlbj0wCiAgICApCiAgICAKICAgIHByaW50KCLinIUg2KfZhNio2YjYqiDZiti52YXZhCDYp9mE2KLZhi4uLiIpCiAgICBwcmludChmIvCfkZEg2YXYudix2YEg2KfZhNmF2LTYsdmBOiB7QURNSU5fSUR9IikKICAgIHByaW50KGYi8J+TpiDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsToge0RJUkVDVF9ET1dOTE9BRF9MSU1JVC8oMTAyNCoxMDI0KTouMGZ9IE1CIikKICAgIHByaW50KGYi8J+TpiDYp9mE2LHZiNin2KjYtyDYp9mE2K7Yp9ix2KzZitipOiB7TUFYX0ZJTEVfU0laRS8oMTAyNCoxMDI0KTouMGZ9IE1CIikKICAgIHByaW50KCLwn46vINin2YTZhdmK2LLYqSDYp9mE2KzYr9mK2K/YqTog2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSEiKQogICAgCiAgICAjINiq2LTYutmK2YQg2KfZhNio2YjYqgogICAgIyDYqtmFINiq2LnYr9mK2YTZhyDZhNmE2LnZhdmEINmB2YogdGhyZWFkCgogICAgaW1wb3J0IGFzeW5jaW8KCiAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCgogICAgYXN5bmNpby5zZXRfZXZlbnRfbG9vcChsb29wKQoKICAgIGFzeW5jIGRlZiBydW4oKToKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24uaW5pdGlhbGl6ZSgpCgogICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnN0YXJ0KCkKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24udXBkYXRlci5zdGFydF9wb2xsaW5nKCkKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgogICAgICAgIGV4Y2VwdDoKCiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZmluYWxseToKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnVwZGF0ZXIuc3RvcCgpCgogICAgICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi5zdG9wKCkKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnNodXRkb3duKCkKCiAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShydW4oKSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
