#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    uptime = ""
    if start_time:
        delta = datetime.now() - start_time
        hours = delta.seconds // 3600
        minutes = (delta.seconds % 3600) // 60
        uptime = f"{delta.days}d {hours}h {minutes}m"
    
    html = f"""
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ - 1 ÿ®Ÿàÿ™</title>
        <style>
            * {{ margin: 0; padding: 0; box-sizing: border-box; }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 800px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2.5em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 1.1em;
            }}
            .status {{
                background: #f0f9ff;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                border-right: 5px solid #10b981;
            }}
            .status h2 {{
                color: #10b981;
                margin-bottom: 15px;
                font-size: 1.5em;
            }}
            .bot-item {{
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzcWxpdGUzCmltcG9ydCBhc3luY2lvCmltcG9ydCBvcwppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHNodXRpbAppbXBvcnQgdHJhY2ViYWNrCmltcG9ydCBsb2dnaW5nCmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aApmcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwKZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZXRpbWUKZnJvbSB0ZWxlZ3JhbSBpbXBvcnQgVXBkYXRlLCBJbmxpbmVLZXlib2FyZEJ1dHRvbiwgSW5saW5lS2V5Ym9hcmRNYXJrdXAKZnJvbSB0ZWxlZ3JhbS5leHQgaW1wb3J0ICgKICAgIEFwcGxpY2F0aW9uLAogICAgQ29tbWFuZEhhbmRsZXIsCiAgICBDYWxsYmFja1F1ZXJ5SGFuZGxlciwKICAgIE1lc3NhZ2VIYW5kbGVyLAogICAgZmlsdGVycywKICAgIENvbnRleHRUeXBlcywKKQoKIyA9PT09PT09PT09PT09PT09PT09PSDYpdi52K/Yp9ivINiq2LPYrNmK2YQg2KfZhNij2K7Yt9in2KEgPT09PT09PT09PT09PT09PT09PT0KIyDYpdmG2LTYp9ihIGxvZ2dlcgpsb2dnaW5nLmJhc2ljQ29uZmlnKAogICAgZm9ybWF0PSclKGFzY3RpbWUpcyAtICUobmFtZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywKICAgIGxldmVsPWxvZ2dpbmcuSU5GTywKICAgIGhhbmRsZXJzPVsKICAgICAgICBsb2dnaW5nLkZpbGVIYW5kbGVyKCdib3RfZXJyb3JzLmxvZycsIGVuY29kaW5nPSd1dGYtOCcpLAogICAgICAgIGxvZ2dpbmcuU3RyZWFtSGFuZGxlcigpCiAgICBdCikKbG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pCgojID09PT09PT09PT09PT09PT09PT09INin2YTYpdi52K/Yp9iv2KfYqiDYp9mE2KvYp9io2KrYqSA9PT09PT09PT09PT09PT09PT09PQpURUxFR1JBTV9CT1RfVE9LRU4gPSAiNzg3MTU4Mzc2MDpBQUVBajFOTWxnTVU3SDhZM1RvM2E3bEd2U2hWWjc0QnZ6VSIKQURNSU5fSUQgPSAxMDU4NjE2MzE2ClRFTEVHUkFNX0FQSV9MSU1JVCA9IDIwICogMTAyNCAqIDEwMjQgICMgMjBNQgpNQVhfRklMRV9TSVpFID0gMjAwMCAqIDEwMjQgKiAxMDI0ICAjIDJHQiDYp9mE2K3YryDYp9mE2KPZgti12Ykg2YTZhNmF2YTZgdin2Kog2KfZhNmD2KjZitix2KkKRElSRUNUX0RPV05MT0FEX0xJTUlUID0gMjAgKiAxMDI0ICogMTAyNCAgIyAyME1CINit2K8g2KfZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LEKCiMg2YXYrNmE2K8g2KfZhNiq2K7YstmK2YYg2KfZhNmF2KTZgtiqClRFTVBfU1RPUkFHRV9ESVIgPSAidGVtcF92aWRlb3MiCgojINi32KfYqNmI2LEg2KfZhNmF2LnYp9mE2KzYqQpwcm9jZXNzaW5nX3F1ZXVlID0gYXN5bmNpby5RdWV1ZSgpCmlzX3Byb2Nlc3NpbmcgPSBGYWxzZQoKIyA9PT09PT09PT09PT09PT09PT09PSDYpdiv2KfYsdipINin2YTZhdmE2YHYp9iqID09PT09PT09PT09PT09PT09PT09CmRlZiBpbml0X3RlbXBfc3RvcmFnZSgpOgogICAgIiIi2KXZhti02KfYoSDZhdis2YTYryDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoiIiIKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhURU1QX1NUT1JBR0VfRElSKToKICAgICAgICBvcy5tYWtlZGlycyhURU1QX1NUT1JBR0VfRElSKQogICAgcHJpbnQoZiLinIUg2YXYrNmE2K8g2KfZhNiq2K7YstmK2YYg2KfZhNmF2KTZgtiqOiB7VEVNUF9TVE9SQUdFX0RJUn0iKQoKZGVmIGNsZWFudXBfb2xkX2ZpbGVzKCk6CiAgICAiIiLYrdiw2YEg2KzZhdmK2Lkg2KfZhNmF2YTZgdin2Kog2KfZhNmC2K/ZitmF2Kkg2LnZhtivINio2K/YoSDYp9mE2KrYtNi62YrZhCIiIgogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgICAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIGZpbGUpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2ZpbGUoZmlsZV9wYXRoKToKICAgICAgICAgICAgICAgICAgICAgICAgb3MudW5saW5rKGZpbGVfcGF0aCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLwn5eR77iPINit2LDZgSDZhdmE2YEg2YLYr9mK2YU6IHtmaWxlfSIpCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLimqDvuI8g2YHYtNmEINit2LDZgSB7ZmlsZX06IHtlfSIpCiAgICAgICAgcHJpbnQoIuKchSDYqtmFINiq2YbYuNmK2YEg2KfZhNmF2KzZhNivINmF2YYg2KfZhNmF2YTZgdin2Kog2KfZhNmC2K/ZitmF2KkiKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTYqtmG2LjZitmBOiB7ZX0iKQoKZGVmIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9wYXRoOiBzdHIpOgogICAgIiIi2K3YsNmBINmF2YTZgSDYqNi02YPZhCDYotmF2YYiIiIKICAgIHRyeToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhmaWxlX3BhdGgpOgogICAgICAgICAgICBvcy51bmxpbmsoZmlsZV9wYXRoKQogICAgICAgICAgICBwcmludChmIvCfl5HvuI8g2KrZhSDYrdiw2YEg2KfZhNmF2YTZgToge2ZpbGVfcGF0aH0iKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4pqg77iPINmB2LTZhCDYrdiw2YEg2KfZhNmF2YTZgSB7ZmlsZV9wYXRofToge2V9IikKICAgIHJldHVybiBGYWxzZQoKZGVmIGdldF9zdG9yYWdlX2luZm8oKToKICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNmF2LPYp9it2Kkg2KfZhNiq2K7YstmK2YbZitipIiIiCiAgICB0cnk6CiAgICAgICAgdG90YWxfc2l6ZSA9IDAKICAgICAgICBmaWxlX2NvdW50ID0gMAogICAgICAgIGZpbGVzX2xpc3QgPSBbXQogICAgICAgIAogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgICAgICBmb3IgZmlsZSBpbiBvcy5saXN0ZGlyKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgICAgICAgICAgZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIGZpbGUpCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShmaWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgIHNpemUgPSBvcy5wYXRoLmdldHNpemUoZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgICAgIHRvdGFsX3NpemUgKz0gc2l6ZQogICAgICAgICAgICAgICAgICAgIGZpbGVfY291bnQgKz0gMQogICAgICAgICAgICAgICAgICAgIGZpbGVzX2xpc3QuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgJ25hbWUnOiBmaWxlLAogICAgICAgICAgICAgICAgICAgICAgICAnc2l6ZSc6IHNpemUsCiAgICAgICAgICAgICAgICAgICAgICAgICdwYXRoJzogZmlsZV9wYXRoCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAndG90YWxfc2l6ZSc6IHRvdGFsX3NpemUsCiAgICAgICAgICAgICdmaWxlX2NvdW50JzogZmlsZV9jb3VudCwKICAgICAgICAgICAgJ2ZpbGVzJzogZmlsZXNfbGlzdAogICAgICAgIH0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTYqtiu2LLZitmGOiB7ZX0iKQogICAgICAgIHJldHVybiB7J3RvdGFsX3NpemUnOiAwLCAnZmlsZV9jb3VudCc6IDAsICdmaWxlcyc6IFtdfQoKZGVmIGZvcm1hdF9zaXplKHNpemVfYnl0ZXMpOgogICAgIiIi2KrYrdmI2YrZhCDYp9mE2K3YrNmFINil2YTZiSDYtdmK2LrYqSDZgtin2KjZhNipINmE2YTZgtix2KfYodipIiIiCiAgICBmb3IgdW5pdCBpbiBbJ0InLCAnS0InLCAnTUInLCAnR0InXToKICAgICAgICBpZiBzaXplX2J5dGVzIDwgMTAyNC4wOgogICAgICAgICAgICByZXR1cm4gZiJ7c2l6ZV9ieXRlczouMmZ9IHt1bml0fSIKICAgICAgICBzaXplX2J5dGVzIC89IDEwMjQuMAogICAgcmV0dXJuIGYie3NpemVfYnl0ZXM6LjJmfSBUQiIKCiMgPT09PT09PT09PT09PT09PT09PT0g2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqID09PT09PT09PT09PT09PT09PT09CmRlZiBpbml0X2RhdGFiYXNlKCk6CiAgICAiIiLYpdmG2LTYp9ihINmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqiDZiNis2K/Yp9mI2YQg2KfZhNmF2LPYqtiu2K/ZhdmK2YYg2YjYp9mE2KXYudiv2KfYr9in2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgCiAgICBjLmV4ZWN1dGUoJycnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdXNlcnMgKAogICAgICAgIHVzZXJfaWQgSU5URUdFUiBQUklNQVJZIEtFWSwKICAgICAgICB1c2VybmFtZSBURVhULAogICAgICAgIHRvdGFsX3ZpZGVvcyBJTlRFR0VSIERFRkFVTFQgMCwKICAgICAgICBqb2luZWRfZGF0ZSBUSU1FU1RBTVAgREVGQVVMVCBDVVJSRU5UX1RJTUVTVEFNUAogICAgKScnJykKICAgIAogICAgYy5leGVjdXRlKCcnJ0NSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHNldHRpbmdzICgKICAgICAgICBrZXkgVEVYVCBQUklNQVJZIEtFWSwKICAgICAgICB2YWx1ZSBURVhUCiAgICApJycnKQogICAgCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCB2YWx1ZSBGUk9NIHNldHRpbmdzIFdIRVJFIGtleSA9ICdhcGlfa2V5JyIpCiAgICBpZiBjLmZldGNob25lKCkgaXMgTm9uZToKICAgICAgICBkZWZhdWx0X2FwaV9rZXkgPSAiZXlKMGVYQWlPaUpLVjFRaUxDSmhiR2NpT2lKU1V6STFOaUo5LmV5SmhkV1FpT2lJeElpd2lhblJwSWpvaVpqRTBOMk5tTkRVMFpqQXpaVE16TkRBd05URmxaR1E0TXpGbVkySmhaRE15T1RNME4yRmlNV00wTTJSa01UUm1NR05tWmpsa1pEQXpOelF4TnpFMk56ZG1NbVk1TTJFeU5tRm1ZekkyWVRnaUxDSnBZWFFpT2pFM05qUXhOVFV4TXpRdU1qa3lOalEwTENKdVltWWlPakUzTmpReE5UVXhNelF1TWpreU5qUTFMQ0psZUhBaU9qUTVNVGs0TWpnM016UXVNamcxTVRBM0xDSnpkV0lpT2lJM016VTNOVFV5TVNJc0luTmpiM0JsY3lJNld5SjBZWE5yTG5keWFYUmxJaXdpZEdGemF5NXlaV0ZrWkNKOS5nZ29sRUJ0bGRKSVpxNzRSMUgzU0k2MUFIVFBjNGlKUnZ1Z0JBV1k5bUFvUU9XM3JiYVVyUUhmOENURHVSWU5mNnBtMHhwbUFnY0ZuNlNyVGJ3MTYtekVFUlljMTFxdk9IR1k1cVhRb2tfYWlGeWoyR29rR1R6YmYzbmhkaHN3WlBtdEFqNjlXbGpXY2dndDZYLTlpd1R5Q2hEWEtxQzdVNkVqZUEyYVc2WHB0WDVSdHVLOXhYRl9OQVNKZXRjN3FpV1gxcjhLemRpd2hiRkpvazRiSTNpOWQ4VlYtZEl0RFdYWkozZXVGZlBjLWx6T2hxd0RmMlpFQTF3UGcyMEJpNmdkMElFMlBnVlFwS3luWnlGa3R1OFdOUE5WemhuT0gweUUxWWE2b2VodkphZ1g0dG1uN2d4MW1manJPSmp0cUFEMkVnMkYtOERsN2dkODZmaGV4T0tlMEJld2ZMTlUxRlU2cm5pVUgzalRkTEpmQWpMOE82UXN1dUxlSlhHOUUyczVtRnBHc3F4cUI3TE1DX0dYTjI3RG00NGtqbUhvQjQ4bTZ6V1lRc1o3NTFESFNKOHJqVlItQnpjUzlBalFlZ1lXMDhuSW5SaFkyVWZJTnJxTmJmdTdVNjlzZGw0TDA5WnVWSUVBR2xqRTJrdGNRQ3F5SENxeGk0a0hpcExhNnEtV1JGdl81YkRJcFdrRjZCSFVqZUVRWVZOMF9GLWJ6ZTFjOHFpWDZtN25RTkhibUdoSWFDVWltN05IRUk5c3o1YnZKTkxLYzk4VmN0UmFueWVKdnktWUw5WmNQLS0xNlN3LWtqMXlkVDc0M21CNE50MEFLU2Y3QTlLd01wS1djaVBXa3ZxNkNlc2o2ZU1UdFMzSFNOMFd2d2hoT1EyMHpjREN4V2pubTE2ayIKICAgICAgICBjLmV4ZWN1dGUoIklOU0VSVCBPUiBSRVBMQUNFIElOVE8gc2V0dGluZ3MgKGtleSwgdmFsdWUpIFZBTFVFUyAoJ2FwaV9rZXknLCA/KSIsIChkZWZhdWx0X2FwaV9rZXksKSkKICAgIAogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgpkZWYgZ2V0X2FwaV9rZXkoKToKICAgICIiItin2YTYrdi12YjZhCDYudmE2Ykg2YXZgdiq2KfYrSBBUEkg2YXZhiDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCJTRUxFQ1QgdmFsdWUgRlJPTSBzZXR0aW5ncyBXSEVSRSBrZXkgPSAnYXBpX2tleSciKQogICAgcmVzdWx0ID0gYy5mZXRjaG9uZSgpCiAgICBjb25uLmNsb3NlKCkKICAgIHJldHVybiByZXN1bHRbMF0gaWYgcmVzdWx0IGVsc2UgTm9uZQoKZGVmIHNldF9hcGlfa2V5KG5ld19rZXkpOgogICAgIiIi2K3Zgdi4INmF2YHYqtin2K0gQVBJINis2K/ZitivINmB2Yog2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIGMuZXhlY3V0ZSgiSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyBzZXR0aW5ncyAoa2V5LCB2YWx1ZSkgVkFMVUVTICgnYXBpX2tleScsID8pIiwgKG5ld19rZXksKSkKICAgIGNvbm4uY29tbWl0KCkKICAgIGNvbm4uY2xvc2UoKQoKZGVmIGdldF91c2VyKHVzZXJfaWQpOgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YXYs9iq2K7Yr9mFIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIGMuZXhlY3V0ZSgnU0VMRUNUIHVzZXJfaWQsIHVzZXJuYW1lLCB0b3RhbF92aWRlb3MsIGpvaW5lZF9kYXRlIEZST00gdXNlcnMgV0hFUkUgdXNlcl9pZCA9ID8nLCAodXNlcl9pZCwpKQogICAgdXNlciA9IGMuZmV0Y2hvbmUoKQogICAgY29ubi5jbG9zZSgpCiAgICByZXR1cm4gdXNlcgoKZGVmIGNyZWF0ZV91c2VyKHVzZXJfaWQsIHVzZXJuYW1lKToKICAgICIiItil2YbYtNin2KEg2YXYs9iq2K7Yr9mFINis2K/ZitivIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIGMuZXhlY3V0ZSgnSU5TRVJUIE9SIElHTk9SRSBJTlRPIHVzZXJzICh1c2VyX2lkLCB1c2VybmFtZSkgVkFMVUVTICg/LCA/KScsICh1c2VyX2lkLCB1c2VybmFtZSkpCiAgICBjb25uLmNvbW1pdCgpCiAgICBjb25uLmNsb3NlKCkKCmRlZiBpbmNyZW1lbnRfdmlkZW9fY291bnQodXNlcl9pZCk6CiAgICAiIiLYstmK2KfYr9ipINi52K/Yp9ivINin2YTZgdmK2K/ZitmI2YfYp9iqIiIiCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIGMuZXhlY3V0ZSgnVVBEQVRFIHVzZXJzIFNFVCB0b3RhbF92aWRlb3MgPSB0b3RhbF92aWRlb3MgKyAxIFdIRVJFIHVzZXJfaWQgPSA/JywgKHVzZXJfaWQsKSkKICAgIGNvbm4uY29tbWl0KCkKICAgIGNvbm4uY2xvc2UoKQoKIyA9PT09PT09PT09PT09PT09PT09PSDYr9mI2KfZhCDYqtmE2YrYrNix2KfZhSA9PT09PT09PT09PT09PT09PT09PQphc3luYyBkZWYgc2VuZF9tZXNzYWdlKGNoYXRfaWQ6IHN0ciwgdGV4dDogc3RyLCBjb250ZXh0PU5vbmUpOgogICAgIiIi2KXYsdiz2KfZhCDYsdiz2KfZhNipINmG2LXZitipIiIiCiAgICB0cnk6CiAgICAgICAgaWYgY29udGV4dDoKICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3Quc2VuZF9tZXNzYWdlKGNoYXRfaWQ9Y2hhdF9pZCwgdGV4dD10ZXh0LCBwYXJzZV9tb2RlPSdNYXJrZG93bicpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e1RFTEVHUkFNX0JPVF9UT0tFTn0vc2VuZE1lc3NhZ2UiCiAgICAgICAgICAgIHJlcXVlc3RzLnBvc3QodXJsLCBkYXRhPXsiY2hhdF9pZCI6IGNoYXRfaWQsICJ0ZXh0IjogdGV4dCwgInBhcnNlX21vZGUiOiAnTWFya2Rvd24nfSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiLYrti32KMg2YHZiiDYpdix2LPYp9mEINin2YTYsdiz2KfZhNipOiB7ZX0iKQogICAgICAgIHByaW50KGYi2K7Yt9ijINmB2Yog2KXYsdiz2KfZhCDYp9mE2LHYs9in2YTYqToge2V9IikKCmFzeW5jIGRlZiBzZW5kX2Vycm9yX3RvX2FkbWluKGNvbnRleHQsIGVycm9yX21lc3NhZ2U6IHN0ciwgdXBkYXRlOiBVcGRhdGUgPSBOb25lKToKICAgICIiItil2LHYs9in2YQg2KrZgdin2LXZitmEINin2YTYrti32KMg2YTZhNmF2LTYsdmBIiIiCiAgICB0cnk6CiAgICAgICAgIyDYqtiz2KzZitmEINin2YTYrti32KMg2YHZiiDYp9mE2YXZhNmBCiAgICAgICAgbG9nZ2VyLmVycm9yKGYiRXJyb3Igb2NjdXJyZWQ6IHtlcnJvcl9tZXNzYWdlfSIpCiAgICAgICAgCiAgICAgICAgIyDYqtit2LbZitixINix2LPYp9mE2Kkg2KfZhNiu2LfYowogICAgICAgIGVycm9yX3RleHQgPSBmIvCfmqggKirYrti32KMg2YHZiiDYp9mE2KjZiNiqISoqXG5cbiIKICAgICAgICBlcnJvcl90ZXh0ICs9IGYi4o+wINin2YTZiNmC2Ko6IHtkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKX1cblxuIgogICAgICAgIAogICAgICAgIGlmIHVwZGF0ZToKICAgICAgICAgICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyOgogICAgICAgICAgICAgICAgZXJyb3JfdGV4dCArPSBmIvCfkaQg2KfZhNmF2LPYqtiu2K/ZhToge3VwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZH0gKEB7dXBkYXRlLmVmZmVjdGl2ZV91c2VyLnVzZXJuYW1lfSlcbiIKICAgICAgICAgICAgaWYgdXBkYXRlLm1lc3NhZ2U6CiAgICAgICAgICAgICAgICBlcnJvcl90ZXh0ICs9IGYi8J+SrCDYp9mE2LHYs9in2YTYqToge3VwZGF0ZS5tZXNzYWdlLnRleHRbOjEwMF0gaWYgdXBkYXRlLm1lc3NhZ2UudGV4dCBlbHNlICdOL0EnfVxuIgogICAgICAgIAogICAgICAgIGVycm9yX3RleHQgKz0gZiJcbuKdjCAqKtin2YTYrti32KM6KipcbmBgYFxue2Vycm9yX21lc3NhZ2VbOjMwMDBdfVxuYGBgIgogICAgICAgIAogICAgICAgICMg2KXYsdiz2KfZhCDZhNmE2YXYtNix2YEKICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2Uoc3RyKEFETUlOX0lEKSwgZXJyb3JfdGV4dCwgY29udGV4dCkKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2dnZXIuZXJyb3IoZiLZgdi02YQg2KXYsdiz2KfZhCDYp9mE2K7Yt9ijINmE2YTZhdi02LHZgToge2V9IikKICAgICAgICBwcmludChmItmB2LTZhCDYpdix2LPYp9mEINin2YTYrti32KMg2YTZhNmF2LTYsdmBOiB7ZX0iKQoKYXN5bmMgZGVmIGVycm9yX2hhbmRsZXIodXBkYXRlOiBvYmplY3QsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2YXYudin2YTYrCDYp9mE2KPYrti32KfYoSDYp9mE2LnYp9mFIiIiCiAgICB0cnk6CiAgICAgICAgIyDYp9mE2K3YtdmI2YQg2LnZhNmJINiq2YHYp9i12YrZhCDYp9mE2K7Yt9ijINin2YTZg9in2YXZhNipCiAgICAgICAgZXJyb3JfdHJhY2ViYWNrID0gJycuam9pbih0cmFjZWJhY2suZm9ybWF0X2V4Y2VwdGlvbihOb25lLCBjb250ZXh0LmVycm9yLCBjb250ZXh0LmVycm9yLl9fdHJhY2ViYWNrX18pKQogICAgICAgIAogICAgICAgICMg2LfYqNin2LnYqSDYp9mE2K7Yt9ijINmB2Yog2KfZhNmD2YjZhtiz2YjZhAogICAgICAgIGxvZ2dlci5lcnJvcihmIkV4Y2VwdGlvbiB3aGlsZSBoYW5kbGluZyBhbiB1cGRhdGU6IHtlcnJvcl90cmFjZWJhY2t9IikKICAgICAgICBwcmludChmIlxueyc9Jyo1MH1cbvCfmqgg2K7Yt9ijINit2K/YqzpcbntlcnJvcl90cmFjZWJhY2t9XG57Jz0nKjUwfVxuIikKICAgICAgICAKICAgICAgICAjINil2LHYs9in2YQg2YTZhNmF2LTYsdmBCiAgICAgICAgaWYgaXNpbnN0YW5jZSh1cGRhdGUsIFVwZGF0ZSk6CiAgICAgICAgICAgIGF3YWl0IHNlbmRfZXJyb3JfdG9fYWRtaW4oY29udGV4dCwgZXJyb3JfdHJhY2ViYWNrLCB1cGRhdGUpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgc2VuZF9lcnJvcl90b19hZG1pbihjb250ZXh0LCBlcnJvcl90cmFjZWJhY2spCiAgICAgICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZ2dlci5lcnJvcihmItiu2LfYoyDZgdmKINmF2LnYp9mE2Kwg2KfZhNij2K7Yt9in2KEg2YbZgdiz2Yc6IHtlfSIpCiAgICAgICAgcHJpbnQoZiLYrti32KMg2YHZiiDZhdi52KfZhNisINin2YTYo9iu2LfYp9ihINmG2YHYs9mHOiB7ZX0iKQoKIyA9PT09PT09PT09PT09PT09PT09PSDYo9mI2KfZhdixINin2YTYqNmI2KogPT09PT09PT09PT09PT09PT09PT0KYXN5bmMgZGVmIHN0YXJ0X2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9zdGFydCIiIgogICAgdXNlciA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlcgogICAgY3JlYXRlX3VzZXIodXNlci5pZCwgdXNlci51c2VybmFtZSkKICAgIAogICAga2V5Ym9hcmRfcm93cyA9IFsKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfk4og2K3Ys9in2KjZiiDZiNil2K3Ytdin2KbZitin2KrZiiIsIGNhbGxiYWNrX2RhdGE9Im15X2FjY291bnQiKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLihLnvuI8g2KfZhNmF2LPYp9i52K/YqSIsIGNhbGxiYWNrX2RhdGE9ImhlbHAiKV0KICAgIF0KICAgIAogICAgaWYgdXNlci5pZCA9PSBBRE1JTl9JRDoKICAgICAgICBrZXlib2FyZF9yb3dzLmFwcGVuZChbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKame+4jyDYpdi52K/Yp9iv2KfYqiDYp9mE2YXYtNix2YEiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXSkKCiAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZF9yb3dzKQogICAgCiAgICB3ZWxjb21lX3RleHQgPSBmIiIiCvCfjqwg2YXYsdit2KjYp9mLIHt1c2VyLmZpcnN0X25hbWV9IQoK2KPZhtinINio2YjYqiDYtti62Lcg2KfZhNmB2YrYr9mK2YjZh9in2KouINin2YTYotmGINij2YbYpyAqKtmF2KzYp9mG2Yog2KjYp9mE2YPYp9mF2YQg2YjYqNiv2YjZhiDZgtmK2YjYryoqISDwn5qACgoqKvCfjq8g2KfZhNmF2YXZitiy2KfYqjoqKgrinKgg2YXYudin2YTYrNipINmF2YTZgdin2Kog2K3YqtmJICoqMkdCKiog2LnYqNixINin2YTYsdmI2KfYqNi3CuKcqCDYqtit2YXZitmEINmF2KjYp9i02LEg2K3YqtmJIDIwTUIg2YXZhiDYqtmK2YTZitis2LHYp9mFCuKcqCDYr9i52YUg2KfZhNix2YjYp9io2Lcg2KfZhNiu2KfYsdis2YrYqSAoR29vZ2xlIERyaXZlLCBEcm9wYm94LCDYpdmE2K4pCuKcqCAzINmF2LPYqtmI2YrYp9iqINi22LrYtyDZgtmI2YrYqSDZhdi5ICoq2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSoqCuKcqCDYrdiw2YEg2KrZhNmC2KfYptmKINmE2YTZhdmE2YHYp9iqINio2LnYryDYp9mE2KXYsdiz2KfZhAoK8J+TpCAqKtmE2YTZhdmE2YHYp9iqINin2YTZg9io2YrYsdipICgrMjBNQik6KioK2KfYsdmB2Lkg2KfZhNmB2YrYr9mK2Ygg2YTZgCBHb29nbGUgRHJpdmUg2KPZiCBEcm9wYm94INmI2KPYsdiz2YQg2KfZhNix2KfYqNi3INin2YTZhdio2KfYtNixIQoK8J+TpCAqKtmE2YTZhdmE2YHYp9iqINin2YTYtdi62YrYsdipICgtMjBNQik6KioK2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYqNin2LTYsdipINmF2YYg2KrZitmE2YrYrNix2KfZhSEKIiIiCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQod2VsY29tZV90ZXh0LCByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwKQoKYXN5bmMgZGVmIG15X2FjY291bnRfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL2FjY291bnQgLSDYudix2LYg2YXYudmE2YjZhdin2Kog2KfZhNit2LPYp9ioIiIiCiAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICB1c2VyX2RhdGEgPSBnZXRfdXNlcih1c2VyX2lkKQogICAgCiAgICBpZiB1c2VyX2RhdGE6CiAgICAgICAgdXNlcl9pZCwgdXNlcm5hbWUsIHRvdGFsX3ZpZGVvcywgam9pbmVkX2RhdGUgPSB1c2VyX2RhdGEKICAgICAgICBhY2NvdW50X3RleHQgPSBmIiIiCvCfk4ogKirZhdi52YTZiNmF2KfYqiDYrdiz2KfYqNmDOioqCgrwn5GkINin2YTZhdi52LHZgToge3VzZXJfaWR9CvCfjqwg2LnYr9ivINin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdi22LrZiNi32Kk6IHt0b3RhbF92aWRlb3N9CvCfk4Ug2KrYp9ix2YrYriDYp9mE2KfZhti22YXYp9mFOiB7am9pbmVkX2RhdGV9CiIiIgogICAgZWxzZToKICAgICAgICBhY2NvdW50X3RleHQgPSAi4p2MINmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2K3Ys9in2KjZgy4g2KfYs9iq2K7Yr9mFIC9zdGFydCDYo9mI2YTYp9mLLiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChhY2NvdW50X3RleHQpCgphc3luYyBkZWYgc2V0YXBpa2V5X2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9zZXRhcGlrZXkgLSDYqti52YrZitmGINmF2YHYqtin2K0gQVBJICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGlmIGxlbihjb250ZXh0LmFyZ3MpID09IDA6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pqg77iPINin2YTYp9iz2KrYrtiv2KfZhTogL3NldGFwaWtleSA8eW91cl9hcGlfa2V5PiIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIG5ld19rZXkgPSBjb250ZXh0LmFyZ3NbMF0KICAgIHNldF9hcGlfa2V5KG5ld19rZXkpCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLinIUg2KrZhSDYqtit2K/ZitirINmF2YHYqtin2K0gQVBJINio2YbYrNin2K0hIikKCmFzeW5jIGRlZiBzdGF0c19jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvc3RhdHMgLSDYudix2LYg2KXYrdi12KfYptmK2KfYqiDYudin2YXYqSAo2YTZhNmF2LTYsdmBINmB2YLYtykiIiIKICAgIGlmIHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZCAhPSBBRE1JTl9JRDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLim5Qg2YfYsNinINin2YTYo9mF2LEg2YTZhNmF2LTYsdmBINmB2YLYtyEiKQogICAgICAgIHJldHVybgogICAgCiAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KCd2aWRlb19ib3QuZGInKQogICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgIAogICAgYy5leGVjdXRlKCJTRUxFQ1QgQ09VTlQoKikgRlJPTSB1c2VycyIpCiAgICB0b3RhbF91c2VycyA9IGMuZmV0Y2hvbmUoKVswXQogICAgCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCBTVU0odG90YWxfdmlkZW9zKSBGUk9NIHVzZXJzIikKICAgIHRvdGFsX3ZpZGVvcyA9IGMuZmV0Y2hvbmUoKVswXSBvciAwCiAgICAKICAgIGNvbm4uY2xvc2UoKQogICAgCiAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgIAogICAgc3RhdHNfdGV4dCA9IGYiIiIK8J+TiiAqKtil2K3Ytdin2KbZitin2Kog2KfZhNio2YjYqjoqKgoK8J+RpSDYudiv2K8g2KfZhNmF2LPYqtiu2K/ZhdmK2YY6IHt0b3RhbF91c2Vyc30K8J+OrCDYpdis2YXYp9mE2Yog2KfZhNmB2YrYr9mK2YjZh9in2Kog2KfZhNmF2LbYutmI2LfYqToge3RvdGFsX3ZpZGVvc30K8J+TpiDYudiv2K8g2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2Kk6IHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0K8J+SviDZhdiz2KfYrdipINin2YTYqtiu2LLZitmGINin2YTZhdiz2KrYrtiv2YXYqToge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0KIiIiCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoc3RhdHNfdGV4dCkKCmFzeW5jIGRlZiBmaWxlc19jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvZmlsZXMgLSDYudix2LYg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2KkgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAKICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID09IDA6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINmE2Kcg2KrZiNis2K8g2YXZhNmB2KfYqiDZhdiu2LLZhtipINit2KfZhNmK2KfZiy4iKQogICAgICAgIHJldHVybgogICAgCiAgICBmaWxlc190ZXh0ID0gZiLwn5OmICoq2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2KkgKHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0pOioqXG5cbiIKICAgIAogICAgZm9yIGksIGZpbGVfaW5mbyBpbiBlbnVtZXJhdGUoc3RvcmFnZV9pbmZvWydmaWxlcyddWzoxMF0sIDEpOgogICAgICAgIGZpbGVzX3RleHQgKz0gZiJ7aX0uIGB7ZmlsZV9pbmZvWyduYW1lJ119YFxuICAg2KfZhNit2KzZhToge2Zvcm1hdF9zaXplKGZpbGVfaW5mb1snc2l6ZSddKX1cblxuIgogICAgCiAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA+IDEwOgogICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbi4uLiDZiCB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gLSAxMH0g2YXZhNmBINii2K7YsSIKICAgIAogICAgZmlsZXNfdGV4dCArPSBmIlxu8J+SviDYp9mE2KXYrNmF2KfZhNmKOiB7Zm9ybWF0X3NpemUoc3RvcmFnZV9pbmZvWyd0b3RhbF9zaXplJ10pfSIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmaWxlc190ZXh0KQoKYXN5bmMgZGVmIGNsZWFudXBfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL2NsZWFudXAgLSDYrdiw2YEg2KzZhdmK2Lkg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2KkgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICBkZWxldGVkX2NvdW50ID0gMAogICAgCiAgICBmb3IgZmlsZV9pbmZvIGluIHN0b3JhZ2VfaW5mb1snZmlsZXMnXToKICAgICAgICBpZiBkZWxldGVfZmlsZV9zYWZlKGZpbGVfaW5mb1sncGF0aCddKToKICAgICAgICAgICAgZGVsZXRlZF9jb3VudCArPSAxCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZiLinIUg2KrZhSDYrdiw2YEge2RlbGV0ZWRfY291bnR9INmF2YTZgSDYqNmG2KzYp9itISIpCgphc3luYyBkZWYgZXJyb3JzX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9lcnJvcnMgLSDYudix2LYg2KLYrtixINin2YTYo9iu2LfYp9ihICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHRyeToKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoJ2JvdF9lcnJvcnMubG9nJyk6CiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKchSDZhNinINiq2YjYrNivINij2K7Yt9in2KEg2YXYs9is2YTYqSEiKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINmC2LHYp9ih2Kkg2KLYrtixIDUwINiz2LfYsSDZhdmGINmF2YTZgSDYp9mE2KPYrti32KfYoQogICAgICAgIHdpdGggb3BlbignYm90X2Vycm9ycy5sb2cnLCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQogICAgICAgICAgICBsYXN0X2xpbmVzID0gbGluZXNbLTUwOl0gaWYgbGVuKGxpbmVzKSA+IDUwIGVsc2UgbGluZXMKICAgICAgICAKICAgICAgICBpZiBub3QgbGFzdF9saW5lczoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINmE2Kcg2KrZiNis2K8g2KPYrti32KfYoSDZhdiz2KzZhNipISIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2LPYrNmECiAgICAgICAgbG9nX3RleHQgPSAnJy5qb2luKGxhc3RfbGluZXMpCiAgICAgICAgCiAgICAgICAgIyDYpdiw2Kcg2YPYp9mGINin2YTZhti1INi32YjZitmEINis2K/Yp9mL2Iwg2YLYs9mF2YcKICAgICAgICBpZiBsZW4obG9nX3RleHQpID4gNDAwMDoKICAgICAgICAgICAgY2h1bmtzID0gW2xvZ190ZXh0W2k6aSs0MDAwXSBmb3IgaSBpbiByYW5nZSgwLCBsZW4obG9nX3RleHQpLCA0MDAwKV0KICAgICAgICAgICAgZm9yIGksIGNodW5rIGluIGVudW1lcmF0ZShjaHVua3NbOjNdLCAxKTogICMg2KPZiNmEIDMg2YLYt9i5INmB2YLYtwogICAgICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmIvCfk4sgKirYs9is2YQg2KfZhNij2K7Yt9in2KEgKHtpfSk6KipcbmBgYFxue2NodW5rfVxuYGBgIikKICAgICAgICBlbHNlOgogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi8J+TiyAqKtiz2KzZhCDYp9mE2KPYrti32KfYoToqKlxuYGBgXG57bG9nX3RleHR9XG5gYGAiKQogICAgICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBlcnJvcl9tc2cgPSBmIuKdjCDYrti32KMg2YHZiiDZgtix2KfYodipINin2YTYs9is2YQ6IHtzdHIoZSl9IgogICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChlcnJvcl9tc2cpCgphc3luYyBkZWYgY2xlYXJfZXJyb3JzX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9jbGVhcmVycm9ycyAtINit2LDZgSDYs9is2YQg2KfZhNij2K7Yt9in2KEgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCdib3RfZXJyb3JzLmxvZycpOgogICAgICAgICAgICBvcy5yZW1vdmUoJ2JvdF9lcnJvcnMubG9nJykKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINiq2YUg2K3YsNmBINiz2KzZhCDYp9mE2KPYrti32KfYoSDYqNmG2KzYp9itISIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINmE2Kcg2YrZiNis2K8g2LPYrNmEINmE2YTYrdiw2YEhIikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4p2MINiu2LfYozoge3N0cihlKX0iKQoKYXN5bmMgZGVmIGJ1dHRvbl9oYW5kbGVyKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItmF2LnYp9mE2Kwg2KfZhNij2LLYsdin2LEiIiIKICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQogICAgCiAgICBkYXRhID0gcXVlcnkuZGF0YQogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTZhdmE2YHYp9iqCiAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoInF1YWxpdHlfIikgYW5kIG5vdCBkYXRhLnN0YXJ0c3dpdGgoInF1YWxpdHlfdXJsXyIpOgogICAgICAgIHF1YWxpdHkgPSBkYXRhLnJlcGxhY2UoInF1YWxpdHlfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2YjYrNmI2K8gZmlsZV9pZAogICAgICAgIGlmICdmaWxlX2lkJyBub3QgaW4gcGVuZGluZzoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYrti32KM6INmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2KfZhNmF2YTZgS4g2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGNoYXRfaWQgPSBwZW5kaW5nWydjaGF0X2lkJ10KICAgICAgICAKICAgICAgICBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLnB1dCh7CiAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgJ3NvdXJjZSc6IHBlbmRpbmdbJ2ZpbGVfaWQnXSwKICAgICAgICAgICAgJ3R5cGUnOiAnZmlsZV9pZCcsCiAgICAgICAgICAgICdmaWxlX3NpemUnOiBwZW5kaW5nWydmaWxlX3NpemUnXSwKICAgICAgICAgICAgJ3F1YWxpdHknOiBxdWFsaXR5CiAgICAgICAgfSkKICAgICAgICAKICAgICAgICBxdWV1ZV9zaXplID0gcHJvY2Vzc2luZ19xdWV1ZS5xc2l6ZSgpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLinIUg2KrZhdiqINil2LbYp9mB2Kkg2KfZhNmB2YrYr9mK2Ygg2YTZhNi32KfYqNmI2LEhXG7wn5SiINin2YTZhdmI2LbYuSDZgdmKINin2YTYt9in2KjZiNixOiB7cXVldWVfc2l6ZX0iKQogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTYsdmI2KfYqNi3CiAgICBlbGlmIGRhdGEuc3RhcnRzd2l0aCgicXVhbGl0eV91cmxfIik6CiAgICAgICAgcXVhbGl0eSA9IGRhdGEucmVwbGFjZSgicXVhbGl0eV91cmxfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNix2KfYqNi3INmF2LHYqSDYo9iu2LHZiS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINmI2KzZiNivIHVybAogICAgICAgIGlmICd1cmwnIG5vdCBpbiBwZW5kaW5nOgogICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgi4p2MINiu2LfYozog2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYp9mE2LHYp9io2LcuINij2LHYs9mEINin2YTYsdin2KjYtyDZhdix2Kkg2KPYrtix2YkuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgY2hhdF9pZCA9IHBlbmRpbmdbJ2NoYXRfaWQnXQogICAgICAgIAogICAgICAgIGF3YWl0IHByb2Nlc3NpbmdfcXVldWUucHV0KHsKICAgICAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICAgICAnc291cmNlJzogcGVuZGluZ1sndXJsJ10sCiAgICAgICAgICAgICd0eXBlJzogJ3VybCcsCiAgICAgICAgICAgICdxdWFsaXR5JzogcXVhbGl0eQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgcXVldWVfc2l6ZSA9IHByb2Nlc3NpbmdfcXVldWUucXNpemUoKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGYi4pyFINiq2YXYqiDYpdi22KfZgdipINin2YTYsdin2KjYtyDZhNmE2LfYp9io2YjYsSFcbvCflKIg2KfZhNmF2YjYtti5INmB2Yog2KfZhNi32KfYqNmI2LE6IHtxdWV1ZV9zaXplfSIpCiAgICAKICAgICMg2YXYudin2YTYrNipINij2LLYsdin2LEg2KfZhNmC2KfYptmF2Kkg2KfZhNix2KbZitiz2YrYqQogICAgZWxpZiBkYXRhID09ICJteV9hY2NvdW50IjoKICAgICAgICB1c2VyX2RhdGEgPSBnZXRfdXNlcih1c2VyX2lkKQogICAgICAgIGlmIHVzZXJfZGF0YToKICAgICAgICAgICAgdXNlcl9pZF9kYiwgdXNlcm5hbWUsIHRvdGFsX3ZpZGVvcywgam9pbmVkX2RhdGUgPSB1c2VyX2RhdGEKICAgICAgICAgICAgYWNjb3VudF90ZXh0ID0gZiIiIgrwn5OKICoq2YXYudmE2YjZhdin2Kog2K3Ys9in2KjZgzoqKgoK8J+RpCDYp9mE2YXYudix2YE6IHt1c2VyX2lkX2RifQrwn46sINi52K/YryDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2YXYtti62YjYt9ipOiB7dG90YWxfdmlkZW9zfQrwn5OFINiq2KfYsdmK2K4g2KfZhNin2YbYttmF2KfZhToge2pvaW5lZF9kYXRlfQoiIiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBhY2NvdW50X3RleHQgPSAi4p2MINmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2K3Ys9in2KjZgy4iCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fc3RhcnQiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGFjY291bnRfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImhlbHAiOgogICAgICAgIGhlbHBfdGV4dCA9ICIiIgrihLnvuI8gKirZg9mK2YHZitipINin2LPYqtiu2K/Yp9mFINin2YTYqNmI2Ko6KioKCioq8J+TpSDZhNmE2YXZhNmB2KfYqiDYp9mE2LXYutmK2LHYqSAo2KPZgtmEINmF2YYgMjBNQik6KioKMe+4j+KDoyDYo9ix2LPZhCDYp9mE2YHZitiv2YrZiCDZhdio2KfYtNix2Kkg2YXZhiDYqtmK2YTZitis2LHYp9mFCjLvuI/ig6Mg2KfYrtiq2LEg2YXYs9iq2YjZiSDYp9mE2KzZiNiv2KkKM++4j+KDoyDYp9mG2KrYuNixINit2KrZiSDZitiq2YUg2KfZhNi22LrYtyDZiNin2YTYpdix2LPYp9mECgoqKvCfk6Qg2YTZhNmF2YTZgdin2Kog2KfZhNmD2KjZitix2KkgKNij2YPYqNixINmF2YYgMjBNQik6KioKMe+4j+KDoyDYp9ix2YHYuSDYp9mE2YHZitiv2YrZiCDYudmE2Ykg2KXYrdiv2Ykg2KfZhNmF2YbYtdin2Ko6CiAgIOKAoiBHb29nbGUgRHJpdmUgKNit2KrZiSAxNUdCINmF2KzYp9mG2KfZiykKICAg4oCiIERyb3Bib3ggKNit2KrZiSAyR0Ig2YXYrNin2YbYp9mLKQogICDigKIgTWVkaWFGaXJlCiAgIAoy77iP4oOjINin2K3YtdmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsToKICAgCiAgICoqR29vZ2xlIERyaXZlOioqCiAgIGBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/ZXhwb3J0PWRvd25sb2FkJmlkPUZJTEVfSURgCiAgIAogICAqKkRyb3Bib3g6KioKICAgYGh0dHBzOi8vd3d3LmRyb3Bib3guY29tL3MveHh4eHgvdmlkZW8ubXA0P2RsPTFgCiAgIAoz77iP4oOjINij2LHYs9mEINin2YTYsdin2KjYtyDZhNmE2KjZiNiqCjTvuI/ig6Mg2KfYrtiq2LEg2YXYs9iq2YjZiSDYp9mE2KzZiNiv2KkKCioq8J+OryDZhdiz2KrZiNmK2KfYqiDYp9mE2KzZiNiv2Kk6KioK8J+UpSAqKti52KfZhNmK2KkqKiAtINis2YjYr9ipINmF2YXYqtin2LLYqdiMINit2KzZhSDYo9mC2YQg2YLZhNmK2YTYp9mLCuKalu+4jyAqKtmF2KrZiNiz2LfYqSoqIC0g2KrZiNin2LLZhiDYqNmK2YYg2KfZhNis2YjYr9ipINmI2KfZhNit2KzZhSAgCvCfkr4gKirZhdmG2K7Zgdi22KkqKiAtINij2YLZhCDYrdis2YUg2YXZhdmD2YbYjCDYrNmI2K/YqSDZhdmC2KjZiNmE2KkKCuKcqCAqKtmF2YrYstipINmF2YfZhdipKio6INin2YTYqNmI2Kog2YrYrdmB2Lgg2KPYqNi52KfYryDYp9mE2YHZitiv2YrZiCDYp9mE2KPYtdmE2YrYqSEK2KfZhNi22LrYtyDZitiq2YUg2YHZgti3INio2KrZgtmE2YrZhCDYp9mE2KzZiNiv2Kkg8J+OrwoK4pqg77iPICoq2YXZhNin2K3YuNin2Ko6KioK4oCiINin2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixOiDYrdiq2YkgMjBNQiDZgdmC2LcK4oCiINin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2Kk6INit2KrZiSAyR0IK4oCiINit2LDZgSDYqtmE2YLYp9im2Yog2YTZhNmF2YTZgdin2Kog2KjYudivINin2YTYpdix2LPYp9mECiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJiYWNrX3RvX3N0YXJ0IildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChoZWxwX3RleHQsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJhZG1pbl9zZXR0aW5ncyI6CiAgICAgICAgaWYgdXNlcl9pZCAhPSBBRE1JTl9JRDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCLim5Qg2YfYsNinINmE2YTZhdi02LHZgSDZgdmC2LchIiwgc2hvd19hbGVydD1UcnVlKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINin2YTYpdit2LXYp9im2YrYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc3RhdHMiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+TpiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX2ZpbGVzIildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfmqgg2LPYrNmEINin2YTYo9iu2LfYp9ihIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fZXJyb3JzIildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfl5HvuI8g2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fY2xlYW51cCIpXSwKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fc3RhcnQiKV0KICAgICAgICBdCiAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKame+4jyAqKtil2LnYr9in2K/Yp9iqINin2YTZhdi02LHZgToqKiIsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fc3RhdHMiOgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICAgICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjLmV4ZWN1dGUoIlNFTEVDVCBDT1VOVCgqKSBGUk9NIHVzZXJzIikKICAgICAgICB0b3RhbF91c2VycyA9IGMuZmV0Y2hvbmUoKVswXQogICAgICAgIGMuZXhlY3V0ZSgiU0VMRUNUIFNVTSh0b3RhbF92aWRlb3MpIEZST00gdXNlcnMiKQogICAgICAgIHRvdGFsX3ZpZGVvcyA9IGMuZmV0Y2hvbmUoKVswXSBvciAwCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgCiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgc3RhdHNfdGV4dCA9IGYiIiIK8J+TiiAqKtil2K3Ytdin2KbZitin2Kog2KfZhNio2YjYqjoqKgoK8J+RpSDYudiv2K8g2KfZhNmF2LPYqtiu2K/ZhdmK2YY6IHt0b3RhbF91c2Vyc30K8J+OrCDYpdis2YXYp9mE2Yog2KfZhNmB2YrYr9mK2YjZh9in2Ko6IHt0b3RhbF92aWRlb3N9CvCfk6Yg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2Kk6IHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0K8J+SviDYp9mE2YXYs9in2K3YqSDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9CiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoc3RhdHNfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2ZpbGVzIjoKICAgICAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgICAgICAKICAgICAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA9PSAwOgogICAgICAgICAgICBmaWxlc190ZXh0ID0gIuKchSDZhNinINiq2YjYrNivINmF2YTZgdin2Kog2YXYrtiy2YbYqSDYrdin2YTZitin2YsuIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZpbGVzX3RleHQgPSBmIvCfk6YgKirYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAoe3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddfSk6KipcblxuIgogICAgICAgICAgICBmb3IgaSwgZmlsZV9pbmZvIGluIGVudW1lcmF0ZShzdG9yYWdlX2luZm9bJ2ZpbGVzJ11bOjEwXSwgMSk6CiAgICAgICAgICAgICAgICBmaWxlc190ZXh0ICs9IGYie2l9LiBge2ZpbGVfaW5mb1snbmFtZSddWzozMF19Li4uYFxuICAge2Zvcm1hdF9zaXplKGZpbGVfaW5mb1snc2l6ZSddKX1cblxuIgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiAxMDoKICAgICAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbi4uLiDZiCB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gLSAxMH0g2YXZhNmBINii2K7YsSIKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbvCfkr4g2KfZhNil2KzZhdin2YTZijoge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0iCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmaWxlc190ZXh0LCByZXBseV9tYXJrdXA9YmFja19idXR0b24pCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fY2xlYW51cCI6CiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgZGVsZXRlZF9jb3VudCA9IDAKICAgICAgICAKICAgICAgICBmb3IgZmlsZV9pbmZvIGluIHN0b3JhZ2VfaW5mb1snZmlsZXMnXToKICAgICAgICAgICAgaWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSk6CiAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDEKICAgICAgICAKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGYi4pyFINiq2YUg2K3YsNmBIHtkZWxldGVkX2NvdW50fSDZhdmE2YEhIiwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2Vycm9ycyI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoJ2JvdF9lcnJvcnMubG9nJyk6CiAgICAgICAgICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFsKICAgICAgICAgICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV0KICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgi4pyFINmE2Kcg2KrZiNis2K8g2KPYrti32KfYoSDZhdiz2KzZhNipISIsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyDZgtix2KfYodipINii2K7YsSAzMCDYs9i32LEKICAgICAgICAgICAgd2l0aCBvcGVuKCdib3RfZXJyb3JzLmxvZycsICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjoKICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQogICAgICAgICAgICAgICAgbGFzdF9saW5lcyA9IGxpbmVzWy0zMDpdIGlmIGxlbihsaW5lcykgPiAzMCBlbHNlIGxpbmVzCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2dfdGV4dCA9ICcnLmpvaW4obGFzdF9saW5lcykKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KrZgti12YrYsSDYp9mE2YbYtSDYpdiw2Kcg2YPYp9mGINi32YjZitmECiAgICAgICAgICAgIGlmIGxlbihsb2dfdGV4dCkgPiAzNTAwOgogICAgICAgICAgICAgICAgbG9nX3RleHQgPSBsb2dfdGV4dFstMzUwMDpdCiAgICAgICAgICAgIAogICAgICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+Xke+4jyDYrdiw2YEg2KfZhNiz2KzZhCIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX2NsZWFyX2Vycm9ycyIpXSwKICAgICAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXQogICAgICAgICAgICBdCiAgICAgICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQogICAgICAgICAgICAKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoCiAgICAgICAgICAgICAgICBmIvCfk4sgKirYotiu2LEg2KfZhNij2K7Yt9in2KEg2KfZhNmF2LPYrNmE2Kk6KipcblxuYGBgXG57bG9nX3RleHR9XG5gYGAiLAogICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cAogICAgICAgICAgICApCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmIuKdjCDYrti32KMg2YHZiiDZgtix2KfYodipINin2YTYs9is2YQ6IHtzdHIoZSl9IiwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2NsZWFyX2Vycm9ycyI6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cygnYm90X2Vycm9ycy5sb2cnKToKICAgICAgICAgICAgICAgIG9zLnJlbW92ZSgnYm90X2Vycm9ycy5sb2cnKQogICAgICAgICAgICAgICAgbWVzc2FnZSA9ICLinIUg2KrZhSDYrdiw2YEg2LPYrNmEINin2YTYo9iu2LfYp9ihINio2YbYrNin2K0hIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbWVzc2FnZSA9ICLinIUg2YTYpyDZitmI2KzYryDYs9is2YQg2YTZhNit2LDZgSEiCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBtZXNzYWdlID0gZiLinYwg2K7Yt9ijOiB7c3RyKGUpfSIKICAgICAgICAKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KG1lc3NhZ2UsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJiYWNrX3RvX3N0YXJ0IjoKICAgICAgICB1c2VyID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyCiAgICAgICAga2V5Ym9hcmRfcm93cyA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINit2LPYp9io2Yog2YjYpdit2LXYp9im2YrYp9iq2YoiLCBjYWxsYmFja19kYXRhPSJteV9hY2NvdW50IildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKEue+4jyDYp9mE2YXYs9in2LnYr9ipIiwgY2FsbGJhY2tfZGF0YT0iaGVscCIpXQogICAgICAgIF0KICAgICAgICAKICAgICAgICBpZiB1c2VyLmlkID09IEFETUlOX0lEOgogICAgICAgICAgICBrZXlib2FyZF9yb3dzLmFwcGVuZChbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKame+4jyDYpdi52K/Yp9iv2KfYqiDYp9mE2YXYtNix2YEiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXSkKICAgICAgICAKICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZF9yb3dzKQogICAgICAgIAogICAgICAgIHdlbGNvbWVfdGV4dCA9IGYiIiIK8J+OrCDZhdix2K3YqNin2Ysge3VzZXIuZmlyc3RfbmFtZX0hCgrYo9mG2Kcg2KjZiNiqINi22LrYtyDYp9mE2YHZitiv2YrZiNmH2KfYqiAtICoq2YXYrNin2YbZiiDYqNin2YTZg9in2YXZhCoqIPCfmoAKCioq8J+OryDYp9mE2YXZhdmK2LLYp9iqOioqCuKcqCDZhdmE2YHYp9iqINit2KrZiSAqKjJHQioqINi52KjYsSDYp9mE2LHZiNin2KjYtwrinKgg2KrYrdmF2YrZhCDZhdio2KfYtNixINit2KrZiSAyME1CCuKcqCAzINmF2LPYqtmI2YrYp9iqINi22LrYtyDZgtmI2YrYqQrinKgg2K3YsNmBINiq2YTZgtin2KbZiiDZhNmE2YXZhNmB2KfYqgoKKirwn5OkINmD2YrZgSDYqtio2K/YozoqKgrigKIg2YXZhNmB2KfYqiDYtdi62YrYsdipOiDYo9ix2LPZhCDZhdio2KfYtNix2KkK4oCiINmF2YTZgdin2Kog2YPYqNmK2LHYqTog2KfYsdmB2Lkg2LnZhNmJIERyaXZlL0Ryb3Bib3gg2YjYo9ix2LPZhCDYp9mE2LHYp9io2LcKCtin2LbYuti3ICLYp9mE2YXYs9in2LnYr9ipIiDZhNmF2LnYsdmB2Kkg2KfZhNiq2YHYp9i12YrZhCEg8J+TmgoiIiIKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCh3ZWxjb21lX3RleHQsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgojID09PT09PT09PT09PT09PT09PT09INmF2LnYp9mE2KzYqSDYp9mE2YHZitiv2YrZiCA9PT09PT09PT09PT09PT09PT09PQphc3luYyBkZWYgZG93bmxvYWRfZmlsZV9mcm9tX3RlbGVncmFtKGNvbnRleHQsIGZpbGVfaWQ6IHN0ciwgZmlsZV9zaXplOiBpbnQpIC0+IE9wdGlvbmFsW3N0cl06CiAgICAiIiLYqtit2YXZitmEINmF2YTZgSDZhdmGINiq2YTZitis2LHYp9mFINil2YTZiSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoiIiIKICAgIHRyeToKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfk6Ug2KrYrdmF2YrZhCDZhdmGIFRlbGVncmFtLi4uINin2YTYrdis2YU6IHtmaWxlX3NpemUgLyAoMTAyNCoxMDI0KTouMmZ9IE1CIikKICAgICAgICBwcmludChmIvCfk6Ug2KrYrdmF2YrZhCDZhdmGIFRlbGVncmFtLi4uINin2YTYrdis2YU6IHtmaWxlX3NpemUgLyAoMTAyNCoxMDI0KTouMmZ9IE1CIikKICAgICAgICAKICAgICAgICBmaWxlID0gYXdhaXQgY29udGV4dC5ib3QuZ2V0X2ZpbGUoZmlsZV9pZCkKICAgICAgICAKICAgICAgICAjINit2YHYuCDZgdmKINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqgogICAgICAgIHRpbWVzdGFtcCA9IGludCh0aW1lLnRpbWUoKSkKICAgICAgICB0ZW1wX2ZpbGVuYW1lID0gZiJ2aWRlb197dGltZXN0YW1wfV97ZmlsZV9pZFs6MTBdfS5tcDQiCiAgICAgICAgdGVtcF9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIHRlbXBfZmlsZW5hbWUpCiAgICAgICAgCiAgICAgICAgYXdhaXQgZmlsZS5kb3dubG9hZF90b19kcml2ZSh0ZW1wX3BhdGgpCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhDoge3RlbXBfcGF0aH0iKQogICAgICAgIHByaW50KGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQ6IHt0ZW1wX3BhdGh9IikKICAgICAgICAKICAgICAgICByZXR1cm4gdGVtcF9wYXRoCiAgICAgICAgCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgZXJyb3JfbXNnID0gZiLinYwg2K7Yt9ijINmB2Yog2KfZhNiq2K3ZhdmK2YQ6IHtlfVxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IgogICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgIGF3YWl0IHNlbmRfZXJyb3JfdG9fYWRtaW4oY29udGV4dCwgZXJyb3JfbXNnKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X3F1YWxpdHlfc2V0dGluZ3MocXVhbGl0eTogc3RyKSAtPiBkaWN0OgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYpdi52K/Yp9iv2KfYqiDYp9mE2KzZiNiv2KkgLSDYqNiv2YjZhiDYqti62YrZitixINin2YTYo9io2LnYp9ivIiIiCiAgICBpZiBxdWFsaXR5ID09ICdoaWdoJzoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMjgsCiAgICAgICAgICAgICJwcmVzZXQiOiAibWVkaXVtIiwKICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiA5NiwKICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IDQ0MTAwLAogICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiAyCiAgICAgICAgfQogICAgZWxpZiBxdWFsaXR5ID09ICdtZWRpdW0nOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJjcmYiOiAzMywKICAgICAgICAgICAgInByZXNldCI6ICJtZWRpdW0iLAogICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IDY0LAogICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5IjogNDQxMDAsCiAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IDIKICAgICAgICB9CiAgICBlbHNlOiAgIyBsb3cKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMzgsCiAgICAgICAgICAgICJwcmVzZXQiOiAiZmFzdCIsCiAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogNDgsCiAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiAyMjA1MCwKICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogMQogICAgICAgIH0KCmRlZiBjb21wcmVzc192aWRlbyh2aWRlb19zb3VyY2U6IHN0ciwgY2hhdF9pZDogc3RyLCBjb250ZXh0LCBxdWFsaXR5OiBzdHIgPSAnbG93JywgaXNfdXJsOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbc3RyXToKICAgICIiIti22LrYtyDYp9mE2YHZitiv2YrZiCDYqNin2LPYqtiu2K/Yp9mFIENsb3VkQ29udmVydCAtINmF2Lkg2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSIiIgogICAgYXBpX2tleSA9IGdldF9hcGlfa2V5KCkKICAgIGlmIG5vdCBhcGlfa2V5OgogICAgICAgIGxvZ2dlci5lcnJvcigi2YTYpyDZitmI2KzYryBBUEkga2V5IikKICAgICAgICByZXR1cm4gIk5PX0FQSV9LRVlfU0VUIgoKICAgIHRyeToKICAgICAgICBsb2dnZXIuaW5mbyhmIvCfjqwg2KjYr9ihINi22LrYtyDYp9mE2YHZitiv2YrZiCAtINin2YTYrNmI2K/YqToge3F1YWxpdHl9LCDZhtmI2Lkg2KfZhNmF2LXYr9ixOiB7J1VSTCcgaWYgaXNfdXJsIGVsc2UgJ9mF2YTZgSDZhdit2YTZiid9IikKICAgICAgICAKICAgICAgICBoZWFkZXJzID0geyJBdXRob3JpemF0aW9uIjogZiJCZWFyZXIge2FwaV9rZXl9In0KICAgICAgICBzZXR0aW5ncyA9IGdldF9xdWFsaXR5X3NldHRpbmdzKHF1YWxpdHkpCiAgICAgICAgCiAgICAgICAgIyDYqtit2K/ZitivINit2YXZiNmE2KkgSm9iIC0g2KjYr9mI2YYgd2lkdGgg2YggaGVpZ2h0INmE2K3Zgdi4INin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipCiAgICAgICAgaWYgaXNfdXJsOgogICAgICAgICAgICBqb2JfcGF5bG9hZCA9IHsKICAgICAgICAgICAgICAgICJ0YXNrcyI6IHsKICAgICAgICAgICAgICAgICAgICAiaW1wb3J0LXZpZGVvIjogeyJvcGVyYXRpb24iOiAiaW1wb3J0L3VybCIsICJ1cmwiOiB2aWRlb19zb3VyY2UsICJmaWxlbmFtZSI6ICJ2aWRlby5tcDQifSwKICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3MtdmlkZW8iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcGVyYXRpb24iOiAiY29udmVydCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiaW5wdXQiOiAiaW1wb3J0LXZpZGVvIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJvdXRwdXRfZm9ybWF0IjogIm1wNCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2aWRlb19jb2RlYyI6ICJ4MjY0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJjcmYiOiBzZXR0aW5nc1siY3JmIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAicHJlc2V0Ijogc2V0dGluZ3NbInByZXNldCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY29kZWMiOiAiYWFjIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogc2V0dGluZ3NbImF1ZGlvX2JpdHJhdGUiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiBzZXR0aW5nc1siYXVkaW9fZnJlcXVlbmN5Il0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiBzZXR0aW5nc1siYXVkaW9fY2hhbm5lbHMiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpcF9tZXRhZGF0YSI6IFRydWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJleHBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJleHBvcnQvdXJsIiwgImlucHV0IjogImNvbXByZXNzLXZpZGVvIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGpvYl9wYXlsb2FkID0gewogICAgICAgICAgICAgICAgInRhc2tzIjogewogICAgICAgICAgICAgICAgICAgICJpbXBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJpbXBvcnQvdXBsb2FkIn0sCiAgICAgICAgICAgICAgICAgICAgImNvbXByZXNzLXZpZGVvIjogewogICAgICAgICAgICAgICAgICAgICAgICAib3BlcmF0aW9uIjogImNvbnZlcnQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImlucHV0IjogImltcG9ydC12aWRlbyIsIAogICAgICAgICAgICAgICAgICAgICAgICAib3V0cHV0X2Zvcm1hdCI6ICJtcDQiLAogICAgICAgICAgICAgICAgICAgICAgICAidmlkZW9fY29kZWMiOiAieDI2NCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiY3JmIjogc2V0dGluZ3NbImNyZiJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgInByZXNldCI6IHNldHRpbmdzWyJwcmVzZXQiXSwKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2NvZGVjIjogImFhYyIsIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IHNldHRpbmdzWyJhdWRpb19iaXRyYXRlIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5Ijogc2V0dGluZ3NbImF1ZGlvX2ZyZXF1ZW5jeSJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogc2V0dGluZ3NbImF1ZGlvX2NoYW5uZWxzIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAic3RyaXBfbWV0YWRhdGEiOiBUcnVlCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAiZXhwb3J0LXZpZGVvIjogeyJvcGVyYXRpb24iOiAiZXhwb3J0L3VybCIsICJpbnB1dCI6ICJjb21wcmVzcy12aWRlbyJ9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAKICAgICAgICBsb2dnZXIuaW5mbygi8J+TpCDYpdix2LPYp9mEINi32YTYqCDYpdmE2YkgQ2xvdWRDb252ZXJ0Li4uIikKICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QoCiAgICAgICAgICAgICJodHRwczovL2FwaS5jbG91ZGNvbnZlcnQuY29tL3YyL2pvYnMiLAogICAgICAgICAgICBqc29uPWpvYl9wYXlsb2FkLAogICAgICAgICAgICBoZWFkZXJzPWhlYWRlcnMKICAgICAgICApCiAgICAgICAgCiAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAxOgogICAgICAgICAgICBlcnJvcl9tc2cgPSBmIuKdjCDZgdi02YQg2KXZhti02KfYoSBKb2I6IHtyZXNwb25zZS5zdGF0dXNfY29kZX0gLSB7cmVzcG9uc2UudGV4dH0iCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgIHByaW50KGVycm9yX21zZykKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgam9iX2RhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICAgIGpvYl9pZCA9IGpvYl9kYXRhWyJpZCJdCiAgICAgICAgbG9nZ2VyLmluZm8oZiLinIUg2KrZhSDYpdmG2LTYp9ihIEpvYjoge2pvYl9pZH0iKQogICAgICAgIAogICAgICAgICMg2LHZgdi5INin2YTZhdmE2YEg2KXYsNinINmD2KfZhiDZhdit2YTZitin2YsKICAgICAgICBpZiBub3QgaXNfdXJsOgogICAgICAgICAgICBpbXBvcnRfdGFzayA9IG5leHQoKHQgZm9yIHQgaW4gam9iX2RhdGFbInRhc2tzIl0gaWYgdFsibmFtZSJdID09ICJpbXBvcnQtdmlkZW8iKSwgTm9uZSkKICAgICAgICAgICAgaWYgbm90IGltcG9ydF90YXNrOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCLinYwg2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSBpbXBvcnQgdGFzayIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgdXBsb2FkX3VybCA9IGltcG9ydF90YXNrWyJyZXN1bHQiXVsiZm9ybSJdWyJ1cmwiXQogICAgICAgICAgICB1cGxvYWRfcGFyYW1zID0gaW1wb3J0X3Rhc2tbInJlc3VsdCJdWyJmb3JtIl1bInBhcmFtZXRlcnMiXQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIvCfk6Qg2LHZgdi5INin2YTZhdmE2YEg2KXZhNmJIENsb3VkQ29udmVydC4uLiIpCiAgICAgICAgICAgIHdpdGggb3Blbih2aWRlb19zb3VyY2UsICdyYicpIGFzIGY6CiAgICAgICAgICAgICAgICBmaWxlcyA9IHsnZmlsZSc6IGZ9CiAgICAgICAgICAgICAgICB1cGxvYWRfcmVzcG9uc2UgPSByZXF1ZXN0cy5wb3N0KHVwbG9hZF91cmwsIGRhdGE9dXBsb2FkX3BhcmFtcywgZmlsZXM9ZmlsZXMpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiB1cGxvYWRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgbm90IGluIFsyMDAsIDIwMV06CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIuKdjCDZgdi02YQg2LHZgdi5INin2YTZhdmE2YE6IHt1cGxvYWRfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IC0ge3VwbG9hZF9yZXNwb25zZS50ZXh0fSIKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICBwcmludChlcnJvcl9tc2cpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIuKchSDYqtmFINix2YHYuSDYp9mE2YXZhNmBINmE2YAgQ2xvdWRDb252ZXJ0IikKICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINix2YHYuSDYp9mE2YXZhNmBINmE2YAgQ2xvdWRDb252ZXJ0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2K3ZhNmKINmB2YjYsdin2Ysg2KjYudivINin2YTYsdmB2LkKICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh2aWRlb19zb3VyY2UpCiAgICAgICAgCiAgICAgICAgIyDYp9mG2KrYuNin2LEg2KfZg9iq2YXYp9mEINin2YTZhdi52KfZhNis2KkKICAgICAgICBtYXhfYXR0ZW1wdHMgPSAxODAKICAgICAgICBhdHRlbXB0ID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgICAgICAgICAgc3RhdHVzX3Jlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgZiJodHRwczovL2FwaS5jbG91ZGNvbnZlcnQuY29tL3YyL2pvYnMve2pvYl9pZH0iLAogICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1c19yZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIuKaoO+4jyDZgdi02YQg2YHYrdi1INin2YTYrdin2YTYqToge3N0YXR1c19yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2YHYrdi1INin2YTYrdin2YTYqToge3N0YXR1c19yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICBhdHRlbXB0ICs9IDEKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBqb2Jfc3RhdHVzID0gc3RhdHVzX3Jlc3BvbnNlLmpzb24oKVsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzWyJzdGF0dXMiXSA9PSAiZmluaXNoZWQiOgogICAgICAgICAgICAgICAgZXhwb3J0X3Rhc2sgPSBuZXh0KCh0IGZvciB0IGluIGpvYl9zdGF0dXNbInRhc2tzIl0gaWYgdFsibmFtZSJdID09ICJleHBvcnQtdmlkZW8iKSwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIGV4cG9ydF90YXNrIGFuZCBleHBvcnRfdGFzay5nZXQoInJlc3VsdCIpOgogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkX3VybCA9IGV4cG9ydF90YXNrWyJyZXN1bHQiXVsiZmlsZXMiXVswXVsidXJsIl0KICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKchSDYp9mD2KrZhdmEINin2YTYtti62LchIFVSTDoge2Rvd25sb2FkX3VybH0iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYi4pyFINin2YPYqtmF2YQg2KfZhNi22LrYtyEgVVJMOiB7ZG93bmxvYWRfdXJsfSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRvd25sb2FkX3VybAogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEIikKICAgICAgICAgICAgICAgICAgICBwcmludCgi4p2MINmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2LHYp9io2Lcg2KfZhNiq2K3ZhdmK2YQiKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIGpvYl9zdGF0dXNbInN0YXR1cyJdID09ICJlcnJvciI6CiAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIuKdjCDZgdi02YQgSm9iOiB7am9iX3N0YXR1c30iCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgICAgIGF0dGVtcHQgKz0gMQogICAgICAgICAgICBsb2dnZXIuaW5mbyhmIuKPsyDYp9mG2KrYuNin2LEuLi4gKHthdHRlbXB0fS97bWF4X2F0dGVtcHRzfSkiKQogICAgICAgICAgICBwcmludChmIuKPsyDYp9mG2KrYuNin2LEuLi4gKHthdHRlbXB0fS97bWF4X2F0dGVtcHRzfSkiKQogICAgICAgIAogICAgICAgIGxvZ2dlci53YXJuaW5nKCLij7HvuI8g2KfZhtiq2YfYqiDZhdmH2YTYqSDYp9mE2KfZhtiq2LjYp9ixIikKICAgICAgICBwcmludCgi4o+x77iPINin2YbYqtmH2Kog2YXZh9mE2Kkg2KfZhNin2YbYqti42KfYsSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBlcnJvcl9tc2cgPSBmIuKdjCDYrti32KMg2YHZiiDYtti62Lcg2KfZhNmB2YrYr9mK2Yg6IHtlfVxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9IgogICAgICAgIGxvZ2dlci5lcnJvcihlcnJvcl9tc2cpCiAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgIGFzeW5jaW8uY3JlYXRlX3Rhc2soc2VuZF9lcnJvcl90b19hZG1pbihjb250ZXh0LCBlcnJvcl9tc2cpKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgc2VuZF9jb21wcmVzc2VkX3ZpZGVvX2FkdmFuY2VkKGNoYXRfaWQ6IHN0ciwgdmlkZW9fdXJsOiBzdHIsIGNhcHRpb246IHN0cikgLT4gdHVwbGU6CiAgICAiIiLYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINin2YTZhdi22LrZiNi3INmF2Lkg2KXYr9in2LHYqSDZhdit2LPZhtipINmE2YTZhdmE2YHYp9iqIiIiCiAgICBtYXhfcmV0cmllcyA9IDMKICAgIAogICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgIHRlbXBfZmlsZV9wYXRoID0gTm9uZQogICAgICAgIAogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoZiLwn5OlINmF2K3Yp9mI2YTYqSDYqtit2YXZitmEINin2YTZgdmK2K/ZitmIICh7YXR0ZW1wdCArIDF9L3ttYXhfcmV0cmllc30pLi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICB2aWRlb19yZXNwb25zZSA9IHJlcXVlc3RzLmdldCh2aWRlb191cmwsIHN0cmVhbT1UcnVlLCB0aW1lb3V0PTMwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHZpZGVvX3Jlc3BvbnNlLnN0YXR1c19jb2RlICE9IDIwMDoKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYp9mE2KrYrdmF2YrZhDoge3ZpZGVvX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYrdmB2Lgg2YXYpNmC2KoKICAgICAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpKQogICAgICAgICAgICB0ZW1wX2ZpbGVuYW1lID0gZiJjb21wcmVzc2VkX3t0aW1lc3RhbXB9X3tjaGF0X2lkfS5tcDQiCiAgICAgICAgICAgIHRlbXBfZmlsZV9wYXRoID0gb3MucGF0aC5qb2luKFRFTVBfU1RPUkFHRV9ESVIsIHRlbXBfZmlsZW5hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICB3aXRoIG9wZW4odGVtcF9maWxlX3BhdGgsICd3YicpIGFzIGY6CiAgICAgICAgICAgICAgICBmb3IgY2h1bmsgaW4gdmlkZW9fcmVzcG9uc2UuaXRlcl9jb250ZW50KGNodW5rX3NpemU9ODE5Mik6CiAgICAgICAgICAgICAgICAgICAgaWYgY2h1bms6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoY2h1bmspCiAgICAgICAgICAgIAogICAgICAgICAgICBmaWxlX3NpemUgPSBvcy5wYXRoLmdldHNpemUodGVtcF9maWxlX3BhdGgpCiAgICAgICAgICAgIHByaW50KGYi4pyFINiq2YUg2KfZhNiq2K3ZhdmK2YQ6IHtmaWxlX3NpemUgLyAoMTAyNCoxMDI0KTouMmZ9IE1CIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiAogICAgICAgICAgICBwcmludCgi8J+TpCDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILi4uIikKICAgICAgICAgICAgCiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnL2JvdHtURUxFR1JBTV9CT1RfVE9LRU59L3NlbmRWaWRlbyIKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGVfcGF0aCwgJ3JiJykgYXMgdmlkZW9fZmlsZToKICAgICAgICAgICAgICAgIGZpbGVzID0geyd2aWRlbyc6IHZpZGVvX2ZpbGV9CiAgICAgICAgICAgICAgICBkYXRhID0gewogICAgICAgICAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgICAgICAgICAnY2FwdGlvbic6IGNhcHRpb24sCiAgICAgICAgICAgICAgICAgICAgJ3N1cHBvcnRzX3N0cmVhbWluZyc6IFRydWUKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VuZF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXJsLCBmaWxlcz1maWxlcywgZGF0YT1kYXRhLCB0aW1lb3V0PTMwMCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHNlbmRfcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KjZhtis2KfYrSEiKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUsIHRlbXBfZmlsZV9wYXRoCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIuKdjCDZgdi02YQg2KfZhNil2LHYs9in2YQ6IHtzZW5kX3Jlc3BvbnNlLnN0YXR1c19jb2RlfSAtIHtzZW5kX3Jlc3BvbnNlLnRleHRbOjIwMF19IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDYrdiw2YEg2KfZhNmF2YTZgSDYp9mE2YHYp9i02YQKICAgICAgICAgICAgICAgIGlmIHRlbXBfZmlsZV9wYXRoOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodGVtcF9maWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSwgdGVtcF9maWxlX3BhdGgKICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTZhdit2KfZiNmE2Kkge2F0dGVtcHQgKyAxfToge2V9IikKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHRlbXBfZmlsZV9wYXRoOgogICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgICAgIHRlbXBfZmlsZV9wYXRoID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgIAogICAgcmV0dXJuIEZhbHNlLCBOb25lCgphc3luYyBkZWYgcHJvY2Vzc192aWRlb19xdWV1ZShjb250ZXh0KToKICAgICIiItmF2LnYp9mE2Kwg2LfYp9io2YjYsSDYp9mE2YHZitiv2YrZiCIiIgogICAgZ2xvYmFsIGlzX3Byb2Nlc3NpbmcKICAgIAogICAgd2hpbGUgVHJ1ZToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHZpZGVvX2RhdGEgPSBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLmdldCgpCiAgICAgICAgICAgIAogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gVHJ1ZQogICAgICAgICAgICBjaGF0X2lkID0gdmlkZW9fZGF0YVsnY2hhdF9pZCddCiAgICAgICAgICAgIHVzZXJfaWQgPSBpbnQoY2hhdF9pZCkKICAgICAgICAgICAgdmlkZW9fc291cmNlID0gdmlkZW9fZGF0YVsnc291cmNlJ10KICAgICAgICAgICAgc291cmNlX3R5cGUgPSB2aWRlb19kYXRhWyd0eXBlJ10KICAgICAgICAgICAgZmlsZV9zaXplID0gdmlkZW9fZGF0YS5nZXQoJ2ZpbGVfc2l6ZScsIDApCiAgICAgICAgICAgIHF1YWxpdHkgPSB2aWRlb19kYXRhLmdldCgncXVhbGl0eScsICdsb3cnKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoZiLwn46sINio2K/YoSDZhdi52KfZhNis2Kk6IHtjaGF0X2lkfSAtIHtzb3VyY2VfdHlwZX0gLSB7cXVhbGl0eX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgY29tcHJlc3NlZF91cmwgPSBOb25lCiAgICAgICAgICAgIGxvY2FsX2ZpbGVfdG9fZGVsZXRlID0gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgIyDZhdi52KfZhNis2Kkg2K3Ys9ioINin2YTZhtmI2LkKICAgICAgICAgICAgaWYgc291cmNlX3R5cGUgPT0gJ3VybCc6CiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIuKPsyDYrNin2LHZiiDZhdi52KfZhNis2Kkg2KfZhNix2KfYqNi3Li4uIiwgY29udGV4dCkKICAgICAgICAgICAgICAgIGNvbXByZXNzZWRfdXJsID0gY29tcHJlc3NfdmlkZW8odmlkZW9fc291cmNlLCBjaGF0X2lkLCBjb250ZXh0LCBxdWFsaXR5LCBpc191cmw9VHJ1ZSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIHNvdXJjZV90eXBlID09ICdmaWxlX2lkJzoKICAgICAgICAgICAgICAgIGlmIGZpbGVfc2l6ZSA8PSBESVJFQ1RfRE9XTkxPQURfTElNSVQ6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLwn5OlINis2KfYsdmKINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguLi4iLCBjb250ZXh0KQogICAgICAgICAgICAgICAgICAgIGxvY2FsX2ZpbGUgPSBhd2FpdCBkb3dubG9hZF9maWxlX2Zyb21fdGVsZWdyYW0oY29udGV4dCwgdmlkZW9fc291cmNlLCBmaWxlX3NpemUpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbG9jYWxfZmlsZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfZmlsZV90b19kZWxldGUgPSBsb2NhbF9maWxlCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4o+zINis2KfYsdmKINi22LrYtyDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXByZXNzZWRfdXJsID0gY29tcHJlc3NfdmlkZW8obG9jYWxfZmlsZSwgY2hhdF9pZCwgY29udGV4dCwgcXVhbGl0eSwgaXNfdXJsPUZhbHNlKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYqtit2YXZitmEINin2YTZgdmK2K/ZitmILiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCBmIuKdjCDYp9mE2YXZhNmBINmD2KjZitixINis2K/Yp9mLICh7ZmlsZV9zaXplLygxMDI0KjEwMjQpOi4yZn0gTUIpLiDYp9mE2K3YryDYp9mE2KPZgti12YkgMjBNQi5cblxu8J+SoSDYp9iz2KrYrtiv2YUgR29vZ2xlIERyaXZlINij2YggRHJvcGJveCDZhNmE2YXZhNmB2KfYqiDYp9mE2KPZg9io2LEhIiwgY29udGV4dCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2KXYsdiz2KfZhCDYp9mE2YbYqtmK2KzYqQogICAgICAgICAgICBpZiBjb21wcmVzc2VkX3VybCA9PSAiTk9fQVBJX0tFWV9TRVQiOgogICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YTZhSDZitiq2YUg2KrYudmK2YrZhiDZhdmB2KrYp9itIEFQSS4g2KPYqNmE2Log2KfZhNmF2LTYsdmBLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZWxpZiBjb21wcmVzc2VkX3VybDoKICAgICAgICAgICAgICAgIHF1YWxpdHlfbmFtZXMgPSB7J2hpZ2gnOiAn8J+UpSDYudin2YTZitipJywgJ21lZGl1bSc6ICfimpbvuI8g2YXYqtmI2LPYt9ipJywgJ2xvdyc6ICfwn5K+INmF2YbYrtmB2LbYqSd9CiAgICAgICAgICAgICAgICBjYXB0aW9uID0gZiLinIUg2KrZhSDYp9mE2LbYuti3INio2YbYrNin2K0hXG7wn46sINin2YTYrNmI2K/YqToge3F1YWxpdHlfbmFtZXMuZ2V0KHF1YWxpdHksICfYudin2K/ZitipJyl9XG7inKgg2KrZhSDYp9mE2K3Zgdin2Lgg2LnZhNmJINin2YTYo9io2LnYp9ivINin2YTYo9i12YTZitipIgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIvCfk6Qg2KzYp9ix2Yog2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHNlbmRfc3VjY2VzcywgdGVtcF9maWxlID0gc2VuZF9jb21wcmVzc2VkX3ZpZGVvX2FkdmFuY2VkKGNoYXRfaWQsIGNvbXByZXNzZWRfdXJsLCBjYXB0aW9uKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZhdik2YLYqiDZgdmI2LHYp9mLINio2LnYryDYp9mE2KXYsdiz2KfZhAogICAgICAgICAgICAgICAgaWYgdGVtcF9maWxlOgogICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUodGVtcF9maWxlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiBzZW5kX3N1Y2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgaW5jcmVtZW50X3ZpZGVvX2NvdW50KHVzZXJfaWQpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmIINil2YTZiSB7Y2hhdF9pZH0iKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMg2KrZhti42YrZgSDYo9mKINmF2YTZgdin2Kog2YXYqtio2YLZitipCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgICAgICAgICAgICAgICAgIGlmIHN0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddID4gNToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIvCfp7kg2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqS4uLiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmaWxlX2luZm8gaW4gc3RvcmFnZV9pbmZvWydmaWxlcyddWzozXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUoZmlsZV9pbmZvWydwYXRoJ10pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILiDYrdin2YjZhCDZhdix2Kkg2KPYrtix2YkuIiwgY29udGV4dCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4p2MINmB2LTZhCDYtti62Lcg2KfZhNmB2YrYr9mK2YguINiq2K3ZgtmCINmF2YYg2KfZhNil2LnYr9in2K/Yp9iqLiIsIGNvbnRleHQpCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2LDZgSDYo9mKINmF2YTZgdin2Kog2YXYrdmE2YrYqSDZhdiq2KjZgtmK2KkKICAgICAgICAgICAgaWYgbG9jYWxfZmlsZV90b19kZWxldGU6CiAgICAgICAgICAgICAgICBkZWxldGVfZmlsZV9zYWZlKGxvY2FsX2ZpbGVfdG9fZGVsZXRlKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJvY2Vzc2luZ19xdWV1ZS50YXNrX2RvbmUoKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYp9mE2YXYudin2YTYrNipOiB7ZX0iKQogICAgICAgICAgICBpc19wcm9jZXNzaW5nID0gRmFsc2UKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQoKYXN5bmMgZGVmIGhhbmRsZV92aWRlbyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTZgdmK2K/ZitmIIiIiCiAgICB1c2VyX2lkID0gdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkCiAgICBjaGF0X2lkID0gc3RyKHVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIAogICAgaWYgdXBkYXRlLm1lc3NhZ2UudmlkZW86CiAgICAgICAgZmlsZV9pZCA9IHVwZGF0ZS5tZXNzYWdlLnZpZGVvLmZpbGVfaWQKICAgICAgICBmaWxlX3NpemUgPSB1cGRhdGUubWVzc2FnZS52aWRlby5maWxlX3NpemUKICAgIGVsaWYgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQgYW5kIHVwZGF0ZS5tZXNzYWdlLmRvY3VtZW50Lm1pbWVfdHlwZSBhbmQgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQubWltZV90eXBlLnN0YXJ0c3dpdGgoInZpZGVvLyIpOgogICAgICAgIGZpbGVfaWQgPSB1cGRhdGUubWVzc2FnZS5kb2N1bWVudC5maWxlX2lkCiAgICAgICAgZmlsZV9zaXplID0gdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQuZmlsZV9zaXplCiAgICBlbHNlOgogICAgICAgIHJldHVybgogICAgCiAgICBmaWxlX3NpemVfbWIgPSBmaWxlX3NpemUgLyAoMTAyNCAqIDEwMjQpCiAgICBwcmludChmIvCfk7kg2YHZitiv2YrZiCDZhdmGIHt1c2VyX2lkfSAtIHtmaWxlX3NpemVfbWI6LjJmfSBNQiIpCiAgICAKICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2K3YrNmFINin2YTZhdmE2YEKICAgIGlmIGZpbGVfc2l6ZSA+IERJUkVDVF9ET1dOTE9BRF9MSU1JVDoKICAgICAgICBoZWxwX3RleHQgPSBmIiIiCuKdjCAqKtin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2Ysg2YTZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LEhKioKCvCfk4og2K3YrNmFINin2YTZgdmK2K/ZitmIOiAqKntmaWxlX3NpemVfbWI6LjJmfSBNQioqCvCfk48g2KfZhNit2K8g2KfZhNij2YLYtdmJINmE2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixOiAqKjIwIE1CKioKCuKchSAqKtin2YTYrdmEINin2YTYs9mH2YQ6KioKMe+4j+KDoyDYp9ix2YHYuSDYp9mE2YHZitiv2YrZiCDYudmE2YkgR29vZ2xlIERyaXZlINij2YggRHJvcGJveAoy77iP4oOjINin2K3YtdmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsQoz77iP4oOjINij2LHYs9mEINin2YTYsdin2KjYtyDZh9mG2KcKCvCfk5ogKirZhdir2KfZhCDZhNmE2LHYp9io2Lcg2KfZhNmF2KjYp9i02LE6KioKYGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9RklMRV9JRGAK2KPZiApgaHR0cHM6Ly93d3cuZHJvcGJveC5jb20vcy94eHh4eC92aWRlby5tcDQ/ZGw9MWAKCvCfkqEgKirZhti12YrYrdipOioqINmK2YXZg9mG2YMg2KfYs9iq2K7Yr9in2YUg2YXZiNin2YLYuSDZhdir2YQ6CuKAoiBHb29nbGUgRHJpdmU6INix2YHYuSDZhdis2KfZhtmKINit2KrZiSAxNUdCCuKAoiBEcm9wYm94OiDYsdmB2Lkg2YXYrNin2YbZiiDYrdiq2YkgMkdCCuKAoiBNZWRpYUZpcmU6INix2YHYuSDZhdis2KfZhtmKCgrwn46vINio2LnYryDYp9mE2LHZgdi52Iwg2KPYsdiz2YQg2KfZhNix2KfYqNi3INin2YTZhdio2KfYtNixINmI2LPYo9i22LrYt9mHINmE2YMhCiIiIgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoaGVscF90ZXh0KQogICAgICAgIHJldHVybgogICAgCiAgICBjb250ZXh0LnVzZXJfZGF0YVsncGVuZGluZ192aWRlbyddID0gewogICAgICAgICdmaWxlX2lkJzogZmlsZV9pZCwKICAgICAgICAnZmlsZV9zaXplJzogZmlsZV9zaXplLAogICAgICAgICdjaGF0X2lkJzogY2hhdF9pZAogICAgfQogICAgCiAgICBrZXlib2FyZCA9IFsKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflKUg2LnYp9mE2YrYqSAo2KzZiNiv2Kkg2YXZhdiq2KfYstipKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfaGlnaCIpXSwKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIuKalu+4jyDZhdiq2YjYs9i32KkgKNiq2YjYp9iy2YYpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9tZWRpdW0iKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5K+INmF2YbYrtmB2LbYqSAo2KPYtdi62LEg2K3YrNmFKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfbG93IildCiAgICBdCiAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgIAogICAgcXVhbGl0eV90ZXh0ID0gZiIiIgrwn46sICoq2KfYrtiq2LEg2KzZiNiv2Kkg2KfZhNi22LrYtzoqKgoK8J+TuSDYrdis2YUg2KfZhNmB2YrYr9mK2Yg6IHtmaWxlX3NpemVfbWI6LjJmfSBNQgoK4pyoICoq2YXZhNin2K3YuNipINmH2KfZhdipKio6INiz2YrYqtmFINin2YTYrdmB2KfYuCDYudmE2Ykg2KPYqNi52KfYryDYp9mE2YHZitiv2YrZiCDYp9mE2KPYtdmE2YrYqSAo2KfZhNi32YjZhCDDlyDYp9mE2LnYsdi2KQrYp9mE2LbYuti3INiz2YrZg9mI2YYg2YHZgti3INio2KrZgtmE2YrZhCDYp9mE2KzZiNiv2Kkg8J+OrwoK2KfYrtiq2LEg2KfZhNis2YjYr9ipINin2YTZhdmG2KfYs9io2Kkg8J+RhwoiIiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChxdWFsaXR5X3RleHQsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgphc3luYyBkZWYgaGFuZGxlX3VybCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLZhdi52KfZhNisINin2YTYsdmI2KfYqNi3IiIiCiAgICAjINin2YTYqtit2YLZgiDZhdmGINmI2KzZiNivINin2YTZhdiz2KrYrtiv2YUg2YjYp9mE2LHYs9in2YTYqQogICAgaWYgbm90IHVwZGF0ZS5tZXNzYWdlIG9yIG5vdCB1cGRhdGUuZWZmZWN0aXZlX3VzZXI6CiAgICAgICAgcmV0dXJuCiAgICAKICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgIGNoYXRfaWQgPSBzdHIodXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQogICAgdXJsID0gdXBkYXRlLm1lc3NhZ2UudGV4dC5zdHJpcCgpCiAgICAKICAgIGlmIG5vdCB1cmwuc3RhcnRzd2l0aCgoJ2h0dHA6Ly8nLCAnaHR0cHM6Ly8nKSk6CiAgICAgICAgcmV0dXJuCiAgICAKICAgICMg2YLYp9im2YXYqSDZhdmI2LPYudipINmE2YXZiNin2YLYuSDYp9mE2YHZitiv2YrZiCDZiNin2YTYqtiu2LLZitmGINin2YTYs9it2KfYqNmKCiAgICB2aWRlb19zaXRlcyA9IFsKICAgICAgICAnLm1wNCcsICcuYXZpJywgJy5tb3YnLCAnLm1rdicsICcuZmx2JywgJy53bXYnLCAnLndlYm0nLAogICAgICAgICdkcml2ZS5nb29nbGUuY29tJywgJ2Ryb3Bib3guY29tJywgJ21lZ2EubnonLCAnbWVkaWFmaXJlLmNvbScsCiAgICAgICAgJ29uZWRyaXZlLmxpdmUuY29tJywgJ2JveC5jb20nLCAnd2V0cmFuc2Zlci5jb20nLAogICAgICAgICdzdHJlYW1hYmxlLmNvbScsICd2aW1lby5jb20nLCAneW91dHViZS5jb20nLCAneW91dHUuYmUnCiAgICBdCiAgICBpc19saWtlbHlfdmlkZW8gPSBhbnkoc2l0ZSBpbiB1cmwubG93ZXIoKSBmb3Igc2l0ZSBpbiB2aWRlb19zaXRlcykKICAgIAogICAgaWYgbm90IGlzX2xpa2VseV92aWRlbzoKICAgICAgICByZXR1cm4KICAgIAogICAgcHJpbnQoZiLwn5SXINix2KfYqNi3INmF2YYge3VzZXJfaWR9OiB7dXJsfSIpCiAgICAKICAgICMg2KrYrdmI2YrZhCDYsdmI2KfYqNi3IEdvb2dsZSBEcml2ZSDZiCBEcm9wYm94INmE2YTYtdmK2LrYqSDYp9mE2YXYqNin2LTYsdipCiAgICBkaXJlY3RfdXJsID0gdXJsCiAgICAKICAgICMgR29vZ2xlIERyaXZlCiAgICBpZiAnZHJpdmUuZ29vZ2xlLmNvbScgaW4gdXJsOgogICAgICAgIGlmICcvZmlsZS9kLycgaW4gdXJsOgogICAgICAgICAgICBmaWxlX2lkID0gdXJsLnNwbGl0KCcvZmlsZS9kLycpWzFdLnNwbGl0KCcvJylbMF0KICAgICAgICAgICAgZGlyZWN0X3VybCA9IGYiaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD17ZmlsZV9pZH0iCiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZiLinIUg2KrZhSDYqtit2YjZitmEINix2KfYqNi3IEdvb2dsZSBEcml2ZSDZhNmE2LXZiti62Kkg2KfZhNmF2KjYp9i02LHYqSEiKQogICAgICAgIGVsaWYgJ2lkPScgaW4gdXJsOgogICAgICAgICAgICAjINin2YTYsdin2KjYtyDZhdio2KfYtNixINio2KfZhNmB2LnZhAogICAgICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFINix2KfYqNi3IEdvb2dsZSBEcml2ZSDYrNin2YfYsiEiKQogICAgCiAgICAjIERyb3Bib3gKICAgIGVsaWYgJ2Ryb3Bib3guY29tJyBpbiB1cmw6CiAgICAgICAgaWYgJz9kbD0wJyBpbiB1cmw6CiAgICAgICAgICAgIGRpcmVjdF91cmwgPSB1cmwucmVwbGFjZSgnP2RsPTAnLCAnP2RsPTEnKQogICAgICAgIGVsaWYgJ2RsPScgbm90IGluIHVybDoKICAgICAgICAgICAgZGlyZWN0X3VybCA9IHVybCArICgnJicgaWYgJz8nIGluIHVybCBlbHNlICc/JykgKyAnZGw9MScKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFINiq2YUg2KrYrdmI2YrZhCDYsdin2KjYtyBEcm9wYm94INmE2YTYtdmK2LrYqSDYp9mE2YXYqNin2LTYsdipISIpCiAgICAKICAgIGNvbnRleHQudXNlcl9kYXRhWydwZW5kaW5nX3ZpZGVvJ10gPSB7CiAgICAgICAgJ3VybCc6IGRpcmVjdF91cmwsCiAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICdvcmlnaW5hbF91cmwnOiB1cmwKICAgIH0KICAgIAogICAga2V5Ym9hcmQgPSBbCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SlINi52KfZhNmK2KkgKNis2YjYr9ipINmF2YXYqtin2LLYqSkiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X3VybF9oaWdoIildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqW77iPINmF2KrZiNiz2LfYqSAo2KrZiNin2LLZhikiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X3VybF9tZWRpdW0iKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5K+INmF2YbYrtmB2LbYqSAo2KPYtdi62LEg2K3YrNmFKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfdXJsX2xvdyIpXQogICAgXQogICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAKICAgIGhlbHBfbWVzc2FnZSA9ICIiIgrwn46sICoq2KfYrtiq2LEg2KzZiNiv2Kkg2KfZhNi22LrYtzoqKgoK4pyoINiz2YrYqtmFINin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2Kkg2YTZhNmB2YrYr9mK2YgKCvCfkqEgKirZhti12YrYrdipOioqINil2LDYpyDZg9in2YYg2KfZhNmB2YrYr9mK2Ygg2YXZhiBHb29nbGUgRHJpdmUg2KPZiCBEcm9wYm94OgrigKIg2KrYo9mD2K8g2KPZhiDYp9mE2LHYp9io2LcgKirZhdio2KfYtNixKiog2YTZhNiq2K3ZhdmK2YQK4oCiIEdvb2dsZSBEcml2ZTog2KfYs9iq2K7Yr9mFINix2KfYqNi3INio2LXZiti62KkgYC91Yz9leHBvcnQ9ZG93bmxvYWQmaWQ9YArigKIgRHJvcGJveDog2KfYs9iq2K7Yr9mFIGA/ZGw9MWAg2YHZiiDZhtmH2KfZitipINin2YTYsdin2KjYtwoiIiIKICAgIAogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChoZWxwX21lc3NhZ2UsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCgojID09PT09PT09PT09PT09PT09PT09INin2YTYqNix2YbYp9mF2Kwg2KfZhNix2KbZitiz2YogPT09PT09PT09PT09PT09PT09PT0KZGVmIG1haW4oKToKICAgICIiItin2YTYqNix2YbYp9mF2Kwg2KfZhNix2KbZitiz2YoiIiIKICAgIHByaW50KCLwn5qAINiq2YfZitim2Kkg2KfZhNio2YjYqi4uLiIpCiAgICAKICAgICMg2KXZhti02KfYoSDYp9mE2YXYrNmE2K/Yp9iqINmI2KfZhNmC2YjYp9i52K8KICAgIGluaXRfdGVtcF9zdG9yYWdlKCkKICAgIGluaXRfZGF0YWJhc2UoKQogICAgCiAgICAjINiq2YbYuNmK2YEg2KfZhNmF2YTZgdin2Kog2KfZhNmC2K/ZitmF2KkKICAgIGNsZWFudXBfb2xkX2ZpbGVzKCkKICAgIAogICAgcHJpbnQoIuKchSDYp9mE2YbYuNin2YUg2KzYp9mH2LIiKQogICAgCiAgICAjINil2YbYtNin2KEg2KfZhNiq2LfYqNmK2YIKICAgIGFwcGxpY2F0aW9uID0gQXBwbGljYXRpb24uYnVpbGRlcigpLnRva2VuKFRFTEVHUkFNX0JPVF9UT0tFTikuYnVpbGQoKQogICAgCiAgICAjINil2LbYp9mB2Kkg2YXYudin2YTYrCDYp9mE2KPYrti32KfYoQogICAgYXBwbGljYXRpb24uYWRkX2Vycm9yX2hhbmRsZXIoZXJyb3JfaGFuZGxlcikKICAgIAogICAgIyDYp9mE2YXYudin2YTYrNin2KoKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGFydCIsIHN0YXJ0X2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImFjY291bnQiLCBteV9hY2NvdW50X2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInNldGFwaWtleSIsIHNldGFwaWtleV9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzdGF0cyIsIHN0YXRzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImZpbGVzIiwgZmlsZXNfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiY2xlYW51cCIsIGNsZWFudXBfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiZXJyb3JzIiwgZXJyb3JzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImNsZWFyZXJyb3JzIiwgY2xlYXJfZXJyb3JzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoYnV0dG9uX2hhbmRsZXIpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoTWVzc2FnZUhhbmRsZXIoZmlsdGVycy5WSURFTyB8IGZpbHRlcnMuRG9jdW1lbnQuVklERU8sIGhhbmRsZV92aWRlbykpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlRFWFQgJiB+ZmlsdGVycy5DT01NQU5ELCBoYW5kbGVfdXJsKSkKICAgIAogICAgIyDYqNiv2KEg2YXYudin2YTYrCDYp9mE2LfYp9io2YjYsQogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgIGxhbWJkYSBjb250ZXh0OiBhc3luY2lvLmNyZWF0ZV90YXNrKHByb2Nlc3NfdmlkZW9fcXVldWUoY29udGV4dCkpLAogICAgICAgIHdoZW49MAogICAgKQogICAgCiAgICBwcmludCgi4pyFINin2YTYqNmI2Kog2YrYudmF2YQg2KfZhNii2YYuLi4iKQogICAgcHJpbnQoZiLwn5GRINmF2LnYsdmBINin2YTZhdi02LHZgToge0FETUlOX0lEfSIpCiAgICBwcmludChmIvCfk6Yg2KfZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LE6IHtESVJFQ1RfRE9XTkxPQURfTElNSVQvKDEwMjQqMTAyNCk6LjBmfSBNQiIpCiAgICBwcmludChmIvCfk6Yg2KfZhNix2YjYp9io2Lcg2KfZhNiu2KfYsdis2YrYqToge01BWF9GSUxFX1NJWkUvKDEwMjQqMTAyNCk6LjBmfSBNQiIpCiAgICBwcmludCgi8J+OryDYp9mE2YXZitiy2Kkg2KfZhNis2K/Zitiv2Kk6INin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkhIikKICAgIHByaW50KCLwn5OLINiq2LPYrNmK2YQg2KfZhNij2K7Yt9in2KE6INmF2YHYudmR2YQgKGJvdF9lcnJvcnMubG9nKSIpCiAgICBwcmludCgi8J+aqCDYp9mE2KPYrti32KfYoSDYs9iq2LHYs9mEINiq2YTZgtin2KbZitin2Ysg2YTZhNmF2LTYsdmBISIpCiAgICAKICAgIGxvZ2dlci5pbmZvKCLinIUg2KfZhNio2YjYqiDYqNiv2KMg2KfZhNi52YXZhCDYqNmG2KzYp9itIikKICAgIGxvZ2dlci5pbmZvKGYi8J+RkSDZhdi52LHZgSDYp9mE2YXYtNix2YE6IHtBRE1JTl9JRH0iKQogICAgCiAgICAjINiq2LTYutmK2YQg2KfZhNio2YjYqgogICAgIyDYqtmFINiq2LnYr9mK2YTZhyDZhNmE2LnZhdmEINmB2YogdGhyZWFkCgogICAgaW1wb3J0IGFzeW5jaW8KCiAgICBsb29wID0gYXN5bmNpby5uZXdfZXZlbnRfbG9vcCgpCgogICAgYXN5bmNpby5zZXRfZXZlbnRfbG9vcChsb29wKQoKICAgIGFzeW5jIGRlZiBydW4oKToKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24uaW5pdGlhbGl6ZSgpCgogICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnN0YXJ0KCkKCiAgICAgICAgYXdhaXQgYXBwbGljYXRpb24udXBkYXRlci5zdGFydF9wb2xsaW5nKCkKCiAgICAgICAgdHJ5OgoKICAgICAgICAgICAgd2hpbGUgVHJ1ZToKCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgogICAgICAgIGV4Y2VwdDoKCiAgICAgICAgICAgIHBhc3MKCiAgICAgICAgZmluYWxseToKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnVwZGF0ZXIuc3RvcCgpCgogICAgICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi5zdG9wKCkKCiAgICAgICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnNodXRkb3duKCkKCiAgICBsb29wLnJ1bl91bnRpbF9jb21wbGV0ZShydW4oKSkKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICBtYWluKCkK",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
