#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ŸÖŸÑŸÅ ŸÖÿØŸÖÿ¨ - 1 ÿ®Ÿàÿ™
ÿ™ŸÖ ÿßŸÑÿØŸÖÿ¨ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÖŸÜ ÿ¨ŸÖŸäÿπ ŸÖŸÑŸÅÿßÿ™ .py
ŸÖÿπ Flask - ŸÑŸÑÿßÿ≥ÿ™ÿ∂ÿßŸÅÿßÿ™ ÿßŸÑÿ™Ÿä ÿ™ÿ≥ŸÖÿ≠ ÿ®ŸÄ Webserver
"""
import os, sys, threading, time, base64
import types
from flask import Flask, jsonify
from datetime import datetime

# Flask Application
app = Flask(__name__)

# ŸÖÿ™ÿ∫Ÿäÿ± ŸÑÿ≠ŸÅÿ∏ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
bots_status = {}
start_time = None

@app.route("/")
def home():
    """ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© - ÿ™ÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™"""
    uptime = ""
    if start_time:
        delta = datetime.now() - start_time
        hours = delta.seconds // 3600
        minutes = (delta.seconds % 3600) // 60
        uptime = f"{delta.days}d {hours}h {minutes}m"
    
    html = f"""
    <!DOCTYPE html>
    <html dir="rtl" lang="ar">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ü§ñ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ - 1 ÿ®Ÿàÿ™</title>
        <style>
            * {{ margin: 0; padding: 0; box-sizing: border-box; }}
            body {{
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }}
            .container {{
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
                padding: 40px;
                max-width: 800px;
                width: 100%;
            }}
            h1 {{
                color: #667eea;
                text-align: center;
                margin-bottom: 10px;
                font-size: 2.5em;
            }}
            .uptime {{
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 1.1em;
            }}
            .status {{
                background: #f0f9ff;
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 20px;
                border-right: 5px solid #10b981;
            }}
            .status h2 {{
                color: #10b981;
                margin-bottom: 15px;
                font-size: 1.5em;
            }}
            .bot-item {{
                background: white;
                padding: 15px;
                margin: 10px 0;
                border-radius: 10px;
                display: flex;
                align-items: center;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }}
            .bot-icon {{
                font-size: 2em;
                margin-left: 15px;
            }}
            .bot-info {{
                flex: 1;
            }}
            .bot-name {{
                font-weight: bold;
                color: #333;
                font-size: 1.1em;
            }}
            .bot-status {{
                color: #10b981;
                font-size: 0.9em;
                margin-top: 5px;
            }}
            .footer {{
                text-align: center;
                margin-top: 30px;
                color: #666;
                font-size: 0.9em;
            }}
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ü§ñ ŸÜÿ∏ÿßŸÖ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™</h1>
            <div class="uptime">‚è±Ô∏è ŸàŸÇÿ™ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ: {uptime}</div>
            
            <div class="status">
                <h2>‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ (1 ÿ®Ÿàÿ™)</h2>
                <div class="bot-item">
                    <div class="bot-icon">ü§ñ</div>
                    <div class="bot-info">
                        <div class="bot-name">2.py</div>
                        <div class="bot-status">‚úì ŸäÿπŸÖŸÑ ÿ®ÿ¥ŸÉŸÑ ÿ∑ÿ®ŸäÿπŸä</div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                Made with ‚ù§Ô∏è | Powered by Flask + Telegram Bot
            </div>
        </div>
    </body>
    </html>
    """
    return html

@app.route("/status")
def status():
    """API endpoint - Ÿäÿπÿ±ÿ∂ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ®ÿµŸäÿ∫ÿ© JSON"""
    return jsonify({
        "total_bots": 1,
        "status": "running",
        "bots": bots_status,
        "uptime": str(datetime.now() - start_time) if start_time else "0"
    })

@app.route("/health")
def health():
    """Health check endpoint"""
    return jsonify({"status": "healthy"}), 200

def run_flask():
    """ÿ™ÿ¥ÿ∫ŸäŸÑ Flask server"""
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port, debug=False, use_reloader=False)

# ÿ£ŸÉŸàÿßÿØ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_CODE = {
    1: "aW1wb3J0IHJlcXVlc3RzCmltcG9ydCB0aW1lCmltcG9ydCBzcWxpdGUzCmltcG9ydCBhc3luY2lvCmltcG9ydCBvcwppbXBvcnQgdGVtcGZpbGUKaW1wb3J0IHNodXRpbApmcm9tIHBhdGhsaWIgaW1wb3J0IFBhdGgKZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdGVsZWdyYW0gaW1wb3J0IFVwZGF0ZSwgSW5saW5lS2V5Ym9hcmRCdXR0b24sIElubGluZUtleWJvYXJkTWFya3VwCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCAoCiAgICBBcHBsaWNhdGlvbiwKICAgIENvbW1hbmRIYW5kbGVyLAogICAgQ2FsbGJhY2tRdWVyeUhhbmRsZXIsCiAgICBNZXNzYWdlSGFuZGxlciwKICAgIGZpbHRlcnMsCiAgICBDb250ZXh0VHlwZXMsCikKCiMgPT09PT09PT09PT09PT09PT09PT0g2KfZhNil2LnYr9in2K/Yp9iqINin2YTYq9in2KjYqtipID09PT09PT09PT09PT09PT09PT09ClRFTEVHUkFNX0JPVF9UT0tFTiA9ICI4NTA0NjQ4NTUwOkFBR0g0VG80dlJ0NzNGMGVPSEhCUjNCc0Q5SVNhLTB6QXRJIgpBRE1JTl9JRCA9IDEwNTg2MTYzMTYKVEVMRUdSQU1fQVBJX0xJTUlUID0gMjAgKiAxMDI0ICogMTAyNCAgIyAyME1CCk1BWF9GSUxFX1NJWkUgPSAyMDAwICogMTAyNCAqIDEwMjQgICMgMkdCINin2YTYrdivINin2YTYo9mC2LXZiSDZhNmE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqQpESVJFQ1RfRE9XTkxPQURfTElNSVQgPSAyMCAqIDEwMjQgKiAxMDI0ICAjIDIwTUIg2K3YryDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsQoKIyDZhdis2YTYryDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2KoKVEVNUF9TVE9SQUdFX0RJUiA9ICJ0ZW1wX3ZpZGVvcyIKCiMg2LfYp9io2YjYsSDYp9mE2YXYudin2YTYrNipCnByb2Nlc3NpbmdfcXVldWUgPSBhc3luY2lvLlF1ZXVlKCkKaXNfcHJvY2Vzc2luZyA9IEZhbHNlCgojID09PT09PT09PT09PT09PT09PT09INil2K/Yp9ix2Kkg2KfZhNmF2YTZgdin2KogPT09PT09PT09PT09PT09PT09PT0KZGVmIGluaXRfdGVtcF9zdG9yYWdlKCk6CiAgICAiIiLYpdmG2LTYp9ihINmF2KzZhNivINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqiIiIgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKFRFTVBfU1RPUkFHRV9ESVIpOgogICAgICAgIG9zLm1ha2VkaXJzKFRFTVBfU1RPUkFHRV9ESVIpCiAgICBwcmludChmIuKchSDZhdis2YTYryDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYpNmC2Ko6IHtURU1QX1NUT1JBR0VfRElSfSIpCgpkZWYgY2xlYW51cF9vbGRfZmlsZXMoKToKICAgICIiItit2LDZgSDYrNmF2YrYuSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqSDYudmG2K8g2KjYr9ihINin2YTYqti02LrZitmEIiIiCiAgICB0cnk6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgZmlsZSkKICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShmaWxlX3BhdGgpOgogICAgICAgICAgICAgICAgICAgICAgICBvcy51bmxpbmsoZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIvCfl5HvuI8g2K3YsNmBINmF2YTZgSDZgtiv2YrZhToge2ZpbGV9IikKICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2K3YsNmBIHtmaWxlfToge2V9IikKICAgICAgICBwcmludCgi4pyFINiq2YUg2KrZhti42YrZgSDYp9mE2YXYrNmE2K8g2YXZhiDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqSIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNiq2YbYuNmK2YE6IHtlfSIpCgpkZWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX3BhdGg6IHN0cik6CiAgICAiIiLYrdiw2YEg2YXZhNmBINio2LTZg9mEINii2YXZhiIiIgogICAgdHJ5OgogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGZpbGVfcGF0aCk6CiAgICAgICAgICAgIG9zLnVubGluayhmaWxlX3BhdGgpCiAgICAgICAgICAgIHByaW50KGYi8J+Xke+4jyDYqtmFINit2LDZgSDYp9mE2YXZhNmBOiB7ZmlsZV9wYXRofSIpCiAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgcHJpbnQoZiLimqDvuI8g2YHYtNmEINit2LDZgSDYp9mE2YXZhNmBIHtmaWxlX3BhdGh9OiB7ZX0iKQogICAgcmV0dXJuIEZhbHNlCgpkZWYgZ2V0X3N0b3JhZ2VfaW5mbygpOgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdi52YTZiNmF2KfYqiDYp9mE2YXYs9in2K3YqSDYp9mE2KrYrtiy2YrZhtmK2KkiIiIKICAgIHRyeToKICAgICAgICB0b3RhbF9zaXplID0gMAogICAgICAgIGZpbGVfY291bnQgPSAwCiAgICAgICAgZmlsZXNfbGlzdCA9IFtdCiAgICAgICAgCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIoVEVNUF9TVE9SQUdFX0RJUik6CiAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgZmlsZSkKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguaXNmaWxlKGZpbGVfcGF0aCk6CiAgICAgICAgICAgICAgICAgICAgc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZShmaWxlX3BhdGgpCiAgICAgICAgICAgICAgICAgICAgdG90YWxfc2l6ZSArPSBzaXplCiAgICAgICAgICAgICAgICAgICAgZmlsZV9jb3VudCArPSAxCiAgICAgICAgICAgICAgICAgICAgZmlsZXNfbGlzdC5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAnbmFtZSc6IGZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgICdzaXplJzogc2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgJ3BhdGgnOiBmaWxlX3BhdGgKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgIAogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICd0b3RhbF9zaXplJzogdG90YWxfc2l6ZSwKICAgICAgICAgICAgJ2ZpbGVfY291bnQnOiBmaWxlX2NvdW50LAogICAgICAgICAgICAnZmlsZXMnOiBmaWxlc19saXN0CiAgICAgICAgfQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTYrdi12YjZhCDYudmE2Ykg2YXYudmE2YjZhdin2Kog2KfZhNiq2K7YstmK2YY6IHtlfSIpCiAgICAgICAgcmV0dXJuIHsndG90YWxfc2l6ZSc6IDAsICdmaWxlX2NvdW50JzogMCwgJ2ZpbGVzJzogW119CgpkZWYgZm9ybWF0X3NpemUoc2l6ZV9ieXRlcyk6CiAgICAiIiLYqtit2YjZitmEINin2YTYrdis2YUg2KXZhNmJINi12YrYutipINmC2KfYqNmE2Kkg2YTZhNmC2LHYp9ih2KkiIiIKICAgIGZvciB1bml0IGluIFsnQicsICdLQicsICdNQicsICdHQiddOgogICAgICAgIGlmIHNpemVfYnl0ZXMgPCAxMDI0LjA6CiAgICAgICAgICAgIHJldHVybiBmIntzaXplX2J5dGVzOi4yZn0ge3VuaXR9IgogICAgICAgIHNpemVfYnl0ZXMgLz0gMTAyNC4wCiAgICByZXR1cm4gZiJ7c2l6ZV9ieXRlczouMmZ9IFRCIgoKIyA9PT09PT09PT09PT09PT09PT09PSDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KogPT09PT09PT09PT09PT09PT09PT0KZGVmIGluaXRfZGF0YWJhc2UoKToKICAgICIiItil2YbYtNin2KEg2YLYp9i52K/YqSDYp9mE2KjZitin2YbYp9iqINmI2KzYr9in2YjZhCDYp9mE2YXYs9iq2K7Yr9mF2YrZhiDZiNin2YTYpdi52K/Yp9iv2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICAKICAgIGMuZXhlY3V0ZSgnJydDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB1c2VycyAoCiAgICAgICAgdXNlcl9pZCBJTlRFR0VSIFBSSU1BUlkgS0VZLAogICAgICAgIHVzZXJuYW1lIFRFWFQsCiAgICAgICAgdG90YWxfdmlkZW9zIElOVEVHRVIgREVGQVVMVCAwLAogICAgICAgIGpvaW5lZF9kYXRlIFRJTUVTVEFNUCBERUZBVUxUIENVUlJFTlRfVElNRVNUQU1QCiAgICApJycnKQogICAgCiAgICBjLmV4ZWN1dGUoJycnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgc2V0dGluZ3MgKAogICAgICAgIGtleSBURVhUIFBSSU1BUlkgS0VZLAogICAgICAgIHZhbHVlIFRFWFQKICAgICknJycpCiAgICAKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIHZhbHVlIEZST00gc2V0dGluZ3MgV0hFUkUga2V5ID0gJ2FwaV9rZXknIikKICAgIGlmIGMuZmV0Y2hvbmUoKSBpcyBOb25lOgogICAgICAgIGRlZmF1bHRfYXBpX2tleSA9ICJleUowZVhBaU9pSktWMVFpTENKaGJHY2lPaUpTVXpJMU5pSjkuZXlKaGRXUWlPaUl4SWl3aWFuUnBJam9pWmpFME4yTm1ORFUwWmpBelpUTXpOREF3TlRGbFpHUTRNekZtWTJKaFpETXlPVE0wTjJGaU1XTTBNMlJrTVRSbU1HTm1aamxrWkRBek56UXhOekUyTnpkbU1tWTVNMkV5Tm1GbVl6STJZVGdpTENKcFlYUWlPakUzTmpReE5UVXhNelF1TWpreU5qUTBMQ0p1WW1ZaU9qRTNOalF4TlRVeE16UXVNamt5TmpRMUxDSmxlSEFpT2pRNU1UazRNamczTXpRdU1qZzFNVEEzTENKemRXSWlPaUkzTXpVM05UVXlNU0lzSW5OamIzQmxjeUk2V3lKMFlYTnJMbmR5YVhSbElpd2lkR0Z6YXk1eVpXRmtaQ0o5Lmdnb2xFQnRsZEpJWnE3NFIxSDNTSTYxQUhUUGM0aUpSdnVnQkFXWTltQW9RT1czcmJhVXJRSGY4Q1REdVJZTmY2cG0weHBtQWdjRm42U3JUYncxNi16RUVSWWMxMXF2T0hHWTVxWFFva19haUZ5ajJHb2tHVHpiZjNuaGRoc3daUG10QWo2OVdsaldjZ2d0NlgtOWl3VHlDaERYS3FDN1U2RWplQTJhVzZYcHRYNVJ0dUs5eFhGX05BU0pldGM3cWlXWDFyOEt6ZGl3aGJGSm9rNGJJM2k5ZDhWVi1kSXREV1haSjNldUZmUGMtbHpPaHF3RGYyWkVBMXdQZzIwQmk2Z2QwSUUyUGdWUXBLeW5aeUZrdHU4V05QTlZ6aG5PSDB5RTFZYTZvZWh2SmFnWDR0bW43Z3gxbWZqck9KanRxQUQyRWcyRi04RGw3Z2Q4NmZoZXhPS2UwQmV3ZkxOVTFGVTZybmlVSDNqVGRMSmZBakw4TzZRc3V1TGVKWEc5RTJzNW1GcEdzcXhxQjdMTUNfR1hOMjdEbTQ0a2ptSG9CNDhtNnpXWVFzWjc1MURIU0o4cmpWUi1CemNTOUFqUWVnWVcwOG5JblJoWTJVZklOcnFOYmZ1N1U2OXNkbDRMMDladVZJRUFHbGpFMmt0Y1FDcXlIQ3F4aTRrSGlwTGE2cS1XUkZ2XzViRElwV2tGNkJIVWplRVFZVk4wX0YtYnplMWM4cWlYNm03blFOSGJtR2hJYUNVaW03TkhFSTlzejVidkpOTEtjOThWY3RSYW55ZUp2eS1ZTDlaY1AtLTE2U3cta2oxeWRUNzQzbUI0TnQwQUtTZjdBOUt3TXBLV2NpUFdrdnE2Q2VzajZlTVR0UzNIU04wV3Z3aGhPUTIwemNEQ3hXam5tMTZrIgogICAgICAgIGMuZXhlY3V0ZSgiSU5TRVJUIE9SIFJFUExBQ0UgSU5UTyBzZXR0aW5ncyAoa2V5LCB2YWx1ZSkgVkFMVUVTICgnYXBpX2tleScsID8pIiwgKGRlZmF1bHRfYXBpX2tleSwpKQogICAgCiAgICBjb25uLmNvbW1pdCgpCiAgICBjb25uLmNsb3NlKCkKCmRlZiBnZXRfYXBpX2tleSgpOgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDZhdmB2KrYp9itIEFQSSDZhdmGINmC2KfYudiv2Kkg2KfZhNio2YrYp9mG2KfYqiIiIgogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICBjLmV4ZWN1dGUoIlNFTEVDVCB2YWx1ZSBGUk9NIHNldHRpbmdzIFdIRVJFIGtleSA9ICdhcGlfa2V5JyIpCiAgICByZXN1bHQgPSBjLmZldGNob25lKCkKICAgIGNvbm4uY2xvc2UoKQogICAgcmV0dXJuIHJlc3VsdFswXSBpZiByZXN1bHQgZWxzZSBOb25lCgpkZWYgc2V0X2FwaV9rZXkobmV3X2tleSk6CiAgICAiIiLYrdmB2Lgg2YXZgdiq2KfYrSBBUEkg2KzYr9mK2K8g2YHZiiDZgtin2LnYr9ipINin2YTYqNmK2KfZhtin2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCJJTlNFUlQgT1IgUkVQTEFDRSBJTlRPIHNldHRpbmdzIChrZXksIHZhbHVlKSBWQUxVRVMgKCdhcGlfa2V5JywgPykiLCAobmV3X2tleSwpKQogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgpkZWYgZ2V0X3VzZXIodXNlcl9pZCk6CiAgICAiIiLYp9mE2K3YtdmI2YQg2LnZhNmJINmF2LnZhNmI2YXYp9iqINin2YTZhdiz2KrYrtiv2YUiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdTRUxFQ1QgdXNlcl9pZCwgdXNlcm5hbWUsIHRvdGFsX3ZpZGVvcywgam9pbmVkX2RhdGUgRlJPTSB1c2VycyBXSEVSRSB1c2VyX2lkID0gPycsICh1c2VyX2lkLCkpCiAgICB1c2VyID0gYy5mZXRjaG9uZSgpCiAgICBjb25uLmNsb3NlKCkKICAgIHJldHVybiB1c2VyCgpkZWYgY3JlYXRlX3VzZXIodXNlcl9pZCwgdXNlcm5hbWUpOgogICAgIiIi2KXZhti02KfYoSDZhdiz2KrYrtiv2YUg2KzYr9mK2K8iIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdJTlNFUlQgT1IgSUdOT1JFIElOVE8gdXNlcnMgKHVzZXJfaWQsIHVzZXJuYW1lKSBWQUxVRVMgKD8sID8pJywgKHVzZXJfaWQsIHVzZXJuYW1lKSkKICAgIGNvbm4uY29tbWl0KCkKICAgIGNvbm4uY2xvc2UoKQoKZGVmIGluY3JlbWVudF92aWRlb19jb3VudCh1c2VyX2lkKToKICAgICIiItiy2YrYp9iv2Kkg2LnYr9in2K8g2KfZhNmB2YrYr9mK2YjZh9in2KoiIiIKICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICBjID0gY29ubi5jdXJzb3IoKQogICAgYy5leGVjdXRlKCdVUERBVEUgdXNlcnMgU0VUIHRvdGFsX3ZpZGVvcyA9IHRvdGFsX3ZpZGVvcyArIDEgV0hFUkUgdXNlcl9pZCA9ID8nLCAodXNlcl9pZCwpKQogICAgY29ubi5jb21taXQoKQogICAgY29ubi5jbG9zZSgpCgojID09PT09PT09PT09PT09PT09PT09INiv2YjYp9mEINiq2YTZitis2LHYp9mFID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBzZW5kX21lc3NhZ2UoY2hhdF9pZDogc3RyLCB0ZXh0OiBzdHIsIGNvbnRleHQ9Tm9uZSk6CiAgICAiIiLYpdix2LPYp9mEINix2LPYp9mE2Kkg2YbYtdmK2KkiIiIKICAgIHRyeToKICAgICAgICBpZiBjb250ZXh0OgogICAgICAgICAgICBhd2FpdCBjb250ZXh0LmJvdC5zZW5kX21lc3NhZ2UoY2hhdF9pZD1jaGF0X2lkLCB0ZXh0PXRleHQsIHBhcnNlX21vZGU9J01hcmtkb3duJykKICAgICAgICBlbHNlOgogICAgICAgICAgICB1cmwgPSBmImh0dHBzOi8vYXBpLnRlbGVncmFtLm9yZy9ib3R7VEVMRUdSQU1fQk9UX1RPS0VOfS9zZW5kTWVzc2FnZSIKICAgICAgICAgICAgcmVxdWVzdHMucG9zdCh1cmwsIGRhdGE9eyJjaGF0X2lkIjogY2hhdF9pZCwgInRleHQiOiB0ZXh0LCAicGFyc2VfbW9kZSI6ICdNYXJrZG93bid9KQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi2K7Yt9ijINmB2Yog2KXYsdiz2KfZhCDYp9mE2LHYs9in2YTYqToge2V9IikKCiMgPT09PT09PT09PT09PT09PT09PT0g2KPZiNin2YXYsSDYp9mE2KjZiNiqID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBzdGFydF9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvc3RhcnQiIiIKICAgIHVzZXIgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIKICAgIGNyZWF0ZV91c2VyKHVzZXIuaWQsIHVzZXIudXNlcm5hbWUpCiAgICAKICAgIGtleWJvYXJkX3Jvd3MgPSBbCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINit2LPYp9io2Yog2YjYpdit2LXYp9im2YrYp9iq2YoiLCBjYWxsYmFja19kYXRhPSJteV9hY2NvdW50IildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4oS577iPINin2YTZhdiz2KfYudiv2KkiLCBjYWxsYmFja19kYXRhPSJoZWxwIildCiAgICBdCiAgICAKICAgIGlmIHVzZXIuaWQgPT0gQURNSU5fSUQ6CiAgICAgICAga2V5Ym9hcmRfcm93cy5hcHBlbmQoW0lubGluZUtleWJvYXJkQnV0dG9uKCLimpnvuI8g2KXYudiv2KfYr9in2Kog2KfZhNmF2LTYsdmBIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV0pCgogICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmRfcm93cykKICAgIAogICAgd2VsY29tZV90ZXh0ID0gZiIiIgrwn46sINmF2LHYrdio2KfZiyB7dXNlci5maXJzdF9uYW1lfSEKCtij2YbYpyDYqNmI2Kog2LbYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqLiDYp9mE2KLZhiDYo9mG2KcgKirZhdis2KfZhtmKINio2KfZhNmD2KfZhdmEINmI2KjYr9mI2YYg2YLZitmI2K8qKiEg8J+agAoKKirwn46vINin2YTZhdmF2YrYstin2Ko6KioK4pyoINmF2LnYp9mE2KzYqSDZhdmE2YHYp9iqINit2KrZiSAqKjJHQioqINi52KjYsSDYp9mE2LHZiNin2KjYtwrinKgg2KrYrdmF2YrZhCDZhdio2KfYtNixINit2KrZiSAyME1CINmF2YYg2KrZitmE2YrYrNix2KfZhQrinKgg2K/YudmFINin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2KkgKEdvb2dsZSBEcml2ZSwgRHJvcGJveCwg2KXZhNiuKQrinKggMyDZhdiz2KrZiNmK2KfYqiDYtti62Lcg2YLZiNmK2Kkg2YXYuSAqKtin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkqKgrinKgg2K3YsNmBINiq2YTZgtin2KbZiiDZhNmE2YXZhNmB2KfYqiDYqNi52K8g2KfZhNil2LHYs9in2YQKCvCfk6QgKirZhNmE2YXZhNmB2KfYqiDYp9mE2YPYqNmK2LHYqSAoKzIwTUIpOioqCtin2LHZgdi5INin2YTZgdmK2K/ZitmIINmE2YAgR29vZ2xlIERyaXZlINij2YggRHJvcGJveCDZiNij2LHYs9mEINin2YTYsdin2KjYtyDYp9mE2YXYqNin2LTYsSEKCvCfk6QgKirZhNmE2YXZhNmB2KfYqiDYp9mE2LXYutmK2LHYqSAoLTIwTUIpOioqCtij2LHYs9mEINin2YTZgdmK2K/ZitmIINmF2KjYp9i02LHYqSDZhdmGINiq2YrZhNmK2KzYsdin2YUhCiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHdlbGNvbWVfdGV4dCwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCmFzeW5jIGRlZiBteV9hY2NvdW50X2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9hY2NvdW50IC0g2LnYsdi2INmF2LnZhNmI2YXYp9iqINin2YTYrdiz2KfYqCIiIgogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgdXNlcl9kYXRhID0gZ2V0X3VzZXIodXNlcl9pZCkKICAgIAogICAgaWYgdXNlcl9kYXRhOgogICAgICAgIHVzZXJfaWQsIHVzZXJuYW1lLCB0b3RhbF92aWRlb3MsIGpvaW5lZF9kYXRlID0gdXNlcl9kYXRhCiAgICAgICAgYWNjb3VudF90ZXh0ID0gZiIiIgrwn5OKICoq2YXYudmE2YjZhdin2Kog2K3Ys9in2KjZgzoqKgoK8J+RpCDYp9mE2YXYudix2YE6IHt1c2VyX2lkfQrwn46sINi52K/YryDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2YXYtti62YjYt9ipOiB7dG90YWxfdmlkZW9zfQrwn5OFINiq2KfYsdmK2K4g2KfZhNin2YbYttmF2KfZhToge2pvaW5lZF9kYXRlfQoiIiIKICAgIGVsc2U6CiAgICAgICAgYWNjb3VudF90ZXh0ID0gIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINit2LPYp9io2YMuINin2LPYqtiu2K/ZhSAvc3RhcnQg2KPZiNmE2KfZiy4iCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoYWNjb3VudF90ZXh0KQoKYXN5bmMgZGVmIHNldGFwaWtleV9jb21tYW5kKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItij2YXYsSAvc2V0YXBpa2V5IC0g2KrYudmK2YrZhiDZhdmB2KrYp9itIEFQSSAo2YTZhNmF2LTYsdmBINmB2YLYtykiIiIKICAgIGlmIHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZCAhPSBBRE1JTl9JRDoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLim5Qg2YfYsNinINin2YTYo9mF2LEg2YTZhNmF2LTYsdmBINmB2YLYtyEiKQogICAgICAgIHJldHVybgogICAgCiAgICBpZiBsZW4oY29udGV4dC5hcmdzKSA9PSAwOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKaoO+4jyDYp9mE2KfYs9iq2K7Yr9in2YU6IC9zZXRhcGlrZXkgPHlvdXJfYXBpX2tleT4iKQogICAgICAgIHJldHVybgogICAgCiAgICBuZXdfa2V5ID0gY29udGV4dC5hcmdzWzBdCiAgICBzZXRfYXBpX2tleShuZXdfa2V5KQogICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4pyFINiq2YUg2KrYrdiv2YrYqyDZhdmB2KrYp9itIEFQSSDYqNmG2KzYp9itISIpCgphc3luYyBkZWYgc3RhdHNfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL3N0YXRzIC0g2LnYsdi2INil2K3Ytdin2KbZitin2Kog2LnYp9mF2KkgKNmE2YTZhdi02LHZgSDZgdmC2LcpIiIiCiAgICBpZiB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQgIT0gQURNSU5fSUQ6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi4puUINmH2LDYpyDYp9mE2KPZhdixINmE2YTZhdi02LHZgSDZgdmC2LchIikKICAgICAgICByZXR1cm4KICAgIAogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgndmlkZW9fYm90LmRiJykKICAgIGMgPSBjb25uLmN1cnNvcigpCiAgICAKICAgIGMuZXhlY3V0ZSgiU0VMRUNUIENPVU5UKCopIEZST00gdXNlcnMiKQogICAgdG90YWxfdXNlcnMgPSBjLmZldGNob25lKClbMF0KICAgIAogICAgYy5leGVjdXRlKCJTRUxFQ1QgU1VNKHRvdGFsX3ZpZGVvcykgRlJPTSB1c2VycyIpCiAgICB0b3RhbF92aWRlb3MgPSBjLmZldGNob25lKClbMF0gb3IgMAogICAgCiAgICBjb25uLmNsb3NlKCkKICAgIAogICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAKICAgIHN0YXRzX3RleHQgPSBmIiIiCvCfk4ogKirYpdit2LXYp9im2YrYp9iqINin2YTYqNmI2Ko6KioKCvCfkaUg2LnYr9ivINin2YTZhdiz2KrYrtiv2YXZitmGOiB7dG90YWxfdXNlcnN9CvCfjqwg2KXYrNmF2KfZhNmKINin2YTZgdmK2K/ZitmI2YfYp9iqINin2YTZhdi22LrZiNi32Kk6IHt0b3RhbF92aWRlb3N9CvCfk6Yg2LnYr9ivINin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipOiB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J119CvCfkr4g2YXYs9in2K3YqSDYp9mE2KrYrtiy2YrZhiDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9CiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHN0YXRzX3RleHQpCgphc3luYyBkZWYgZmlsZXNfY29tbWFuZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAiIiLYo9mF2LEgL2ZpbGVzIC0g2LnYsdi2INin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgCiAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA9PSAwOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKchSDZhNinINiq2YjYrNivINmF2YTZgdin2Kog2YXYrtiy2YbYqSDYrdin2YTZitin2YsuIikKICAgICAgICByZXR1cm4KICAgIAogICAgZmlsZXNfdGV4dCA9IGYi8J+TpiAqKtin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICh7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J119KToqKlxuXG4iCiAgICAKICAgIGZvciBpLCBmaWxlX2luZm8gaW4gZW51bWVyYXRlKHN0b3JhZ2VfaW5mb1snZmlsZXMnXVs6MTBdLCAxKToKICAgICAgICBmaWxlc190ZXh0ICs9IGYie2l9LiBge2ZpbGVfaW5mb1snbmFtZSddfWBcbiAgINin2YTYrdis2YU6IHtmb3JtYXRfc2l6ZShmaWxlX2luZm9bJ3NpemUnXSl9XG5cbiIKICAgIAogICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiAxMDoKICAgICAgICBmaWxlc190ZXh0ICs9IGYiXG4uLi4g2Ygge3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddIC0gMTB9INmF2YTZgSDYotiu2LEiCiAgICAKICAgIGZpbGVzX3RleHQgKz0gZiJcbvCfkr4g2KfZhNil2KzZhdin2YTZijoge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0iCiAgICAKICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZmlsZXNfdGV4dCkKCmFzeW5jIGRlZiBjbGVhbnVwX2NvbW1hbmQodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgIiIi2KPZhdixIC9jbGVhbnVwIC0g2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqINin2YTZhdiu2LLZhtipICjZhNmE2YXYtNix2YEg2YHZgti3KSIiIgogICAgaWYgdXBkYXRlLmVmZmVjdGl2ZV91c2VyLmlkICE9IEFETUlOX0lEOgogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIuKblCDZh9iw2Kcg2KfZhNij2YXYsSDZhNmE2YXYtNix2YEg2YHZgti3ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHN0b3JhZ2VfaW5mbyA9IGdldF9zdG9yYWdlX2luZm8oKQogICAgZGVsZXRlZF9jb3VudCA9IDAKICAgIAogICAgZm9yIGZpbGVfaW5mbyBpbiBzdG9yYWdlX2luZm9bJ2ZpbGVzJ106CiAgICAgICAgaWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSk6CiAgICAgICAgICAgIGRlbGV0ZWRfY291bnQgKz0gMQogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFINiq2YUg2K3YsNmBIHtkZWxldGVkX2NvdW50fSDZhdmE2YEg2KjZhtis2KfYrSEiKQoKYXN5bmMgZGVmIGJ1dHRvbl9oYW5kbGVyKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItmF2LnYp9mE2Kwg2KfZhNij2LLYsdin2LEiIiIKICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQogICAgCiAgICBkYXRhID0gcXVlcnkuZGF0YQogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTZhdmE2YHYp9iqCiAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoInF1YWxpdHlfIikgYW5kIG5vdCBkYXRhLnN0YXJ0c3dpdGgoInF1YWxpdHlfdXJsXyIpOgogICAgICAgIHF1YWxpdHkgPSBkYXRhLnJlcGxhY2UoInF1YWxpdHlfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2YjYrNmI2K8gZmlsZV9pZAogICAgICAgIGlmICdmaWxlX2lkJyBub3QgaW4gcGVuZGluZzoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKdjCDYrti32KM6INmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2KfZhNmF2YTZgS4g2KPYsdiz2YQg2KfZhNmB2YrYr9mK2Ygg2YXYsdipINij2K7YsdmJLiIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgIGNoYXRfaWQgPSBwZW5kaW5nWydjaGF0X2lkJ10KICAgICAgICAKICAgICAgICBhd2FpdCBwcm9jZXNzaW5nX3F1ZXVlLnB1dCh7CiAgICAgICAgICAgICdjaGF0X2lkJzogY2hhdF9pZCwKICAgICAgICAgICAgJ3NvdXJjZSc6IHBlbmRpbmdbJ2ZpbGVfaWQnXSwKICAgICAgICAgICAgJ3R5cGUnOiAnZmlsZV9pZCcsCiAgICAgICAgICAgICdmaWxlX3NpemUnOiBwZW5kaW5nWydmaWxlX3NpemUnXSwKICAgICAgICAgICAgJ3F1YWxpdHknOiBxdWFsaXR5CiAgICAgICAgfSkKICAgICAgICAKICAgICAgICBxdWV1ZV9zaXplID0gcHJvY2Vzc2luZ19xdWV1ZS5xc2l6ZSgpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLinIUg2KrZhdiqINil2LbYp9mB2Kkg2KfZhNmB2YrYr9mK2Ygg2YTZhNi32KfYqNmI2LEhXG7wn5SiINin2YTZhdmI2LbYuSDZgdmKINin2YTYt9in2KjZiNixOiB7cXVldWVfc2l6ZX0iKQogICAgCiAgICAjINmF2LnYp9mE2KzYqSDYp9iu2KrZitin2LEg2KfZhNis2YjYr9ipINmE2YTYsdmI2KfYqNi3CiAgICBlbGlmIGRhdGEuc3RhcnRzd2l0aCgicXVhbGl0eV91cmxfIik6CiAgICAgICAgcXVhbGl0eSA9IGRhdGEucmVwbGFjZSgicXVhbGl0eV91cmxfIiwgIiIpCiAgICAgICAgCiAgICAgICAgcGVuZGluZyA9IGNvbnRleHQudXNlcl9kYXRhLmdldCgncGVuZGluZ192aWRlbycpCiAgICAgICAgaWYgbm90IHBlbmRpbmc6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLinYwg2KfZhtiq2YfYqiDYtdmE2KfYrdmK2Kkg2KfZhNi32YTYqC4g2KPYsdiz2YQg2KfZhNix2KfYqNi3INmF2LHYqSDYo9iu2LHZiS4iKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjINin2YTYqtit2YLZgiDZhdmGINmI2KzZiNivIHVybAogICAgICAgIGlmICd1cmwnIG5vdCBpbiBwZW5kaW5nOgogICAgICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dCgi4p2MINiu2LfYozog2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYp9mE2LHYp9io2LcuINij2LHYs9mEINin2YTYsdin2KjYtyDZhdix2Kkg2KPYrtix2YkuIikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgY2hhdF9pZCA9IHBlbmRpbmdbJ2NoYXRfaWQnXQogICAgICAgIAogICAgICAgIGF3YWl0IHByb2Nlc3NpbmdfcXVldWUucHV0KHsKICAgICAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICAgICAnc291cmNlJzogcGVuZGluZ1sndXJsJ10sCiAgICAgICAgICAgICd0eXBlJzogJ3VybCcsCiAgICAgICAgICAgICdxdWFsaXR5JzogcXVhbGl0eQogICAgICAgIH0pCiAgICAgICAgCiAgICAgICAgcXVldWVfc2l6ZSA9IHByb2Nlc3NpbmdfcXVldWUucXNpemUoKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGYi4pyFINiq2YXYqiDYpdi22KfZgdipINin2YTYsdin2KjYtyDZhNmE2LfYp9io2YjYsSFcbvCflKIg2KfZhNmF2YjYtti5INmB2Yog2KfZhNi32KfYqNmI2LE6IHtxdWV1ZV9zaXplfSIpCiAgICAKICAgICMg2YXYudin2YTYrNipINij2LLYsdin2LEg2KfZhNmC2KfYptmF2Kkg2KfZhNix2KbZitiz2YrYqQogICAgZWxpZiBkYXRhID09ICJteV9hY2NvdW50IjoKICAgICAgICB1c2VyX2RhdGEgPSBnZXRfdXNlcih1c2VyX2lkKQogICAgICAgIGlmIHVzZXJfZGF0YToKICAgICAgICAgICAgdXNlcl9pZF9kYiwgdXNlcm5hbWUsIHRvdGFsX3ZpZGVvcywgam9pbmVkX2RhdGUgPSB1c2VyX2RhdGEKICAgICAgICAgICAgYWNjb3VudF90ZXh0ID0gZiIiIgrwn5OKICoq2YXYudmE2YjZhdin2Kog2K3Ys9in2KjZgzoqKgoK8J+RpCDYp9mE2YXYudix2YE6IHt1c2VyX2lkX2RifQrwn46sINi52K/YryDYp9mE2YHZitiv2YrZiNmH2KfYqiDYp9mE2YXYtti62YjYt9ipOiB7dG90YWxfdmlkZW9zfQrwn5OFINiq2KfYsdmK2K4g2KfZhNin2YbYttmF2KfZhToge2pvaW5lZF9kYXRlfQoiIiIKICAgICAgICBlbHNlOgogICAgICAgICAgICBhY2NvdW50X3RleHQgPSAi4p2MINmE2YUg2YrYqtmFINin2YTYudir2YjYsSDYudmE2Ykg2K3Ys9in2KjZgy4iCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fc3RhcnQiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGFjY291bnRfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImhlbHAiOgogICAgICAgIGhlbHBfdGV4dCA9ICIiIgrihLnvuI8gKirZg9mK2YHZitipINin2LPYqtiu2K/Yp9mFINin2YTYqNmI2Ko6KioKCioq8J+TpSDZhNmE2YXZhNmB2KfYqiDYp9mE2LXYutmK2LHYqSAo2KPZgtmEINmF2YYgMjBNQik6KioKMe+4j+KDoyDYo9ix2LPZhCDYp9mE2YHZitiv2YrZiCDZhdio2KfYtNix2Kkg2YXZhiDYqtmK2YTZitis2LHYp9mFCjLvuI/ig6Mg2KfYrtiq2LEg2YXYs9iq2YjZiSDYp9mE2KzZiNiv2KkKM++4j+KDoyDYp9mG2KrYuNixINit2KrZiSDZitiq2YUg2KfZhNi22LrYtyDZiNin2YTYpdix2LPYp9mECgoqKvCfk6Qg2YTZhNmF2YTZgdin2Kog2KfZhNmD2KjZitix2KkgKNij2YPYqNixINmF2YYgMjBNQik6KioKMe+4j+KDoyDYp9ix2YHYuSDYp9mE2YHZitiv2YrZiCDYudmE2Ykg2KXYrdiv2Ykg2KfZhNmF2YbYtdin2Ko6CiAgIOKAoiBHb29nbGUgRHJpdmUgKNit2KrZiSAxNUdCINmF2KzYp9mG2KfZiykKICAg4oCiIERyb3Bib3ggKNit2KrZiSAyR0Ig2YXYrNin2YbYp9mLKQogICDigKIgTWVkaWFGaXJlCiAgIAoy77iP4oOjINin2K3YtdmEINi52YTZiSDYsdin2KjYtyDYp9mE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsToKICAgCiAgICoqR29vZ2xlIERyaXZlOioqCiAgIGBodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/ZXhwb3J0PWRvd25sb2FkJmlkPUZJTEVfSURgCiAgIAogICAqKkRyb3Bib3g6KioKICAgYGh0dHBzOi8vd3d3LmRyb3Bib3guY29tL3MveHh4eHgvdmlkZW8ubXA0P2RsPTFgCiAgIAoz77iP4oOjINij2LHYs9mEINin2YTYsdin2KjYtyDZhNmE2KjZiNiqCjTvuI/ig6Mg2KfYrtiq2LEg2YXYs9iq2YjZiSDYp9mE2KzZiNiv2KkKCioq8J+OryDZhdiz2KrZiNmK2KfYqiDYp9mE2KzZiNiv2Kk6KioK8J+UpSAqKti52KfZhNmK2KkqKiAtINis2YjYr9ipINmF2YXYqtin2LLYqdiMINit2KzZhSDYo9mC2YQg2YLZhNmK2YTYp9mLCuKalu+4jyAqKtmF2KrZiNiz2LfYqSoqIC0g2KrZiNin2LLZhiDYqNmK2YYg2KfZhNis2YjYr9ipINmI2KfZhNit2KzZhSAgCvCfkr4gKirZhdmG2K7Zgdi22KkqKiAtINij2YLZhCDYrdis2YUg2YXZhdmD2YbYjCDYrNmI2K/YqSDZhdmC2KjZiNmE2KkKCuKcqCAqKtmF2YrYstipINmF2YfZhdipKio6INin2YTYqNmI2Kog2YrYrdmB2Lgg2KPYqNi52KfYryDYp9mE2YHZitiv2YrZiCDYp9mE2KPYtdmE2YrYqSEK2KfZhNi22LrYtyDZitiq2YUg2YHZgti3INio2KrZgtmE2YrZhCDYp9mE2KzZiNiv2Kkg8J+OrwoK4pqg77iPICoq2YXZhNin2K3YuNin2Ko6KioK4oCiINin2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixOiDYrdiq2YkgMjBNQiDZgdmC2LcK4oCiINin2YTYsdmI2KfYqNi3INin2YTYrtin2LHYrNmK2Kk6INit2KrZiSAyR0IK4oCiINit2LDZgSDYqtmE2YLYp9im2Yog2YTZhNmF2YTZgdin2Kog2KjYudivINin2YTYpdix2LPYp9mECiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJiYWNrX3RvX3N0YXJ0IildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChoZWxwX3RleHQsIHJlcGx5X21hcmt1cD1iYWNrX2J1dHRvbikKICAgIAogICAgZWxpZiBkYXRhID09ICJhZG1pbl9zZXR0aW5ncyI6CiAgICAgICAgaWYgdXNlcl9pZCAhPSBBRE1JTl9JRDoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuYW5zd2VyKCLim5Qg2YfYsNinINmE2YTZhdi02LHZgSDZgdmC2LchIiwgc2hvd19hbGVydD1UcnVlKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICBrZXlib2FyZCA9IFsKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5OKINin2YTYpdit2LXYp9im2YrYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc3RhdHMiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+TpiDYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX2ZpbGVzIildLAogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfl5HvuI8g2K3YsNmBINis2YXZiti5INin2YTZhdmE2YHYp9iqIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fY2xlYW51cCIpXSwKICAgICAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fc3RhcnQiKV0KICAgICAgICBdCiAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIuKame+4jyAqKtil2LnYr9in2K/Yp9iqINin2YTZhdi02LHZgToqKiIsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fc3RhdHMiOgogICAgICAgIGNvbm4gPSBzcWxpdGUzLmNvbm5lY3QoJ3ZpZGVvX2JvdC5kYicpCiAgICAgICAgYyA9IGNvbm4uY3Vyc29yKCkKICAgICAgICBjLmV4ZWN1dGUoIlNFTEVDVCBDT1VOVCgqKSBGUk9NIHVzZXJzIikKICAgICAgICB0b3RhbF91c2VycyA9IGMuZmV0Y2hvbmUoKVswXQogICAgICAgIGMuZXhlY3V0ZSgiU0VMRUNUIFNVTSh0b3RhbF92aWRlb3MpIEZST00gdXNlcnMiKQogICAgICAgIHRvdGFsX3ZpZGVvcyA9IGMuZmV0Y2hvbmUoKVswXSBvciAwCiAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgCiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgCiAgICAgICAgc3RhdHNfdGV4dCA9IGYiIiIK8J+TiiAqKtil2K3Ytdin2KbZitin2Kog2KfZhNio2YjYqjoqKgoK8J+RpSDYudiv2K8g2KfZhNmF2LPYqtiu2K/ZhdmK2YY6IHt0b3RhbF91c2Vyc30K8J+OrCDYpdis2YXYp9mE2Yog2KfZhNmB2YrYr9mK2YjZh9in2Ko6IHt0b3RhbF92aWRlb3N9CvCfk6Yg2KfZhNmF2YTZgdin2Kog2KfZhNmF2K7YstmG2Kk6IHtzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXX0K8J+SviDYp9mE2YXYs9in2K3YqSDYp9mE2YXYs9iq2K7Yr9mF2Kk6IHtmb3JtYXRfc2l6ZShzdG9yYWdlX2luZm9bJ3RvdGFsX3NpemUnXSl9CiIiIgogICAgICAgIGJhY2tfYnV0dG9uID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoW1tJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UmSDYp9mE2LnZiNiv2KkiLCBjYWxsYmFja19kYXRhPSJhZG1pbl9zZXR0aW5ncyIpXV0pCiAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoc3RhdHNfdGV4dCwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImFkbWluX2ZpbGVzIjoKICAgICAgICBzdG9yYWdlX2luZm8gPSBnZXRfc3RvcmFnZV9pbmZvKCkKICAgICAgICAKICAgICAgICBpZiBzdG9yYWdlX2luZm9bJ2ZpbGVfY291bnQnXSA9PSAwOgogICAgICAgICAgICBmaWxlc190ZXh0ID0gIuKchSDZhNinINiq2YjYrNivINmF2YTZgdin2Kog2YXYrtiy2YbYqSDYrdin2YTZitin2YsuIgogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGZpbGVzX3RleHQgPSBmIvCfk6YgKirYp9mE2YXZhNmB2KfYqiDYp9mE2YXYrtiy2YbYqSAoe3N0b3JhZ2VfaW5mb1snZmlsZV9jb3VudCddfSk6KipcblxuIgogICAgICAgICAgICBmb3IgaSwgZmlsZV9pbmZvIGluIGVudW1lcmF0ZShzdG9yYWdlX2luZm9bJ2ZpbGVzJ11bOjEwXSwgMSk6CiAgICAgICAgICAgICAgICBmaWxlc190ZXh0ICs9IGYie2l9LiBge2ZpbGVfaW5mb1snbmFtZSddWzozMF19Li4uYFxuICAge2Zvcm1hdF9zaXplKGZpbGVfaW5mb1snc2l6ZSddKX1cblxuIgogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiAxMDoKICAgICAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbi4uLiDZiCB7c3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gLSAxMH0g2YXZhNmBINii2K7YsSIKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVzX3RleHQgKz0gZiJcbvCfkr4g2KfZhNil2KzZhdin2YTZijoge2Zvcm1hdF9zaXplKHN0b3JhZ2VfaW5mb1sndG90YWxfc2l6ZSddKX0iCiAgICAgICAgCiAgICAgICAgYmFja19idXR0b24gPSBJbmxpbmVLZXlib2FyZE1hcmt1cChbW0lubGluZUtleWJvYXJkQnV0dG9uKCLwn5SZINin2YTYudmI2K/YqSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildXSkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmaWxlc190ZXh0LCByZXBseV9tYXJrdXA9YmFja19idXR0b24pCiAgICAKICAgIGVsaWYgZGF0YSA9PSAiYWRtaW5fY2xlYW51cCI6CiAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgZGVsZXRlZF9jb3VudCA9IDAKICAgICAgICAKICAgICAgICBmb3IgZmlsZV9pbmZvIGluIHN0b3JhZ2VfaW5mb1snZmlsZXMnXToKICAgICAgICAgICAgaWYgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSk6CiAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDEKICAgICAgICAKICAgICAgICBiYWNrX2J1dHRvbiA9IElubGluZUtleWJvYXJkTWFya3VwKFtbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflJkg2KfZhNi52YjYr9ipIiwgY2FsbGJhY2tfZGF0YT0iYWRtaW5fc2V0dGluZ3MiKV1dKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KGYi4pyFINiq2YUg2K3YsNmBIHtkZWxldGVkX2NvdW50fSDZhdmE2YEhIiwgcmVwbHlfbWFya3VwPWJhY2tfYnV0dG9uKQogICAgCiAgICBlbGlmIGRhdGEgPT0gImJhY2tfdG9fc3RhcnQiOgogICAgICAgIHVzZXIgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIKICAgICAgICBrZXlib2FyZF9yb3dzID0gWwogICAgICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfk4og2K3Ys9in2KjZiiDZiNil2K3Ytdin2KbZitin2KrZiiIsIGNhbGxiYWNrX2RhdGE9Im15X2FjY291bnQiKV0sCiAgICAgICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4oS577iPINin2YTZhdiz2KfYudiv2KkiLCBjYWxsYmFja19kYXRhPSJoZWxwIildCiAgICAgICAgXQogICAgICAgIAogICAgICAgIGlmIHVzZXIuaWQgPT0gQURNSU5fSUQ6CiAgICAgICAgICAgIGtleWJvYXJkX3Jvd3MuYXBwZW5kKFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqZ77iPINil2LnYr9in2K/Yp9iqINin2YTZhdi02LHZgSIsIGNhbGxiYWNrX2RhdGE9ImFkbWluX3NldHRpbmdzIildKQogICAgICAgIAogICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkX3Jvd3MpCiAgICAgICAgCiAgICAgICAgd2VsY29tZV90ZXh0ID0gZiIiIgrwn46sINmF2LHYrdio2KfZiyB7dXNlci5maXJzdF9uYW1lfSEKCtij2YbYpyDYqNmI2Kog2LbYuti3INin2YTZgdmK2K/ZitmI2YfYp9iqIC0gKirZhdis2KfZhtmKINio2KfZhNmD2KfZhdmEKiog8J+agAoKKirwn46vINin2YTZhdmF2YrYstin2Ko6KioK4pyoINmF2YTZgdin2Kog2K3YqtmJICoqMkdCKiog2LnYqNixINin2YTYsdmI2KfYqNi3CuKcqCDYqtit2YXZitmEINmF2KjYp9i02LEg2K3YqtmJIDIwTUIK4pyoIDMg2YXYs9iq2YjZitin2Kog2LbYuti3INmC2YjZitipCuKcqCDYrdiw2YEg2KrZhNmC2KfYptmKINmE2YTZhdmE2YHYp9iqCgoqKvCfk6Qg2YPZitmBINiq2KjYr9ijOioqCuKAoiDZhdmE2YHYp9iqINi12LrZitix2Kk6INij2LHYs9mEINmF2KjYp9i02LHYqQrigKIg2YXZhNmB2KfYqiDZg9io2YrYsdipOiDYp9ix2YHYuSDYudmE2YkgRHJpdmUvRHJvcGJveCDZiNij2LHYs9mEINin2YTYsdin2KjYtwoK2KfYtti62LcgItin2YTZhdiz2KfYudiv2KkiINmE2YXYudix2YHYqSDYp9mE2KrZgdin2LXZitmEISDwn5OaCiIiIgogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KHdlbGNvbWVfdGV4dCwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCiMgPT09PT09PT09PT09PT09PT09PT0g2YXYudin2YTYrNipINin2YTZgdmK2K/ZitmIID09PT09PT09PT09PT09PT09PT09CmFzeW5jIGRlZiBkb3dubG9hZF9maWxlX2Zyb21fdGVsZWdyYW0oY29udGV4dCwgZmlsZV9pZDogc3RyLCBmaWxlX3NpemU6IGludCkgLT4gT3B0aW9uYWxbc3RyXToKICAgICIiItiq2K3ZhdmK2YQg2YXZhNmBINmF2YYg2KrZhNmK2KzYsdin2YUg2KXZhNmJINin2YTYqtiu2LLZitmGINin2YTZhdik2YLYqiIiIgogICAgdHJ5OgogICAgICAgIHByaW50KGYi8J+TpSDYqtit2YXZitmEINmF2YYgVGVsZWdyYW0uLi4g2KfZhNit2KzZhToge2ZpbGVfc2l6ZSAvICgxMDI0KjEwMjQpOi4yZn0gTUIiKQogICAgICAgIAogICAgICAgIGZpbGUgPSBhd2FpdCBjb250ZXh0LmJvdC5nZXRfZmlsZShmaWxlX2lkKQogICAgICAgIAogICAgICAgICMg2K3Zgdi4INmB2Yog2YXYrNmE2K8g2KfZhNiq2K7YstmK2YYg2KfZhNmF2KTZgtiqCiAgICAgICAgdGltZXN0YW1wID0gaW50KHRpbWUudGltZSgpKQogICAgICAgIHRlbXBfZmlsZW5hbWUgPSBmInZpZGVvX3t0aW1lc3RhbXB9X3tmaWxlX2lkWzoxMF19Lm1wNCIKICAgICAgICB0ZW1wX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgdGVtcF9maWxlbmFtZSkKICAgICAgICAKICAgICAgICBhd2FpdCBmaWxlLmRvd25sb2FkX3RvX2RyaXZlKHRlbXBfcGF0aCkKICAgICAgICBwcmludChmIuKchSDYqtmFINin2YTYqtit2YXZitmEOiB7dGVtcF9wYXRofSIpCiAgICAgICAgCiAgICAgICAgcmV0dXJuIHRlbXBfcGF0aAogICAgICAgIAogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTYqtit2YXZitmEOiB7ZX0iKQogICAgICAgIHJldHVybiBOb25lCgpkZWYgZ2V0X3F1YWxpdHlfc2V0dGluZ3MocXVhbGl0eTogc3RyKSAtPiBkaWN0OgogICAgIiIi2KfZhNit2LXZiNmEINi52YTZiSDYpdi52K/Yp9iv2KfYqiDYp9mE2KzZiNiv2KkgLSDYqNiv2YjZhiDYqti62YrZitixINin2YTYo9io2LnYp9ivIiIiCiAgICBpZiBxdWFsaXR5ID09ICdoaWdoJzoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMjgsCiAgICAgICAgICAgICJwcmVzZXQiOiAibWVkaXVtIiwKICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiA5NiwKICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IDQ0MTAwLAogICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiAyCiAgICAgICAgfQogICAgZWxpZiBxdWFsaXR5ID09ICdtZWRpdW0nOgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICJjcmYiOiAzMywKICAgICAgICAgICAgInByZXNldCI6ICJtZWRpdW0iLAogICAgICAgICAgICAiYXVkaW9fYml0cmF0ZSI6IDY0LAogICAgICAgICAgICAiYXVkaW9fZnJlcXVlbmN5IjogNDQxMDAsCiAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IDIKICAgICAgICB9CiAgICBlbHNlOiAgIyBsb3cKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAiY3JmIjogMzgsCiAgICAgICAgICAgICJwcmVzZXQiOiAiZmFzdCIsCiAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogNDgsCiAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiAyMjA1MCwKICAgICAgICAgICAgImF1ZGlvX2NoYW5uZWxzIjogMQogICAgICAgIH0KCmRlZiBjb21wcmVzc192aWRlbyh2aWRlb19zb3VyY2U6IHN0ciwgY2hhdF9pZDogc3RyLCBjb250ZXh0LCBxdWFsaXR5OiBzdHIgPSAnbG93JywgaXNfdXJsOiBib29sID0gVHJ1ZSkgLT4gT3B0aW9uYWxbc3RyXToKICAgICIiIti22LrYtyDYp9mE2YHZitiv2YrZiCDYqNin2LPYqtiu2K/Yp9mFIENsb3VkQ29udmVydCAtINmF2Lkg2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSIiIgogICAgYXBpX2tleSA9IGdldF9hcGlfa2V5KCkKICAgIGlmIG5vdCBhcGlfa2V5OgogICAgICAgIHJldHVybiAiTk9fQVBJX0tFWV9TRVQiCgogICAgdHJ5OgogICAgICAgIGhlYWRlcnMgPSB7IkF1dGhvcml6YXRpb24iOiBmIkJlYXJlciB7YXBpX2tleX0ifQogICAgICAgIHNldHRpbmdzID0gZ2V0X3F1YWxpdHlfc2V0dGluZ3MocXVhbGl0eSkKICAgICAgICAKICAgICAgICAjINiq2K3Yr9mK2K8g2K3ZhdmI2YTYqSBKb2IgLSDYqNiv2YjZhiB3aWR0aCDZiCBoZWlnaHQg2YTYrdmB2Lgg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkKICAgICAgICBpZiBpc191cmw6CiAgICAgICAgICAgIGpvYl9wYXlsb2FkID0gewogICAgICAgICAgICAgICAgInRhc2tzIjogewogICAgICAgICAgICAgICAgICAgICJpbXBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJpbXBvcnQvdXJsIiwgInVybCI6IHZpZGVvX3NvdXJjZSwgImZpbGVuYW1lIjogInZpZGVvLm1wNCJ9LAogICAgICAgICAgICAgICAgICAgICJjb21wcmVzcy12aWRlbyI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgIm9wZXJhdGlvbiI6ICJjb252ZXJ0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJpbnB1dCI6ICJpbXBvcnQtdmlkZW8iLCAKICAgICAgICAgICAgICAgICAgICAgICAgIm91dHB1dF9mb3JtYXQiOiAibXA0IiwKICAgICAgICAgICAgICAgICAgICAgICAgInZpZGVvX2NvZGVjIjogIngyNjQiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImNyZiI6IHNldHRpbmdzWyJjcmYiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJwcmVzZXQiOiBzZXR0aW5nc1sicHJlc2V0Il0sCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19jb2RlYyI6ICJhYWMiLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2JpdHJhdGUiOiBzZXR0aW5nc1siYXVkaW9fYml0cmF0ZSJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgImF1ZGlvX2ZyZXF1ZW5jeSI6IHNldHRpbmdzWyJhdWRpb19mcmVxdWVuY3kiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19jaGFubmVscyI6IHNldHRpbmdzWyJhdWRpb19jaGFubmVscyJdLCAKICAgICAgICAgICAgICAgICAgICAgICAgInN0cmlwX21ldGFkYXRhIjogVHJ1ZQogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImV4cG9ydC12aWRlbyI6IHsib3BlcmF0aW9uIjogImV4cG9ydC91cmwiLCAiaW5wdXQiOiAiY29tcHJlc3MtdmlkZW8ifQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgam9iX3BheWxvYWQgPSB7CiAgICAgICAgICAgICAgICAidGFza3MiOiB7CiAgICAgICAgICAgICAgICAgICAgImltcG9ydC12aWRlbyI6IHsib3BlcmF0aW9uIjogImltcG9ydC91cGxvYWQifSwKICAgICAgICAgICAgICAgICAgICAiY29tcHJlc3MtdmlkZW8iOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJvcGVyYXRpb24iOiAiY29udmVydCIsIAogICAgICAgICAgICAgICAgICAgICAgICAiaW5wdXQiOiAiaW1wb3J0LXZpZGVvIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJvdXRwdXRfZm9ybWF0IjogIm1wNCIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ2aWRlb19jb2RlYyI6ICJ4MjY0IiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJjcmYiOiBzZXR0aW5nc1siY3JmIl0sIAogICAgICAgICAgICAgICAgICAgICAgICAicHJlc2V0Ijogc2V0dGluZ3NbInByZXNldCJdLAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY29kZWMiOiAiYWFjIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19iaXRyYXRlIjogc2V0dGluZ3NbImF1ZGlvX2JpdHJhdGUiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJhdWRpb19mcmVxdWVuY3kiOiBzZXR0aW5nc1siYXVkaW9fZnJlcXVlbmN5Il0sIAogICAgICAgICAgICAgICAgICAgICAgICAiYXVkaW9fY2hhbm5lbHMiOiBzZXR0aW5nc1siYXVkaW9fY2hhbm5lbHMiXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICJzdHJpcF9tZXRhZGF0YSI6IFRydWUKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJleHBvcnQtdmlkZW8iOiB7Im9wZXJhdGlvbiI6ICJleHBvcnQvdXJsIiwgImlucHV0IjogImNvbXByZXNzLXZpZGVvIn0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIAogICAgICAgIHJlc3BvbnNlID0gcmVxdWVzdHMucG9zdCgKICAgICAgICAgICAgImh0dHBzOi8vYXBpLmNsb3VkY29udmVydC5jb20vdjIvam9icyIsCiAgICAgICAgICAgIGpzb249am9iX3BheWxvYWQsCiAgICAgICAgICAgIGhlYWRlcnM9aGVhZGVycwogICAgICAgICkKICAgICAgICAKICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDE6CiAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYpdmG2LTYp9ihIEpvYjoge3Jlc3BvbnNlLnRleHR9IikKICAgICAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAgICAgCiAgICAgICAgam9iX2RhdGEgPSByZXNwb25zZS5qc29uKClbImRhdGEiXQogICAgICAgIGpvYl9pZCA9IGpvYl9kYXRhWyJpZCJdCiAgICAgICAgCiAgICAgICAgIyDYsdmB2Lkg2KfZhNmF2YTZgSDYpdiw2Kcg2YPYp9mGINmF2K3ZhNmK2KfZiwogICAgICAgIGlmIG5vdCBpc191cmw6CiAgICAgICAgICAgIGltcG9ydF90YXNrID0gbmV4dCgodCBmb3IgdCBpbiBqb2JfZGF0YVsidGFza3MiXSBpZiB0WyJuYW1lIl0gPT0gImltcG9ydC12aWRlbyIpLCBOb25lKQogICAgICAgICAgICBpZiBub3QgaW1wb3J0X3Rhc2s6CiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgdXBsb2FkX3VybCA9IGltcG9ydF90YXNrWyJyZXN1bHQiXVsiZm9ybSJdWyJ1cmwiXQogICAgICAgICAgICB1cGxvYWRfcGFyYW1zID0gaW1wb3J0X3Rhc2tbInJlc3VsdCJdWyJmb3JtIl1bInBhcmFtZXRlcnMiXQogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHZpZGVvX3NvdXJjZSwgJ3JiJykgYXMgZjoKICAgICAgICAgICAgICAgIGZpbGVzID0geydmaWxlJzogZn0KICAgICAgICAgICAgICAgIHVwbG9hZF9yZXNwb25zZSA9IHJlcXVlc3RzLnBvc3QodXBsb2FkX3VybCwgZGF0YT11cGxvYWRfcGFyYW1zLCBmaWxlcz1maWxlcykKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHVwbG9hZF9yZXNwb25zZS5zdGF0dXNfY29kZSBub3QgaW4gWzIwMCwgMjAxXToKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYsdmB2Lkg2KfZhNmF2YTZgToge3VwbG9hZF9yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoIuKchSDYqtmFINix2YHYuSDYp9mE2YXZhNmBINmE2YAgQ2xvdWRDb252ZXJ0IikKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2K3ZhNmKINmB2YjYsdin2Ysg2KjYudivINin2YTYsdmB2LkKICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh2aWRlb19zb3VyY2UpCiAgICAgICAgCiAgICAgICAgIyDYp9mG2KrYuNin2LEg2KfZg9iq2YXYp9mEINin2YTZhdi52KfZhNis2KkKICAgICAgICBtYXhfYXR0ZW1wdHMgPSAxODAKICAgICAgICBhdHRlbXB0ID0gMAogICAgICAgIAogICAgICAgIHdoaWxlIGF0dGVtcHQgPCBtYXhfYXR0ZW1wdHM6CiAgICAgICAgICAgIHRpbWUuc2xlZXAoNSkKICAgICAgICAgICAgc3RhdHVzX3Jlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KAogICAgICAgICAgICAgICAgZiJodHRwczovL2FwaS5jbG91ZGNvbnZlcnQuY29tL3YyL2pvYnMve2pvYl9pZH0iLAogICAgICAgICAgICAgICAgaGVhZGVycz1oZWFkZXJzCiAgICAgICAgICAgICkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIHN0YXR1c19yZXNwb25zZS5zdGF0dXNfY29kZSAhPSAyMDA6CiAgICAgICAgICAgICAgICBwcmludChmIuKaoO+4jyDZgdi02YQg2YHYrdi1INin2YTYrdin2YTYqToge3N0YXR1c19yZXNwb25zZS50ZXh0fSIpCiAgICAgICAgICAgICAgICBhdHRlbXB0ICs9IDEKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICBqb2Jfc3RhdHVzID0gc3RhdHVzX3Jlc3BvbnNlLmpzb24oKVsiZGF0YSJdCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBqb2Jfc3RhdHVzWyJzdGF0dXMiXSA9PSAiZmluaXNoZWQiOgogICAgICAgICAgICAgICAgZXhwb3J0X3Rhc2sgPSBuZXh0KCh0IGZvciB0IGluIGpvYl9zdGF0dXNbInRhc2tzIl0gaWYgdFsibmFtZSJdID09ICJleHBvcnQtdmlkZW8iKSwgTm9uZSkKICAgICAgICAgICAgICAgIGlmIGV4cG9ydF90YXNrIGFuZCBleHBvcnRfdGFzay5nZXQoInJlc3VsdCIpOgogICAgICAgICAgICAgICAgICAgIGRvd25sb2FkX3VybCA9IGV4cG9ydF90YXNrWyJyZXN1bHQiXVsiZmlsZXMiXVswXVsidXJsIl0KICAgICAgICAgICAgICAgICAgICBwcmludChmIuKchSDYp9mD2KrZhdmEINin2YTYtti62LchIFVSTDoge2Rvd25sb2FkX3VybH0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBkb3dubG9hZF91cmwKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIuKdjCDZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgICAgICAKICAgICAgICAgICAgZWxpZiBqb2Jfc3RhdHVzWyJzdGF0dXMiXSA9PSAiZXJyb3IiOgogICAgICAgICAgICAgICAgcHJpbnQoZiLinYwg2YHYtNmEIEpvYjoge2pvYl9zdGF0dXN9IikKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICBhdHRlbXB0ICs9IDEKICAgICAgICAgICAgcHJpbnQoZiLij7Mg2KfZhtiq2LjYp9ixLi4uICh7YXR0ZW1wdH0ve21heF9hdHRlbXB0c30pIikKICAgICAgICAKICAgICAgICBwcmludCgi4o+x77iPINin2YbYqtmH2Kog2YXZh9mE2Kkg2KfZhNin2YbYqti42KfYsSIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgICAgICAKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIuKdjCDYrti32KMg2YHZiiDYtti62Lcg2KfZhNmB2YrYr9mK2Yg6IHtlfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKCmRlZiBzZW5kX2NvbXByZXNzZWRfdmlkZW9fYWR2YW5jZWQoY2hhdF9pZDogc3RyLCB2aWRlb191cmw6IHN0ciwgY2FwdGlvbjogc3RyKSAtPiB0dXBsZToKICAgICIiItil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KfZhNmF2LbYutmI2Lcg2YXYuSDYpdiv2KfYsdipINmF2K3Ys9mG2Kkg2YTZhNmF2YTZgdin2KoiIiIKICAgIG1heF9yZXRyaWVzID0gMwogICAgCiAgICBmb3IgYXR0ZW1wdCBpbiByYW5nZShtYXhfcmV0cmllcyk6CiAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgCiAgICAgICAgdHJ5OgogICAgICAgICAgICBwcmludChmIvCfk6Ug2YXYrdin2YjZhNipINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YggKHthdHRlbXB0ICsgMX0ve21heF9yZXRyaWVzfSkuLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYqtit2YXZitmEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIHZpZGVvX3Jlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHZpZGVvX3VybCwgc3RyZWFtPVRydWUsIHRpbWVvdXQ9MzAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdmlkZW9fcmVzcG9uc2Uuc3RhdHVzX2NvZGUgIT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoZiLinYwg2YHYtNmEINin2YTYqtit2YXZitmEOiB7dmlkZW9fcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgIAogICAgICAgICAgICAjINit2YHYuCDZhdik2YLYqgogICAgICAgICAgICB0aW1lc3RhbXAgPSBpbnQodGltZS50aW1lKCkpCiAgICAgICAgICAgIHRlbXBfZmlsZW5hbWUgPSBmImNvbXByZXNzZWRfe3RpbWVzdGFtcH1fe2NoYXRfaWR9Lm1wNCIKICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBvcy5wYXRoLmpvaW4oVEVNUF9TVE9SQUdFX0RJUiwgdGVtcF9maWxlbmFtZSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHdpdGggb3Blbih0ZW1wX2ZpbGVfcGF0aCwgJ3diJykgYXMgZjoKICAgICAgICAgICAgICAgIGZvciBjaHVuayBpbiB2aWRlb19yZXNwb25zZS5pdGVyX2NvbnRlbnQoY2h1bmtfc2l6ZT04MTkyKToKICAgICAgICAgICAgICAgICAgICBpZiBjaHVuazoKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShjaHVuaykKICAgICAgICAgICAgCiAgICAgICAgICAgIGZpbGVfc2l6ZSA9IG9zLnBhdGguZ2V0c2l6ZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgcHJpbnQoZiLinIUg2KrZhSDYp9mE2KrYrdmF2YrZhDoge2ZpbGVfc2l6ZSAvICgxMDI0KjEwMjQpOi4yZn0gTUIiKQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmICiAgICAgICAgICAgIHByaW50KCLwn5OkINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2YguLi4iKQogICAgICAgICAgICAKICAgICAgICAgICAgdXJsID0gZiJodHRwczovL2FwaS50ZWxlZ3JhbS5vcmcvYm90e1RFTEVHUkFNX0JPVF9UT0tFTn0vc2VuZFZpZGVvIgogICAgICAgICAgICAKICAgICAgICAgICAgd2l0aCBvcGVuKHRlbXBfZmlsZV9wYXRoLCAncmInKSBhcyB2aWRlb19maWxlOgogICAgICAgICAgICAgICAgZmlsZXMgPSB7J3ZpZGVvJzogdmlkZW9fZmlsZX0KICAgICAgICAgICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkLAogICAgICAgICAgICAgICAgICAgICdjYXB0aW9uJzogY2FwdGlvbiwKICAgICAgICAgICAgICAgICAgICAnc3VwcG9ydHNfc3RyZWFtaW5nJzogVHJ1ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzZW5kX3Jlc3BvbnNlID0gcmVxdWVzdHMucG9zdCh1cmwsIGZpbGVzPWZpbGVzLCBkYXRhPWRhdGEsIHRpbWVvdXQ9MzAwKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgc2VuZF9yZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBwcmludCgi4pyFINiq2YUg2KXYsdiz2KfZhCDYp9mE2YHZitiv2YrZiCDYqNmG2KzYp9itISIpCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZSwgdGVtcF9maWxlX3BhdGgKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYi4p2MINmB2LTZhCDYp9mE2KXYsdiz2KfZhDoge3NlbmRfcmVzcG9uc2Uuc3RhdHVzX2NvZGV9IC0ge3NlbmRfcmVzcG9uc2UudGV4dFs6MjAwXX0iKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjINit2LDZgSDYp9mE2YXZhNmBINin2YTZgdin2LTZhAogICAgICAgICAgICAgICAgaWYgdGVtcF9maWxlX3BhdGg6CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh0ZW1wX2ZpbGVfcGF0aCkKICAgICAgICAgICAgICAgICAgICB0ZW1wX2ZpbGVfcGF0aCA9IE5vbmUKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCB0ZW1wX2ZpbGVfcGF0aAogICAgICAgIAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiLinYwg2K7Yt9ijINmB2Yog2KfZhNmF2K3Yp9mI2YTYqSB7YXR0ZW1wdCArIDF9OiB7ZX0iKQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgdGVtcF9maWxlX3BhdGg6CiAgICAgICAgICAgICAgICBkZWxldGVfZmlsZV9zYWZlKHRlbXBfZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgdGVtcF9maWxlX3BhdGggPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgdGltZS5zbGVlcCg1KQogICAgCiAgICByZXR1cm4gRmFsc2UsIE5vbmUKCmFzeW5jIGRlZiBwcm9jZXNzX3ZpZGVvX3F1ZXVlKGNvbnRleHQpOgogICAgIiIi2YXYudin2YTYrCDYt9in2KjZiNixINin2YTZgdmK2K/ZitmIIiIiCiAgICBnbG9iYWwgaXNfcHJvY2Vzc2luZwogICAgCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHRyeToKICAgICAgICAgICAgdmlkZW9fZGF0YSA9IGF3YWl0IHByb2Nlc3NpbmdfcXVldWUuZ2V0KCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlzX3Byb2Nlc3NpbmcgPSBUcnVlCiAgICAgICAgICAgIGNoYXRfaWQgPSB2aWRlb19kYXRhWydjaGF0X2lkJ10KICAgICAgICAgICAgdXNlcl9pZCA9IGludChjaGF0X2lkKQogICAgICAgICAgICB2aWRlb19zb3VyY2UgPSB2aWRlb19kYXRhWydzb3VyY2UnXQogICAgICAgICAgICBzb3VyY2VfdHlwZSA9IHZpZGVvX2RhdGFbJ3R5cGUnXQogICAgICAgICAgICBmaWxlX3NpemUgPSB2aWRlb19kYXRhLmdldCgnZmlsZV9zaXplJywgMCkKICAgICAgICAgICAgcXVhbGl0eSA9IHZpZGVvX2RhdGEuZ2V0KCdxdWFsaXR5JywgJ2xvdycpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChmIvCfjqwg2KjYr9ihINmF2LnYp9mE2KzYqToge2NoYXRfaWR9IC0ge3NvdXJjZV90eXBlfSAtIHtxdWFsaXR5fSIpCiAgICAgICAgICAgIAogICAgICAgICAgICBjb21wcmVzc2VkX3VybCA9IE5vbmUKICAgICAgICAgICAgbG9jYWxfZmlsZV90b19kZWxldGUgPSBOb25lCiAgICAgICAgICAgIAogICAgICAgICAgICAjINmF2LnYp9mE2KzYqSDYrdiz2Kgg2KfZhNmG2YjYuQogICAgICAgICAgICBpZiBzb3VyY2VfdHlwZSA9PSAndXJsJzoKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi4o+zINis2KfYsdmKINmF2LnYp9mE2KzYqSDYp9mE2LHYp9io2LcuLi4iLCBjb250ZXh0KQogICAgICAgICAgICAgICAgY29tcHJlc3NlZF91cmwgPSBjb21wcmVzc192aWRlbyh2aWRlb19zb3VyY2UsIGNoYXRfaWQsIGNvbnRleHQsIHF1YWxpdHksIGlzX3VybD1UcnVlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGVsaWYgc291cmNlX3R5cGUgPT0gJ2ZpbGVfaWQnOgogICAgICAgICAgICAgICAgaWYgZmlsZV9zaXplIDw9IERJUkVDVF9ET1dOTE9BRF9MSU1JVDoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIvCfk6Ug2KzYp9ix2Yog2KrYrdmF2YrZhCDYp9mE2YHZitiv2YrZiC4uLiIsIGNvbnRleHQpCiAgICAgICAgICAgICAgICAgICAgbG9jYWxfZmlsZSA9IGF3YWl0IGRvd25sb2FkX2ZpbGVfZnJvbV90ZWxlZ3JhbShjb250ZXh0LCB2aWRlb19zb3VyY2UsIGZpbGVfc2l6ZSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBsb2NhbF9maWxlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9maWxlX3RvX2RlbGV0ZSA9IGxvY2FsX2ZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLij7Mg2KzYp9ix2Yog2LbYuti3INin2YTZgdmK2K/ZitmILi4uIiwgY29udGV4dCkKICAgICAgICAgICAgICAgICAgICAgICAgY29tcHJlc3NlZF91cmwgPSBjb21wcmVzc192aWRlbyhsb2NhbF9maWxlLCBjaGF0X2lkLCBjb250ZXh0LCBxdWFsaXR5LCBpc191cmw9RmFsc2UpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YHYtNmEINiq2K3ZhdmK2YQg2KfZhNmB2YrYr9mK2YguIiwgY29udGV4dCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsIGYi4p2MINin2YTZhdmE2YEg2YPYqNmK2LEg2KzYr9in2YsgKHtmaWxlX3NpemUvKDEwMjQqMTAyNCk6LjJmfSBNQikuINin2YTYrdivINin2YTYo9mC2LXZiSAyME1CLlxuXG7wn5KhINin2LPYqtiu2K/ZhSBHb29nbGUgRHJpdmUg2KPZiCBEcm9wYm94INmE2YTZhdmE2YHYp9iqINin2YTYo9mD2KjYsSEiLCBjb250ZXh0KQogICAgICAgICAgICAKICAgICAgICAgICAgIyDYpdix2LPYp9mEINin2YTZhtiq2YrYrNipCiAgICAgICAgICAgIGlmIGNvbXByZXNzZWRfdXJsID09ICJOT19BUElfS0VZX1NFVCI6CiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX21lc3NhZ2UoY2hhdF9pZCwgIuKdjCDZhNmFINmK2KrZhSDYqti52YrZitmGINmF2YHYqtin2K0gQVBJLiDYo9io2YTYuiDYp9mE2YXYtNix2YEuIiwgY29udGV4dCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICBlbGlmIGNvbXByZXNzZWRfdXJsOgogICAgICAgICAgICAgICAgcXVhbGl0eV9uYW1lcyA9IHsnaGlnaCc6ICfwn5SlINi52KfZhNmK2KknLCAnbWVkaXVtJzogJ+Kalu+4jyDZhdiq2YjYs9i32KknLCAnbG93JzogJ/Cfkr4g2YXZhtiu2YHYttipJ30KICAgICAgICAgICAgICAgIGNhcHRpb24gPSBmIuKchSDYqtmFINin2YTYtti62Lcg2KjZhtis2KfYrSFcbvCfjqwg2KfZhNis2YjYr9ipOiB7cXVhbGl0eV9uYW1lcy5nZXQocXVhbGl0eSwgJ9i52KfYr9mK2KknKX1cbuKcqCDYqtmFINin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRfbWVzc2FnZShjaGF0X2lkLCAi8J+TpCDYrNin2LHZiiDYpdix2LPYp9mEINin2YTZgdmK2K/ZitmILi4uIiwgY29udGV4dCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2VuZF9zdWNjZXNzLCB0ZW1wX2ZpbGUgPSBzZW5kX2NvbXByZXNzZWRfdmlkZW9fYWR2YW5jZWQoY2hhdF9pZCwgY29tcHJlc3NlZF91cmwsIGNhcHRpb24pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMg2K3YsNmBINin2YTZhdmE2YEg2KfZhNmF2KTZgtiqINmB2YjYsdin2Ysg2KjYudivINin2YTYpdix2LPYp9mECiAgICAgICAgICAgICAgICBpZiB0ZW1wX2ZpbGU6CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZSh0ZW1wX2ZpbGUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNlbmRfc3VjY2VzczoKICAgICAgICAgICAgICAgICAgICBpbmNyZW1lbnRfdmlkZW9fY291bnQodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICBwcmludChmIuKchSDYqtmFINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2Ygg2KXZhNmJIHtjaGF0X2lkfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDYqtmG2LjZitmBINij2Yog2YXZhNmB2KfYqiDZhdiq2KjZgtmK2KkKICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgc3RvcmFnZV9pbmZvID0gZ2V0X3N0b3JhZ2VfaW5mbygpCiAgICAgICAgICAgICAgICAgICAgaWYgc3RvcmFnZV9pbmZvWydmaWxlX2NvdW50J10gPiA1OgogICAgICAgICAgICAgICAgICAgICAgICBwcmludCgi8J+nuSDYqtmG2LjZitmBINin2YTZhdmE2YHYp9iqINin2YTZgtiv2YrZhdipLi4uIikKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGZpbGVfaW5mbyBpbiBzdG9yYWdlX2luZm9bJ2ZpbGVzJ11bOjNdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlX2ZpbGVfc2FmZShmaWxlX2luZm9bJ3BhdGgnXSkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YHYtNmEINil2LHYs9in2YQg2KfZhNmB2YrYr9mK2YguINit2KfZiNmEINmF2LHYqSDYo9iu2LHZiS4iLCBjb250ZXh0KQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgYXdhaXQgc2VuZF9tZXNzYWdlKGNoYXRfaWQsICLinYwg2YHYtNmEINi22LrYtyDYp9mE2YHZitiv2YrZiC4g2KrYrdmC2YIg2YXZhiDYp9mE2KXYudiv2KfYr9in2KouIiwgY29udGV4dCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMg2K3YsNmBINij2Yog2YXZhNmB2KfYqiDZhdit2YTZitipINmF2KrYqNmC2YrYqQogICAgICAgICAgICBpZiBsb2NhbF9maWxlX3RvX2RlbGV0ZToKICAgICAgICAgICAgICAgIGRlbGV0ZV9maWxlX3NhZmUobG9jYWxfZmlsZV90b19kZWxldGUpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcm9jZXNzaW5nX3F1ZXVlLnRhc2tfZG9uZSgpCiAgICAgICAgICAgIGlzX3Byb2Nlc3NpbmcgPSBGYWxzZQogICAgICAgICAgICAKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYi4p2MINiu2LfYoyDZgdmKINin2YTZhdi52KfZhNis2Kk6IHtlfSIpCiAgICAgICAgICAgIGlzX3Byb2Nlc3NpbmcgPSBGYWxzZQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEpCgphc3luYyBkZWYgaGFuZGxlX3ZpZGVvKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItmF2LnYp9mE2Kwg2KfZhNmB2YrYr9mK2YgiIiIKICAgIHVzZXJfaWQgPSB1cGRhdGUuZWZmZWN0aXZlX3VzZXIuaWQKICAgIGNoYXRfaWQgPSBzdHIodXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQogICAgCiAgICBpZiB1cGRhdGUubWVzc2FnZS52aWRlbzoKICAgICAgICBmaWxlX2lkID0gdXBkYXRlLm1lc3NhZ2UudmlkZW8uZmlsZV9pZAogICAgICAgIGZpbGVfc2l6ZSA9IHVwZGF0ZS5tZXNzYWdlLnZpZGVvLmZpbGVfc2l6ZQogICAgZWxpZiB1cGRhdGUubWVzc2FnZS5kb2N1bWVudCBhbmQgdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQubWltZV90eXBlIGFuZCB1cGRhdGUubWVzc2FnZS5kb2N1bWVudC5taW1lX3R5cGUuc3RhcnRzd2l0aCgidmlkZW8vIik6CiAgICAgICAgZmlsZV9pZCA9IHVwZGF0ZS5tZXNzYWdlLmRvY3VtZW50LmZpbGVfaWQKICAgICAgICBmaWxlX3NpemUgPSB1cGRhdGUubWVzc2FnZS5kb2N1bWVudC5maWxlX3NpemUKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuCiAgICAKICAgIGZpbGVfc2l6ZV9tYiA9IGZpbGVfc2l6ZSAvICgxMDI0ICogMTAyNCkKICAgIHByaW50KGYi8J+TuSDZgdmK2K/ZitmIINmF2YYge3VzZXJfaWR9IC0ge2ZpbGVfc2l6ZV9tYjouMmZ9IE1CIikKICAgIAogICAgIyDYp9mE2KrYrdmC2YIg2YXZhiDYrdis2YUg2KfZhNmF2YTZgQogICAgaWYgZmlsZV9zaXplID4gRElSRUNUX0RPV05MT0FEX0xJTUlUOgogICAgICAgIGhlbHBfdGV4dCA9IGYiIiIK4p2MICoq2KfZhNmF2YTZgSDZg9io2YrYsSDYrNiv2KfZiyDZhNmE2KrYrdmF2YrZhCDYp9mE2YXYqNin2LTYsSEqKgoK8J+TiiDYrdis2YUg2KfZhNmB2YrYr9mK2Yg6ICoqe2ZpbGVfc2l6ZV9tYjouMmZ9IE1CKioK8J+TjyDYp9mE2K3YryDYp9mE2KPZgti12Ykg2YTZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LE6ICoqMjAgTUIqKgoK4pyFICoq2KfZhNit2YQg2KfZhNiz2YfZhDoqKgox77iP4oOjINin2LHZgdi5INin2YTZgdmK2K/ZitmIINi52YTZiSBHb29nbGUgRHJpdmUg2KPZiCBEcm9wYm94CjLvuI/ig6Mg2KfYrdi12YQg2LnZhNmJINix2KfYqNi3INin2YTYqtit2YXZitmEINin2YTZhdio2KfYtNixCjPvuI/ig6Mg2KPYsdiz2YQg2KfZhNix2KfYqNi3INmH2YbYpwoK8J+TmiAqKtmF2KvYp9mEINmE2YTYsdin2KjYtyDYp9mE2YXYqNin2LTYsToqKgpgaHR0cHM6Ly9kcml2ZS5nb29nbGUuY29tL3VjP2V4cG9ydD1kb3dubG9hZCZpZD1GSUxFX0lEYArYo9mICmBodHRwczovL3d3dy5kcm9wYm94LmNvbS9zL3h4eHh4L3ZpZGVvLm1wND9kbD0xYAoK8J+SoSAqKtmG2LXZitit2Kk6Kiog2YrZhdmD2YbZgyDYp9iz2KrYrtiv2KfZhSDZhdmI2KfZgti5INmF2KvZhDoK4oCiIEdvb2dsZSBEcml2ZTog2LHZgdi5INmF2KzYp9mG2Yog2K3YqtmJIDE1R0IK4oCiIERyb3Bib3g6INix2YHYuSDZhdis2KfZhtmKINit2KrZiSAyR0IK4oCiIE1lZGlhRmlyZTog2LHZgdi5INmF2KzYp9mG2YoKCvCfjq8g2KjYudivINin2YTYsdmB2LnYjCDYo9ix2LPZhCDYp9mE2LHYp9io2Lcg2KfZhNmF2KjYp9i02LEg2YjYs9ij2LbYuti32Ycg2YTZgyEKIiIiCiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChoZWxwX3RleHQpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIGNvbnRleHQudXNlcl9kYXRhWydwZW5kaW5nX3ZpZGVvJ10gPSB7CiAgICAgICAgJ2ZpbGVfaWQnOiBmaWxlX2lkLAogICAgICAgICdmaWxlX3NpemUnOiBmaWxlX3NpemUsCiAgICAgICAgJ2NoYXRfaWQnOiBjaGF0X2lkCiAgICB9CiAgICAKICAgIGtleWJvYXJkID0gWwogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi8J+UpSDYudin2YTZitipICjYrNmI2K/YqSDZhdmF2KrYp9iy2KkpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9oaWdoIildLAogICAgICAgIFtJbmxpbmVLZXlib2FyZEJ1dHRvbigi4pqW77iPINmF2KrZiNiz2LfYqSAo2KrZiNin2LLZhikiLCBjYWxsYmFja19kYXRhPSJxdWFsaXR5X21lZGl1bSIpXSwKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfkr4g2YXZhtiu2YHYttipICjYo9i12LrYsSDYrdis2YUpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV9sb3ciKV0KICAgIF0KICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQogICAgCiAgICBxdWFsaXR5X3RleHQgPSBmIiIiCvCfjqwgKirYp9iu2KrYsSDYrNmI2K/YqSDYp9mE2LbYuti3OioqCgrwn5O5INit2KzZhSDYp9mE2YHZitiv2YrZiDoge2ZpbGVfc2l6ZV9tYjouMmZ9IE1CCgrinKggKirZhdmE2KfYrdi42Kkg2YfYp9mF2KkqKjog2LPZitiq2YUg2KfZhNit2YHYp9i4INi52YTZiSDYo9io2LnYp9ivINin2YTZgdmK2K/ZitmIINin2YTYo9i12YTZitipICjYp9mE2LfZiNmEIMOXINin2YTYudix2LYpCtin2YTYtti62Lcg2LPZitmD2YjZhiDZgdmC2Lcg2KjYqtmC2YTZitmEINin2YTYrNmI2K/YqSDwn46vCgrYp9iu2KrYsSDYp9mE2KzZiNiv2Kkg2KfZhNmF2YbYp9iz2KjYqSDwn5GHCiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHF1YWxpdHlfdGV4dCwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCmFzeW5jIGRlZiBoYW5kbGVfdXJsKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgICIiItmF2LnYp9mE2Kwg2KfZhNix2YjYp9io2LciIiIKICAgICMg2KfZhNiq2K3ZgtmCINmF2YYg2YjYrNmI2K8g2KfZhNmF2LPYqtiu2K/ZhSDZiNin2YTYsdiz2KfZhNipCiAgICBpZiBub3QgdXBkYXRlLm1lc3NhZ2Ugb3Igbm90IHVwZGF0ZS5lZmZlY3RpdmVfdXNlcjoKICAgICAgICByZXR1cm4KICAgIAogICAgdXNlcl9pZCA9IHVwZGF0ZS5lZmZlY3RpdmVfdXNlci5pZAogICAgY2hhdF9pZCA9IHN0cih1cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCiAgICB1cmwgPSB1cGRhdGUubWVzc2FnZS50ZXh0LnN0cmlwKCkKICAgIAogICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCgnaHR0cDovLycsICdodHRwczovLycpKToKICAgICAgICByZXR1cm4KICAgIAogICAgIyDZgtin2KbZhdipINmF2YjYs9i52Kkg2YTZhdmI2KfZgti5INin2YTZgdmK2K/ZitmIINmI2KfZhNiq2K7YstmK2YYg2KfZhNiz2K3Yp9io2YoKICAgIHZpZGVvX3NpdGVzID0gWwogICAgICAgICcubXA0JywgJy5hdmknLCAnLm1vdicsICcubWt2JywgJy5mbHYnLCAnLndtdicsICcud2VibScsCiAgICAgICAgJ2RyaXZlLmdvb2dsZS5jb20nLCAnZHJvcGJveC5jb20nLCAnbWVnYS5ueicsICdtZWRpYWZpcmUuY29tJywKICAgICAgICAnb25lZHJpdmUubGl2ZS5jb20nLCAnYm94LmNvbScsICd3ZXRyYW5zZmVyLmNvbScsCiAgICAgICAgJ3N0cmVhbWFibGUuY29tJywgJ3ZpbWVvLmNvbScsICd5b3V0dWJlLmNvbScsICd5b3V0dS5iZScKICAgIF0KICAgIGlzX2xpa2VseV92aWRlbyA9IGFueShzaXRlIGluIHVybC5sb3dlcigpIGZvciBzaXRlIGluIHZpZGVvX3NpdGVzKQogICAgCiAgICBpZiBub3QgaXNfbGlrZWx5X3ZpZGVvOgogICAgICAgIHJldHVybgogICAgCiAgICBwcmludChmIvCflJcg2LHYp9io2Lcg2YXZhiB7dXNlcl9pZH06IHt1cmx9IikKICAgIAogICAgIyDYqtit2YjZitmEINix2YjYp9io2LcgR29vZ2xlIERyaXZlINmIIERyb3Bib3gg2YTZhNi12YrYutipINin2YTZhdio2KfYtNix2KkKICAgIGRpcmVjdF91cmwgPSB1cmwKICAgIAogICAgIyBHb29nbGUgRHJpdmUKICAgIGlmICdkcml2ZS5nb29nbGUuY29tJyBpbiB1cmw6CiAgICAgICAgaWYgJy9maWxlL2QvJyBpbiB1cmw6CiAgICAgICAgICAgIGZpbGVfaWQgPSB1cmwuc3BsaXQoJy9maWxlL2QvJylbMV0uc3BsaXQoJy8nKVswXQogICAgICAgICAgICBkaXJlY3RfdXJsID0gZiJodHRwczovL2RyaXZlLmdvb2dsZS5jb20vdWM/ZXhwb3J0PWRvd25sb2FkJmlkPXtmaWxlX2lkfSIKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChmIuKchSDYqtmFINiq2K3ZiNmK2YQg2LHYp9io2LcgR29vZ2xlIERyaXZlINmE2YTYtdmK2LrYqSDYp9mE2YXYqNin2LTYsdipISIpCiAgICAgICAgZWxpZiAnaWQ9JyBpbiB1cmw6CiAgICAgICAgICAgICMg2KfZhNix2KfYqNi3INmF2KjYp9i02LEg2KjYp9mE2YHYudmECiAgICAgICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZiLinIUg2LHYp9io2LcgR29vZ2xlIERyaXZlINis2KfZh9iyISIpCiAgICAKICAgICMgRHJvcGJveAogICAgZWxpZiAnZHJvcGJveC5jb20nIGluIHVybDoKICAgICAgICBpZiAnP2RsPTAnIGluIHVybDoKICAgICAgICAgICAgZGlyZWN0X3VybCA9IHVybC5yZXBsYWNlKCc/ZGw9MCcsICc/ZGw9MScpCiAgICAgICAgZWxpZiAnZGw9JyBub3QgaW4gdXJsOgogICAgICAgICAgICBkaXJlY3RfdXJsID0gdXJsICsgKCcmJyBpZiAnPycgaW4gdXJsIGVsc2UgJz8nKSArICdkbD0xJwogICAgICAgIGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZiLinIUg2KrZhSDYqtit2YjZitmEINix2KfYqNi3IERyb3Bib3gg2YTZhNi12YrYutipINin2YTZhdio2KfYtNix2KkhIikKICAgIAogICAgY29udGV4dC51c2VyX2RhdGFbJ3BlbmRpbmdfdmlkZW8nXSA9IHsKICAgICAgICAndXJsJzogZGlyZWN0X3VybCwKICAgICAgICAnY2hhdF9pZCc6IGNoYXRfaWQsCiAgICAgICAgJ29yaWdpbmFsX3VybCc6IHVybAogICAgfQogICAgCiAgICBrZXlib2FyZCA9IFsKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCflKUg2LnYp9mE2YrYqSAo2KzZiNiv2Kkg2YXZhdiq2KfYstipKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfdXJsX2hpZ2giKV0sCiAgICAgICAgW0lubGluZUtleWJvYXJkQnV0dG9uKCLimpbvuI8g2YXYqtmI2LPYt9ipICjYqtmI2KfYstmGKSIsIGNhbGxiYWNrX2RhdGE9InF1YWxpdHlfdXJsX21lZGl1bSIpXSwKICAgICAgICBbSW5saW5lS2V5Ym9hcmRCdXR0b24oIvCfkr4g2YXZhtiu2YHYttipICjYo9i12LrYsSDYrdis2YUpIiwgY2FsbGJhY2tfZGF0YT0icXVhbGl0eV91cmxfbG93IildCiAgICBdCiAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgIAogICAgaGVscF9tZXNzYWdlID0gIiIiCvCfjqwgKirYp9iu2KrYsSDYrNmI2K/YqSDYp9mE2LbYuti3OioqCgrinKgg2LPZitiq2YUg2KfZhNit2YHYp9i4INi52YTZiSDYp9mE2KPYqNi52KfYryDYp9mE2KPYtdmE2YrYqSDZhNmE2YHZitiv2YrZiAoK8J+SoSAqKtmG2LXZitit2Kk6Kiog2KXYsNinINmD2KfZhiDYp9mE2YHZitiv2YrZiCDZhdmGIEdvb2dsZSBEcml2ZSDYo9mIIERyb3Bib3g6CuKAoiDYqtij2YPYryDYo9mGINin2YTYsdin2KjYtyAqKtmF2KjYp9i02LEqKiDZhNmE2KrYrdmF2YrZhArigKIgR29vZ2xlIERyaXZlOiDYp9iz2KrYrtiv2YUg2LHYp9io2Lcg2KjYtdmK2LrYqSBgL3VjP2V4cG9ydD1kb3dubG9hZCZpZD1gCuKAoiBEcm9wYm94OiDYp9iz2KrYrtiv2YUgYD9kbD0xYCDZgdmKINmG2YfYp9mK2Kkg2KfZhNix2KfYqNi3CiIiIgogICAgCiAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGhlbHBfbWVzc2FnZSwgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCiMgPT09PT09PT09PT09PT09PT09PT0g2KfZhNio2LHZhtin2YXYrCDYp9mE2LHYptmK2LPZiiA9PT09PT09PT09PT09PT09PT09PQpkZWYgbWFpbigpOgogICAgIiIi2KfZhNio2LHZhtin2YXYrCDYp9mE2LHYptmK2LPZiiIiIgogICAgcHJpbnQoIvCfmoAg2KrZh9mK2KbYqSDYp9mE2KjZiNiqLi4uIikKICAgIAogICAgIyDYpdmG2LTYp9ihINin2YTZhdis2YTYr9in2Kog2YjYp9mE2YLZiNin2LnYrwogICAgaW5pdF90ZW1wX3N0b3JhZ2UoKQogICAgaW5pdF9kYXRhYmFzZSgpCiAgICAKICAgICMg2KrZhti42YrZgSDYp9mE2YXZhNmB2KfYqiDYp9mE2YLYr9mK2YXYqQogICAgY2xlYW51cF9vbGRfZmlsZXMoKQogICAgCiAgICBwcmludCgi4pyFINin2YTZhti42KfZhSDYrNin2YfYsiIpCiAgICAKICAgICMg2KXZhti02KfYoSDYp9mE2KrYt9io2YrZggogICAgYXBwbGljYXRpb24gPSBBcHBsaWNhdGlvbi5idWlsZGVyKCkudG9rZW4oVEVMRUdSQU1fQk9UX1RPS0VOKS5idWlsZCgpCiAgICAKICAgICMg2KfZhNmF2LnYp9mE2KzYp9iqCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzdGFydF9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhY2NvdW50IiwgbXlfYWNjb3VudF9jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJzZXRhcGlrZXkiLCBzZXRhcGlrZXlfY29tbWFuZCkpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhdHMiLCBzdGF0c19jb21tYW5kKSkKICAgIGFwcGxpY2F0aW9uLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJmaWxlcyIsIGZpbGVzX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImNsZWFudXAiLCBjbGVhbnVwX2NvbW1hbmQpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoYnV0dG9uX2hhbmRsZXIpKQogICAgYXBwbGljYXRpb24uYWRkX2hhbmRsZXIoTWVzc2FnZUhhbmRsZXIoZmlsdGVycy5WSURFTyB8IGZpbHRlcnMuRG9jdW1lbnQuVklERU8sIGhhbmRsZV92aWRlbykpCiAgICBhcHBsaWNhdGlvbi5hZGRfaGFuZGxlcihNZXNzYWdlSGFuZGxlcihmaWx0ZXJzLlRFWFQgJiB+ZmlsdGVycy5DT01NQU5ELCBoYW5kbGVfdXJsKSkKICAgIAogICAgIyDYqNiv2KEg2YXYudin2YTYrCDYp9mE2LfYp9io2YjYsQogICAgYXBwbGljYXRpb24uam9iX3F1ZXVlLnJ1bl9vbmNlKAogICAgICAgIGxhbWJkYSBjb250ZXh0OiBhc3luY2lvLmNyZWF0ZV90YXNrKHByb2Nlc3NfdmlkZW9fcXVldWUoY29udGV4dCkpLAogICAgICAgIHdoZW49MAogICAgKQogICAgCiAgICBwcmludCgi4pyFINin2YTYqNmI2Kog2YrYudmF2YQg2KfZhNii2YYuLi4iKQogICAgcHJpbnQoZiLwn5GRINmF2LnYsdmBINin2YTZhdi02LHZgToge0FETUlOX0lEfSIpCiAgICBwcmludChmIvCfk6Yg2KfZhNiq2K3ZhdmK2YQg2KfZhNmF2KjYp9i02LE6IHtESVJFQ1RfRE9XTkxPQURfTElNSVQvKDEwMjQqMTAyNCk6LjBmfSBNQiIpCiAgICBwcmludChmIvCfk6Yg2KfZhNix2YjYp9io2Lcg2KfZhNiu2KfYsdis2YrYqToge01BWF9GSUxFX1NJWkUvKDEwMjQqMTAyNCk6LjBmfSBNQiIpCiAgICBwcmludCgi8J+OryDYp9mE2YXZitiy2Kkg2KfZhNis2K/Zitiv2Kk6INin2YTYrdmB2KfYuCDYudmE2Ykg2KfZhNij2KjYudin2K8g2KfZhNij2LXZhNmK2KkhIikKICAgIAogICAgIyDYqti02LrZitmEINin2YTYqNmI2KoKICAgICMg2KrZhSDYqti52K/ZitmE2Ycg2YTZhNi52YXZhCDZgdmKIHRocmVhZAoKICAgIGltcG9ydCBhc3luY2lvCgogICAgbG9vcCA9IGFzeW5jaW8ubmV3X2V2ZW50X2xvb3AoKQoKICAgIGFzeW5jaW8uc2V0X2V2ZW50X2xvb3AobG9vcCkKCiAgICBhc3luYyBkZWYgcnVuKCk6CgogICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLmluaXRpYWxpemUoKQoKICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi5zdGFydCgpCgogICAgICAgIGF3YWl0IGFwcGxpY2F0aW9uLnVwZGF0ZXIuc3RhcnRfcG9sbGluZygpCgogICAgICAgIHRyeToKCiAgICAgICAgICAgIHdoaWxlIFRydWU6CgogICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxKQoKICAgICAgICBleGNlcHQ6CgogICAgICAgICAgICBwYXNzCgogICAgICAgIGZpbmFsbHk6CgogICAgICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi51cGRhdGVyLnN0b3AoKQoKICAgICAgICAgICAgYXdhaXQgYXBwbGljYXRpb24uc3RvcCgpCgogICAgICAgICAgICBhd2FpdCBhcHBsaWNhdGlvbi5zaHV0ZG93bigpCgogICAgbG9vcC5ydW5fdW50aWxfY29tcGxldGUocnVuKCkpCgppZiBfX25hbWVfXyA9PSAnX19tYWluX18nOgogICAgbWFpbigpCg==",
}

# ÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
BOTS_NAMES = {
    1: "2.py",
}

# ÿ™ÿ®ÿπŸäÿßÿ™ ŸÉŸÑ ÿ®Ÿàÿ™
BOTS_IMPORTS = {
}

def load_helper_files(bot_num):
    """ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ™Ÿä Ÿäÿ≠ÿ™ÿßÿ¨Ÿáÿß ÿßŸÑÿ®Ÿàÿ™"""
    if bot_num not in BOTS_IMPORTS:
        return
    
    for module_name in BOTS_IMPORTS[bot_num]:
        if module_name in HELPER_FILES:
            try:
                # ŸÅŸÉ ÿßŸÑÿ™ÿ¥ŸÅŸäÿ±
                code = base64.b64decode(HELPER_FILES[module_name]).decode("utf-8")
                
                # ÿ•ŸÜÿ¥ÿßÿ° module
                module = types.ModuleType(module_name)
                
                # ÿ™ŸÜŸÅŸäÿ∞ ÿßŸÑŸÉŸàÿØ
                exec(code, module.__dict__)
                
                # ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑŸÜÿ∏ÿßŸÖ
                sys.modules[module_name] = module
                
                print(f"      ‚úì ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ {module_name}")
            except Exception as e:
                print(f"      ‚ùå ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ {module_name}: {e}")

def run_bot(bot_num):
    bot_name = BOTS_NAMES[bot_num]
    print(f"\nü§ñ ÿ™ÿ¥ÿ∫ŸäŸÑ: {bot_name}")
    bots_status[bot_num] = {"name": bot_name, "status": "starting"}
    try:
        # ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        load_helper_files(bot_num)
        
        # ŸÅŸÉ ÿ™ÿ¥ŸÅŸäÿ± Ÿàÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™
        code = base64.b64decode(BOTS_CODE[bot_num]).decode("utf-8")
        bots_status[bot_num]["status"] = "running"
        exec(code, {"__name__": "__main__"})
    except Exception as e:
        print(f"‚ùå ÿÆÿ∑ÿ£ ŸÅŸä {bot_name}: {e}")
        bots_status[bot_num]["status"] = "error"
        bots_status[bot_num]["error"] = str(e)
        import traceback
        traceback.print_exc()

def main():
    global start_time
    start_time = datetime.now()
    
    print("=" * 70)
    print("üöÄ ÿ™ÿ¥ÿ∫ŸäŸÑ 1 ÿ®Ÿàÿ™ ŸÖÿπ Flask")
    print("=" * 70)
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ Flask
    print("\nüåê ÿ™ÿ¥ÿ∫ŸäŸÑ Flask Server...")
    threading.Thread(target=run_flask, daemon=True).start()
    time.sleep(2)
    print("‚úÖ Flask ŸäÿπŸÖŸÑ")
    
    # ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™
    for bot_num in range(1, 2):
        threading.Thread(target=run_bot, args=(bot_num,), daemon=True).start()
        time.sleep(1.5)
    
    print("\n" + "=" * 70)
    print("‚úÖ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ®Ÿàÿ™ÿßÿ™ ÿ™ÿπŸÖŸÑ!")
    print("üåê Flask: http://0.0.0.0:" + str(os.environ.get("PORT", 8080)))
    print("=" * 70)
    
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n‚õî ÿ™ŸàŸÇŸÅ")

if __name__ == "__main__":
    main()
